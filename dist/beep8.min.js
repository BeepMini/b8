"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}function _readOnlyError(r){throw new TypeError('"'+r+'" is read-only')}var beep8={};(function(beep8){beep8.CONFIG={DEBUG:true,NAME:"beep8 Project",VERSION:"1.0.0-dev",CANVAS_SETTINGS:{CANVAS_ID:"beep8-canvas",CANVAS_CLASSES:[],CONTAINER:null},SFX:{TYPING:"click",MENU_UP:"blip",MENU_DOWN:"blip2",MENU_SELECT:"blip3"},FONT_DEFAULT:"../assets/font-default.png",FONT_TILES:"../assets/font-tiles.png",FONT_ACTORS:"../assets/font-actors.png",CHRS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*+=-<>_#&@%^~$£€¥¢!?:;'\"/\\()[]{}.,©®™•…| ",CHR_WIDTH:12,CHR_HEIGHT:12,SCREEN_ROWS:30,SCREEN_COLS:24,SCREEN_COLORS:1,CRT_ENABLE:.3,CRT_VIGNETTE:true,COLORS:["#0A0C1F","#263264","#A0ABB6","#B2EFEB","#3FB0F1","#3548A3","#420241","#6A3E49","#C22D44","#E08355","#FFC763","#A7D171","#30AB62","#1E7F82","#FF76D7","#F4F4F4"],PASSKEY:"beep8IsAwesome",TOUCH_VJOY:true,CURSOR:{WIDTH_F:.8,HEIGHT_F:.8,BLINK_INTERVAL:400,OFFSET_V:.1,OFFSET_H:0},PRINT_ESCAPE_START:"{{",PRINT_ESCAPE_END:"}}",BORDER_CHAR:54}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.init=function(callback){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};beep8.Utilities.checkFunction("callback",callback);beep8.Utilities.checkObject("options",options);if(options!==null){beep8.CONFIG=beep8.Utilities.deepMerge(beep8.CONFIG,options)}return beep8.Core.init(callback)};beep8.frame=function(){var renderHandler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var updateHandler=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var fps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:30;beep8.Core.preflight("beep8.frame");if(renderHandler!==null){beep8.Utilities.checkFunction("render handler",renderHandler)}if(updateHandler!==null){beep8.Utilities.checkFunction("update handler",updateHandler)}beep8.Utilities.checkNumber("fps",fps);return beep8.Core.setFrameHandlers(renderHandler,updateHandler,fps)};beep8.render=function(){beep8.Core.preflight("beep8.render");return beep8.Renderer.render()};beep8.color=function(fg){var bg=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;beep8.Core.preflight("beep8.color");beep8.Utilities.checkNumber("fg",fg);if(bg!==undefined){beep8.Utilities.checkNumber("bg",bg)}beep8.Core.setColor(fg,bg)};beep8.getFgColor=function(){beep8.Core.preflight("getFgColor");return beep8.Core.drawState.fgColor};beep8.getBgColor=function(){beep8.Core.preflight("beep8.getBgColor");return beep8.Core.drawState.bgColor};beep8.cls=function(){var bgColor=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;beep8.Core.preflight("beep8.Core.cls");beep8.Core.cls(bgColor)};beep8.locate=function(col,row){beep8.Core.preflight("beep8.locate");beep8.Utilities.checkNumber("col",col);if(row!==undefined){beep8.Utilities.checkNumber("row",row)}beep8.Core.setCursorLocation(col,row)};beep8.col=function(){beep8.Core.preflight("col");return beep8.Core.drawState.cursorCol};beep8.row=function(){beep8.Core.preflight("row");return beep8.Core.drawState.cursorRow};beep8.cursor=function(visible){beep8.Core.preflight("cursor");beep8.Utilities.checkBoolean("visible",visible);beep8.CursorRenderer.setCursorVisible(visible)};beep8.print=function(text){var wrapWidth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var fontId=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;beep8.Core.preflight("beep8.text");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("wrapWidth",wrapWidth);var font=fontId;if(null!==font){beep8.Utilities.checkString("fontId",fontId);font=beep8.TextRenderer.getFontByName(fontId)}beep8.TextRenderer.print(text,font,wrapWidth)};beep8.printCentered=function(text,width){var fontId=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;beep8.Core.preflight("beep8.printCentered");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("width",width);var font=fontId;if(null!==font){beep8.Utilities.checkString("fontId",fontId);font=beep8.TextRenderer.getFontByName(fontId)}beep8.TextRenderer.printCentered(text,width,font)};beep8.drawText=function(x,y,text){var fontId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;beep8.Core.preflight("beep8.drawText");beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkString("text",text);if(fontId){beep8.Utilities.checkString("fontId",fontId)}beep8.TextRenderer.drawText(x,y,text,fontId)};beep8.measure=function(text){beep8.Core.preflight("measure");beep8.Utilities.checkString("text",text);return beep8.TextRenderer.measure(text)};beep8.printChar=function(charCode){var numTimes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var fontId=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;beep8.Core.preflight("beep8.printChar");charCode=beep8.convChar(charCode);beep8.Utilities.checkInt("charCode",charCode);beep8.Utilities.checkInt("numTimes",numTimes);if(numTimes<0){beep8.Utilities.fatal("[beep8.printChar] numTimes must be a positive integer")}if(0===numTimes){return}var font=fontId;if(null!==font){beep8.Utilities.checkString("fontId",fontId);font=beep8.TextRenderer.getFontByName(fontId)}beep8.TextRenderer.printChar(charCode,numTimes,font)};beep8.printRect=function(widthCols,heightRows){var charCode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:8;beep8.Core.preflight("beep8.printRect");charCode=beep8.convChar(charCode);beep8.Utilities.checkNumber("widthCols",widthCols);beep8.Utilities.checkNumber("heightRows",heightRows);beep8.Utilities.checkNumber("charCode",charCode);beep8.TextRenderer.printRect(widthCols,heightRows,charCode)};beep8.printBox=function(widthCols,heightRows){var fill=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var borderChar=arguments.length>3&&arguments[3]!==undefined?arguments[3]:beep8.CONFIG.BORDER_CHAR;beep8.Core.preflight("beep8.printBox");borderChar=beep8.convChar(borderChar);beep8.Utilities.checkNumber("widthCols",widthCols);beep8.Utilities.checkNumber("heightRows",heightRows);beep8.Utilities.checkBoolean("fill",fill);beep8.Utilities.checkNumber("borderChar",borderChar);beep8.TextRenderer.printBox(widthCols,heightRows,fill,borderChar)};beep8.drawImage=function(x,y,image){beep8.Utilities.checkInstanceOf("image",image,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Core.drawImage(image,x,y)};beep8.drawImageRect=function(x,y,image,srcX,srcY,width,height){beep8.Utilities.checkInstanceOf("image",image,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("srcX",srcX);beep8.Utilities.checkNumber("srcY",srcY);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.drawImage(image,x,y,srcX,srcY,width,height)};beep8.drawRect=function(x,y,width,height){var lineWidth=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkNumber("lineWidth",lineWidth);beep8.Core.drawRect(x,y,width,height,lineWidth)};beep8.fillRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.fillRect(x,y,width,height)};beep8.playSound=function(sfx){var volume=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var loop=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;beep8.Utilities.checkInstanceOf("sfx",sfx,HTMLAudioElement);sfx.currentTime=0;sfx.volume=volume;sfx.loop=loop;sfx.play()};beep8.spr=function(ch,x,y){ch=beep8.convChar(ch);beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.TextRenderer.spr(ch,x,y)};beep8.drawActor=function(ch,animation){ch=beep8.convChar(ch);beep8.Utilities.checkInt("ch",ch);beep8.Utilities.checkString("animation",animation);beep8.Actors.draw(ch,animation)};beep8.sprActor=function(ch,animation,x,y){var startTime=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;ch=beep8.convChar(ch);beep8.Utilities.checkInt("ch",ch);beep8.Utilities.checkString("animation",animation);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);return beep8.Actors.spr(ch,animation,x,y,startTime)};beep8.key=function(keyName){beep8.Core.preflight("beep8.key");beep8.Utilities.checkString("keyName",keyName);return beep8.Input.keyHeld(keyName)};beep8.playSong=function(song){beep8.Utilities.checkString("song",song);beep8.Sound.playSong(song)};beep8.playSfx=function(sfx){beep8.Utilities.checkString("sfx",sfx);beep8.Sfx.play(sfx)};beep8.keyp=function(keyName){beep8.Core.preflight("beep8.keyp");beep8.Utilities.checkString("keyName",keyName);return beep8.Input.keyJustPressed(keyName)};beep8.redefineColors=function(colors){beep8.Core.preflight("beep8.redefineColors");beep8.Utilities.checkArray("colors",colors);beep8.Core.defineColors(colors)};beep8.setFont=function(fontId){beep8.Core.preflight("beep8.setFont");fontId=fontId||"default";beep8.Utilities.checkString("fontId",fontId);beep8.TextRenderer.setFont(fontId)};beep8.getFont=function(){beep8.Core.preflight("beep8.getFont");beep8.TextRenderer.getFont()};beep8.getFontByName=function(fontName){beep8.Utilities.checkString("fontName",fontName);return beep8.TextRenderer.getFontByName(fontName)};beep8.setTileFont=function(fontId){beep8.Core.preflight("beep8.setTileFont");fontId=fontId||"tiles";beep8.Utilities.checkString("fontId",fontId);beep8.TextRenderer.setTileFont(fontId)};beep8.convChar=function(charCode){if(typeof charCode==="string"&&charCode.length>0){return charCode.charCodeAt(0)}return charCode};beep8.stopSound=function(sfx){beep8.Utilities.checkInstanceOf("sfx",sfx,HTMLAudioElement);sfx.currentTime=0;sfx.pause()};beep8.getContext=function(){return beep8.Core.getContext()};beep8.saveScreen=function(){return beep8.Core.saveScreen()};beep8.restoreScreen=function(screenData){return beep8.Core.restoreScreen(screenData)};beep8.wrapText=function(text,width){beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("width",width);return beep8.TextRenderer.wrapText(text,width)};beep8.addScene=function(name){var update=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};beep8.Scene.add(name,update)};beep8.switchScene=function(name){beep8.Scene.switchScene(name)};beep8.getScene=function(){return beep8.Scene.get()}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Async={};beep8.Async.key=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:beep8.Core.preflight("beep8.Async.key");_context.next=3;return beep8.Input.readKeyAsync();case 3:return _context.abrupt("return",_context.sent);case 4:case"end":return _context.stop()}},_callee)}));beep8.Async.pointer=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:beep8.Core.preflight("beep8.Async.pointer");_context2.next=3;return beep8.Input.readPointerAsync();case 3:return _context2.abrupt("return",_context2.sent);case 4:case"end":return _context2.stop()}},_callee2)}));beep8.Async.readLine=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(){var initString,maxLen,maxWidth,_args3=arguments;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:initString=_args3.length>0&&_args3[0]!==undefined?_args3[0]:"";maxLen=_args3.length>1&&_args3[1]!==undefined?_args3[1]:-1;maxWidth=_args3.length>2&&_args3[2]!==undefined?_args3[2]:-1;beep8.Core.preflight("beep8.Async.readLine");beep8.Utilities.checkString("initString",initString);beep8.Utilities.checkNumber("maxLen",maxLen);_context3.next=8;return beep8.Input.readLine(initString,maxLen,maxWidth);case 8:return _context3.abrupt("return",_context3.sent);case 9:case"end":return _context3.stop()}},_callee3)}));beep8.Async.menu=function(){var _ref4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(choices){var options,_args4=arguments;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:options=_args4.length>1&&_args4[1]!==undefined?_args4[1]:{};beep8.Core.preflight("beep8.Async.menu");beep8.Utilities.checkArray("choices",choices);beep8.Utilities.checkObject("options",options);_context4.next=6;return beep8.Menu.display(choices,options);case 6:return _context4.abrupt("return",_context4.sent);case 7:case"end":return _context4.stop()}},_callee4)}));return function(_x){return _ref4.apply(this,arguments)}}();beep8.Async.dialog=function(){var _ref5=_asyncToGenerator(_regeneratorRuntime().mark(function _callee5(prompt){var choices,_args5=arguments;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:choices=_args5.length>1&&_args5[1]!==undefined?_args5[1]:["OK"];beep8.Core.preflight("beep8.Async.dialog");beep8.Utilities.checkString("prompt",prompt);beep8.Utilities.checkArray("choices",choices);return _context5.abrupt("return",beep8.Async.menu(choices,{prompt:prompt,center:true}));case 5:case"end":return _context5.stop()}},_callee5)}));return function(_x2){return _ref5.apply(this,arguments)}}();beep8.Async.dialogTypewriter=function(){var _ref6=_asyncToGenerator(_regeneratorRuntime().mark(function _callee6(prompt){var choices,wrapWidth,delay,_args6=arguments;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:choices=_args6.length>1&&_args6[1]!==undefined?_args6[1]:["OK"];wrapWidth=_args6.length>2&&_args6[2]!==undefined?_args6[2]:-1;delay=_args6.length>3&&_args6[3]!==undefined?_args6[3]:.05;beep8.Core.preflight("beep8.Async.dialogTypewriter");beep8.Utilities.checkString("prompt",prompt);beep8.Utilities.checkArray("choices",choices);beep8.Utilities.checkNumber("delay",delay);if(wrapWidth>0){prompt=beep8.TextRenderer.wrapText(prompt,wrapWidth)}_context6.next=10;return beep8.Async.menu(choices,{prompt:prompt,typewriter:true});case 10:return _context6.abrupt("return",_context6.sent);case 11:case"end":return _context6.stop()}},_callee6)}));return function(_x3){return _ref6.apply(this,arguments)}}();beep8.Async.typewriter=function(){var _ref7=_asyncToGenerator(_regeneratorRuntime().mark(function _callee7(text){var wrapWidth,delay,fontId,font,_args7=arguments;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:wrapWidth=_args7.length>1&&_args7[1]!==undefined?_args7[1]:-1;delay=_args7.length>2&&_args7[2]!==undefined?_args7[2]:.05;fontId=_args7.length>3&&_args7[3]!==undefined?_args7[3]:null;beep8.Core.preflight("beep8.Async.typewriter");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("wrapWidth",wrapWidth);beep8.Utilities.checkNumber("delay",delay);font=fontId;if(null!==font){beep8.Utilities.checkString("fontId",fontId);font=beep8.TextRenderer.getFontByName(fontId)}_context7.next=11;return beep8.TextRenderer.printTypewriter(text,wrapWidth,delay,font);case 11:case"end":return _context7.stop()}},_callee7)}));return function(_x4){return _ref7.apply(this,arguments)}}();beep8.Async.loadImage=function(){var _ref8=_asyncToGenerator(_regeneratorRuntime().mark(function _callee8(url){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:beep8.Core.preflight("beep8.Async.loadImage");return _context8.abrupt("return",new Promise(function(resolve){var img=new Image;img.onload=function(){return resolve(img)};img.src=url}));case 2:case"end":return _context8.stop()}},_callee8)}));return function(_x5){return _ref8.apply(this,arguments)}}();beep8.Async.loadSound=function(){var _ref9=_asyncToGenerator(_regeneratorRuntime().mark(function _callee9(url){return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:beep8.Core.preflight("beep8.Async.loadSound");return _context9.abrupt("return",new Promise(function(resolve){var audio=new Audio;audio.oncanplaythrough=function(){return resolve(audio)};audio.src=url;audio.load()}));case 2:case"end":return _context9.stop()}},_callee9)}));return function(_x6){return _ref9.apply(this,arguments)}}();beep8.Async.loadFont=function(){var _ref10=_asyncToGenerator(_regeneratorRuntime().mark(function _callee10(fontImageFile){var tileSizeMultiplier,fontName,_args10=arguments;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:tileSizeMultiplier=_args10.length>1&&_args10[1]!==undefined?_args10[1]:1;beep8.Core.preflight("beep8.Async.loadFont");beep8.Utilities.checkString("fontImageFile",fontImageFile);fontName="FONT@"+beep8.Utilities.makeUrlPretty(fontImageFile);_context10.next=6;return beep8.TextRenderer.loadFontAsync(fontName,fontImageFile,tileSizeMultiplier);case 6:return _context10.abrupt("return",fontName);case 7:case"end":return _context10.stop()}},_callee10)}));return function(_x7){return _ref10.apply(this,arguments)}}();beep8.Async.wait=function(){var _ref11=_asyncToGenerator(_regeneratorRuntime().mark(function _callee11(seconds){return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:beep8.Core.preflight("beep8.Async.wait");beep8.Utilities.checkNumber("seconds",seconds);beep8.Renderer.render();_context11.next=5;return new Promise(function(resolve){return setTimeout(resolve,Math.round(seconds*1e3))});case 5:return _context11.abrupt("return",_context11.sent);case 6:case"end":return _context11.stop()}},_callee11)}));return function(_x8){return _ref11.apply(this,arguments)}}();beep8.Async.waitForContinue=_asyncToGenerator(_regeneratorRuntime().mark(function _callee12(){var key;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:if(!true){_context12.next=8;break}_context12.next=3;return beep8.Async.key();case 3:key=_context12.sent;if(!(key.includes("Enter")||key.includes("ButtonA"))){_context12.next=6;break}return _context12.abrupt("break",8);case 6:_context12.next=0;break;case 8:case"end":return _context12.stop()}},_callee12)}))})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Actors={};beep8.Actors.animations={idle:{frames:[0],fps:1,loop:true},"move-right":{frames:[1,2],fps:4,loop:true},"move-left":{frames:[-1,-2],fps:4,loop:true},"move-up":{frames:[4,-4],fps:4,loop:true},"move-down":{frames:[3,-3],fps:4,loop:true},"jump-right":{frames:[5],fps:1,loop:false},"jump-left":{frames:[-5],fps:1,loop:false},"spin-left":{frames:[0,1,4,-1],fps:4,loop:true},"spin-right":{frames:[0,-1,4,1],fps:4,loop:true}};var drawActor=function drawActor(ch,animation,x,y,direction){var font=beep8.TextRenderer.curActors_;var chrIndex=ch*font.getColCount()+Math.abs(animationFrame(animation));beep8.TextRenderer.spr(chrIndex,x,y,font,direction||0)};beep8.Actors.draw=function(ch,animation){beep8.Utilities.checkInt("ch",ch);beep8.Utilities.checkString("animation",animation);var frame=animationFrame(animation);var direction=frame>=0?0:1;drawActor(ch,animation,beep8.Core.drawState.cursorCol*beep8.CONFIG.CHR_WIDTH,beep8.Core.drawState.cursorRow*beep8.CONFIG.CHR_HEIGHT,direction||0)};beep8.Actors.spr=function(ch,animation,x,y){var startTime=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;beep8.Utilities.checkInt("ch",ch);beep8.Utilities.checkString("animation",animation);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);if(startTime!==null)beep8.Utilities.checkNumber("startTime",startTime);var frame=animationFrame(animation,startTime);var anim=beep8.Actors.animations[animation];var direction=frame>=0?0:1;if(!shouldLoopAnimation(anim,startTime)){return false}drawActor(ch,animation,x,y,direction||0);return true};var animationFrame=function animationFrame(animation){var startTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(beep8.Actors.animations[animation]===undefined){beep8.Utilities.fatal("Invalid animation: "+animation)}if(startTime===null){startTime=beep8.Core.startTime}var anim=beep8.Actors.animations[animation];var frame=0;if(anim.frames.length===1){frame=anim.frames[0]}if(anim.frames.length>1){var totalTime=beep8.Core.getNow()-startTime;var frameCount=anim.frames.length;var frameDuration=1/anim.fps;var frameIndex=Math.floor(totalTime/1e3/frameDuration%frameCount);frame=anim.frames[frameIndex]}return frame};var shouldLoopAnimation=function shouldLoopAnimation(anim,startTime){if(startTime===null||anim.loop===true){return true}var animationLength=anim.frames.length*(1e3/anim.fps);if(beep8.Core.getNow()-startTime>=animationLength){return false}return true}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Collision={};beep8.COLLISION={};beep8.COLLISION.NONE=0;beep8.COLLISION.N=1;beep8.COLLISION.E=2;beep8.COLLISION.S=4;beep8.COLLISION.W=8;beep8.COLLISION.NE=beep8.COLLISION.N+beep8.COLLISION.E;beep8.COLLISION.NS=beep8.COLLISION.N+beep8.COLLISION.S;beep8.COLLISION.NW=beep8.COLLISION.N+beep8.COLLISION.W;beep8.COLLISION.SE=beep8.COLLISION.S+beep8.COLLISION.E;beep8.COLLISION.SW=beep8.COLLISION.S+beep8.COLLISION.W;beep8.COLLISION.WE=beep8.COLLISION.W+beep8.COLLISION.E;beep8.COLLISION.WNE=beep8.COLLISION.W+beep8.COLLISION.N+beep8.COLLISION.E;beep8.COLLISION.WES=beep8.COLLISION.W+beep8.COLLISION.E+beep8.COLLISION.S;beep8.COLLISION.NES=beep8.COLLISION.N+beep8.COLLISION.E+beep8.COLLISION.S;beep8.COLLISION.ALL=beep8.COLLISION.N+beep8.COLLISION.E+beep8.COLLISION.S+beep8.COLLISION.W})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Core={};beep8.Core.realCanvas=null;beep8.Core.realCtx=null;beep8.Core.canvas=null;beep8.Core.ctx=null;beep8.Core.container=null;beep8.Core.startTime=0;beep8.Core.deltaTime=0;beep8.Core.crashed=false;beep8.Core.crashing=false;beep8.Core.state=null;beep8.Core.drawState={fgColor:7,bgColor:0,cursorCol:0,cursorRow:0,cursorVisible:false};var lastFrameTime=null;var initDone=false;var updateHandler=null;var renderHandler=null;var targetDt=0;var timeToNextFrame=0;var pendingAsync=null;beep8.Core.init=function(callback){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};beep8.Utilities.checkFunction("callback",callback);if(options){beep8.Utilities.checkObject("options",options)}beep8.CONFIG=_objectSpread(_objectSpread({},beep8.CONFIG),options);beep8.Core.initScreenshot();beep8.Core.asyncInit(callback);beep8.Core.startTime=beep8.Core.getNow()};beep8.Core.initialized=function(){return initDone};beep8.Core.asyncInit=_asyncToGenerator(_regeneratorRuntime().mark(function _callee13(){var callback,_iterator,_step,className,_args13=arguments;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:callback=_args13.length>0&&_args13[0]!==undefined?_args13[0]:null;beep8.Utilities.log("beep8 System initializing");beep8.CONFIG.SCREEN_WIDTH=beep8.CONFIG.SCREEN_COLS*beep8.CONFIG.CHR_WIDTH;beep8.CONFIG.SCREEN_HEIGHT=beep8.CONFIG.SCREEN_ROWS*beep8.CONFIG.CHR_HEIGHT;beep8.Core.realCanvas=document.createElement("canvas");if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CANVAS_ID){beep8.Core.realCanvas.setAttribute("id",beep8.CONFIG.CANVAS_SETTINGS.CANVAS_ID)}if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES){_iterator=_createForOfIteratorHelper(beep8.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES);try{for(_iterator.s();!(_step=_iterator.n()).done;){className=_step.value;beep8.Core.realCanvas.classList.add(className)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}beep8.Core.realCanvas.style.touchAction="none";beep8.Core.realCanvas.style.userSelect="none";beep8.Core.realCanvas.style.imageRendering="pixelated";beep8.Core.realCanvas.addEventListener("touchstart",function(e){return e.preventDefault()});beep8.Core.container=document.createElement("div");beep8.Core.container.setAttribute("style","");beep8.Core.container.id="beep8";beep8.Core.container.style.display="block";beep8.Core.container.style.lineHeight="0";beep8.Core.container.style.position="relative";beep8.Core.container.appendChild(beep8.Core.realCanvas);beep8.Core.getBeepContainerEl().appendChild(beep8.Core.container);beep8.Core.canvas=document.createElement("canvas");beep8.Core.canvas.width=beep8.CONFIG.SCREEN_WIDTH;beep8.Core.canvas.height=beep8.CONFIG.SCREEN_HEIGHT;beep8.Core.canvas.style.width=beep8.CONFIG.SCREEN_WIDTH+"px";beep8.Core.canvas.style.height=beep8.CONFIG.SCREEN_HEIGHT+"px";beep8.Core.ctx=beep8.Core.canvas.getContext("2d");beep8.Core.ctx.imageSmoothingEnabled=false;beep8.Core.state=new beep8.State;_context13.next=29;return beep8.TextRenderer.initAsync();case 29:beep8.Input.init();beep8.Core.updateLayout(false);window.addEventListener("resize",function(){return beep8.Core.updateLayout(true)});if(beep8.Core.isMobile()){beep8.Joystick.setup()}initDone=true;beep8.Utilities.log("beep8 System initialized");_context13.next=37;return beep8.Intro.loading();case 37:_context13.next=39;return beep8.Intro.splash();case 39:if(!callback){_context13.next=42;break}_context13.next=42;return callback();case 42:case"end":return _context13.stop()}},_callee13)}));beep8.Core.getBeepContainerEl=function(){var container=document.body;if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CONTAINER){var containerSpec=beep8.CONFIG.CANVAS_SETTINGS.CONTAINER;if(typeof containerSpec==="string"){container=document.getElementById(containerSpec.replace("#",""));if(!container){beep8.Utilities.fatal("beep8: Could not find container element with ID: "+containerSpec)}}else if(containerSpec instanceof HTMLElement){container=containerSpec}else{console.error("beep8: beep8.CONFIG.CANVAS_SETTINGS.CONTAINER must be either an ID of an HTMLElement.");container=document.body}}return container};beep8.Core.preflight=function(apiMethod){if(beep8.Core.crashed){throw new Error("Can't call API method ".concat(apiMethod,"() because the engine has crashed."))}if(!initDone){beep8.Utilities.fatal("Can't call API method ".concat(apiMethod,"(): API not initialized. ")+"Call initAsync() wait until it finishes before calling API methods.")}if(pendingAsync){beep8.Utilities.fatal("Can't call API method ".concat(apiMethod,"() because there is a pending async ")+"call to ".concat(pendingAsync.name,"() that hasn't finished running yet. Are you missing ")+"an 'await' keyword to wait for the async method? Use 'await ".concat(pendingAsync.name,"()',")+"not just '".concat(pendingAsync.name,"()'"))}};beep8.Core.startAsync=function(asyncMethodName,resolve,reject){if(pendingAsync){throw new Error("Internal bug: startAsync called while pendingAsync is not null. "+"Missing preflight() call?")}pendingAsync={name:asyncMethodName,resolve:resolve,reject:reject};beep8.Renderer.render()};beep8.Core.hasPendingAsync=function(asyncMethodName){return pendingAsync&&pendingAsync.name===asyncMethodName};beep8.Core.endAsyncImpl=function(asyncMethodName,isError,result){if(!pendingAsync){throw new Error("Internal bug: endAsync(".concat(asyncMethodName,") called with no pendingAsync"))}if(pendingAsync.name!==asyncMethodName){throw new Error("Internal bug: endAsync(".concat(asyncMethodName,") called but pendingAsync.name ")+"is ".concat(pendingAsync.name))}var fun=isError?pendingAsync.reject:pendingAsync.resolve;pendingAsync=null;fun(result)};beep8.Core.resolveAsync=function(asyncMethodName,result){beep8.Core.endAsyncImpl(asyncMethodName,false,result)};beep8.Core.failAsync=function(asyncMethodName,error){beep8.Core.endAsyncImpl(asyncMethodName,true,error)};var running=false;var animationFrameId=null;beep8.Core.setFrameHandlers=function(){var renderCallback=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var updateCallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var targetFps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:30;updateHandler=updateCallback||function(){};renderHandler=renderCallback||function(){};targetDt=1/targetFps;timeToNextFrame=0;lastFrameTime=beep8.Core.getNow();if(animationFrameId){window.cancelAnimationFrame(animationFrameId);animationFrameId=null}running=true;animationFrameId=window.requestAnimationFrame(beep8.Core.doFrame)};beep8.Core.doFrame=_asyncToGenerator(_regeneratorRuntime().mark(function _callee14(){var now,delta,numUpdates,MAX_UPDATES,i;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:if(running){_context14.next=2;break}return _context14.abrupt("return");case 2:now=beep8.Core.getNow();delta=(now-lastFrameTime)/1e3;lastFrameTime=now;delta=Math.min(delta,.05);timeToNextFrame+=delta;numUpdates=Math.floor(timeToNextFrame/targetDt);MAX_UPDATES=10;if(numUpdates>MAX_UPDATES){numUpdates=MAX_UPDATES;timeToNextFrame=0}for(i=0;i<numUpdates;i++){if(updateHandler){updateHandler(targetDt)}if(beep8.Input&&typeof beep8.Input.onEndFrame==="function"){beep8.Input.onEndFrame()}beep8.Particles.update(targetDt)}timeToNextFrame%=targetDt;if(renderHandler){renderHandler()}beep8.Renderer.render();animationFrameId=window.requestAnimationFrame(beep8.Core.doFrame);case 15:case"end":return _context14.stop()}},_callee14)}));beep8.Core.stopFrame=function(){running=false;if(animationFrameId){window.cancelAnimationFrame(animationFrameId);animationFrameId=null}};beep8.Core.cls=function(){var bgColor=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;bgColor=bgColor||beep8.Core.drawState.bgColor;beep8.Utilities.checkNumber("bgColor",bgColor);beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(bgColor);beep8.Core.ctx.fillRect(0,0,beep8.Core.canvas.width,beep8.Core.canvas.height);beep8.Core.setCursorLocation(0,0);beep8.Renderer.markDirty()};beep8.Core.defineColors=function(colors){beep8.Utilities.checkArray("colors",colors);beep8.CONFIG.COLORS=colors.slice();beep8.TextRenderer.regenColors()};beep8.Core.setColor=function(fg){var bg=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;beep8.Utilities.checkNumber("fg",fg);beep8.Core.drawState.fgColor=Math.round(fg);if(bg!==undefined){beep8.Utilities.checkNumber("bg",bg);beep8.Core.drawState.bgColor=Math.round(bg)}};beep8.Core.setCursorLocation=function(col,row){beep8.Utilities.checkNumber("col",col);if(row!==undefined){beep8.Utilities.checkNumber("row",row)}beep8.Core.drawState.cursorCol=Math.round(col);if(row!==undefined){beep8.Core.drawState.cursorRow=Math.round(row)}};beep8.Core.nextCursorLocation=function(){var currentCursorCol=beep8.Core.drawState.cursorCol;var currentCursorRow=beep8.Core.drawState.cursorRow;beep8.Core.setCursorLocation(currentCursorCol+1,currentCursorRow)};beep8.Core.getColorHex=function(c){if(typeof c!=="number"){return"#f0f"}if(c<0){return"#000"}c=beep8.Utilities.clamp(Math.round(c),0,beep8.CONFIG.COLORS.length-1);return beep8.CONFIG.COLORS[c]};beep8.Core.getNow=function(){if(window.performance&&window.performance.now){return window.performance.now()}return(new Date).getTime()};beep8.Core.drawImage=function(img,x,y,srcX,srcY,width,height){beep8.Utilities.checkInstanceOf("img",img,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);if(srcX!==undefined)beep8.Utilities.checkNumber("srcX",srcX);if(srcY!==undefined)beep8.Utilities.checkNumber("srcY",srcY);if(width!==undefined)beep8.Utilities.checkNumber("width",width);if(height!==undefined)beep8.Utilities.checkNumber("height",height);if(srcX!==undefined&&srcY!==undefined&&width!==undefined&&height!==undefined){beep8.Core.ctx.drawImage(img,srcX,srcY,width,height,x,y,width,height)}else{beep8.Core.ctx.drawImage(img,x,y)}};beep8.Core.drawRect=function(x,y,width,height){var lineWidth=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkNumber("lineWidth",lineWidth);var oldStrokeStyle=beep8.Core.ctx.strokeStyle;var oldLineWidth=beep8.Core.ctx.lineWidth;var halfLineWidth=lineWidth/2;beep8.Core.ctx.strokeStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);beep8.Core.ctx.lineWidth=lineWidth;beep8.Core.ctx.strokeRect(Math.round(x),Math.round(y),Math.round(width),Math.round(height));console.log(lineWidth,Math.round(x)+halfLineWidth,Math.round(y)+halfLineWidth,Math.round(width)-lineWidth,Math.round(height)-lineWidth);beep8.Core.ctx.strokeStyle=oldStrokeStyle;beep8.Core.ctx.lineWidth=oldLineWidth};beep8.Core.fillRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);beep8.Core.ctx.fillRect(Math.round(x)+.5,Math.round(y)+.5,Math.round(width)-1,Math.round(height)-1)};beep8.Core.initScreenshot=function(){if(beep8.Core.initialized()){return}document.addEventListener("keyup",function(e){if(e.key==="0"){beep8.Core.downloadScreenshot()}})};beep8.Core.saveScreen=function(){return beep8.Core.ctx.getImageData(0,0,beep8.Core.canvas.width,beep8.Core.canvas.height)};beep8.Core.downloadScreenshot=function(){var dataUrl=beep8.Core.getHighResDataURL(beep8.Core.realCanvas);beep8.Utilities.downloadFile("beep8-screenshot.png",dataUrl)};beep8.Core.getHighResDataURL=function(canvas){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var mimeType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"image/png";var quality=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var offscreenCanvas=document.createElement("canvas");offscreenCanvas.width=canvas.width*scale;offscreenCanvas.height=canvas.height*scale;var offscreenCtx=offscreenCanvas.getContext("2d");offscreenCtx.imageSmoothingEnabled=false;offscreenCtx.scale(scale,scale);offscreenCtx.drawImage(canvas,0,0);return offscreenCanvas.toDataURL(mimeType,quality)};beep8.Core.restoreScreen=function(screenData){beep8.Utilities.checkInstanceOf("screenData",screenData,ImageData);beep8.Core.ctx.putImageData(screenData,0,0)};beep8.Core.updateLayout=function(renderNow){beep8.Core.updateLayout2d();if(renderNow){beep8.Renderer.render()}};beep8.Core.updateLayout2d=function(){beep8.Core.realCtx=beep8.Core.realCanvas.getContext("2d");beep8.Core.realCtx.imageSmoothingEnabled=false;beep8.CONFIG.SCREEN_EL_WIDTH=beep8.CONFIG.SCREEN_WIDTH;beep8.CONFIG.SCREEN_EL_HEIGHT=beep8.CONFIG.SCREEN_HEIGHT;beep8.CONFIG.SCREEN_REAL_WIDTH=beep8.CONFIG.SCREEN_WIDTH;beep8.CONFIG.SCREEN_REAL_HEIGHT=beep8.CONFIG.SCREEN_HEIGHT;beep8.Core.realCanvas.style.width="100%";beep8.Core.realCanvas.style.height="100%";beep8.Core.realCanvas.style.filter="blur(0.5px)";beep8.Core.realCanvas.width=beep8.CONFIG.SCREEN_REAL_WIDTH;beep8.Core.realCanvas.height=beep8.CONFIG.SCREEN_REAL_HEIGHT;beep8.Core.container.style.aspectRatio="".concat(beep8.CONFIG.SCREEN_COLS," / ").concat(beep8.CONFIG.SCREEN_ROWS)};beep8.Core.handleCrash=function(){var errorMessage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"Fatal error";if(beep8.Core.crashed||beep8.Core.crashing)return;beep8.Core.crashing=true;beep8.Core.setColor(beep8.CONFIG.COLORS.length-1,0);beep8.Core.cls();beep8.Core.setCursorLocation(1,1);beep8.TextRenderer.print("*** CRASH ***:\n"+errorMessage,null,beep8.CONFIG.SCREEN_COLS-2);beep8.Renderer.render();beep8.Core.crashing=false;beep8.Core.crashed=true};beep8.Core.isTouchDevice=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0};beep8.Core.isMobile=function(){return beep8.Core.isIOS()||beep8.Core.isAndroid()};beep8.Core.isIOS=function(){return/(ipad|ipod|iphone)/i.test(navigator.userAgent)};beep8.Core.isAndroid=function(){return/android/i.test(navigator.userAgent)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.CursorRenderer={};var blinkCycle_=0;var toggleBlinkHandle_=null;beep8.CursorRenderer.setCursorVisible=function(visible){beep8.Utilities.checkBoolean("visible",visible);if(beep8.Core.drawState.cursorVisible===visible)return;beep8.Core.drawState.cursorVisible=visible;blinkCycle_=0;beep8.Renderer.render();if(toggleBlinkHandle_!==null){clearInterval(toggleBlinkHandle_);toggleBlinkHandle_=null}if(visible){toggleBlinkHandle_=setInterval(function(){return advanceBlink_()},beep8.CONFIG.CURSOR.BLINK_INTERVAL)}};beep8.CursorRenderer.draw=function(targetCtx,canvasWidth,canvasHeight){beep8.Utilities.checkInstanceOf("targetCtx",targetCtx,CanvasRenderingContext2D);beep8.Utilities.checkNumber("canvasWidth",canvasWidth);beep8.Utilities.checkNumber("canvasHeight",canvasHeight);if(!beep8.Core.drawState.cursorVisible||blinkCycle_<=0)return;var ratio=canvasWidth/beep8.Core.canvas.width;var realX=Math.round((beep8.Core.drawState.cursorCol+.5-beep8.CONFIG.CURSOR.WIDTH_F/2+beep8.CONFIG.CURSOR.OFFSET_H)*beep8.CONFIG.CHR_WIDTH*ratio);var realY=Math.round((beep8.Core.drawState.cursorRow+1-beep8.CONFIG.CURSOR.HEIGHT_F-beep8.CONFIG.CURSOR.OFFSET_V)*beep8.CONFIG.CHR_HEIGHT*ratio);targetCtx.fillStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);targetCtx.fillRect(realX,realY,Math.round(beep8.CONFIG.CURSOR.WIDTH_F*beep8.CONFIG.CHR_WIDTH*ratio),Math.round(beep8.CONFIG.CURSOR.HEIGHT_F*beep8.CONFIG.CHR_HEIGHT*ratio))};advanceBlink_=function advanceBlink_(){blinkCycle_=(blinkCycle_+1)%2;beep8.Renderer.render()}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Input={};var keysHeld_=null;var keysJustPressed_=null;beep8.Input.init=function(){keysHeld_=new Set;keysJustPressed_=new Set;window.addEventListener("keydown",function(e){return beep8.Input.onKeyDown(e)});window.addEventListener("keyup",function(e){return beep8.Input.onKeyUp(e)});window.addEventListener("pointerdown",function(e){return beep8.Input.onPointerDown(e)})};beep8.Input.keyHeld=function(keyName){return keysHeld_.has(keyName.toUpperCase())};beep8.Input.keyJustPressed=function(keyName){return keysJustPressed_.has(keyName.toUpperCase())};beep8.Input.onEndFrame=function(){keysJustPressed_.clear()};beep8.Input.onKeyDown=function(e){var key=e.key;var keys=beep8.Input.getKeys(key);if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(key)){e.preventDefault()}var _iterator2=_createForOfIteratorHelper(keys),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var k=_step2.value;keysJustPressed_.add(k.toUpperCase());keysHeld_.add(k.toUpperCase())}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}if(beep8.Core.hasPendingAsync("beep8.Async.key")){beep8.Core.resolveAsync("beep8.Async.key",keys)}};beep8.Input.onPointerDown=function(e){if(beep8.Core.hasPendingAsync("beep8.Async.pointer")){beep8.Core.resolveAsync("beep8.Async.pointer",{x:e.clientX,y:e.clientY})}};beep8.Input.onKeyUp=function(e){var key=e.key.toUpperCase();var keys=beep8.Input.getKeys(key);var _iterator3=_createForOfIteratorHelper(keys),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var k=_step3.value;keysHeld_["delete"](k.toUpperCase())}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}};beep8.Input.readKeyAsync=function(){return new Promise(function(resolve,reject){beep8.Core.startAsync("beep8.Async.key",resolve,reject)})};beep8.Input.readPointerAsync=function(){return new Promise(function(resolve,reject){beep8.Core.startAsync("beep8.Async.pointer",resolve,reject)})};beep8.Input.getKeys=function(key){var keys=[key];switch(key.toUpperCase()){case"W":keys.push("ArrowUp");break;case"A":keys.push("ArrowLeft");break;case"S":keys.push("ArrowDown");break;case"D":keys.push("ArrowRight");break;case"Enter":keys.push("Escape");break;case"Z":case"N":keys.push("ButtonA");break;case"X":case"M":keys.push("ButtonB");break}return keys};beep8.Input.readLine=function(){var _ref15=_asyncToGenerator(_regeneratorRuntime().mark(function _callee15(initString,maxLen){var maxWidth,startCol,startRow,curCol,curRow,curStrings,curPos,cursorWasVisible,keys,_iterator4,_step4,key,_args15=arguments;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:maxWidth=_args15.length>2&&_args15[2]!==undefined?_args15[2]:-1;startCol=beep8.Core.drawState.cursorCol;startRow=beep8.Core.drawState.cursorRow;curCol=startCol;curRow=startRow;curStrings=[initString];curPos=0;cursorWasVisible=beep8.Core.drawState.cursorVisible;beep8.CursorRenderer.setCursorVisible(true);case 9:if(!true){_context15.next=52;break}beep8.Core.setCursorLocation(curCol,curRow);beep8.TextRenderer.print(curStrings[curPos]||"");_context15.next=14;return beep8.Input.readKeyAsync();case 14:keys=_context15.sent;_iterator4=_createForOfIteratorHelper(keys);_context15.prev=16;_iterator4.s();case 18:if((_step4=_iterator4.n()).done){_context15.next=42;break}key=_step4.value;if(!(key==="Backspace")){_context15.next=32;break}if(!(curStrings[curPos].length===0)){_context15.next=26;break}if(!(curPos===0)){_context15.next=24;break}return _context15.abrupt("continue",40);case 24:curPos--;curRow--;case 26:curStrings[curPos]=curStrings[curPos].length>0?curStrings[curPos].substring(0,curStrings[curPos].length-1):curStrings[curPos];beep8.Core.setCursorLocation(curCol+curStrings[curPos].length,curRow);beep8.TextRenderer.print(" ");beep8.Sfx.play(beep8.CONFIG.SFX.TYPING);_context15.next=40;break;case 32:if(!(key==="Enter")){_context15.next=39;break}beep8.Core.setCursorLocation(1,curRow+1);beep8.CursorRenderer.setCursorVisible(cursorWasVisible);beep8.Sfx.play(beep8.CONFIG.SFX.TYPING);return _context15.abrupt("return",curStrings.join(""));case 39:if(key.length===1){if(curStrings.join("").length<maxLen||maxLen===-1){curStrings[curPos]+=key;if(maxWidth!==-1&&curStrings[curPos].length>=maxWidth){beep8.TextRenderer.print(curStrings[curPos].charAt(curStrings[curPos].length-1));curCol=startCol;curPos++;curStrings[curPos]="";curRow++}}beep8.Sfx.play(beep8.CONFIG.SFX.TYPING)}case 40:_context15.next=18;break;case 42:_context15.next=47;break;case 44:_context15.prev=44;_context15.t0=_context15["catch"](16);_iterator4.e(_context15.t0);case 47:_context15.prev=47;_iterator4.f();return _context15.finish(47);case 50:_context15.next=9;break;case 52:case"end":return _context15.stop()}},_callee15,null,[[16,44,47,50]])}));return function(_x9,_x10){return _ref15.apply(this,arguments)}}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Intro={};beep8.Intro.loading=function(){var _ref16=_asyncToGenerator(_regeneratorRuntime().mark(function _callee16(sfx){var prefix;return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:prefix="8> ";beep8.color(0,4);beep8.cls();beep8.locate(1,1);beep8.print(prefix+"beep8 Loading...\n");_context16.next=7;return beep8.Async.wait(.4);case 7:case"end":return _context16.stop()}},_callee16)}));return function(_x11){return _ref16.apply(this,arguments)}}();beep8.Intro.splash=_asyncToGenerator(_regeneratorRuntime().mark(function _callee17(){var titleScreen,message;return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:titleScreen=beep8.Tilemap.load("mB6YIIMBBACDAQQAgwMDBIMBBACDAQQAgxhIAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMPBQSDAQQAgw0FBAAPAAAPAJgggwEEAIMBBACDAQQAgwEEAIMBBACDGEoDBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDGQHlAwSDAQQAgwABBIMBBACDAQQAgxhuAwSDAQQAgwADBIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmCCDGDYDBIMYNwMEgxg3AwSDGFsDBIMYNwMEgxilAwSDAQQAgwMDBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwADBIMYKQMEgxgpAwSDAQQAgwEEAIMBBACDAQQAAA8AAA8AmCCDGK0DBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDGG4DBIMAAwSDFwMEgxiXDwODAgMEgxgYAwSDAQQAgwEEAIMBBAAADwAADwCYIIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDGHoDBIMYmQMEgwEEAIMBBACDAQQAgwMDBIMDAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBAAADwAADwCYIIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMDAwSDAwMEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwAEBIMABASDAAQEAA8AAA8AmCCDAQQAgwEEAIMBBACDGJIDBIMYNwMEgxhbAwSDGDcDBIMYNwMEgxg3AwSDGQEEAwSDGDcDBIMYNwMEgxg3AwSDGDcDBIMYNwMEgxg3AwSDGDcDBIMZARYDBIMYNwMEgxg4AwSDAQQAgwEEAIMBBACDAAQEgwMDBIMBBAAADwAADwCYIIMBBACDAQQAgw8FBIMYSAMEgwIPBIMBDwCDEw8EgwEEAIMZAYgPBIMZAYcPBIMZAYkPBIMYTgUEgxkBUw8EgxkBVA8EgxkBVQ8EgxhOBQSDAQ8EgwEPAIMTDwSDGEoDBIMBBACDAQQAgwEEAIMPBQSDAQQAgwEEAAAPAAAPAJgggwEEAIMBBACDAQQAgxhIAwSDAQ8AgxhyBQSDAQ8AgxhOBQSDGQGZDwSDGHIFBIMYPQUEgxivBQSDGQFTDwSDGHIFBIMYPQUEgxivBQSDCw8EgxhyBQSDCw8EgxhIAwSDAQQAgwEEAIMBBACDAAQEgwEEAIMPBQQADwAADwCYIIMBBACDAQQAgwEEAIMYSgMEgwEPAIMBDwCDFwQPgwEEAIMZAZ0PBIMBDwSDGE4FBIMBBACDGQFUDwSDGQFTDwSDGE4BBIMBBACDAQ8EgwEPAIMYJQ8FgxhuDwSDGG4PBIMYlw8EgwAPBIMABASDAQQAgwEEAAAPAAAPAJgggwEEAIMBBACDAQQAgxhIAwSDCQ8EgxhyBQSDAQ8AgxhOAQSDGQGdDwSDGHIFBIMYrwUEgwEEAIMZAVMPBIMYcgUEgxivBQSDAQQAgwEPBIMYcgUEgxg9BQSDGEgDBIMBBACDAQQAgwEEAIMABASDAAQEgwAEBAAPAAAPAJgggwADBIMYbgMEgwEEAIMYSAMEgxhPDwSDAQ8AgxglDwWDGE4FBIMZAZoPBIMSCg+DGBwFCoMYGQUKgxgdBQqDEwoPgxgdBQ+DGE4FBIMGDwSDGE4FBIMPAwSDGEgDBIMOBQSDAQQAgwEEAIMBBACDAQQAgwEEAAAPAAAPAJgggwADBIMAAwSDAQQAgxhaAwSDGDcDBIMYNwMEgxg3AwSDGDcDBIMYNwMEgwEKBIMYKwoFgxg3AwSDGCsECoMBCgSDGCsFBIMYNwMEgxhbAwSDGDcDBIMYNwMEgxilAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBAAADwAADwCYIIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMYJAoEgxguBQqDGBkKBIMYLwQKgxglCgWDGCsBBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmCCDAQQAgwEEAIMBBACDGCkDBIMBBACDAQQAgwEEAIMBBACDAQQAgxIKBIMYHAUKgxgZAQqDGB0FCoMTCgWDGCIFBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmCCDAQQAgxcDBIMYlw8DgxiXDwODGBgDBIMBBACDAQQAgwEEAIMNBQSDCwQKgxgrCgWDAAQEgxgrBAqDAQoEgxgyBQSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAwMEgwMDBIMBBACDAQQAgwEEAAAPAAAPAJgggxg3AwSDGDgDBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDGCQKBIMYLgUKgxgZCgSDGC8ECoMYJQoFgxgrBQSDAAUKgxgdAQSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBAAADwAADwCYIIMQBQSDGEoDBIMBBACDAQQAgwEEAIMBBACDAQQAgwAKBIMACgSDAAoEgxguBQSDGBkEBYMYGQQBgxgZBAWDGC8FBIMYLgUEgxgvBQSDAQQAgwEEAIMBBACDAQQAgxisAwSDGDcDBIMYNwMEgxhbAwSDGDcDBAAPAAAPAJgggwEEAIMYWgMEgxg3AwSDGDcDBIMYmwMEgwEEAIMBBACDAQQAgwEEAIMBBASDAQQEgwEEBIMBBASDAQQEgwEEAIMBBACDAQQAgwEEAIMZAeUDBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBAAADwAADwCYIIMBBACDAA8EgwEEAIMBBACDAQQAgwEEAIMBBACDGG4DBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAAAPAAAPAJgggwEEAIMBBACDAA8EgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwADBIMYegMEgxiZAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMAAwSDAAMEgwADBAAPAAAPAJgggwEEAIMBBACDGBwKBIMYHQoEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDGCkDBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBAAADwAADwCYIIMBBACDAQQAgxguCgSDGC8KBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMYKQMEgxgpAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMXAwSDAQMEgxgYAwSDAAMEgwEEAIMYdAMEgxiGAwSDAAUEgwEEAAAPAAAPAJgggwEEAIMBBACDAQQAgwEEAIMBBACDAA8EgwEEAIMBBACDAQQAgxcDBIMCAwSDAQMEgxgYAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAAMEgwADBIMYdAMEgxkBbAUEgwEEAIMZAUYFBIMBBAAADwAADwCYIIMWBQSDEAUEgxYDBIMYKAMEgwEEAIMBBACDGHQDBIMQAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMWAwSDGCgDBIMYdAMEgxiGAwSDGHQDBIMYtAUEgwAFBYMBBQSDAQUEgwEFBAAPAAAPAJgggwEFBIMBBQSDGCgFA4MABQODGCgDBIMYdAMEgwEEAIMBBACDDQUEgwEEAIMBBACDGHQDBIMYhgMEgxYDBIMYKAMEgxYDBIMBAwSDAQMEgxADBIMAAwSDAQQAgwEFBIMABQWDAQUEgwEFBIMBBQQADwAADwCYIIMBBQSDAQUEgwEFBIMYKAUDgwAFA4MYKAMEgxi4BQSDAQQAgwEEAIMYhgMEgxh0AwSDGLgFBIMPAwSDCwMEgwEDBIMBAwSDGQFqBQODAQMEgwEDBIMYKAMEgwEEAIMBBQSDAAUFgw8BBYMBBQSDAQUEAA8AAA8AmCCDCQEFgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgw8BBYMDBQGDAQUEgwEFBAAPAAAPAJgYgwAPAYMJAQWDAA8FgwAPBYMADwWDAA8FgwAPBYMADwWDAA8FgwABBYMADwWDAA8FgwAPBYMADwWDAA8FgwAPBYMADwWDAA8FgwAPBYMADwWDAA8FgwkBBYMYWAUBgwAPAZgYgwAPAYMADwGDAA8BgxABBYMADwWDAA8FgwAPBYMADwWDAA8FgwEBBYMQAQWDAA8FgwAPBYMADwWDAA8FgwAPBYMJAQWDAA8FgwAPBYMEAQWDAA8BgwAPAYMADwGDAAUB");beep8.locate(0,0);beep8.Tilemap.draw(titleScreen);message="Click to start";if(beep8.Core.isTouchDevice())message="Tap to start";beep8.color(4,5);beep8.locate(0,beep8.CONFIG.SCREEN_ROWS-2);beep8.printCentered(message,beep8.CONFIG.SCREEN_COLS);_context17.next=10;return beep8.Input.readPointerAsync();case 10:beep8.color(15,0);beep8.cls();case 12:case"end":return _context17.stop()}},_callee17)}))})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Menu={};beep8.Menu.display=function(){var _ref18=_asyncToGenerator(_regeneratorRuntime().mark(function _callee18(choices,options){var startCol,startRow,promptSize,prompt01,border01,choicesCols,choicesRows,totalCols,totalRows,t,selIndex,k;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:options=options||{};beep8.Utilities.checkArray("choices",choices);beep8.Utilities.checkObject("options",options);options=Object.assign({title:"",prompt:"",selBgColor:beep8.Core.drawState.fgColor,selFgColor:beep8.Core.drawState.bgColor,bgChar:0,borderChar:beep8.CONFIG.BORDER_CHAR,center:false,centerH:false,centerV:false,padding:1,selIndex:0,cancelable:false,typewriter:false},options);startCol=beep8.Core.drawState.cursorCol;startRow=beep8.Core.drawState.cursorRow;promptSize=beep8.TextRenderer.measure(options.prompt);prompt01=options.prompt?1:0;border01=options.borderChar?1:0;choicesCols=0;choicesRows=choices.length;choices.forEach(function(choice){choicesCols=Math.max(choicesCols,choice.length)});totalCols=Math.max(promptSize.cols,choicesCols)+2*options.padding+2*border01;totalCols=Math.min(totalCols,beep8.CONFIG.SCREEN_COLS);totalRows=prompt01*(promptSize.rows+1)+choicesRows+2*options.padding+2*border01;if(options.centerH||options.center){startCol=Math.round((beep8.CONFIG.SCREEN_COLS-totalCols)/2)}if(options.centerV||options.center){startRow=Math.round((beep8.CONFIG.SCREEN_ROWS-totalRows)/2)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow;beep8.TextRenderer.printRect(totalCols,totalRows,options.bgChar);if(options.borderChar){beep8.TextRenderer.printBox(totalCols,totalRows,false,options.borderChar);if(options.title){t=" "+options.title+" ";beep8.Core.drawState.cursorCol=startCol+Math.round((totalCols-t.length)/2);beep8.TextRenderer.print(t)}}if(!options.prompt){_context18.next=30;break}beep8.Core.drawState.cursorCol=promptSize.cols<=totalCols?startCol+border01+options.padding:startCol+Math.round((totalCols-promptSize.cols)/2);beep8.Core.drawState.cursorRow=startRow+border01+options.padding;if(!options.typewriter){_context18.next=29;break}_context18.next=27;return beep8.Async.typewriter(options.prompt);case 27:_context18.next=30;break;case 29:beep8.TextRenderer.print(options.prompt);case 30:selIndex=options.selIndex;case 31:if(!true){_context18.next=57;break}beep8.Core.drawState.cursorRow=startRow+border01+options.padding+prompt01*(promptSize.rows+1);beep8.Core.drawState.cursorCol=promptSize.cols<=choicesCols?startCol+border01+options.padding:startCol+Math.round((totalCols-choicesCols)/2);printChoices(choices,selIndex,options);_context18.next=37;return beep8.Input.readKeyAsync();case 37:k=_context18.sent;if(!k.includes("ArrowUp")){_context18.next=43;break}selIndex=selIndex>0?selIndex-1:choices.length-1;if(choices.length>1)beep8.Sfx.play(beep8.CONFIG.SFX.MENU_UP);_context18.next=55;break;case 43:if(!k.includes("ArrowDown")){_context18.next=48;break}selIndex=(selIndex+1)%choices.length;if(choices.length>1)beep8.Sfx.play(beep8.CONFIG.SFX.MENU_DOWN);_context18.next=55;break;case 48:if(!(k.includes("Enter")||k.includes("ButtonA"))){_context18.next=53;break}beep8.Sfx.play(beep8.CONFIG.SFX.MENU_SELECT);return _context18.abrupt("return",selIndex);case 53:if(!((k.includes("Escape")||k.includes("ButtonB"))&&options.cancelable)){_context18.next=55;break}return _context18.abrupt("return",-1);case 55:_context18.next=31;break;case 57:case"end":return _context18.stop()}},_callee18)}));return function(_x12,_x13){return _ref18.apply(this,arguments)}}();var printChoices=function printChoices(choices,selIndex,options){var origBg=beep8.Core.drawState.bgColor;var origFg=beep8.Core.drawState.fgColor;for(var i=0;i<choices.length;i++){var isSel=i===selIndex;beep8.Core.setColor(isSel?options.selFgColor:origFg,isSel?options.selBgColor:origBg);beep8.TextRenderer.print(choices[i]+"\n")}beep8.Core.setColor(origFg,origBg)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Music={};function times(n,fn){var result=[];for(var i=0;i<n;i++){result.push(fn(i))}return result}var p1Alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function noteToMidi(note){var regex=/^([A-Ga-g])([#b]?)(\d)$/;var match=note.match(regex);if(!match)return null;var letter=match[1].toUpperCase();var accidental=match[2];var octave=parseInt(match[3],10);var semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[letter];if(accidental==="#"){semitones+=1}else if(accidental==="b"){semitones-=1}return(octave+1)*12+semitones}function noteToP1(note){var midi=noteToMidi(note);if(midi===null)return"?";midi=beep8.Utilities.clamp(midi,36,87);return p1Alphabet.charAt(midi-36)}function compressNotes(arr){if(arr.length===0)return"";var result=arr[0];for(var i=1;i<arr.length;i++){if(arr[i]===arr[i-1]&&arr[i]!==" "&&arr[i]!=="|"){result+="-"}else{result+=arr[i]}}return result}function createRandomPattern(len,freq,interval,loop){var pattern=times(len,function(){return false});for(var i=0;i<loop;i++){if(interval>len)break;pattern=reversePattern(pattern,interval,freq);interval*=2}return pattern}function reversePattern(pattern,interval,freq){var pt=times(interval,function(){return false});for(var i=0;i<freq;i++){pt[beep8.Random["int"](0,interval-1)]=true}return pattern.map(function(p,i){return pt[i%interval]?!p:p})}var chords=[["I","IIIm","VIm"],["IV","IIm"],["V","VIIm"]];var nextChordsIndex=[[0,1,2],[1,2,0],[2,0]];var chordMap={I:["C4","E4","G4","B4"],IIIm:["E4","G4","B4","D5"],VIm:["A3","C4","E4","G4"],IV:["F4","A4","C5","E5"],IIm:["D4","F4","A4","C5"],V:["G3","B3","D4","F4"],VIIm:["B3","D4","F4","A4"]};var keyShift={C:0,D:2,Eb:3,F:5,G:7,A:9,Bb:10};var instrumentOptions=[0,1,2,3,4,5];var drumOptions=[6,7];function getChordNotes(key,roman){var base=chordMap[roman]||chordMap.I;var shift=keyShift[key]||0;return base.map(function(note){return transpose(note,shift)})}function transpose(note,shift){var midi=noteToMidi(note);if(midi===null){return note}midi+=shift;var octave=Math.floor(midi/12)-1;var index=midi%12;var noteNames=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return noteNames[index]+octave}function generateChordProgression(len){var keys=["C","D","Eb","F","G","A","Bb"];var key=beep8.Random.pick(keys);var chordChangeInterval=4;var currentRoman=null;var chordsIndex=0;var progression=[];for(var i=0;i<len;i++){if(i%chordChangeInterval===0){if(i===0){chordsIndex=beep8.Random["int"](0,chords.length-1);currentRoman=beep8.Random.pick(chords[chordsIndex])}else if(beep8.Random.num()<.8-i/chordChangeInterval%2*.5){chordsIndex=beep8.Random.pick(nextChordsIndex[chordsIndex]);currentRoman=beep8.Random.pick(chords[chordsIndex])}var currentChord=getChordNotes(key,currentRoman)}progression.push(currentChord)}return progression}function generateMelodyNote(noteCount,chordProgressionNotes){var notes=[beep8.Random.pick(instrumentOptions),"|"];var pattern=createRandomPattern(noteCount,4,8,3);var octaveOffset=beep8.Random["int"](-1,1);for(var i=0;i<noteCount;i++){if(beep8.Random.chance(10)){octaveOffset+=beep8.Random["int"](-1,1)}if(!pattern[i]){notes.push(" ");continue}var chordNotes=chordProgressionNotes[i];var ns=chordNotes[beep8.Random["int"](0,chordNotes.length-1)];var baseOctave=parseInt(ns.slice(-1),10);var newOctave=beep8.Utilities.clamp(baseOctave+octaveOffset,3,6);var noteName=ns.slice(0,-1).toUpperCase();var finalNote=noteName+newOctave;var p1Note=noteToP1(finalNote);notes.push(p1Note)}notes.push("|");return compressNotes(notes)}function generateChordNote(noteCount,chordProgressionNotes){var notes=[beep8.Random.pick(instrumentOptions),"|"];var isArpeggio=beep8.Random.chance(30);var arpeggioInterval=beep8.Random.pick([4,8,16]);var arpeggioPattern=times(arpeggioInterval,function(){return beep8.Random["int"](0,3)});var interval=beep8.Random.pick([2,4,8]);var pattern=isArpeggio?times(noteCount,function(){return true}):createRandomPattern(noteCount,beep8.Random.pick([1,1,interval/2]),interval,2);var baseOctave=beep8.Random["int"](-1,1);var isReciprocatingOctave=beep8.Random.chance(isArpeggio?30:80);var octaveOffset=0;for(var i=0;i<noteCount;i++){if(isReciprocatingOctave&&i%interval===0){octaveOffset=(octaveOffset+1)%2}if(!pattern[i]){notes.push(" ");continue}var chordNotes=chordProgressionNotes[i];var noteIndex=isArpeggio?arpeggioPattern[i%arpeggioInterval]:0;var ns=chordNotes[noteIndex];var baseOct=parseInt(ns.slice(-1),10);var newOct=beep8.Utilities.clamp(baseOct+baseOctave+octaveOffset,3,6);var noteName=ns.slice(0,-1).toUpperCase();var finalNote=noteName+newOct;var p1Note=noteToP1(finalNote);notes.push(p1Note)}notes.push("|");return compressNotes(notes)}function generateDrumNote(noteCount){var notes=[beep8.Random.pick(drumOptions),"|"];var pattern=createRandomPattern(noteCount,beep8.Random["int"](1,3),beep8.Random.pick([4,8]),3);var drumHit=noteToP1("C4");for(var i=0;i<noteCount;i++){notes.push(pattern[i]?drumHit:" ")}notes.push("|");return compressNotes(notes)}beep8.Music.generate=function(options){if(options&&options.seed){beep8.Random.setSeed(options.seed)}var defaultOptions={seed:beep8.Random["int"](1e4,99999),noteCount:beep8.Random.pick([16,32,48,64]),channelCount:beep8.Random["int"](2,5),drumPartRatio:.3,tempo:beep8.Random.pick([70,100,140,170,200,240,280]),hold:beep8.Random.pick([40,50,60,60,70,70,70,80,80,80,80,90,90,90,100,110,120,130,140,150])};var opts=Object.assign({},defaultOptions,options);beep8.Music.currentSongProperties=opts;console.log(opts);beep8.Random.setSeed(opts.seed);var chordProgressionNotes=generateChordProgression(opts.noteCount);var parts=times(opts.channelCount,function(){var isDrum=beep8.Random.num()<opts.drumPartRatio;if(isDrum){return generateDrumNote(opts.noteCount)}else{if(beep8.Random.num()<.5){return generateMelodyNote(opts.noteCount,chordProgressionNotes)}else{return generateChordNote(opts.noteCount,chordProgressionNotes)}}});if(opts.tempo!==null){var tempoStr=String(opts.tempo);if(opts.hold!==null){tempoStr+="."+String(opts.hold)}parts[0]=tempoStr+"\n"+parts[0]}return parts.join("\n")};beep8.Music.stop=function(){beep8.Music.play("")};beep8.Music.play=function(song){p1(song)};beep8.Music.setTempo=function(tempo){beep8.Utilities.checkInt("tempo",tempo);if(tempo<50){tempo=50}p1.setTempo(tempo)};beep8.Music.isPlaying=function(){return p1.isPlaying()}})(beep8);(function(beep8){beep8.Particles={};var particles_=[];beep8.Particles.add=function(x,y,props){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkObject("props",props);var defaults={x:x,y:y,vx:0,vy:0,life:1,size:1,color:15,gravity:0};var newParticle=Object.assign({},defaults,props);if(Array.isArray(newParticle.color)){newParticle.color=beep8.Random.pick(newParticle.color)}if(Array.isArray(newParticle.size)){newParticle.size=beep8.Random.pick(newParticle.size)}particles_.push(newParticle)};beep8.Particles.createExplosion=function(x,y){var count=arguments.length>2&&arguments[2]!==undefined?arguments[2]:10;var props=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("count",count);beep8.Utilities.checkObject("props",props);var defaults={size:1,color:beep8.Core.drawState.fgColor,life:2,speed:25,gravity:0};var newExplosion=Object.assign({},defaults,props);for(var i=0;i<count;i++){var angle=beep8.Random.range(0,Math.PI*2);var speed=beep8.Random.range(newExplosion.speed/2,newExplosion.speed);beep8.Particles.add(x,y,{size:newExplosion.size,color:newExplosion.color,life:newExplosion.life,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,g:newExplosion.gravity})}};beep8.Particles.update=function(dt){for(var i=particles_.length-1;i>=0;i--){var p=particles_[i];p.vy+=p.g*dt;p.x+=p.vx*dt;p.y+=p.vy*dt;p.life-=dt;if(p.life<=0){particles_.splice(i,1)}}};beep8.Particles.render=function(){for(var i=0;i<particles_.length;i++){var p=particles_[i];var center=p.size/2;beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(p.color);beep8.Core.ctx.fillRect(Math.round(p.x-center),Math.round(p.y-center),Math.round(p.size),Math.round(p.size))}};beep8.Particles.clearAll=function(){particles_=[]};beep8.Particles.getParticles=function(){return _toConsumableArray(particles_)};beep8.Particles.setParticles=function(particles){beep8.Utilities.checkArray("particles",particles);particles_=particles}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Passcodes={};beep8.Passcodes.codeLength=4;beep8.Passcodes.getCode=function(id){beep8.Utilities.checkIsSet("id",id);var combined=id+beep8.CONFIG.PASSKEY;var hash=hashString(combined);hash=hash.replace(/[^a-zA-Z]/g,"");hash=hash.toUpperCase();return hash.substring(0,beep8.Passcodes.codeLength)};beep8.Passcodes.checkCode=function(id,code){beep8.Utilities.checkIsSet("id",id);beep8.Utilities.checkString("code",code);var generatedCode=beep8.Passcodes.getCode(id);return generatedCode===code};beep8.Passcodes.getId=function(code){beep8.Utilities.checkString("code",code);code=code.toUpperCase();for(c=1;c<999;c++){if(beep8.Passcodes.checkCode(c,code)){return c}}return null};beep8.Passcodes.input=_asyncToGenerator(_regeneratorRuntime().mark(function _callee19(){var message,width,height,xPosition,yPosition,passcode,value;return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:message="Enter code:";width=message.length+2+2;height=6;xPosition=Math.round((beep8.CONFIG.SCREEN_COLS-width)/2);yPosition=Math.round((beep8.CONFIG.SCREEN_ROWS-height)/2);beep8.Core.setCursorLocation(xPosition,yPosition);beep8.TextRenderer.printBox(width,height);beep8.Core.setCursorLocation(xPosition+2,yPosition+2);beep8.TextRenderer.print(message+"\n>");_context19.next=11;return beep8.Async.readLine("",beep8.Passcodes.codeLength);case 11:passcode=_context19.sent;value=beep8.Passcodes.getId(passcode);return _context19.abrupt("return",value);case 14:case"end":return _context19.stop()}},_callee19)}));function hashString(input){input=btoa(input);var hash=0;var result="";for(var i=0;i<input.length;i++){hash=(hash<<5)-hash+input.charCodeAt(i);hash=hash&hash}for(var j=0;j<5;j++){hash=(hash<<5)-hash+beep8.CONFIG.PASSKEY.charCodeAt(j%beep8.CONFIG.PASSKEY.length);result+=Math.abs(hash).toString(36)}return result}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Random={};var randomSeed=null;beep8.Random.setSeed=function(){var seed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(seed===null){seed=Date.now()}if(typeof seed==="string"){seed=seed.split("").reduce(function(a,b){return a+b.charCodeAt(0)},0)}seed^=seed<<13;seed^=seed>>17;seed^=seed<<5;seed>>>=0;randomSeed=seed;for(var i=0;i<10;i++){beep8.Random.num()}};beep8.Random.getSeed=function(){return randomSeed};beep8.Random.num=function(){var a=1664525;var c=1013904223;var m=4294967296;randomSeed=(randomSeed*a+c)%m;return randomSeed/m};beep8.Random.range=function(min,max){beep8.Utilities.checkNumber("min",min);beep8.Utilities.checkNumber("max",max);return min+beep8.Random.num()*(max-min)};beep8.Random["int"]=function(min,max){beep8.Utilities.checkInt("min",min);beep8.Utilities.checkInt("max",max);if(max<=min){var tmp=max;max=min;min=tmp}var randomValue=beep8.Random.range(min,max);return Math.round(randomValue)};beep8.Random.pick=function(array){beep8.Utilities.checkArray("array",array);var index=beep8.Random["int"](0,array.length-1);return array[index]};beep8.Random.pickWeighted=function(array){var decayFactor=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.2;beep8.Utilities.checkArray("array",array);var weightedArray=beep8.Random.weightedArray(array,decayFactor);return beep8.Random.pick(weightedArray)};beep8.Random.shuffleArray=function(array){beep8.Utilities.checkArray("array",array);array=array.slice();for(var i=0;i<array.length;i++){var j=beep8.Random["int"](0,array.length-1);var tmp=array[i];array[i]=array[j];array[j]=tmp}return array};beep8.Random.chance=function(probability){beep8.Utilities.checkNumber("probability",probability);return beep8.Random.num()<probability/100};beep8.Random.weightedArray=function(array){var decayFactor=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.2;beep8.Utilities.checkArray("array",array);var weightedArray=[];for(var i=0;i<array.length;i++){var count=Math.pow(decayFactor,i)*10;for(var j=0;j<count;j++){weightedArray.push(array[i])}}return weightedArray};beep8.Random.setSeed()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Renderer={};var dirty=false;var phosphor_bloom=[];var scale_add=1;var scale_times=.4;var canvasImageData=null;var screenshakeDuration=0;var initCrt=function initCrt(){for(var i=0;i<256;i++){phosphor_bloom[i]=scale_times*Math.pow(i/255,1/2.2)+scale_add}};beep8.Renderer.render=function(){if(beep8.Core.crashed){return}beep8.Core.realCtx.imageSmoothingEnabled=false;var x=0;var y=0;if(screenshakeDuration>0){x=Math.min(10,Math.round(Math.random()*screenshakeDuration-screenshakeDuration/2));y=Math.min(10,Math.round(Math.random()*screenshakeDuration-screenshakeDuration/2));screenshakeDuration-=1}beep8.Core.realCtx.clearRect(0,0,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height);beep8.Core.realCtx.drawImage(beep8.Core.canvas,x,y,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height);dirty=false;beep8.CursorRenderer.draw(beep8.Core.realCtx,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height);beep8.Renderer.applyCrtFilter()};beep8.Renderer.shakeScreen=function(duration){screenshakeDuration=duration};beep8.Renderer.markDirty=function(){if(dirty){return}dirty=true;setTimeout(beep8.Core.render,1)};beep8.Renderer.applyCrtFilter=function(){if(beep8.CONFIG.CRT_ENABLE<=0||!beep8.CONFIG.CRT_VIGNETTE){return}canvasImageData=beep8.Core.realCtx.getImageData(0,0,beep8.CONFIG.SCREEN_WIDTH,beep8.CONFIG.SCREEN_HEIGHT);var imageData=canvasImageData.data;drawVignette(imageData);drawScanlines(imageData);beep8.Core.realCtx.putImageData(canvasImageData,0,0)};var drawVignette=function drawVignette(imageData){if(!beep8.CONFIG.CRT_VIGNETTE){return imageData}var width=beep8.CONFIG.SCREEN_WIDTH;var height=beep8.CONFIG.SCREEN_HEIGHT;var centerRadius=.8;var maxDarkness=.25;var centerX=width/2,centerY=height/2;var maxDistance=Math.sqrt(Math.pow(centerX,2)+Math.pow(centerY,2));var innerRadius=centerRadius*maxDistance;var scaleFactor=maxDarkness/(maxDistance*(1-centerRadius));for(var i=0;i<imageData.length;i+=4){var x=i/4%width;var y=Math.floor(i/4/width);var distance=Math.sqrt(Math.pow(x-centerX,2)+Math.pow(y-centerY,2));var vignetteFactor=distance<innerRadius?1:Math.max(0,1-(distance-innerRadius)*scaleFactor);imageData[i]*=vignetteFactor;imageData[i+1]*=vignetteFactor;imageData[i+2]*=vignetteFactor}};var drawScanlines=function drawScanlines(imageData){var width=beep8.CONFIG.SCREEN_WIDTH;var height=beep8.CONFIG.SCREEN_HEIGHT;for(var y=0;y<height;y+=2){for(var x=0;x<width;x++){var currentPixelPos=getPixelPosition(x,y);var current_pixel_data=getPixelData(imageData,currentPixelPos);var previous_pixel_data=x>0?getPixelData(imageData,getPixelPosition(x-1,y)):current_pixel_data;var next_pixel_data=x<width-1?getPixelData(imageData,getPixelPosition(x+1,y)):current_pixel_data;setPixel(imageData,currentPixelPos,blendPixels(current_pixel_data,previous_pixel_data,next_pixel_data))}}};var blendPixels=function blendPixels(currentPixel,previousPixel,nextPixel){var phosphor_bleed=beep8.CONFIG.CRT_ENABLE;var phosphor_blend=1-phosphor_bleed;return{r:currentPixel[0]*phosphor_blend+(previousPixel[0]+nextPixel[0])/2*phosphor_bleed*phosphor_bloom[previousPixel[0]],g:currentPixel[1]*phosphor_blend+(previousPixel[1]+nextPixel[1])/2*phosphor_bleed*phosphor_bloom[previousPixel[1]],b:currentPixel[2]*phosphor_blend+(previousPixel[2]+nextPixel[2])/2*phosphor_bleed*phosphor_bloom[previousPixel[2]]}};var getPixelData=function getPixelData(imageData,pixelPos){return[imageData[pixelPos+1],imageData[pixelPos+2],imageData[pixelPos+3]]};var setPixel=function setPixel(imageData,pixelPos,color){imageData[pixelPos+1]=color.r;imageData[pixelPos+2]=color.g;imageData[pixelPos+3]=color.b};var getPixelPosition=function getPixelPosition(x,y){return y*beep8.CONFIG.SCREEN_WIDTH*4+x*4};initCrt()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Scene={};var activeScene=null;var sceneList={};beep8.Scene.add=function(name){var gameObject=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var frameRate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:30;beep8.Utilities.checkString("name",name);if(gameObject!==null){beep8.Utilities.checkObject("gameObject",gameObject)}beep8.Utilities.checkInt("frameRate",frameRate);var init=gameObject.init||null;var update=gameObject.update||null;var render=gameObject.render||null;sceneList[name]={init:init,update:update,render:render,frameRate:frameRate}};beep8.Scene.set=function(name){beep8.Utilities.checkString("name",name);if(!sceneList[name]){beep8.Utilities.fatal('Scene "'.concat(name,'" does not exist.'))}beep8.Core.stopFrame();activeScene=name;var currentScene=sceneList[name];if(currentScene.init){currentScene.init()}if(currentScene.update||currentScene.render){beep8.frame(currentScene.render,currentScene.update,currentScene.frameRate)}};beep8.Scene.pause=function(){beep8.frame(null)};beep8.Scene.resume=function(){if(!activeScene){return}var currentScene=sceneList[activeScene];if(currentScene.update||currentScene.render){beep8.frame(currentScene.render||function(){},currentScene.update||function(){},currentScene.frameRate||30)}};beep8.Scene.get=function(){return activeScene};beep8.Scene.getAll=function(){return sceneList}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Sfx={};beep8.Sfx.library={coin:[1.2,0,1675,,.06,.24,1,1.82,,,837,.06],coin2:[1.2,0,523.2511,.01,.06,.3,1,1.82,,,837,.06],blip:[5,0,150,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],blip2:[3,0,200,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],blip3:[3,0,250,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],hit:[,0,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17],sparkle:[1.2,0,539,0,.04,.29,1,1.92,,,567,.02,.02,,,,.04],sparkle2:[1.2,0,80,.3,.4,.7,2,.1,-.73,3.42,-430,.09,.17,,,,.19],life:[1.5,0,537,.02,.02,.22,1,1.59,-6.98,4.97],life2:[1.4,0,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07],break:[1.2,0,528,.01,,.48,,.6,-11.6,,,,.32,4.2],lazer1:[1.5,0,515,.05,.07,.09,1,2.8,,,302,.06,.1,,3.5,.1,.08,.75,.04],alien:[,0,662,.82,.11,.33,1,0,,-.2,,,,1.2,,.26,.01],beep:[2,0,270,,.1,,1,1.5,,,,,,,,.1,.01],beep2:[2,0,150,,.1,,1,1.5,,,,,,,,.1,.01],beep3:[2,0,200,,.1,,1,1.5,,,,,,,,.1,.01],ding:[1,0,685,.01,.03,.17,1,1.4,,,,,,,,,,.63,.01,,420],drum:[1.5,0,129,.01,,.15,,,,,,,,5],explode:[1.5,0,333,.01,0,.9,4,1.9,,,,,,.5,,.6],explode2:[1.1,0,418,0,.02,.2,4,1.15,-8.5,,,,,.7,,.1],explode3:[1.2,0,82,.02,,.2,4,4,,,,,,.8,,.2,,.8,.09],squeak1:[1.2,0,1975,.08,.56,.02,,,-.4,,-322,.56,.41,,,,.25],squeak2:[,0,75,.03,.08,.17,1,1.88,7.83,,,,,.4],squeak3:[1.2,0,1306,.8,.08,.02,1,,,,,,.48,,-.1,.11,.25],squeak4:[1.2,0,1e3,.02,,.01,2,,18,,475,.01,.01],bell:[2,0,999,,,,,1.5,,.3,-99,.1,1.63,,,.11,.22],satellite:[,0,847,.02,.3,.9,1,1.67,,,-294,.04,.13,,,,.1],phone:[,0,1600,.13,.52,.61,1,1.1,,,,,,.1,,.14],pop:[4,0,224,.02,.02,.08,1,1.7,-13.9,,,,,,6.7],rocket:[1.5,0,941,.8,,.8,4,.74,-222,,,,,.8,,1],rocket2:[1.2,0,172,.8,,.8,1,.76,7.7,3.73,-482,.08,.15,,.14],squirt:[,0,448,.01,.1,.3,3,.39,-.5,,,,,,.2,.1,.08],swing:[1.5,0,150,.05,,.05,,1.3,,,,,,3],wave:[,0,40,.5,,1.5,,11,,,,,,199],warp:[3,0,713,.16,.09,.24,,.6,-29,-16,,,.09,.5,,,.23,.75,.15,.48],radioactive:[,0,130,.02,.9,.39,2,.8,,,,,.13,.2,,.1,,.93,.06,.28],siren:[1.3,0,960,,1,.01,,.8,-.01,,-190,.5,,.05,,,1],car_horn:[1.8,0,250,.02,.02,.2,2,2,,,,,.02,,,.02,.01,,,.1],engine2:[1.2,0,25,.05,.3,.5,3,9,-.01,,,,,,13,.1,.2],thunder:[1.2,0,471,,.09,.47,4,1.06,-6.7,,,,,.9,61,.1,,.82,.09,.13],sparkle3:[,0,63,,1,,1,1.5,,,,,,,,3.69,.08],sweep:[1.2,0,9220,.01,,,,5,,,,,,9],click:[1.5,0,900,,.01,0,1,,-10,,-31,.02,,,,,,1.2,,.16,-1448]};beep8.Sfx.play=function(){var sfx=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(!sfx)return;beep8.Utilities.checkString("sfx",sfx);if(!beep8.Sfx.library[sfx]){beep8.Utilities.fatal("SFX ".concat(sfx," not found."))}zzfx.apply(void 0,_toConsumableArray(beep8.Sfx.library[sfx]))};beep8.Sfx.add=function(sfxName,sfxArray){beep8.Utilities.checkString("sfxName",sfxName);beep8.Utilities.checkArray("sfxArray",sfxArray);beep8.Sfx.library[sfxName]=sfxArray};beep8.Sfx.get=function(){return Object.keys(beep8.Sfx.library)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.State={};beep8.State=function(){function _class(){var initialState=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var renderFn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,_class);this.listeners={};this.renderFn=renderFn;return this.createProxy(initialState)}return _createClass(_class,[{key:"createProxy",value:function createProxy(target){var _this=this;return new Proxy(target,{get:function get(obj,prop){if(_typeof(obj[prop])==="object"&&obj[prop]!==null){return _this.createProxy(obj[prop])}return obj[prop]},set:function set(obj,prop,value){obj[prop]=value;beep8.Utilities.event("stateChange",{prop:prop,value:value});if(_this.renderFn){_this.renderFn()}return true}})}}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.TextRenderer={};var charMap=[];beep8.TextRenderer.fonts_={};beep8.TextRenderer.curFont_=null;beep8.TextRenderer.curTiles_=null;beep8.TextRenderer.prepareCharMap=function(){var charString=_toConsumableArray(beep8.CONFIG.CHRS);for(var i=0;i<charString.length;i++){charMap.push(charString[i].charCodeAt(0))}};beep8.TextRenderer.initAsync=_asyncToGenerator(_regeneratorRuntime().mark(function _callee20(){return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:beep8.Utilities.log("beep8.TextRenderer init.");_context20.next=3;return beep8.TextRenderer.loadFontAsync("default",beep8.CONFIG.FONT_DEFAULT);case 3:beep8.TextRenderer.curFont_=_context20.sent;_context20.next=6;return beep8.TextRenderer.loadFontAsync("tiles",beep8.CONFIG.FONT_TILES);case 6:beep8.TextRenderer.curTiles_=_context20.sent;_context20.next=9;return beep8.TextRenderer.loadFontAsync("actors",beep8.CONFIG.FONT_ACTORS);case 9:beep8.TextRenderer.curActors_=_context20.sent;beep8.TextRenderer.prepareCharMap();case 11:case"end":return _context20.stop()}},_callee20)}));beep8.TextRenderer.loadFontAsync=function(){var _ref21=_asyncToGenerator(_regeneratorRuntime().mark(function _callee21(fontName,fontImageFile){var tileSizeMultiplier,font,_args21=arguments;return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:tileSizeMultiplier=_args21.length>2&&_args21[2]!==undefined?_args21[2]:1;beep8.Utilities.checkString("fontName",fontName);beep8.Utilities.checkString("fontImageFile",fontImageFile);font=new beep8.TextRendererFont(fontName,fontImageFile,tileSizeMultiplier);_context21.next=6;return font.initAsync();case 6:beep8.TextRenderer.fonts_[fontName]=font;return _context21.abrupt("return",font);case 8:case"end":return _context21.stop()}},_callee21)}));return function(_x14,_x15){return _ref21.apply(this,arguments)}}();beep8.TextRenderer.setFont=function(fontName){var font=beep8.TextRenderer.getFontByName(fontName);if(font){beep8.TextRenderer.curFont_=font}};beep8.TextRenderer.getFont=function(){return beep8.TextRenderer.curFont_};beep8.TextRenderer.setTileFont=function(fontName){var font=beep8.TextRenderer.getFontByName(fontName);if(font){beep8.TextRenderer.curTiles_=font}};beep8.TextRenderer.getFontByName=function(fontName){beep8.Utilities.checkString("fontName",fontName);var font=beep8.TextRenderer.fonts_[fontName];if(!font){beep8.Utilities.fatal("setFont(): font not found: ".concat(fontName));return}var cw=font.getCharWidth();var ch=font.getCharHeight();if(cw%beep8.CONFIG.CHR_WIDTH!==0||ch%beep8.CONFIG.CHR_HEIGHT!==0){beep8.Utilities.fatal("getFontByName(): font ".concat(fontName," has character size ").concat(cw,"x").concat(ch,", ")+"which is not an integer multiple of beep8.CONFIG.CHR_WIDTH x beep8.CONFIG.CHR_HEIGHT = "+"".concat(beep8.CONFIG.CHR_WIDTH,"x").concat(beep8.CONFIG.CHR_HEIGHT,", so it can't be set as the ")+"current font due to the row,column system. However, you can still use it "+"directly with drawText() by passing it as a parameter to that function.");return}return font};beep8.TextRenderer.print=function(text){var font=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var wrapWidth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;beep8.TextRenderer.printFont_=font||beep8.TextRenderer.curFont_;beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("wrapWidth",wrapWidth);if(font!==null)beep8.Utilities.checkObject("font",font);text=beep8.TextRenderer.wrapText(text,wrapWidth,font);var col=beep8.Core.drawState.cursorCol;var row=beep8.Core.drawState.cursorRow;beep8.TextRenderer.origFgColor_=beep8.Core.drawState.fgColor;beep8.TextRenderer.origBgColor_=beep8.Core.drawState.bgColor;beep8.TextRenderer.origFont_=beep8.TextRenderer.printFont_;var colInc=beep8.TextRenderer.printFont_.getCharColCount();var rowInc=beep8.TextRenderer.printFont_.getCharRowCount();var initialCol=col;for(var i=0;i<text.length;i++){i=processEscapeSeq_(text,i);var ch=text.charCodeAt(i);if(ch===10){col=initialCol;row+=rowInc}else{var chIndex=charMap.indexOf(ch);if(chIndex>=0){put_(chIndex,col,row,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,beep8.TextRenderer.printFont_);col+=colInc}}}beep8.Core.drawState.cursorCol=col;beep8.Core.drawState.cursorRow=row;beep8.Core.drawState.fgColor=beep8.TextRenderer.origFgColor_;beep8.Core.drawState.bgColor=beep8.TextRenderer.origBgColor_;beep8.Renderer.markDirty()};beep8.TextRenderer.printTypewriter=function(){var _ref22=_asyncToGenerator(_regeneratorRuntime().mark(function _callee22(text){var wrapWidth,delay,font,startCol,startRow,i,endPos,_c,_args22=arguments;return _regeneratorRuntime().wrap(function _callee22$(_context22){while(1)switch(_context22.prev=_context22.next){case 0:wrapWidth=_args22.length>1&&_args22[1]!==undefined?_args22[1]:-1;delay=_args22.length>2&&_args22[2]!==undefined?_args22[2]:.05;font=_args22.length>3&&_args22[3]!==undefined?_args22[3]:null;beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("wrapWidth",wrapWidth);beep8.Utilities.checkNumber("delay",delay);startCol=beep8.col();startRow=beep8.row();text=beep8.TextRenderer.wrapText(text,wrapWidth);i=0;case 10:if(!(i<=text.length)){_context22.next=21;break}if(beep8.CONFIG.PRINT_ESCAPE_START&&text.substring(i,i+beep8.CONFIG.PRINT_ESCAPE_START.length)===beep8.CONFIG.PRINT_ESCAPE_START){endPos=text.indexOf(beep8.CONFIG.PRINT_ESCAPE_END,i+beep8.CONFIG.PRINT_ESCAPE_START.length);if(endPos>=0){i=endPos+beep8.CONFIG.PRINT_ESCAPE_END.length}}_c=text.charCodeAt(i);beep8.Core.setCursorLocation(startCol,startRow);beep8.TextRenderer.print(text.substring(0,i),font);if(!(_c!==32)){_context22.next=18;break}_context22.next=18;return beep8.Async.wait(delay);case 18:i++;_context22.next=10;break;case 21:case"end":return _context22.stop()}},_callee22)}));return function(_x16){return _ref22.apply(this,arguments)}}();beep8.TextRenderer.printCentered=function(text,width){var font=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;beep8.TextRenderer.printFont_=font||beep8.TextRenderer.curFont_;beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("width",width);if(!text){return}var col=beep8.Core.drawState.cursorCol;var rowInc=beep8.TextRenderer.printFont_.getCharRowCount();text=text.split("\n");for(var i=0;i<text.length;i++){var textWidth=beep8.TextRenderer.measure(text[i]).cols;var tempCol=Math.floor(col+(width-textWidth)/2);beep8.Core.drawState.cursorCol=tempCol;beep8.TextRenderer.print(text[i],font,width);beep8.Core.drawState.cursorRow+=rowInc}beep8.Core.drawState.cursorCol=col};beep8.TextRenderer.printChar=function(ch,n){var font=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(n===undefined||isNaN(n)){n=1}beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("n",n);while(n-- >0){put_(ch,beep8.Core.drawState.cursorCol,beep8.Core.drawState.cursorRow,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,font);beep8.Core.drawState.cursorCol++}beep8.Renderer.markDirty()};beep8.TextRenderer.spr=function(ch,x,y){var font=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var direction=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkInt("direction",direction);if(font!==null)beep8.Utilities.checkObject("font",font);putxy_(ch,x,y,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,font,direction)};beep8.TextRenderer.drawText=function(x,y,text,fontName){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkString("text",text);if(fontName){beep8.Utilities.checkString("fontName",fontName)}var x0=x;var font=fontName?beep8.TextRenderer.fonts_[fontName]||beep8.TextRenderer.curFont_:beep8.TextRenderer.curFont_;if(!font){beep8.Utilities.warn("Requested font '".concat(fontName,"' not found: not drawing text."));return}for(var i=0;i<text.length;i++){var ch=text.charCodeAt(i);if(ch===10){x=x0;y+=font.getCharHeight()}else{putxy_(ch,x,y,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,font);x+=font.getCharWidth()}}};beep8.TextRenderer.measure=function(text){beep8.Utilities.checkString("text",text);if(text===""){return{cols:0,rows:0}}var rows=1;var thisLineWidth=0;var cols=0;for(var i=0;i<text.length;i++){i=processEscapeSeq_(text,i,true);var ch=text.charCodeAt(i);if(ch===10){rows++;thisLineWidth=0}else{++thisLineWidth;cols=Math.max(cols,thisLineWidth)}}return{cols:cols,rows:rows}};beep8.TextRenderer.printRect=function(width,height,ch){beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkNumber("ch",ch);var startCol=beep8.Core.drawState.cursorCol;var startRow=beep8.Core.drawState.cursorRow;for(var i=0;i<height;i++){beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow+i;beep8.TextRenderer.printChar(ch,width)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow};beep8.TextRenderer.printBox=function(width,height){var fill=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var borderChar=arguments.length>3&&arguments[3]!==undefined?arguments[3]:beep8.CONFIG.BORDER_CHAR;beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkBoolean("fill",fill);beep8.Utilities.checkNumber("borderChar",borderChar);var colCount=beep8.TextRenderer.curTiles_.getColCount();var borderNW=borderChar;var borderNE=borderChar+2;var borderSW=borderChar+colCount+colCount;var borderSE=borderChar+colCount+colCount+2;var borderV=borderChar+colCount;var borderH=borderChar+1;var startCol=beep8.Core.drawState.cursorCol;var startRow=beep8.Core.drawState.cursorRow;for(var i=0;i<height;i++){beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow+i;if(i===0){beep8.TextRenderer.printChar(borderNW);beep8.TextRenderer.printChar(borderH,width-2);beep8.TextRenderer.printChar(borderNE)}else if(i===height-1){beep8.TextRenderer.printChar(borderSW);beep8.TextRenderer.printChar(borderH,width-2);beep8.TextRenderer.printChar(borderSE)}else{beep8.TextRenderer.printChar(borderV);beep8.Core.drawState.cursorCol=startCol+width-1;beep8.TextRenderer.printChar(borderV)}}if(fill&&width>2&&height>2){beep8.Core.drawState.cursorCol=startCol+1;beep8.Core.drawState.cursorRow=startRow+1;beep8.TextRenderer.printRect(width-2,height-2,0)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow};beep8.TextRenderer.wrapText=function(text,wrapWidth){var font=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;font=font||beep8.TextRenderer.curFont_;if(wrapWidth<=0){return text}wrapWidth=Math.floor(wrapWidth/font.getCharColCount());var lines=text.split("\n");var wrappedLines=[];var _iterator5=_createForOfIteratorHelper(lines),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var line=_step5.value;var words=line.split(" ");var wrappedLine="";var lineWidth=0;var _iterator6=_createForOfIteratorHelper(words),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var word=_step6.value;var wordWidth=beep8.TextRenderer.measure(word).cols;if(lineWidth+wordWidth>wrapWidth){wrappedLines.push(wrappedLine.trim());wrappedLine="";lineWidth=0}wrappedLine+=word+" ";lineWidth+=wordWidth+1}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}wrappedLines.push(wrappedLine.trim())}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return wrappedLines.join("\n")};var put_=function put_(ch,col,row,fgColor,bgColor){var font=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var direction=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var x=Math.round(col*beep8.CONFIG.CHR_WIDTH);var y=Math.round(row*beep8.CONFIG.CHR_HEIGHT);putxy_(ch,x,y,fgColor,bgColor,font,direction)};var putxy_=function putxy_(ch,x,y,fgColor,bgColor){var font=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var direction=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;font=font||beep8.TextRenderer.curTiles_;var colCount=font.getColCount();var chrW=font.getCharWidth();var chrH=font.getCharHeight();var fontRow=Math.floor(ch/colCount);var fontCol=ch%colCount;x=Math.round(x);y=Math.round(y);if(bgColor>=0){beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(bgColor);beep8.Core.ctx.fillRect(x,y,chrW,chrH)}if(beep8.CONFIG.SCREEN_COLORS===1&&bgColor===fgColor){return}if(direction>0){beep8.Core.ctx.save();var flipH=(direction&1)!==0;var flipV=(direction&2)!==0;var translateX=flipH?chrW:0;var translateY=flipV?chrH:0;beep8.Core.ctx.translate(x+translateX,y+translateY);var scaleX=flipH?-1:1;var scaleY=flipV?-1:1;beep8.Core.ctx.scale(scaleX,scaleY);x=0;y=0}var color=beep8.Utilities.clamp(fgColor,0,beep8.CONFIG.COLORS.length-1);var img=font.getImageForColor(color);beep8.Core.ctx.drawImage(img,fontCol*chrW,fontRow*chrH,chrW,chrH,x,y,chrW,chrH);if(direction>0){beep8.Core.ctx.restore()}beep8.Renderer.markDirty()};var processEscapeSeq_=function processEscapeSeq_(text,startPos){var pretend=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var startSeq=beep8.CONFIG.PRINT_ESCAPE_START;var endSeq=beep8.CONFIG.PRINT_ESCAPE_END;if(!startSeq||!endSeq){return startPos}if(text.substring(startPos,startPos+startSeq.length)!=startSeq){return startPos}var endPos=text.indexOf(endSeq,startPos+startSeq.length);if(!pretend){var command=text.substring(startPos+startSeq.length,endPos);_runEscapeCommand_(command)}return endPos+endSeq.length};var _runEscapeCommand_=function runEscapeCommand_(command){if(command.indexOf(",")>0){var parts=command.split(",");var _iterator7=_createForOfIteratorHelper(parts),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var part=_step7.value;_runEscapeCommand_(part)}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return}command=command.trim();if(command===""){return}var verb=command[0].toLowerCase();var arg=command.substring(1);var argNum=1*arg;switch(verb){case"f":case"c":beep8.Core.drawState.fgColor=arg!==""?argNum:beep8.TextRenderer.origFgColor_;break;case"b":beep8.Core.drawState.bgColor=arg!==""?argNum:beep8.TextRenderer.origBgColor_;break;case"t":beep8.TextRenderer.printFont_=beep8.TextRenderer.getFontByName(arg);break;case"z":beep8.Core.drawState.fgColor=beep8.TextRenderer.origFgColor_;beep8.Core.drawState.bgColor=beep8.TextRenderer.origBgColor_;beep8.TextRenderer.printFont_=beep8.TextRenderer.origFont_||beep8.TextRenderer.fonts_["default"];break;default:console.warn("Unknown beep8 print escape command: "+command)}};beep8.TextRenderer.regenColors=function(){Object.values(beep8.TextRenderer.fonts_).forEach(function(f){return f.regenColors()})}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.TextRendererFont=function(){function _class2(fontName,fontImageFile){var tileSizeMultiplier=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;_classCallCheck(this,_class2);beep8.Utilities.checkString("fontName",fontName);beep8.Utilities.checkString("fontImageFile",fontImageFile);this.fontName_=fontName;this.fontImageFile_=fontImageFile;this.origImg_=null;this.chrImages_=[];this.imageWidth_=0;this.imageHeight_=0;this.colCount_=0;this.rowCount_=0;this.charWidth_=0;this.charHeight_=0;this.charColCount_=0;this.charRowCount_=0;this.tileSizeMultiplier_=tileSizeMultiplier}return _createClass(_class2,[{key:"getCharWidth",value:function getCharWidth(){return this.charWidth_}},{key:"getCharHeight",value:function getCharHeight(){return this.charHeight_}},{key:"getCharColCount",value:function getCharColCount(){return this.charColCount_}},{key:"getCharRowCount",value:function getCharRowCount(){return this.charRowCount_}},{key:"getRowCount",value:function getRowCount(){return this.rowCount_}},{key:"getColCount",value:function getColCount(){return this.colCount_}},{key:"getImageForColor",value:function getImageForColor(colorNumber){return this.chrImages_[colorNumber]}},{key:"initAsync",value:function(){var _initAsync=_asyncToGenerator(_regeneratorRuntime().mark(function _callee23(){var imageCharWidth,imageCharHeight;return _regeneratorRuntime().wrap(function _callee23$(_context23){while(1)switch(_context23.prev=_context23.next){case 0:beep8.Utilities.log("Building font ".concat(this.fontName_," from image ").concat(this.fontImageFile_));_context23.next=3;return beep8.Utilities.loadImageAsync(this.fontImageFile_);case 3:this.origImg_=_context23.sent;imageCharWidth=beep8.CONFIG.CHR_WIDTH*this.tileSizeMultiplier_;imageCharHeight=beep8.CONFIG.CHR_HEIGHT*this.tileSizeMultiplier_;beep8.Utilities.assert(this.origImg_.width%imageCharWidth===0&&this.origImg_.height%imageCharHeight===0,"Font ".concat(this.fontName_,": image ").concat(this.fontImageFile_," has dimensions ")+"".concat(this.origImg_.width,"x").concat(this.origImg_.height,"."));_context23.next=9;return beep8.Utilities.makeColorTransparent(this.origImg_);case 9:this.origImg_=_context23.sent;this.charWidth_=imageCharWidth;this.charHeight_=imageCharHeight;this.imageWidth_=this.origImg_.width;this.imageHeight_=this.origImg_.height;this.colCount_=this.imageWidth_/this.charWidth_;this.rowCount_=this.imageHeight_/this.charHeight_;this.charColCount_=this.tileSizeMultiplier_;this.charRowCount_=this.tileSizeMultiplier_;console.log("load image",this);_context23.next=21;return this.regenColors();case 21:case"end":return _context23.stop()}},_callee23,this)}));function initAsync(){return _initAsync.apply(this,arguments)}return initAsync}()},{key:"regenColors",value:function(){var _regenColors=_asyncToGenerator(_regeneratorRuntime().mark(function _callee24(){var _c2,tempCanvas,ctx;return _regeneratorRuntime().wrap(function _callee24$(_context24){while(1)switch(_context24.prev=_context24.next){case 0:this.chrImages_=[];for(_c2=0;_c2<beep8.CONFIG.COLORS.length;_c2++){tempCanvas=document.createElement("canvas");tempCanvas.width=this.origImg_.width;tempCanvas.height=this.origImg_.height;ctx=tempCanvas.getContext("2d");beep8.Utilities.log("Initializing font ".concat(this.fontName_,", color ").concat(_c2," = ").concat(beep8.CONFIG.COLORS[_c2]));ctx.clearRect(0,0,this.origImg_.width,this.origImg_.height);ctx.globalCompositeOperation="source-over";ctx.drawImage(this.origImg_,0,0,this.origImg_.width,this.origImg_.height);ctx.globalCompositeOperation="source-in";ctx.fillStyle=beep8.CONFIG.COLORS[_c2];ctx.fillRect(0,0,this.origImg_.width,this.origImg_.height);if(beep8.CONFIG.SCREEN_COLORS===2){ctx.globalCompositeOperation="multiply";ctx.drawImage(this.origImg_,0,0,this.origImg_.width,this.origImg_.height)}this.chrImages_.push(tempCanvas)}case 2:case"end":return _context24.stop()}},_callee24,this)}));function regenColors(){return _regenColors.apply(this,arguments)}return regenColors}()}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Tilemap={};beep8.Tilemap.MAP_CHAR=0;beep8.Tilemap.MAP_FG=1;beep8.Tilemap.MAP_BG=2;beep8.Tilemap.MAP_COLLISION=3;beep8.Tilemap.MAP_DATA=4;var wallTiles={solid:{0:1,1:1,2:1,3:36,4:1,5:1,6:18,7:1,8:1,9:37,10:1,11:1,12:19,13:1,14:1,15:1},rounded:{0:1,1:42,2:23,3:36,4:41,5:1,6:18,7:1,8:24,9:37,10:1,11:1,12:19,13:1,14:1,15:1},half:{0:128,1:75,2:58,3:93,4:75,5:75,6:57,7:129,8:58,9:95,10:58,11:111,12:59,13:130,14:112,15:113},half_rounded:{0:128,1:148,2:166,3:93,4:149,5:75,6:57,7:129,8:167,9:95,10:58,11:111,12:59,13:130,14:112,15:113},pipe:{0:128,1:148,2:166,3:93,4:149,5:[75,77],6:57,7:129,8:167,9:95,10:[58,94],11:111,12:59,13:130,14:112,15:[113,131,76]},thin:{0:110,1:173,2:172,3:164,4:154,5:72,6:146,7:126,8:155,9:165,10:55,11:108,12:147,13:127,14:109,15:73}};beep8.Tilemap.save=function(tilemap){beep8.Utilities.checkArray("tilemap",tilemap);var cborString=CBOR.encode(tilemap);var encodedString=btoa(String.fromCharCode.apply(null,new Uint8Array(cborString)));return encodedString};beep8.Tilemap.load=function(data){beep8.Utilities.checkString("data",data);var binaryString=atob(data);var byteArray=new Uint8Array(binaryString.length);for(var i=0;i<binaryString.length;i++){byteArray[i]=binaryString.charCodeAt(i)}var arrayBuffer=byteArray.buffer;var mapData=CBOR.decode(arrayBuffer);return mapData};beep8.Tilemap.draw=function(tilemap){var width=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;beep8.Utilities.checkArray("tilemap",tilemap);if(!width){width=tilemap[0].length}if(!height){height=tilemap.length}beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);var startRow=beep8.Core.drawState.cursorRow;var startCol=beep8.Core.drawState.cursorCol;for(var y=0;y<height;y++){beep8.locate(0+startCol,y+startRow);for(var x=0;x<width;x++){var tile=tilemap[y][x];if(tile&&tile.length>=3){beep8.color(tile[beep8.Tilemap.MAP_FG],tile[beep8.Tilemap.MAP_BG]);beep8.printChar(tile[beep8.Tilemap.MAP_CHAR])}}}};beep8.Tilemap.createEmptyTilemap=function(width,height){var layout=[];for(var y=0;y<height;y++){layout[y]=[];for(var x=0;x<width;x++){layout[y][x]=beep8.Tilemap.getDefaultTile()}}return layout};beep8.Tilemap.shift=function(tilemap,dx,dy){beep8.Utilities.checkArray("tilemap",tilemap);beep8.Utilities.checkNumber("dx",dx);beep8.Utilities.checkNumber("dy",dy);var width=tilemap[0].length;var height=tilemap.length;var newTilemap=beep8.Tilemap.createEmptyTilemap(width,height);for(var y=0;y<height;y++){for(var x=0;x<width;x++){var newX=(x+dx+width)%width;var newY=(y+dy+height)%height;newTilemap[newY][newX]=_toConsumableArray(tilemap[y][x])}}return newTilemap};beep8.Tilemap.resize=function(tilemap,width,height){beep8.Utilities.checkArray("tilemap",tilemap);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);var newTilemap=beep8.Tilemap.createEmptyTilemap(width,height);for(var y=0;y<height;y++){for(var x=0;x<width;x++){if(tilemap[y]&&tilemap[y][x]){newTilemap[y][x]=_toConsumableArray(tilemap[y][x])}}}return newTilemap};beep8.Tilemap.getDefaultTile=function(){return[0,15,0,0,{}]};beep8.Tilemap.convertFromText=function(mapText){beep8.Utilities.checkString("text",mapText);var lines=mapText.trim().split("\n");var map=lines.map(function(row){return row.trim().split("")});return map};beep8.Tilemap.createFromArray=function(grid,tilePattern){beep8.Utilities.checkArray("grid",grid);beep8.Utilities.checkObject("tilePattern",tilePattern);var tilemap=[];for(var y=0;y<grid.length;y++){tilemap[y]=[];for(var x=0;x<grid[y].length;x++){tilemap[y][x]=beep8.Tilemap.getDefaultTile();if(!tilePattern[grid[y][x]]){beep8.Utilities.log("Tile pattern not found for: "+grid[y][x]);continue}var tile=tilePattern[grid[y][x]];var tileId=tile.t;if(typeof tileId==="string"&&tileId.startsWith("wall_")){tileId=beep8.Tilemap.wallTile(x,y,grid,tileId)}if(Array.isArray(tileId)){tileId=beep8.Random.pickWeighted(tileId)}var fg=tile.fg||15;if(Array.isArray(fg)){fg=beep8.Random.pickWeighted(fg)}var bg=tile.bg||0;if(Array.isArray(bg)){bg=beep8.Random.pickWeighted(bg)}tilemap[y][x]=[tileId,fg,bg,tile.coll||0,tile.data||{}]}}return tilemap};beep8.Tilemap.wallTile=function(x,y,grid){var name=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkArray("grid",grid);beep8.Utilities.checkString("name",name);if(null===name){beep8.Utilities.fatal("Wall tile name not given: "+name)}var tileType=name.substring(5);if(!wallTiles[tileType]){beep8.Utilities.fatal("Wall tile type not found: "+tileType)}var mask=computeBitmask(grid,x,y);return wallTiles[tileType][mask]};function computeBitmask(grid,x,y){var bitmask=0;var tileId=grid[y][x];if(y>0&&grid[y-1][x]===tileId)bitmask+=1;if(x<grid[y].length-1&&grid[y][x+1]===tileId)bitmask+=2;if(y<grid.length-1&&grid[y+1][x]===tileId)bitmask+=4;if(x>0&&grid[y][x-1]===tileId)bitmask+=8;return bitmask}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Utilities={};beep8.Utilities.fatal=function(error){beep8.Utilities.error("Fatal error: "+error);try{beep8.Core.handleCrash(error)}catch(e){beep8.Utilities.error("Error in beep8.Core.handleCrash: "+e+" while handling error "+error)}throw new Error("Error: "+error)};beep8.Utilities.assert=function(cond,msg){if(!cond){beep8.Utilities.fatal(msg||"Assertion Failed")}return cond};beep8.Utilities.assertDebug=function(cond,msg){if(!cond){if(beep8.CONFIG.DEBUG){warn("DEBUG ASSERT failed: "+msg)}else{beep8.Utilities.fatal(msg)}}return cond};beep8.Utilities.assertEquals=function(expected,actual,what){if(expected!==actual){beep8.Utilities.fatal("".concat(what,": expected ").concat(expected," but got ").concat(actual))}return actual};beep8.Utilities.checkType=function(varName,varValue,varType){beep8.Utilities.assert(varName,"checkType: varName must be provided.");beep8.Utilities.assert(varType,"checkType: varType must be provided.");beep8.Utilities.assert(_typeof(varValue)===varType,"".concat(varName," should be of type ").concat(varType," but was ").concat(_typeof(varValue),": ").concat(varValue));return varValue};beep8.Utilities.checkNumber=function(varName,varValue){var optMin=arguments.length>2&&arguments[2]!==undefined?arguments[2]:undefined;var optMax=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;beep8.Utilities.checkType(varName,varValue,"number");if(isNaN(varValue)){beep8.Utilities.fatal("".concat(varName," should be a number but is NaN"))}if(!isFinite(varValue)){beep8.Utilities.fatal("".concat(varName," should be a number but is infinite: ").concat(varValue))}if(optMin!==undefined){beep8.Utilities.assert(varValue>=optMin,"".concat(varName," should be >= ").concat(optMin," but is ").concat(varValue))}if(optMax!==undefined){beep8.Utilities.assert(varValue<=optMax,"".concat(varName," should be <= ").concat(optMax," but is ").concat(varValue))}return varValue};beep8.Utilities.checkInt=function(varName,varValue,optMin,optMax){beep8.Utilities.checkNumber(varName,varValue,optMin,optMax);if(varValue!==Math.round(varValue)){beep8.Utilities.fatal("".concat(varName," should be an integer but is ").concat(varValue))}return varValue};beep8.Utilities.checkString=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"string")};beep8.Utilities.checkBoolean=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"boolean")};beep8.Utilities.checkFunction=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"function")};beep8.Utilities.checkObject=function(varName,varValue){if(varValue===null){beep8.Utilities.fatal("".concat(varName," should be an object, but was null"))}return beep8.Utilities.checkType(varName,varValue,"object")};beep8.Utilities.checkInstanceOf=function(varName,varValue,expectedClass){beep8.Utilities.assert(varValue instanceof expectedClass,"".concat(varName," should be an instance of ").concat(expectedClass.name," but was not, it's: ").concat(varValue));return varValue};beep8.Utilities.checkIsSet=function(varName,varValue){beep8.Utilities.assert(varValue!==undefined&&varValue!==null,"".concat(varName," should be set but was: ").concat(varValue));return varValue};beep8.Utilities.checkArray=function(varName,varValue){beep8.Utilities.assert(Array.isArray(varValue),"".concat(varName," should be an array, but was: ").concat(varValue));return varValue};beep8.Utilities.log=function(msg){if(beep8.CONFIG.DEBUG){console.log(msg)}};beep8.Utilities.warn=function(msg){console.warn(msg)};beep8.Utilities.error=function(msg){console.error(msg)};beep8.Utilities.loadImageAsync=function(){var _ref23=_asyncToGenerator(_regeneratorRuntime().mark(function _callee25(src){return _regeneratorRuntime().wrap(function _callee25$(_context25){while(1)switch(_context25.prev=_context25.next){case 0:return _context25.abrupt("return",new Promise(function(resolver){var img=new Image;img.src=src;img.onload=function(){return resolver(img)}}));case 1:case"end":return _context25.stop()}},_callee25)}));return function(_x17){return _ref23.apply(this,arguments)}}();beep8.Utilities.makeColorTransparent=function(){var _ref24=_asyncToGenerator(_regeneratorRuntime().mark(function _callee26(img){var color,range,canvas,ctx,imageData,data,i,r,g,b,_args26=arguments;return _regeneratorRuntime().wrap(function _callee26$(_context26){while(1)switch(_context26.prev=_context26.next){case 0:color=_args26.length>1&&_args26[1]!==undefined?_args26[1]:[255,0,255];range=_args26.length>2&&_args26[2]!==undefined?_args26[2]:5;canvas=document.createElement("canvas");ctx=canvas.getContext("2d");canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);imageData=ctx.getImageData(0,0,canvas.width,canvas.height);data=imageData.data;for(i=0;i<data.length;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(Math.abs(r-color[0])<=range&&Math.abs(g-color[1])<=range&&Math.abs(b-color[2])<=range){data[i+3]=0}}ctx.putImageData(imageData,0,0);return _context26.abrupt("return",canvas);case 12:case"end":return _context26.stop()}},_callee26)}));return function(_x18){return _ref24.apply(this,arguments)}}();beep8.Utilities.loadFileAsync=function(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(){if(xhr.status<200||xhr.status>299){reject("HTTP request finished with status "+xhr.status)}else{resolve(xhr.responseText)}});xhr.addEventListener("error",function(e){return reject(e)});xhr.open("GET",url);xhr.send()})};beep8.Utilities.clamp=function(x,lo,hi){return Math.min(Math.max(x,lo),hi)};beep8.Utilities.dist2d=function(x0,y0,x1,y1){beep8.Utilities.checkNumber("x0",x0);beep8.Utilities.checkNumber("y0",y0);beep8.Utilities.checkNumber("x1",x1);beep8.Utilities.checkNumber("y1",y1);var dx=x0-x1;var dy=y0-y1;return Math.sqrt(dx*dx+dy*dy)};beep8.Utilities.intersectIntervals=function(as,ae,bs,be){var result=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;beep8.Utilities.checkNumber("as",as);beep8.Utilities.checkNumber("ae",ae);beep8.Utilities.checkNumber("bs",bs);beep8.Utilities.checkNumber("be",be);if(result){beep8.Utilities.checkObject("result",result)}var start=Math.max(as,bs);var end=Math.min(ae,be);if(end>=start){if(result){result.start=start;result.end=end}return true}return false};beep8.Utilities.intersectRects=function(r1,r2){var dx1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var dy1=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var dx2=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var dy2=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var result=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;beep8.Utilities.checkObject("r1",r1);beep8.Utilities.checkObject("r2",r2);beep8.Utilities.checkNumber("r1.x",r1.x);beep8.Utilities.checkNumber("r1.y",r1.y);beep8.Utilities.checkNumber("r1.w",r1.w);beep8.Utilities.checkNumber("r1.h",r1.h);beep8.Utilities.checkNumber("r2.x",r2.x);beep8.Utilities.checkNumber("r2.y",r2.y);beep8.Utilities.checkNumber("r2.w",r2.w);beep8.Utilities.checkNumber("r2.h",r2.h);beep8.Utilities.checkNumber("dx1",dx1);beep8.Utilities.checkNumber("dx2",dx2);beep8.Utilities.checkNumber("dy1",dy1);beep8.Utilities.checkNumber("dy2",dy2);if(result){checkObject("result",result)}var xint=intersectRects_xint;var yint=intersectRects_yint;if(!beep8.Utilities.intersectIntervals(r1.x+dx1,r1.x+dx1+r1.w-1,r2.x+dx2,r2.x+dx2+r2.w-1,xint)){return false}if(!beep8.Utilities.intersectIntervals(r1.y+dy1,r1.y+dy1+r1.h-1,r2.y+dy2,r2.y+dy2+r2.h-1,yint)){return false}if(result){result.x=xint.start;result.w=xint.end-xint.start+1;result.y=yint.start;result.h=yint.end-yint.start+1}return true};var intersectRects_xint={};var intersectRects_yint={};beep8.Utilities.makeUrlPretty=function(uglyStr){beep8.Utilities.checkString("uglyStr",uglyStr);var str=uglyStr;str=str.toLowerCase();str=str.replace(/[\s/]+/g,"-");str=str.replace(/[^a-z0-9\-]+/g,"");str=str.replace(/-+/g,"-");str=str.replace(/^-+|-+$/g,"");return str};beep8.Utilities.deepMerge=function(){var isObject=function isObject(obj){return obj&&_typeof(obj)==="object"};for(var _len=arguments.length,objects=new Array(_len),_key=0;_key<_len;_key++){objects[_key]=arguments[_key]}return objects.reduce(function(prev,obj){Object.keys(obj).forEach(function(key){var pVal=prev[key];var oVal=obj[key];if(Array.isArray(pVal)&&Array.isArray(oVal)){prev[key]=pVal.concat.apply(pVal,_toConsumableArray(oVal))}else if(isObject(pVal)&&isObject(oVal)){prev[key]=beep8.Utilities.deepMerge(pVal,oVal)}else{prev[key]=oVal}});return prev},{})};beep8.Utilities.padWithZeros=function(number,length){beep8.Utilities.checkNumber("number",number);beep8.Utilities.checkInt("length",length);if(number<0){beep8.Utilities.fatal("padWithZeros does not support negative numbers")}return number.toString().padStart(length,"0")};beep8.Utilities.event=function(eventName){var detail=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var target=arguments.length>2&&arguments[2]!==undefined?arguments[2]:document;beep8.Utilities.checkString("eventName",eventName);beep8.Utilities.checkObject("detail",detail);beep8.Utilities.checkObject("target",target);eventName="beep8.".concat(eventName);var event=new CustomEvent(eventName,{detail:detail});target.dispatchEvent(event)};beep8.Utilities.repeatArray=function(array,times){beep8.Utilities.checkArray("array",array);beep8.Utilities.checkInt("times",times,0);return Array(times).fill().flatMap(function(){return array})};beep8.Utilities.downloadFile=function(){var filename=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var src=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";beep8.Utilities.checkString("filename",filename);beep8.Utilities.checkString("src",src);var element=document.createElement("a");element.setAttribute("href",src);element.setAttribute("download",filename);document.body.appendChild(element);element.click();document.body.removeChild(element)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Joystick={};var VJOY_HTML="\n<button id='vjoy-button-ter' class='vjoy-button'>Start</button>\n<div class=\"vjoy-controls\">\n<div class=\"vjoy-dpad\">\n<button id='vjoy-button-up' class='vjoy-button'>Up</button>\n<button id='vjoy-button-down' class='vjoy-button'>Down</button>\n<button id='vjoy-button-left' class='vjoy-button'>Left</button>\n<button id='vjoy-button-right' class='vjoy-button'>Right</button>\n<div id='vjoy-button-center'></div>\n</div>\n<div class=\"vjoy-buttons\">\n<button id='vjoy-button-pri' class='vjoy-button'>A</button>\n<button id='vjoy-button-sec' class='vjoy-button'>B</button>\n</div>\n</div>";var VJOY_CSS="\n:root {\n\t--b8-vjoy-button-color: #333;\n\t--b8-vjoy-button-dpad-size: 40vw;\n}\n\n.vjoy-container,\n.vjoy-container * {\n\tbox-sizing: border-box;\n\tuser-select: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n\n.vjoy-container {\nwidth: 100%;\npadding: 0 5vw;\n}\n\n.vjoy-controls {\ndisplay: flex;\ngap: 5vw;\njustify-content: space-between;\nalign-items: center;\n}\n\n.vjoy-dpad {\naspect-ratio: 1;\ndisplay: grid;\ngrid-template-columns: 1fr 1fr 1fr;\ngrid-template-rows: 1fr 1fr 1fr;\nwidth: var(--vjoy-button-dpad-size);\n}\n\n.vjoy-buttons {\ndisplay: flex;\ngap: 5vw;\n}\n\n.vjoy-buttons button {\n\twidth: calc( var(--vjoy-button-dpad-size) / 3 );\n\theight: calc( var(--vjoy-button-dpad-size) / 3 );\n\tborder-radius: 5rem;\n}\n\n.vjoy-button {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground: var(--b8-vjoy-button-color) !important;\n\tborder: none;\n\tfont: bold 14px monospace;\n\tcolor: #999 !important;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n\ttext-shadow: 0 -2px 0 black;\n}\n\n.vjoy-button:active,\n.vjoy-button:active {\n\tbackground: black;\n}\n\n#vjoy-button-up {\n\tgrid-area: 1 / 2;\n\tborder-radius: 1rem 1rem 0 0;\n}\n\n#vjoy-button-down {\n\tgrid-area: 3 / 2;\n\tborder-radius: 0 0 1rem 1rem;\n}\n\n#vjoy-button-left {\n\tgrid-area: 2 / 1;\n\tborder-radius: 1rem 0 0 1rem;\n}\n\n#vjoy-button-right {\n\tgrid-area: 2 / 3;\n\tborder-radius: 0 1rem 1rem 0;\n}\n\n#vjoy-button-center {\n\tgrid-column: 2;\n\tgrid-row: 2;\n\tbackground: var(--b8-vjoy-button-color);\n}\n\n#vjoy-button-pri {\n\tmargin-top: 5vw;\n}\n\n#vjoy-button-ter {\n\theight: 10vw;\n\tborder-radius: 1rem;\n}\n";beep8.Joystick.setup=function(){beep8.Utilities.log("Setting up virtual joystick...");var styleEl=document.createElement("style");styleEl.setAttribute("type","text/css");styleEl.innerText=VJOY_CSS;document.body.appendChild(styleEl);var container=document.createElement("div");container.className="vjoy-container";container.innerHTML=VJOY_HTML;beep8.Core.getBeepContainerEl().appendChild(container);setTimeout(beep8.Joystick.continueSetup,10)};beep8.Joystick.continueSetup=function(){beep8.Joystick.setUpButton("vjoy-button-up","ArrowUp");beep8.Joystick.setUpButton("vjoy-button-down","ArrowDown");beep8.Joystick.setUpButton("vjoy-button-left","ArrowLeft");beep8.Joystick.setUpButton("vjoy-button-right","ArrowRight");beep8.Joystick.setUpButton("vjoy-button-pri","ButtonA");beep8.Joystick.setUpButton("vjoy-button-sec","ButtonB");beep8.Joystick.setUpButton("vjoy-button-ter","Escape");document.body.addEventListener("touchstart",function(e){return e.preventDefault()})};beep8.Joystick.setUpButton=function(buttonId,buttonKeyName){var button=beep8.Utilities.assert(document.getElementById(buttonId),"Could not find button ID "+buttonId);if(buttonKeyName===null){button.style.display="none";return}button.addEventListener("pointerdown",function(e){return beep8.Joystick.handleButtonEvent(buttonKeyName,true,e)});button.addEventListener("pointerstart",function(e){return beep8.Joystick.handleButtonEvent(buttonKeyName,true,e)});button.addEventListener("pointerup",function(e){return beep8.Joystick.handleButtonEvent(buttonKeyName,false,e)});button.addEventListener("pointerend",function(e){return beep8.Joystick.handleButtonEvent(buttonKeyName,false,e)});button.addEventListener("contextmenu",function(e){return e.preventDefault()})};beep8.Joystick.handleButtonEvent=function(buttonKeyName,down,evt){console.log("handleButtonEvent",buttonKeyName,down,evt);evt.key=buttonKeyName;if(down){beep8.Input.onKeyDown(evt)}else{beep8.Input.onKeyUp(evt)}evt.preventDefault()}})(beep8||({},_readOnlyError("beep8")));(function(global,undefined){"use strict";var POW_2_24=Math.pow(2,-24),POW_2_32=Math.pow(2,32),POW_2_53=Math.pow(2,53);function encode(value){var data=new ArrayBuffer(256);var dataView=new DataView(data);var lastLength;var offset=0;function ensureSpace(length){var newByteLength=data.byteLength;var requiredLength=offset+length;while(newByteLength<requiredLength)newByteLength*=2;if(newByteLength!==data.byteLength){var oldDataView=dataView;data=new ArrayBuffer(newByteLength);dataView=new DataView(data);var uint32count=offset+3>>2;for(var i=0;i<uint32count;++i)dataView.setUint32(i*4,oldDataView.getUint32(i*4))}lastLength=length;return dataView}function write(){offset+=lastLength}function writeFloat64(value){write(ensureSpace(8).setFloat64(offset,value))}function writeUint8(value){write(ensureSpace(1).setUint8(offset,value))}function writeUint8Array(value){var dataView=ensureSpace(value.length);for(var i=0;i<value.length;++i)dataView.setUint8(offset+i,value[i]);write()}function writeUint16(value){write(ensureSpace(2).setUint16(offset,value))}function writeUint32(value){write(ensureSpace(4).setUint32(offset,value))}function writeUint64(value){var low=value%POW_2_32;var high=(value-low)/POW_2_32;var dataView=ensureSpace(8);dataView.setUint32(offset,high);dataView.setUint32(offset+4,low);write()}function writeTypeAndLength(type,length){if(length<24){writeUint8(type<<5|length)}else if(length<256){writeUint8(type<<5|24);writeUint8(length)}else if(length<65536){writeUint8(type<<5|25);writeUint16(length)}else if(length<4294967296){writeUint8(type<<5|26);writeUint32(length)}else{writeUint8(type<<5|27);writeUint64(length)}}function encodeItem(value){var i;if(value===false)return writeUint8(244);if(value===true)return writeUint8(245);if(value===null)return writeUint8(246);if(value===undefined)return writeUint8(247);switch(_typeof(value)){case"number":if(Math.floor(value)===value){if(0<=value&&value<=POW_2_53)return writeTypeAndLength(0,value);if(-POW_2_53<=value&&value<0)return writeTypeAndLength(1,-(value+1))}writeUint8(251);return writeFloat64(value);case"string":var utf8data=[];for(i=0;i<value.length;++i){var charCode=value.charCodeAt(i);if(charCode<128){utf8data.push(charCode)}else if(charCode<2048){utf8data.push(192|charCode>>6);utf8data.push(128|charCode&63)}else if(charCode<55296){utf8data.push(224|charCode>>12);utf8data.push(128|charCode>>6&63);utf8data.push(128|charCode&63)}else{charCode=(charCode&1023)<<10;charCode|=value.charCodeAt(++i)&1023;charCode+=65536;utf8data.push(240|charCode>>18);utf8data.push(128|charCode>>12&63);utf8data.push(128|charCode>>6&63);utf8data.push(128|charCode&63)}}writeTypeAndLength(3,utf8data.length);return writeUint8Array(utf8data);default:var length;if(Array.isArray(value)){length=value.length;writeTypeAndLength(4,length);for(i=0;i<length;++i)encodeItem(value[i])}else if(value instanceof Uint8Array){writeTypeAndLength(2,value.length);writeUint8Array(value)}else{var keys=Object.keys(value);length=keys.length;writeTypeAndLength(5,length);for(i=0;i<length;++i){var key=keys[i];encodeItem(key);encodeItem(value[key])}}}}encodeItem(value);if("slice"in data)return data.slice(0,offset);var ret=new ArrayBuffer(offset);var retView=new DataView(ret);for(var i=0;i<offset;++i)retView.setUint8(i,dataView.getUint8(i));return ret}function decode(data,tagger,simpleValue){var dataView=new DataView(data);var offset=0;if(typeof tagger!=="function")tagger=function tagger(value){return value};if(typeof simpleValue!=="function")simpleValue=function simpleValue(){return undefined};function read(value,length){offset+=length;return value}function readArrayBuffer(length){return read(new Uint8Array(data,offset,length),length)}function readFloat16(){var tempArrayBuffer=new ArrayBuffer(4);var tempDataView=new DataView(tempArrayBuffer);var value=readUint16();var sign=value&32768;var exponent=value&31744;var fraction=value&1023;if(exponent===31744)exponent=255<<10;else if(exponent!==0)exponent+=127-15<<10;else if(fraction!==0)return fraction*POW_2_24;tempDataView.setUint32(0,sign<<16|exponent<<13|fraction<<13);return tempDataView.getFloat32(0)}function readFloat32(){return read(dataView.getFloat32(offset),4)}function readFloat64(){return read(dataView.getFloat64(offset),8)}function readUint8(){return read(dataView.getUint8(offset),1)}function readUint16(){return read(dataView.getUint16(offset),2)}function readUint32(){return read(dataView.getUint32(offset),4)}function readUint64(){return readUint32()*POW_2_32+readUint32()}function readBreak(){if(dataView.getUint8(offset)!==255)return false;offset+=1;return true}function readLength(additionalInformation){if(additionalInformation<24)return additionalInformation;if(additionalInformation===24)return readUint8();if(additionalInformation===25)return readUint16();if(additionalInformation===26)return readUint32();if(additionalInformation===27)return readUint64();if(additionalInformation===31)return-1;throw"Invalid length encoding"}function readIndefiniteStringLength(majorType){var initialByte=readUint8();if(initialByte===255)return-1;var length=readLength(initialByte&31);if(length<0||initialByte>>5!==majorType)throw"Invalid indefinite length element";return length}function appendUtf16data(utf16data,length){for(var i=0;i<length;++i){var value=readUint8();if(value&128){if(value<224){value=(value&31)<<6|readUint8()&63;length-=1}else if(value<240){value=(value&15)<<12|(readUint8()&63)<<6|readUint8()&63;length-=2}else{value=(value&15)<<18|(readUint8()&63)<<12|(readUint8()&63)<<6|readUint8()&63;length-=3}}if(value<65536){utf16data.push(value)}else{value-=65536;utf16data.push(55296|value>>10);utf16data.push(56320|value&1023)}}}function decodeItem(){var initialByte=readUint8();var majorType=initialByte>>5;var additionalInformation=initialByte&31;var i;var length;if(majorType===7){switch(additionalInformation){case 25:return readFloat16();case 26:return readFloat32();case 27:return readFloat64()}}length=readLength(additionalInformation);if(length<0&&(majorType<2||6<majorType))throw"Invalid length";switch(majorType){case 0:return length;case 1:return-1-length;case 2:if(length<0){var elements=[];var fullArrayLength=0;while((length=readIndefiniteStringLength(majorType))>=0){fullArrayLength+=length;elements.push(readArrayBuffer(length))}var fullArray=new Uint8Array(fullArrayLength);var fullArrayOffset=0;for(i=0;i<elements.length;++i){fullArray.set(elements[i],fullArrayOffset);fullArrayOffset+=elements[i].length}return fullArray}return readArrayBuffer(length);case 3:var utf16data=[];if(length<0){while((length=readIndefiniteStringLength(majorType))>=0)appendUtf16data(utf16data,length)}else appendUtf16data(utf16data,length);return String.fromCharCode.apply(null,utf16data);case 4:var retArray;if(length<0){retArray=[];while(!readBreak())retArray.push(decodeItem())}else{retArray=new Array(length);for(i=0;i<length;++i)retArray[i]=decodeItem()}return retArray;case 5:var retObject={};for(i=0;i<length||length<0&&!readBreak();++i){var key=decodeItem();retObject[key]=decodeItem()}return retObject;case 6:return tagger(decodeItem(),length);case 7:switch(length){case 20:return false;case 21:return true;case 22:return null;case 23:return undefined;default:return simpleValue(length)}}}var ret=decodeItem();if(offset!==data.byteLength)throw"Remaining bytes";return ret}var obj={encode:encode,decode:decode};if(typeof define==="function"&&define.amd)define("cbor/cbor",obj);else if(!global.CBOR)global.CBOR=obj})(void 0);(function(){var audioCtx=new AudioContext;var noteBuffers={};var schedulerInterval=null;var schedules=[];var schedulePointers=[];var playbackStartTime=0;var tempo=120;var lookaheadTime=.5;var schedulerIntervalMs=50;var volumeMultiplier=.2;var unlocked=false;var sineComponent=function sineComponent(x,offset){return Math.sin(x*6.28+offset)};var pianoWaveform=function pianoWaveform(x){return sineComponent(x,Math.pow(sineComponent(x,0),2)+sineComponent(x,.25)*.75+sineComponent(x,.5)*.1)*volumeMultiplier};var piano2WaveForm=function piano2WaveForm(x){return Math.sin(x*6.28)*Math.sin(x*3.14)*volumeMultiplier};var sineWaveform=function sineWaveform(x){return Math.sin(2*Math.PI*x)*volumeMultiplier};var squareWaveform=function squareWaveform(x){return(Math.sin(2*Math.PI*x)>=0?1:-1)*volumeMultiplier};var sawtoothWaveform=function sawtoothWaveform(x){var t=x-Math.floor(x);return(2*t-1)*volumeMultiplier};var triangleWaveform=function triangleWaveform(x){var t=x-Math.floor(x);return(2*Math.abs(2*t-1)-1)*volumeMultiplier};var drumWaveform=function drumWaveform(x){return(Math.random()*2-1)*Math.exp(-x/10)*volumeMultiplier};var softDrumWaveform=function softDrumWaveform(x){return(Math.sin(x*2)+.3*(Math.random()-.5))*Math.exp(-x/15)*volumeMultiplier*2};var instrumentMapping=[pianoWaveform,piano2WaveForm,sineWaveform,sawtoothWaveform,squareWaveform,triangleWaveform,drumWaveform,softDrumWaveform];function p1(params){if(Array.isArray(params)){params=params[0]}if(!params||params.trim()===""){p1.stop();return}if(noteBuffers.length>200){console.warn("Beep8.Music: Note buffers exceeded limit, clearing old buffers.");({}),_readOnlyError("noteBuffers")}tempo=125;var baseNoteDuration=.5;schedules=[];var rawLines=params.split("\n").map(function(line){return line.trim()});var noteInterval=tempo/1e3;var trackLineRegex=/^([0-9])\|(.*)\|$/;rawLines.forEach(function(line){if(!line)return;if(line.startsWith("[")&&line.endsWith("]")||/^\d+(\.\d+)?$/.test(line)){var timing=line.replace(/[\[\]]/g,"").split(".");tempo=parseFloat(timing[0])||tempo;baseNoteDuration=(parseFloat(timing[1])||50)/100;noteInterval=tempo/1e3;return}if(!trackLineRegex.test(line)){console.error("Track lines must be in the format 'instrument|track data|': "+line);return}var match=line.match(trackLineRegex);var instrumentId=parseInt(match[1],10);var instrumentFn=instrumentMapping[instrumentId]||instrumentMapping[0];var trackData=match[2].trim();var events=[];for(var i=0;i<trackData.length;i++){var _char=trackData[i];var dashCount=1;while(i+dashCount<trackData.length&&trackData[i+dashCount]==="-"){dashCount++}var eventTime=i*noteInterval;if(_char===" "){events.push({startTime:eventTime,noteBuffer:null});i+=dashCount-1;continue}var noteValue=_char.charCodeAt(0);noteValue-=noteValue>90?71:65;var noteDuration=dashCount*baseNoteDuration*(tempo/125);var noteBuffer=createNoteBuffer(noteValue,noteDuration,44100,instrumentFn);events.push({startTime:eventTime,noteBuffer:noteBuffer});i+=dashCount-1}schedules.push(events)});schedulePointers=schedules.map(function(){return 0});playbackStartTime=audioCtx.currentTime+.1;p1.stop();schedulerInterval=setInterval(schedulerFunction,schedulerIntervalMs)}function schedulerFunction(){var currentTime=audioCtx.currentTime;var noteInterval=tempo/1e3;var effectiveLookahead=Math.max(lookaheadTime,noteInterval);schedules.forEach(function(events,trackIndex){var pointer=schedulePointers[trackIndex];var trackLength=events.length;if(trackLength===0)return;var step=pointer%trackLength;var loopCount=Math.floor(pointer/trackLength);var eventTime=playbackStartTime+step*noteInterval+loopCount*trackLength*noteInterval;if(eventTime<currentTime+effectiveLookahead){var event=events[step];if(event.noteBuffer){playNoteBuffer(event.noteBuffer,audioCtx,eventTime)}schedulePointers[trackIndex]++}});if(!p1.loop){var done=schedules.every(function(events,i){return schedulePointers[i]>=events.length});if(done){p1.stop()}}}p1.stop=function(){if(schedulerInterval!==null){clearInterval(schedulerInterval);schedulerInterval=null}playingSources.forEach(function(source){return source.stop()});playingSources=[]};p1.isPlaying=function(){return schedulerInterval!==null};p1.setTempo=function(newTempo){if(newTempo<50)newTempo=50;var oldNoteInterval=tempo/1e3;var newNoteInterval=newTempo/1e3;var elapsed=audioCtx.currentTime-playbackStartTime;var currentIndex=elapsed/oldNoteInterval;playbackStartTime=audioCtx.currentTime-currentIndex*newNoteInterval;tempo=newTempo};p1.clearCache=function(){({}),_readOnlyError("noteBuffers")};p1.loop=true;var createNoteBuffer=function createNoteBuffer(note,durationSeconds,sampleRate,instrumentFn){var key=note+"-"+durationSeconds+"-"+instrumentFn.name;var buffer=noteBuffers[key];if(note>=0&&!buffer){var frequencyFactor=65.406*Math.pow(1.06,note)/sampleRate;var totalSamples=Math.floor(sampleRate*durationSeconds);var attackSamples=88;var decaySamples=sampleRate*(durationSeconds-.002);buffer=noteBuffers[key]=audioCtx.createBuffer(1,totalSamples,sampleRate);var channelData=buffer.getChannelData(0);for(var i=0;i<totalSamples;i++){var amplitude=void 0;if(i<attackSamples){amplitude=i/(attackSamples+.2)}else{amplitude=Math.pow(1-(i-attackSamples)/decaySamples,Math.pow(Math.log(1e4*frequencyFactor)/2,2))}channelData[i]=amplitude*instrumentFn(i*frequencyFactor)}if(!unlocked){playNoteBuffer(buffer,audioCtx,audioCtx.currentTime,true);unlocked=true}}return buffer};var playingSources=[];var playNoteBuffer=function playNoteBuffer(buffer,context,when){var stopImmediately=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var source=context.createBufferSource();source.buffer=buffer;source.connect(context.destination);source.start(when);playingSources.push(source);if(stopImmediately){source.stop()}source.onended=function(){var index=playingSources.indexOf(source);if(index!==-1){playingSources.splice(index,1)}}};window.p1=p1})();"use strict";var zzfx=function zzfx(){return zzfxP(zzfxG.apply(void 0,arguments))};var zzfxV=.3;var zzfxR=44100;var zzfxX=new AudioContext;var zzfxP=function zzfxP(){for(var _len2=arguments.length,samples=new Array(_len2),_key2=0;_key2<_len2;_key2++){samples[_key2]=arguments[_key2]}var buffer=zzfxX.createBuffer(samples.length,samples[0].length,zzfxR),source=zzfxX.createBufferSource();samples.map(function(d,i){return buffer.getChannelData(i).set(d)});source.buffer=buffer;source.connect(zzfxX.destination);source.start();return source};var zzfxG=function zzfxG(){var volume=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var randomness=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.05;var frequency=arguments.length>2&&arguments[2]!==undefined?arguments[2]:220;var attack=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var sustain=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var release=arguments.length>5&&arguments[5]!==undefined?arguments[5]:.1;var shape=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var shapeCurve=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1;var slide=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var deltaSlide=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var pitchJump=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var pitchJumpTime=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var repeatTime=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var noise=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var modulation=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var bitCrush=arguments.length>15&&arguments[15]!==undefined?arguments[15]:0;var delay=arguments.length>16&&arguments[16]!==undefined?arguments[16]:0;var sustainVolume=arguments.length>17&&arguments[17]!==undefined?arguments[17]:1;var decay=arguments.length>18&&arguments[18]!==undefined?arguments[18]:0;var tremolo=arguments.length>19&&arguments[19]!==undefined?arguments[19]:0;var filter=arguments.length>20&&arguments[20]!==undefined?arguments[20]:0;var PI2=Math.PI*2,sign=function sign(v){return v<0?-1:1},startSlide=slide*=500*PI2/zzfxR/zzfxR,startFrequency=frequency*=(1+randomness*2*Math.random()-randomness)*PI2/zzfxR,b=[],t=0,tm=0,i=0,j=1,r=0,c=0,s=0,f,length,quality=2,w=PI2*Math.abs(filter)*2/zzfxR,cos=Math.cos(w),alpha=Math.sin(w)/2/quality,a0=1+alpha,a1=-2*cos/a0,a2=(1-alpha)/a0,b0=(1+sign(filter)*cos)/2/a0,b1=-(sign(filter)+cos)/a0,b2=b0,x2=0,x1=0,y2=0,y1=0;attack=attack*zzfxR+9;decay*=zzfxR;sustain*=zzfxR;release*=zzfxR;delay*=zzfxR;deltaSlide*=500*PI2/Math.pow(zzfxR,3);modulation*=PI2/zzfxR;pitchJump*=PI2/zzfxR;pitchJumpTime*=zzfxR;repeatTime=repeatTime*zzfxR|0;volume*=zzfxV;for(length=attack+decay+sustain+release+delay|0;i<length;b[i++]=s*volume){if(!(++c%(bitCrush*100|0))){s=shape?shape>1?shape>2?shape>3?Math.sin(Math.pow(t,3)):Math.max(Math.min(Math.tan(t),1),-1):1-(2*t/PI2%2+2)%2:1-4*Math.abs(Math.round(t/PI2)-t/PI2):Math.sin(t);s=(repeatTime?1-tremolo+tremolo*Math.sin(PI2*i/repeatTime):1)*sign(s)*Math.pow(Math.abs(s),shapeCurve)*(i<attack?i/attack:i<attack+decay?1-(i-attack)/decay*(1-sustainVolume):i<attack+decay+sustain?sustainVolume:i<length-delay?(length-i-delay)/release*sustainVolume:0);s=delay?s/2+(delay>i?0:(i<length-delay?1:(length-i)/delay)*b[i-delay|0]/2/volume):s;if(filter)s=y1=b2*x2+b1*(x2=x1)+b0*(x1=s)-a2*y2-a1*(y2=y1)}f=(frequency+=slide+=deltaSlide)*Math.cos(modulation*tm++);t+=f+f*noise*Math.sin(Math.pow(i,5));if(j&&++j>pitchJumpTime){frequency+=pitchJump;startFrequency+=pitchJump;j=0}if(repeatTime&&!(++r%repeatTime)){frequency=startFrequency;slide=startSlide;j=j||1}}return b};