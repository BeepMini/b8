"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}function _readOnlyError(r){throw new TypeError('"'+r+'" is read-only')}var beep8={};(function(beep8){beep8.CONFIG={DEBUG:true,NAME:"beep8 Project",VERSION:"1.0.0-dev",CANVAS_SETTINGS:{CANVAS_ID:"beep8-canvas",CANVAS_CLASSES:[],CONTAINER:null},SFX:{TYPING:"click",MENU_UP:"blip",MENU_DOWN:"blip2",MENU_SELECT:"blip3"},FONT_DEFAULT:"../assets/font-default.png",FONT_TILES:"../assets/font-tiles.png",CHRS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*+=-<>_#&@%^~$£€¥¢!?:;'\"/\\()[]{}.,©®™•…| ",CHR_WIDTH:12,CHR_HEIGHT:12,SCREEN_ROWS:32,SCREEN_COLS:32,SCAN_LINES_OPACITY:.1,COLORS:["#0E0F17","#2A3752","#9DB1BF","#8DF0F7","#44BDF9","#3C55B0","#54002A","#754B3B","#B51212","#F7883D","#FFCF66","#9AE065","#42C26B","#12897C","#F078DC","#F4F4F4"],TOUCH_VJOY:true,CURSOR:{WIDTH_F:.8,HEIGHT_F:.8,BLINK_INTERVAL:400,OFFSET_V:.1,OFFSET_H:0},PRINT_ESCAPE_START:"{{",PRINT_ESCAPE_END:"}}"}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.init=function(callback){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};beep8.Utilities.checkFunction("callback",callback);beep8.Utilities.checkObject("options",options);if(options!==null){beep8.CONFIG=Object.assign(beep8.CONFIG,options)}return beep8.Core.init(callback)};beep8.frame=function(handler){var fps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:30;beep8.Core.preflight("beep8.frame");if(handler!==null){beep8.Utilities.checkFunction("handler",handler)}beep8.Utilities.checkNumber("fps",fps);return beep8.Core.setFrameHandler(handler,fps)};beep8.render=function(){beep8.Core.preflight("beep8.render");return beep8.Core.render()};beep8.color=function(fg,bg){beep8.Core.preflight("beep8.color");beep8.Utilities.checkNumber("fg",fg);if(bg!==undefined){beep8.Utilities.checkNumber("bg",bg)}beep8.Core.setColor(fg,bg)};beep8.getFgColor=function(){beep8.Core.preflight("getFgColor");return beep8.Core.drawState.fgColor};beep8.getBgColor=function(){beep8.Core.preflight("beep8.getBgColor");return beep8.Core.drawState.bgColor};beep8.cls=function(){var bgColor=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;beep8.Core.preflight("beep8.Core.cls");beep8.Core.cls(bgColor)};beep8.locate=function(col,row){beep8.Core.preflight("beep8.locate");beep8.Utilities.checkNumber("col",col);if(row!==undefined){beep8.Utilities.checkNumber("row",row)}beep8.Core.setCursorLocation(col,row)};beep8.col=function(){beep8.Core.preflight("col");return beep8.Core.drawState.cursorCol};beep8.row=function(){beep8.Core.preflight("row");return beep8.Core.drawState.cursorRow};beep8.cursor=function(visible){beep8.Core.preflight("cursor");beep8.Utilities.checkBoolean("visible",visible);beep8.Core.cursorRenderer.setCursorVisible(visible)};beep8.print=function(text){var wrapWidth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;beep8.Core.preflight("beep8.text");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("wrapWidth",wrapWidth);beep8.Core.textRenderer.print(text,null,wrapWidth)};beep8.printCentered=function(text,width){beep8.Core.preflight("beep8.printCentered");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("width",width);beep8.Core.textRenderer.printCentered(text,width)};beep8.drawText=function(x,y,text){var fontId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;beep8.Core.preflight("beep8.drawText");beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkString("text",text);if(fontId){beep8.Utilities.checkString("fontId",fontId)}beep8.Core.textRenderer.drawText(x,y,text,fontId)};beep8.measure=function(text){beep8.Core.preflight("measure");beep8.Utilities.checkString("text",text);return beep8.Core.textRenderer.measure(text)};beep8.printChar=function(charCode){var numTimes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;beep8.Core.preflight("beep8.printChar");charCode=beep8.convChar(charCode);beep8.Utilities.checkNumber("charCode",charCode);beep8.Utilities.checkNumber("numTimes",numTimes);beep8.Core.textRenderer.printChar(charCode,numTimes)};beep8.printRect=function(widthCols,heightRows){var charCode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:32;beep8.Core.preflight("beep8.printRect");charCode=beep8.convChar(charCode);beep8.Utilities.checkNumber("widthCols",widthCols);beep8.Utilities.checkNumber("heightRows",heightRows);beep8.Utilities.checkNumber("charCode",charCode);beep8.Core.textRenderer.printRect(widthCols,heightRows,charCode)};beep8.printBox=function(widthCols,heightRows){var fill=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var borderChar=arguments.length>3&&arguments[3]!==undefined?arguments[3]:48;beep8.Core.preflight("beep8.printBox");borderChar=beep8.convChar(borderChar);beep8.Utilities.checkNumber("widthCols",widthCols);beep8.Utilities.checkNumber("heightRows",heightRows);beep8.Utilities.checkBoolean("fill",fill);beep8.Utilities.checkNumber("borderChar",borderChar);beep8.Core.textRenderer.printBox(widthCols,heightRows,fill,borderChar)};beep8.drawImage=function(x,y,image){beep8.Utilities.checkInstanceOf("image",image,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Core.drawImage(image,x,y)};beep8.drawImageRect=function(x,y,image,srcX,srcY,width,height){beep8.Utilities.checkInstanceOf("image",image,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("srcX",srcX);beep8.Utilities.checkNumber("srcY",srcY);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.drawImage(image,x,y,srcX,srcY,width,height)};beep8.drawRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.drawRect(x,y,width,height)};beep8.fillRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.fillRect(x,y,width,height)};beep8.playSound=function(sfx){var volume=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var loop=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;beep8.Utilities.checkInstanceOf("sfx",sfx,HTMLAudioElement);sfx.currentTime=0;sfx.volume=volume;sfx.loop=loop;sfx.play()};beep8.spr=function(ch,x,y){ch=beep8.convChar(ch);beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Core.textRenderer.spr(ch,x,y)};beep8.key=function(keyName){beep8.Core.preflight("beep8.key");beep8.Utilities.checkString("keyName",keyName);return beep8.Core.inputSys.keyHeld(keyName)};beep8.playSong=function(song){beep8.Utilities.checkString("song",song);beep8.Sound.playSong(song)};beep8.keyp=function(keyName){beep8.Core.preflight("beep8.keyp");beep8.Utilities.checkString("keyName",keyName);return beep8.Core.inputSys.keyJustPressed(keyName)};beep8.redefineColors=function(colors){beep8.Core.preflight("beep8.redefineColors");beep8.Utilities.checkArray("colors",colors);beep8.Core.defineColors(colors)};beep8.setFont=function(fontId){beep8.Core.preflight("beep8.setFont");fontId=fontId||"default";beep8.Utilities.checkString("fontId",fontId);beep8.Core.textRenderer.setFont(fontId)};beep8.getFont=function(){beep8.Core.preflight("beep8.getFont");beep8.Core.textRenderer.getFont()};beep8.getFontByName=function(fontName){beep8.Utilities.checkString("fontName",fontName);return beep8.Core.textRenderer.getFontByName(fontName)};beep8.setTileFont=function(fontId){beep8.Core.preflight("beep8.setTileFont");fontId=fontId||"tiles";beep8.Utilities.checkString("fontId",fontId);beep8.Core.textRenderer.setTileFont(fontId)};beep8.convChar=function(charCode){if(typeof charCode==="string"&&charCode.length>0){return charCode.charCodeAt(0)}return charCode};beep8.stopSound=function(sfx){beep8.Utilities.checkInstanceOf("sfx",sfx,HTMLAudioElement);sfx.currentTime=0;sfx.pause()};beep8.getContext=function(){return beep8.Core.getContext()};beep8.saveScreen=function(){return beep8.Core.saveScreen()};beep8.restoreScreen=function(screenData){return beep8.Core.restoreScreen(screenData)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Async={};beep8.Async.key=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:beep8.Core.preflight("beep8.Async.key");_context.next=3;return beep8.Core.inputSys.readKeyAsync();case 3:return _context.abrupt("return",_context.sent);case 4:case"end":return _context.stop()}},_callee)}));beep8.Async.pointer=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:beep8.Core.preflight("beep8.Async.pointer");_context2.next=3;return beep8.Core.inputSys.readPointerAsync();case 3:return _context2.abrupt("return",_context2.sent);case 4:case"end":return _context2.stop()}},_callee2)}));beep8.Async.readLine=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(){var initString,maxLen,maxWidth,_args3=arguments;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:initString=_args3.length>0&&_args3[0]!==undefined?_args3[0]:"";maxLen=_args3.length>1&&_args3[1]!==undefined?_args3[1]:-1;maxWidth=_args3.length>2&&_args3[2]!==undefined?_args3[2]:-1;beep8.Core.preflight("beep8.Async.readLine");beep8.Utilities.checkString("initString",initString);beep8.Utilities.checkNumber("maxLen",maxLen);_context3.next=8;return beep8.Core.inputSys.readLine(initString,maxLen,maxWidth);case 8:return _context3.abrupt("return",_context3.sent);case 9:case"end":return _context3.stop()}},_callee3)}));beep8.Async.menu=function(){var _ref4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(choices){var options,_args4=arguments;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:options=_args4.length>1&&_args4[1]!==undefined?_args4[1]:{};beep8.Core.preflight("beep8.Async.menu");beep8.Utilities.checkArray("choices",choices);beep8.Utilities.checkObject("options",options);_context4.next=6;return beep8.Menu.display(choices,options);case 6:return _context4.abrupt("return",_context4.sent);case 7:case"end":return _context4.stop()}},_callee4)}));return function(_x){return _ref4.apply(this,arguments)}}();beep8.Async.dialog=function(){var _ref5=_asyncToGenerator(_regeneratorRuntime().mark(function _callee5(prompt){var choices,_args5=arguments;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:choices=_args5.length>1&&_args5[1]!==undefined?_args5[1]:["OK"];beep8.Core.preflight("beep8.Async.dialog");beep8.Utilities.checkString("prompt",prompt);beep8.Utilities.checkArray("choices",choices);return _context5.abrupt("return",beep8.Async.menu(choices,{prompt:prompt,center:true}));case 5:case"end":return _context5.stop()}},_callee5)}));return function(_x2){return _ref5.apply(this,arguments)}}();beep8.Async.wait=function(){var _ref6=_asyncToGenerator(_regeneratorRuntime().mark(function _callee6(seconds){return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:beep8.Core.preflight("beep8.Async.wait");beep8.Utilities.checkNumber("seconds",seconds);beep8.Core.render();_context6.next=5;return new Promise(function(resolve){return setTimeout(resolve,Math.round(seconds*1e3))});case 5:return _context6.abrupt("return",_context6.sent);case 6:case"end":return _context6.stop()}},_callee6)}));return function(_x3){return _ref6.apply(this,arguments)}}();beep8.Async.typewriter=function(){var _ref7=_asyncToGenerator(_regeneratorRuntime().mark(function _callee7(text){var wrapWidth,delay,startCol,startRow,i,endPos,c,_args7=arguments;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:wrapWidth=_args7.length>1&&_args7[1]!==undefined?_args7[1]:-1;delay=_args7.length>2&&_args7[2]!==undefined?_args7[2]:.05;beep8.Core.preflight("beep8.Async.typewriter");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("delay",delay);startCol=beep8.col();startRow=beep8.row();text=beep8.Core.textRenderer.wrapText(text,wrapWidth);i=0;case 9:if(!(i<=text.length)){_context7.next=20;break}if(beep8.CONFIG.PRINT_ESCAPE_START&&text.substring(i,i+beep8.CONFIG.PRINT_ESCAPE_START.length)===beep8.CONFIG.PRINT_ESCAPE_START){endPos=text.indexOf(beep8.CONFIG.PRINT_ESCAPE_END,i+beep8.CONFIG.PRINT_ESCAPE_START.length);if(endPos>=0){i=endPos+beep8.CONFIG.PRINT_ESCAPE_END.length}}c=text.charCodeAt(i);beep8.locate(startCol,startRow);beep8.print(text.substring(0,i));if(!(c!==32)){_context7.next=17;break}_context7.next=17;return beep8.Async.wait(delay);case 17:i++;_context7.next=9;break;case 20:case"end":return _context7.stop()}},_callee7)}));return function(_x4){return _ref7.apply(this,arguments)}}();beep8.Async.loadImage=function(){var _ref8=_asyncToGenerator(_regeneratorRuntime().mark(function _callee8(url){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:beep8.Core.preflight("beep8.Async.loadImage");return _context8.abrupt("return",new Promise(function(resolve){var img=new Image;img.onload=function(){return resolve(img)};img.src=url}));case 2:case"end":return _context8.stop()}},_callee8)}));return function(_x5){return _ref8.apply(this,arguments)}}();beep8.Async.loadSound=function(){var _ref9=_asyncToGenerator(_regeneratorRuntime().mark(function _callee9(url){return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:beep8.Core.preflight("beep8.Async.loadSound");return _context9.abrupt("return",new Promise(function(resolve){var audio=new Audio;audio.oncanplaythrough=function(){return resolve(audio)};audio.src=url;audio.load()}));case 2:case"end":return _context9.stop()}},_callee9)}));return function(_x6){return _ref9.apply(this,arguments)}}();beep8.Async.loadFont=function(){var _ref10=_asyncToGenerator(_regeneratorRuntime().mark(function _callee10(fontImageFile){var fontName;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:beep8.Core.preflight("beep8.Async.loadFont");beep8.Utilities.checkString("fontImageFile",fontImageFile);fontName="FONT@"+beep8.Utilities.makeUrlPretty(fontImageFile);_context10.next=5;return beep8.Core.textRenderer.loadFontAsync(fontName,fontImageFile);case 5:return _context10.abrupt("return",fontName);case 6:case"end":return _context10.stop()}},_callee10)}));return function(_x7){return _ref10.apply(this,arguments)}}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Core={};beep8.Core.textRenderer=null;beep8.Core.inputSys=null;beep8.Core.cursorRenderer=null;beep8.Core.realCanvas=null;beep8.Core.realCtx=null;beep8.Core.canvas=null;beep8.Core.ctx=null;beep8.Core.container=null;beep8.Core.deltaTime=0;beep8.Core.drawState={fgColor:7,bgColor:0,cursorCol:0,cursorRow:0,cursorVisible:false};var lastFrameTime=null;var crashed=false;var initDone=false;var frameHandler=null;var frameHandlerTargetInterval=null;var animFrameRequested=false;var timeToNextFrame=0;var scanLinesEl=null;var pendingAsync=null;var dirty=false;beep8.Core.init=function(callback,options){beep8.CONFIG=_objectSpread(_objectSpread({},beep8.CONFIG),options);beep8.Utilities.checkFunction("callback",callback);beep8.Core.asyncInit(callback)};beep8.Core.asyncInit=function(){var _ref11=_asyncToGenerator(_regeneratorRuntime().mark(function _callee11(callback){var _iterator,_step,className;return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:beep8.Utilities.log("beep8 System initialized");beep8.CONFIG.SCREEN_WIDTH=beep8.CONFIG.SCREEN_COLS*beep8.CONFIG.CHR_WIDTH;beep8.CONFIG.SCREEN_HEIGHT=beep8.CONFIG.SCREEN_ROWS*beep8.CONFIG.CHR_HEIGHT;beep8.Core.realCanvas=document.createElement("canvas");if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CANVAS_ID){beep8.Core.realCanvas.setAttribute("id",beep8.CONFIG.CANVAS_SETTINGS.CANVAS_ID)}if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES){_iterator=_createForOfIteratorHelper(beep8.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES);try{for(_iterator.s();!(_step=_iterator.n()).done;){className=_step.value;beep8.Core.realCanvas.classList.add(className)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}beep8.Core.realCanvas.style.touchAction="none";beep8.Core.realCanvas.style.userSelect="none";beep8.Core.realCanvas.style.imageRendering="pixelated";beep8.Core.realCanvas.addEventListener("touchstart",function(e){return e.preventDefault()});beep8.Core.container=document.createElement("div");beep8.Core.container.setAttribute("style","");beep8.Core.container.id="beep8";beep8.Core.container.style.display="block";beep8.Core.container.style.lineHeight="0";beep8.Core.container.style.position="relative";beep8.Core.container.appendChild(beep8.Core.realCanvas);beep8.Core.getBeepContainerEl().appendChild(beep8.Core.container);beep8.Core.canvas=document.createElement("canvas");beep8.Core.canvas.width=beep8.CONFIG.SCREEN_WIDTH;beep8.Core.canvas.height=beep8.CONFIG.SCREEN_HEIGHT;beep8.Core.canvas.style.width=beep8.CONFIG.SCREEN_WIDTH+"px";beep8.Core.canvas.style.height=beep8.CONFIG.SCREEN_HEIGHT+"px";beep8.Core.ctx=beep8.Core.canvas.getContext("2d");beep8.Core.ctx.imageSmoothingEnabled=false;beep8.Core.addScanlines();beep8.Core.textRenderer=new beep8.TextRenderer;beep8.Core.inputSys=new beep8.Input;beep8.Core.cursorRenderer=new beep8.CursorRenderer;_context11.next=31;return beep8.Core.textRenderer.initAsync();case 31:beep8.Core.updateLayout(false);window.addEventListener("resize",function(){return beep8.Core.updateLayout(true)});if(beep8.Core.isMobile()){beep8.Joystick.setup()}initDone=true;_context11.next=37;return beep8.Intro.loading();case 37:_context11.next=39;return beep8.Intro.splash();case 39:_context11.next=41;return new Promise(function(resolve){return setTimeout(resolve,1)});case 41:_context11.next=43;return callback();case 43:beep8.Core.render();case 44:case"end":return _context11.stop()}},_callee11)}));return function(_x8){return _ref11.apply(this,arguments)}}();beep8.Core.getBeepContainerEl=function(){var container=document.body;if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CONTAINER){var containerSpec=beep8.CONFIG.CANVAS_SETTINGS.CONTAINER;if(typeof containerSpec==="string"){container=document.getElementById(containerSpec);if(!container){console.error("beep8: Could not find container element with ID: "+containerSpec);container=document.body}}else if(containerSpec instanceof HTMLElement){container=containerSpec}else{console.error("beep8: beep8.CONFIG.CANVAS_SETTINGS.CONTAINER must be either an ID of an HTMLElement.");container=document.body}}return container};beep8.Core.preflight=function(apiMethod){if(crashed){throw new Error("Can't call API method ".concat(apiMethod,"() because the engine has crashed."))}if(!initDone){beep8.Utilities.fatal("Can't call API method ".concat(apiMethod,"(): API not initialized. ")+"Call initAsync() wait until it finishes before calling API methods.")}if(pendingAsync){beep8.Utilities.fatal("Can't call API method ".concat(apiMethod,"() because there is a pending async ")+"call to ".concat(pendingAsync.name,"() that hasn't finished running yet. Are you missing ")+"an 'await' keyword to wait for the async method? Use 'await ".concat(pendingAsync.name,"()',")+"not just '".concat(pendingAsync.name,"()'"))}};beep8.Core.startAsync=function(asyncMethodName,resolve,reject){if(pendingAsync){throw new Error("Internal bug: startAsync called while pendingAsync is not null. "+"Missing preflight() call?")}pendingAsync={name:asyncMethodName,resolve:resolve,reject:reject};beep8.Core.render()};beep8.Core.hasPendingAsync=function(asyncMethodName){return pendingAsync&&pendingAsync.name===asyncMethodName};beep8.Core.endAsyncImpl=function(asyncMethodName,isError,result){if(!pendingAsync){throw new Error("Internal bug: endAsync(".concat(asyncMethodName,") called with no pendingAsync"))}if(pendingAsync.name!==asyncMethodName){throw new Error("Internal bug: endAsync(".concat(asyncMethodName,") called but pendingAsync.name ")+"is ".concat(pendingAsync.name))}var fun=isError?pendingAsync.reject:pendingAsync.resolve;pendingAsync=null;fun(result)};beep8.Core.resolveAsync=function(asyncMethodName,result){beep8.Core.endAsyncImpl(asyncMethodName,false,result)};beep8.Core.failAsync=function(asyncMethodName,error){beep8.Core.endAsyncImpl(asyncMethodName,true,error)};beep8.Core.setFrameHandler=function(callback){var targetFps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:30;frameHandler=callback;frameHandlerTargetInterval=1/(targetFps||30);timeToNextFrame=0;if(!animFrameRequested){window.requestAnimationFrame(beep8.Core.doFrame)}};beep8.Core.render=function(){if(crashed)return;beep8.Core.realCtx.imageSmoothingEnabled=false;beep8.Core.realCtx.clearRect(0,0,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height);beep8.Core.realCtx.drawImage(beep8.Core.canvas,0,0,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height);dirty=false;beep8.Core.cursorRenderer.drawCursor(beep8.Core.realCtx,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height)};beep8.Core.markDirty=function(){if(dirty)return;dirty=true;setTimeout(beep8.Core.render,1)};beep8.Core.cls=function(){var bgColor=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;bgColor=bgColor||beep8.Core.drawState.bgColor;beep8.Utilities.checkNumber("bgColor",bgColor);beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(bgColor);beep8.Core.ctx.fillRect(0,0,beep8.Core.canvas.width,beep8.Core.canvas.height);this.setCursorLocation(0,0);beep8.Core.markDirty()};beep8.Core.defineColors=function(colors){beep8.Utilities.checkArray("colors",colors);beep8.CONFIG.COLORS=colors.slice();beep8.Core.textRenderer.regenColors()};beep8.Core.setColor=function(fg,bg){beep8.Utilities.checkNumber("fg",fg);beep8.Core.drawState.fgColor=Math.round(fg);if(bg!==undefined){beep8.Utilities.checkNumber("bg",bg);beep8.Core.drawState.bgColor=Math.round(bg)}};beep8.Core.setCursorLocation=function(col,row){beep8.Utilities.checkNumber("col",col);if(row!==undefined){beep8.Utilities.checkNumber("row",row)}beep8.Core.drawState.cursorCol=Math.round(col);if(row!==undefined){beep8.Core.drawState.cursorRow=Math.round(row)}};beep8.Core.getColorHex=function(c){if(typeof c!=="number"){return"#f0f"}if(c<0){return"#000"}c=beep8.Utilities.clamp(Math.round(c),0,beep8.CONFIG.COLORS.length-1);return beep8.CONFIG.COLORS[c]};beep8.Core.getNow=function(){if(window.performance&&window.performance.now){return window.performance.now()}return(new Date).getTime()};beep8.Core.drawImage=function(img,x,y,srcX,srcY,width,height){beep8.Utilities.checkInstanceOf("img",img,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);if(srcX!==undefined)beep8.Utilities.checkNumber("srcX",srcX);if(srcY!==undefined)beep8.Utilities.checkNumber("srcY",srcY);if(width!==undefined)beep8.Utilities.checkNumber("width",width);if(height!==undefined)beep8.Utilities.checkNumber("height",height);if(srcX!==undefined&&srcY!==undefined&&width!==undefined&&height!==undefined){beep8.Core.ctx.drawImage(img,srcX,srcY,width,height,x,y,width,height)}else{beep8.Core.ctx.drawImage(img,x,y)}};beep8.Core.drawRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);var oldStrokeStyle=beep8.Core.ctx.strokeStyle;beep8.Core.ctx.strokeStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);beep8.Core.ctx.strokeRect(Math.round(x)+.5,Math.round(y)+.5,Math.round(width)-1,Math.round(height)-1);beep8.Core.ctx.strokeStyle=oldStrokeStyle};beep8.Core.fillRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);beep8.Core.ctx.fillRect(Math.round(x)+.5,Math.round(y)+.5,Math.round(width)-1,Math.round(height)-1)};beep8.Core.saveScreen=function(){return beep8.Core.ctx.getImageData(0,0,beep8.Core.canvas.width,beep8.Core.canvas.height)};beep8.Core.restoreScreen=function(screenData){beep8.Utilities.checkInstanceOf("screenData",screenData,ImageData);beep8.Core.ctx.putImageData(screenData,0,0)};beep8.Core.doFrame=_asyncToGenerator(_regeneratorRuntime().mark(function _callee12(){var now,numFramesDone;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:animFrameRequested=false;now=beep8.Core.getNow();beep8.Core.deltaTime=lastFrameTime!==null?.001*(now-lastFrameTime):1/60;beep8.Core.deltaTime=Math.min(beep8.Core.deltaTime,.05);lastFrameTime=now;timeToNextFrame+=beep8.Core.deltaTime;numFramesDone=0;case 7:if(!(frameHandler&&numFramesDone<4&&timeToNextFrame>frameHandlerTargetInterval)){_context12.next=15;break}_context12.next=10;return frameHandler();case 10:beep8.Core.inputSys.onEndFrame();timeToNextFrame-=frameHandlerTargetInterval;++numFramesDone;_context12.next=7;break;case 15:beep8.Core.render();if(frameHandler){animFrameRequested=true;window.requestAnimationFrame(beep8.Core.doFrame)}case 17:case"end":return _context12.stop()}},_callee12)}));beep8.Core.updateLayout=function(renderNow){beep8.Core.updateLayout2d();if(renderNow){beep8.Core.render()}};beep8.Core.updateLayout2d=function(){beep8.Core.realCtx=beep8.Core.realCanvas.getContext("2d");beep8.Core.realCtx.imageSmoothingEnabled=false;beep8.CONFIG.SCREEN_EL_WIDTH=beep8.CONFIG.SCREEN_WIDTH;beep8.CONFIG.SCREEN_EL_HEIGHT=beep8.CONFIG.SCREEN_HEIGHT;beep8.CONFIG.SCREEN_REAL_WIDTH=beep8.CONFIG.SCREEN_WIDTH;beep8.CONFIG.SCREEN_REAL_HEIGHT=beep8.CONFIG.SCREEN_HEIGHT;beep8.Core.realCanvas.style.width="100%";beep8.Core.realCanvas.style.height="100%";beep8.Core.realCanvas.width=beep8.CONFIG.SCREEN_REAL_WIDTH;beep8.Core.realCanvas.height=beep8.CONFIG.SCREEN_REAL_HEIGHT;console.log(beep8.CONFIG.SCREEN_REAL_HEIGHT,beep8.CONFIG.SCREEN_EL_HEIGHT);beep8.Core.container.style.aspectRatio="".concat(beep8.CONFIG.SCREEN_ROWS," / ").concat(beep8.CONFIG.SCREEN_COLS)};beep8.Core.addScanlines=function(){if(scanLinesEl){return}var scanLinesOp=beep8.CONFIG.SCAN_LINES_OPACITY||0;if(scanLinesOp>0){if(!scanLinesEl){scanLinesEl=document.createElement("div");beep8.Core.container.appendChild(scanLinesEl)}scanLinesEl.style.background="linear-gradient(rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 50%), "+"linear-gradient(90deg, rgba(255, 0, 0, .6), rgba(0, 255, 0, .2), rgba(0, 0, 255, .6))";scanLinesEl.style.backgroundSize="100% 4px, 3px 100%";scanLinesEl.style.opacity=scanLinesOp;scanLinesEl.style.position="absolute";scanLinesEl.style.left=0;scanLinesEl.style.top=0;scanLinesEl.style.width="100%";scanLinesEl.style.height="100%";scanLinesEl.style.zIndex=1}};var crashing=false;beep8.Core.handleCrash=function(){var errorMessage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"Fatal error";if(crashed||crashing)return;crashing=true;beep8.Core.setColor(beep8.CONFIG.COLORS.length-1,0);beep8.Core.cls();beep8.Core.drawState.cursorCol=beep8.Core.drawState.cursorRow=1;beep8.Core.textRenderer.print("*** CRASH ***:\n"+errorMessage);beep8.Core.render();crashing=false;crashed=true};beep8.Core.isTouchDevice=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0};beep8.Core.isMobile=function(){return beep8.Core.isIOS()||beep8.Core.isAndroid()};beep8.Core.isIOS=function(){return/(ipad|ipod|iphone)/i.test(navigator.userAgent)};beep8.Core.isAndroid=function(){return/android/i.test(navigator.userAgent)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.CursorRenderer=function(){function _class(){_classCallCheck(this,_class);this.blinkCycle_=0;this.toggleBlinkHandle_=null}return _createClass(_class,[{key:"setCursorVisible",value:function setCursorVisible(visible){var _this=this;beep8.Utilities.checkBoolean("visible",visible);if(beep8.Core.drawState.cursorVisible===visible)return;beep8.Core.drawState.cursorVisible=visible;this.blinkCycle_=0;beep8.Core.render();if(this.toggleBlinkHandle_!==null){clearInterval(this.toggleBlinkHandle_);this.toggleBlinkHandle_=null}if(visible){this.toggleBlinkHandle_=setInterval(function(){return _this.advanceBlink_()},beep8.CONFIG.CURSOR.BLINK_INTERVAL)}}},{key:"advanceBlink_",value:function advanceBlink_(){this.blinkCycle_=(this.blinkCycle_+1)%2;beep8.Core.render()}},{key:"drawCursor",value:function drawCursor(targetCtx,canvasWidth,canvasHeight){beep8.Utilities.checkInstanceOf("targetCtx",targetCtx,CanvasRenderingContext2D);beep8.Utilities.checkNumber("canvasWidth",canvasWidth);beep8.Utilities.checkNumber("canvasHeight",canvasHeight);if(!beep8.Core.drawState.cursorVisible||this.blinkCycle_<=0)return;var ratio=canvasWidth/beep8.Core.canvas.width;var realX=Math.round((beep8.Core.drawState.cursorCol+.5-beep8.CONFIG.CURSOR.WIDTH_F/2+beep8.CONFIG.CURSOR.OFFSET_H)*beep8.CONFIG.CHR_WIDTH*ratio);var realY=Math.round((beep8.Core.drawState.cursorRow+1-beep8.CONFIG.CURSOR.HEIGHT_F-beep8.CONFIG.CURSOR.OFFSET_V)*beep8.CONFIG.CHR_HEIGHT*ratio);targetCtx.fillStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);targetCtx.fillRect(realX,realY,Math.round(beep8.CONFIG.CURSOR.WIDTH_F*beep8.CONFIG.CHR_WIDTH*ratio),Math.round(beep8.CONFIG.CURSOR.HEIGHT_F*beep8.CONFIG.CHR_HEIGHT*ratio))}}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Input=function(){function _class2(){var _this2=this;_classCallCheck(this,_class2);this.keysHeld_=new Set;this.keysJustPressed_=new Set;window.addEventListener("keydown",function(e){return _this2.onKeyDown(e)});window.addEventListener("keyup",function(e){return _this2.onKeyUp(e)});window.addEventListener("pointerdown",function(e){return _this2.onPointerDown(e)})}return _createClass(_class2,[{key:"keyHeld",value:function keyHeld(keyName){return this.keysHeld_.has(keyName.toUpperCase())}},{key:"keyJustPressed",value:function keyJustPressed(keyName){return this.keysJustPressed_.has(keyName.toUpperCase())}},{key:"onEndFrame",value:function onEndFrame(){this.keysJustPressed_.clear()}},{key:"onKeyDown",value:function onKeyDown(e){this.keysJustPressed_.add(e.key.toUpperCase());this.keysHeld_.add(e.key.toUpperCase());if(beep8.Core.hasPendingAsync("beep8.Async.key")){beep8.Core.resolveAsync("beep8.Async.key",e.key)}}},{key:"onPointerDown",value:function onPointerDown(e){if(beep8.Core.hasPendingAsync("beep8.Async.pointer")){console.log("Pointer event");beep8.Core.resolveAsync("beep8.Async.pointer",{x:e.clientX,y:e.clientY})}}},{key:"onKeyUp",value:function onKeyUp(e){this.keysHeld_["delete"](e.key.toUpperCase())}},{key:"readKeyAsync",value:function readKeyAsync(){return new Promise(function(resolve,reject){beep8.Core.startAsync("beep8.Async.key",resolve,reject)})}},{key:"readPointerAsync",value:function readPointerAsync(){return new Promise(function(resolve,reject){beep8.Core.startAsync("beep8.Async.pointer",resolve,reject)})}},{key:"readLine",value:function(){var _readLine=_asyncToGenerator(_regeneratorRuntime().mark(function _callee13(initString,maxLen){var maxWidth,startCol,startRow,curCol,curRow,curStrings,curPos,cursorWasVisible,key,_args13=arguments;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:maxWidth=_args13.length>2&&_args13[2]!==undefined?_args13[2]:-1;startCol=beep8.Core.drawState.cursorCol;startRow=beep8.Core.drawState.cursorRow;curCol=startCol;curRow=startRow;curStrings=[initString];curPos=0;cursorWasVisible=beep8.Core.drawState.cursorVisible;beep8.Core.cursorRenderer.setCursorVisible(true);case 9:if(!true){_context13.next=37;break}beep8.Core.setCursorLocation(curCol,curRow);beep8.Core.textRenderer.print(curStrings[curPos]||"");_context13.next=14;return this.readKeyAsync();case 14:key=_context13.sent;if(!(key==="Backspace")){_context13.next=27;break}if(!(curStrings[curPos].length===0)){_context13.next=21;break}if(!(curPos===0)){_context13.next=19;break}return _context13.abrupt("continue",9);case 19:curPos--;curRow--;case 21:curStrings[curPos]=curStrings[curPos].length>0?curStrings[curPos].substring(0,curStrings[curPos].length-1):curStrings[curPos];beep8.Core.setCursorLocation(curCol+curStrings[curPos].length,curRow);beep8.Core.textRenderer.print(" ");beep8.Sfx.play(beep8.CONFIG.SFX.TYPING);_context13.next=35;break;case 27:if(!(key==="Enter")){_context13.next=34;break}beep8.Core.setCursorLocation(1,curRow+1);beep8.Core.cursorRenderer.setCursorVisible(cursorWasVisible);beep8.Sfx.play(beep8.CONFIG.SFX.TYPING);return _context13.abrupt("return",curStrings.join(""));case 34:if(key.length===1){if(curStrings.join("").length<maxLen||maxLen===-1){curStrings[curPos]+=key;if(maxWidth!==-1&&curStrings[curPos].length>=maxWidth){beep8.Core.textRenderer.print(curStrings[curPos].charAt(curStrings[curPos].length-1));curCol=startCol;curPos++;curStrings[curPos]="";curRow++}}beep8.Sfx.play(beep8.CONFIG.SFX.TYPING)}case 35:_context13.next=9;break;case 37:case"end":return _context13.stop()}},_callee13,this)}));function readLine(_x9,_x10){return _readLine.apply(this,arguments)}return readLine}()}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Intro={};beep8.Intro.loading=function(){var _ref13=_asyncToGenerator(_regeneratorRuntime().mark(function _callee14(sfx){var colourCount,prefix;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:colourCount=beep8.CONFIG.COLORS.length;prefix="8> ";beep8.color(0,10);beep8.cls();beep8.locate(1,1);beep8.print(prefix+"beep8 Loading...\n");_context14.next=8;return beep8.Async.wait(.1);case 8:beep8.print(prefix+"Let's 'a go!");_context14.next=11;return beep8.Async.wait(.3);case 11:case"end":return _context14.stop()}},_callee14)}));return function(_x11){return _ref13.apply(this,arguments)}}();beep8.Intro.splash=_asyncToGenerator(_regeneratorRuntime().mark(function _callee15(){var name,startCol,message;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:name=beep8.CONFIG.NAME;startCol=2;beep8.color(0,10);beep8.cls();beep8.locate(1,1);beep8.printBox(beep8.CONFIG.SCREEN_COLS-2,beep8.CONFIG.SCREEN_ROWS-2);startCol=Math.floor((beep8.CONFIG.SCREEN_COLS-name.length)/2);beep8.locate(startCol,Math.floor(beep8.CONFIG.SCREEN_ROWS*.3));beep8.print(name+"\n");beep8.print("_".repeat(name.length)+"\n");message="Click to start";if(beep8.Core.isTouchDevice())message="Tap to start";startCol=Math.round((beep8.CONFIG.SCREEN_COLS-message.length)/2);beep8.locate(startCol,beep8.CONFIG.SCREEN_ROWS-4);beep8.print(message);_context15.next=17;return beep8.Core.inputSys.readPointerAsync();case 17:case"end":return _context15.stop()}},_callee15)}))})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Menu={};beep8.Menu.display=function(){var _ref15=_asyncToGenerator(_regeneratorRuntime().mark(function _callee16(choices,options){var startCol,startRow,promptSize,prompt01,border01,choicesCols,choicesRows,totalCols,totalRows,t,selIndex,k;return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:options=options||{};beep8.Utilities.checkArray("choices",choices);beep8.Utilities.checkObject("options",options);options=Object.assign({title:"",prompt:"",selBgColor:beep8.Core.drawState.fgColor,selFgColor:beep8.Core.drawState.bgColor,bgChar:0,borderChar:48,center:false,centerH:false,centerV:false,padding:1,selIndex:0,cancelable:false},options);startCol=beep8.Core.drawState.cursorCol;startRow=beep8.Core.drawState.cursorRow;promptSize=beep8.Core.textRenderer.measure(options.prompt);prompt01=options.prompt?1:0;border01=options.borderChar?1:0;choicesCols=0;choicesRows=choices.length;choices.forEach(function(choice){return choicesCols=Math.max(choicesCols,choice.length)});totalCols=Math.max(promptSize.cols,choicesCols)+2*options.padding+2*border01;totalRows=prompt01*(promptSize.rows+1)+choicesRows+2*options.padding+2*border01;if(options.centerH||options.center){startCol=Math.round((beep8.CONFIG.SCREEN_COLS-totalCols)/2)}if(options.centerV||options.center){startRow=Math.round((beep8.CONFIG.SCREEN_ROWS-totalRows)/2)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow;beep8.Core.textRenderer.printRect(totalCols,totalRows,options.bgChar);if(options.borderChar){beep8.Core.textRenderer.printBox(totalCols,totalRows,false,options.borderChar);if(options.title){t=" "+options.title+" ";beep8.Core.drawState.cursorCol=startCol+Math.round((totalCols-t.length)/2);beep8.Core.textRenderer.print(t)}}if(options.prompt){beep8.Core.drawState.cursorCol=promptSize.cols<=totalCols?startCol+border01+options.padding:startCol+Math.round((totalCols-promptSize.cols)/2);beep8.Core.drawState.cursorRow=startRow+border01+options.padding;beep8.Core.textRenderer.print(options.prompt)}selIndex=options.selIndex;case 22:if(!true){_context16.next=48;break}beep8.Core.drawState.cursorRow=startRow+border01+options.padding+prompt01*(promptSize.rows+1);beep8.Core.drawState.cursorCol=promptSize.cols<=choicesCols?startCol+border01+options.padding:startCol+Math.round((totalCols-choicesCols)/2);beep8.Menu.printChoices(choices,selIndex,options);_context16.next=28;return beep8.Core.inputSys.readKeyAsync();case 28:k=_context16.sent;if(!(k==="ArrowUp")){_context16.next=34;break}selIndex=selIndex>0?selIndex-1:choices.length-1;if(choices.length>1)beep8.Sfx.play(beep8.CONFIG.SFX.MENU_UP);_context16.next=46;break;case 34:if(!(k==="ArrowDown")){_context16.next=39;break}selIndex=(selIndex+1)%choices.length;if(choices.length>1)beep8.Sfx.play(beep8.CONFIG.SFX.MENU_DOWN);_context16.next=46;break;case 39:if(!(k==="Enter"||k==="ButtonA")){_context16.next=44;break}beep8.Sfx.play(beep8.CONFIG.SFX.MENU_SELECT);return _context16.abrupt("return",selIndex);case 44:if(!((k==="Escape"||k==="ButtonB")&&options.cancelable)){_context16.next=46;break}return _context16.abrupt("return",-1);case 46:_context16.next=22;break;case 48:case"end":return _context16.stop()}},_callee16)}));return function(_x12,_x13){return _ref15.apply(this,arguments)}}();beep8.Menu.printChoices=function(choices,selIndex,options){var origBg=beep8.Core.drawState.bgColor;var origFg=beep8.Core.drawState.fgColor;for(var i=0;i<choices.length;i++){var isSel=i===selIndex;beep8.Core.setColor(isSel?options.selFgColor:origFg,isSel?options.selBgColor:origBg);beep8.Core.textRenderer.print(choices[i]+"\n")}beep8.Core.setColor(origFg,origBg)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var audioContext=typeof AudioContext!=="undefined"?new AudioContext:new webkitAudioContext;var startPatterns=["X-X-","XX--"];var followPatterns=["X--X","X-X-","XX--"];var bassPatterns=["X---","X---X---","X-------","X-X-X-X-","X-------X-------","X-------        ","        X-------"];var scales={minor:[2,1,2,2,1,2,2],harmonicMinor:[2,1,2,2,1,3,1],melodicMinorAscending:[2,1,2,2,2,2,1],melodicMinorDescending:[2,1,2,2,1,2,2],pentatonicMajor:[2,2,3,2,3],pentatonicMinor:[3,2,2,3,2],blues:[3,2,1,1,3,2],chromatic:[1,1,1,1,1,1,1,1,1,1,1,1],wholeTone:[2,2,2,2,2,2],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2],phrygianDominant:[1,3,1,2,1,2,2],hungarianMinor:[2,1,3,1,1,3,1],gypsy:[1,3,1,2,1,3,1],japanese:[1,4,2,1,4],arabian:[2,2,1,1,2,2,2],eastern:[1,2,2,1,1,3,1]};var scaleRangeDistance=[3,2,2,1,1,1,0,0,0,0,-1,-1,-1,-2,-2,-3];var speedRange=[75,100,150,200,250,300];var durationRange=[40,50,60,70,80,90];var scaleRange=12;var noteMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");beep8.Music={};beep8.Music.play=function(song){console.log("play song",song);p1(song)};beep8.Music.create=function(){var melody=[];var scaleKeys=Object.keys(scales);var scaleIndex=scaleKeys[Math.floor(Math.random()*scaleKeys.length)];var pattern=generatePattern(8,startPatterns,followPatterns);melody.push(generateMelody(generateScale(2,scaleIndex),pattern));melody.push(generateMelody(generateScale(1,scaleIndex),pattern));var bassRepeat=Math.floor(Math.random()*3)+1;melody.push(generateMelody(generateScale(0,scaleIndex),generatePattern(bassRepeat,[],bassPatterns)));return"".concat(beep8.Utilities.randomPick(speedRange),".").concat(beep8.Utilities.randomPick(durationRange),"\n").concat(melody.join("\n"))};function generateScale(noteMapId,scaleIndex){var startNote=noteMapId*scaleRange;var scale=[];var currentIndex=startNote;var _iterator2=_createForOfIteratorHelper(scales[scaleIndex]),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var interval=_step2.value;scale.push(noteMap[currentIndex]);console.log(noteMap[currentIndex],currentIndex);currentIndex+=interval}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return scale}function generatePattern(){var totalPatterns=arguments.length>0&&arguments[0]!==undefined?arguments[0]:4;var startPatterns=arguments.length>1&&arguments[1]!==undefined?arguments[1]:startPatterns;var followPatterns=arguments.length>2&&arguments[2]!==undefined?arguments[2]:followPatterns;if(totalPatterns<1){return""}var pattern=[];if(startPatterns.length>0){pattern.push(startPatterns[Math.floor(Math.random()*startPatterns.length)])}if(followPatterns.length>0){for(var i=1;i<totalPatterns;i++){var randomPattern=followPatterns[Math.floor(Math.random()*followPatterns.length)];var patternRepeat=Math.floor(Math.random()*3)+1;for(var j=0;j<patternRepeat;j++){pattern.push(randomPattern)}}}console.log(pattern);return pattern.join("|")}function generateMelody(scale,rhythmPattern){var melody="";var scaleIndex=Math.floor(Math.random()*scale.length);for(var i=0;i<rhythmPattern.length;i++){if(rhythmPattern[i]==="-"){melody+="-"}if(rhythmPattern[i]===" "){melody+=" "}if(rhythmPattern[i]==="|"){melody+="|"}if(rhythmPattern[i]==="X"){melody+=scale[scaleIndex];scaleIndex+=scaleRangeDistance[Math.floor(Math.random()*scaleRangeDistance.length)];if(scaleIndex<0){scaleIndex=0}if(scaleIndex>=scale.length){scaleIndex=scale.length-1}}}return melody}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var sfxLibrary={coin:[,0,1675,,.06,.24,1,1.82,,,837,.06],coin2:[,0,523.2511,.01,.06,.3,1,1.82,,,837,.06],blip:[3,0,150,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],blip2:[1.5,0,200,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],blip3:[2,0,250,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],hit:[,0,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17],sparkle:[,0,539,0,.04,.29,1,1.92,,,567,.02,.02,,,,.04],sparkle2:[,0,80,.3,.4,.7,2,.1,-.73,3.42,-430,.09,.17,,,,.19],life:[,0,537,.02,.02,.22,1,1.59,-6.98,4.97],break:[,0,528,.01,,.48,,.6,-11.6,,,,.32,4.2],life2:[,0,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07],alien:[,0,662,.82,.11,.33,1,0,,-.2,,,,1.2,,.26,.01],beep:[1.5,0,270,,.1,,1,1.5,,,,,,,,.1,.01],beep2:[1.2,0,150,,.1,,1,1.5,,,,,,,,.1,.01],beep3:[1.5,0,200,,.1,,1,1.5,,,,,,,,.1,.01],ding:[.9,0,685,.01,.03,.17,1,1.4,,,,,,,,,,.63,.01,,420],drum:[,0,129,.01,,.15,,,,,,,,5],explode:[,0,333,.01,0,.9,4,1.9,,,,,,.5,,.6],explode2:[,0,418,0,.02,.2,4,1.15,-8.5,,,,,.7,,.1],explode3:[,0,82,.02,,.2,4,4,,,,,,.8,,.2,,.8,.09],squeak1:[,0,1975,.08,.56,.02,,,-.4,,-322,.56,.41,,,,.25],squeak2:[,0,75,.03,.08,.17,1,1.88,7.83,,,,,.4],squeak3:[,0,1306,.8,.08,.02,1,,,,,,.48,,-.1,.11,.25],squeak4:[,0,1e3,.02,,.01,2,,18,,475,.01,.01],bell:[2,0,999,,,,,1.5,,.3,-99,.1,1.63,,,.11,.22],satellite:[,0,847,.02,.3,.9,1,1.67,,,-294,.04,.13,,,,.1],phone:[,0,1600,.13,.52,.61,1,1.1,,,,,,.1,,.14],pop:[,0,224,.02,.02,.08,1,1.7,-13.9,,,,,,6.7],rocket:[,0,941,.8,,.8,4,.74,-222,,,,,.8,,1],rocket2:[,0,172,.8,,.8,1,.76,7.7,3.73,-482,.08,.15,,.14],squirt:[,0,448,.01,.1,.3,3,.39,-.5,,,,,,.2,.1,.08],swing:[,0,150,.05,,.05,,1.3,,,,,,3],wave:[,0,40,.5,,1.5,,11,,,,,,199],warp:[2,0,713,.16,.09,.24,,.6,-29,-16,,,.09,.5,,,.23,.75,.15,.48],radioactive:[,0,130,.02,.9,.39,2,.8,,,,,.13,.2,,.1,,.93,.06,.28],siren:[,0,960,,1,.01,,.8,-.01,,-190,.5,,.05,,,1],car_horn:[1.5,0,250,.02,.02,.2,2,2,,,,,.02,,,.02,.01,,,.1],engine2:[,0,25,.05,.3,.5,3,9,-.01,,,,,,13,.1,.2],thunder:[,0,471,,.09,.47,4,1.06,-6.7,,,,,.9,61,.1,,.82,.09,.13],sparkle3:[,0,63,,1,,1,1.5,,,,,,,,3.69,.08],sweep:[,0,9220,.01,,,,5,,,,,,9],click:[1.1,0,900,,.01,0,1,,-10,,-31,.02,,,,,,1.2,,.16,-1448]};beep8.Sfx={};beep8.Sfx.play=function(){var sfx=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(!sfx)return;beep8.Utilities.checkString("sfx",sfx);if(!sfxLibrary[sfx]){beep8.Utilities.error("SFX ".concat(sfx," not found."))}zzfx.apply(void 0,_toConsumableArray(sfxLibrary[sfx]))};beep8.Sfx.add=function(sfxName,sfxArray){beep8.Utilities.checkString("sfxName",sfxName);beep8.Utilities.checkArray("sfxArray",sfxArray);sfxLibrary[sfxName]=sfxArray};beep8.Sfx.get=function(){return Object.keys(sfxLibrary)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var styles={classical:{roots:"CDEFGAB".split(""),modes:["maj","min"],len_seqs:[[1],[2,2],[2,4,4],[2,4,8,8],[4,4,4,4],[2,8,8,8,8],[4,4,4,8,8],[8,8,8,8,8,8,8,8]],numNotes:64,numTracks:4,tempo:600,sustain:70},jazz:{roots:"CDEFGAB".split(""),modes:["maj","min","blues","pentatonic"],len_seqs:[[2,2,2,2,2,2],[3,3,3],[4,4,8],[8,8]],numNotes:48,numTracks:5,tempo:450,sustain:60},rock:{roots:"CDEFGAB".split(""),modes:["maj","min","pentatonic"],len_seqs:[[4,4,4,4],[8,8,8,8],[4,8,8,8]],numNotes:32,numTracks:3,tempo:500,sustain:80},electro:{roots:"CDEFGAB".split(""),modes:["maj","min"],len_seqs:[[8,8,8,8,8,8,8,8],[16,16,16,16],[8,8,16,16]],numNotes:32,numTracks:2,tempo:400,sustain:90}};beep8.Sound={};beep8.Sound.playSong=function(song){console.log("play song",song);p1(song)};beep8.Sound.stopSong=function(){p1("")};beep8.Sound.createMusic=function(){function generateP1Music(seed,style){var generator=new Math.seedrandom(seed);var selectedStyle=styles[style];var roots=selectedStyle.roots,modes=selectedStyle.modes,len_seqs=selectedStyle.len_seqs,numNotes=selectedStyle.numNotes,numTracks=selectedStyle.numTracks,tempo=selectedStyle.tempo,sustain=selectedStyle.sustain;var root=roots[Math.floor(generator()*roots.length)];var mode=modes[Math.floor(generator()*modes.length)];var scale=generateScale(root,mode,2,5);var markovChain={C:["D","E","G"],D:["E","F","A"],E:["F","G","C"],F:["G","A","D"],G:["A","B","E"],A:["B","C","F"],B:["C","D","G"]};var tracks=[];for(var t=0;t<numTracks;t++){var notes=generateNotes(scale,len_seqs,generator,8,numNotes,markovChain);var p1Music=convertNotesToP1(notes);tracks.push(p1Music)}var p1FormattedMusic="".concat(tempo,".").concat(sustain,"\n").concat(tracks.join("\n"));return p1FormattedMusic}function generateScale(root,mode,min_oct,max_oct){var steps={maj:[2,2,1,2,2,2,1],min:[2,1,2,2,1,2,2],blues:[3,2,1,1,3,2],pentatonic:[2,2,3,2,3]}[mode];var notes="CDEFGAB".split("");var scale=[];for(var oct=min_oct;oct<=max_oct;oct++){var noteIndex=notes.indexOf(root);var _iterator3=_createForOfIteratorHelper(steps),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var step=_step3.value;scale.push(notes[noteIndex]+oct);noteIndex=(noteIndex+step)%notes.length}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return scale}function generateNotes(scale,len_seqs,generator,res,numNotes,markovChain){var notes="";var currentNote=scale[Math.floor(generator()*scale.length)];for(var i=0;i<numNotes;i++){var seq=len_seqs[Math.floor(generator()*len_seqs.length)];var len=seq[Math.floor(generator()*seq.length)];var noteLen=res/len;notes+=currentNote[0]+currentNote[1]+"-".repeat(noteLen-1)+" ";currentNote=getNextNoteUsingMarkovChain(currentNote,markovChain,generator)}return notes.trim()}function getNextNoteUsingMarkovChain(currentNote,markovChain,generator){var note=currentNote[0];var possibleNextNotes=markovChain[note];var nextNote=possibleNextNotes[Math.floor(generator()*possibleNextNotes.length)];return nextNote+currentNote[1]}function convertNotesToP1(notes){var p1Letters={C2:"C",D2:"D",E2:"E",F2:"F",G2:"G",A2:"A",B2:"B",C3:"V",D3:"W",E3:"X",F3:"Y",G3:"Z",A3:"a",B3:"b",C4:"c",D4:"d",E4:"e",F4:"f",G4:"g",A4:"h",B4:"i",C5:"j",D5:"k",E5:"l",F5:"m",G5:"n",A5:"o",B5:"p"};var p1String="";var _iterator4=_createForOfIteratorHelper(notes.split(" ")),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var note=_step4.value;var p1Note=p1Letters[note[0]+note[1]];p1String+=p1Note?p1Note+note.slice(2):" "}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return p1String.trim()}var seed="d12d21ddd";var music=generateP1Music(seed,"rock");console.log(music);return music}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var charMap=[];beep8.TextRenderer=function(){function _class3(){_classCallCheck(this,_class3);this.fonts_={};this.curFont_=null;this.curTiles_=null}return _createClass(_class3,[{key:"prepareCharMap",value:function prepareCharMap(){var charString=_toConsumableArray(beep8.CONFIG.CHRS);for(var i=0;i<charString.length;i++){charMap.push(charString[i].charCodeAt(0))}}},{key:"initAsync",value:function(){var _initAsync=_asyncToGenerator(_regeneratorRuntime().mark(function _callee17(){return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:beep8.Utilities.log("beep8.TextRenderer init.");_context17.next=3;return this.loadFontAsync("default",beep8.CONFIG.FONT_DEFAULT);case 3:this.curFont_=_context17.sent;_context17.next=6;return this.loadFontAsync("tiles",beep8.CONFIG.FONT_TILES);case 6:this.curTiles_=_context17.sent;this.prepareCharMap();case 8:case"end":return _context17.stop()}},_callee17,this)}));function initAsync(){return _initAsync.apply(this,arguments)}return initAsync}()},{key:"loadFontAsync",value:function(){var _loadFontAsync=_asyncToGenerator(_regeneratorRuntime().mark(function _callee18(fontName,fontImageFile){var font;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:beep8.Utilities.checkString("fontName",fontName);beep8.Utilities.checkString("fontImageFile",fontImageFile);font=new beep8.TextRendererFont(fontName,fontImageFile);_context18.next=5;return font.initAsync();case 5:this.fonts_[fontName]=font;return _context18.abrupt("return",font);case 7:case"end":return _context18.stop()}},_callee18,this)}));function loadFontAsync(_x14,_x15){return _loadFontAsync.apply(this,arguments)}return loadFontAsync}()},{key:"setFont",value:function setFont(fontName){var font=this.getFontByName(fontName);if(font){this.curFont_=font}}},{key:"getFont",value:function getFont(){return this.curFont_}},{key:"setTileFont",value:function setTileFont(fontName){var font=this.getFontByName(fontName);if(font){this.curTiles_=font}}},{key:"getFontByName",value:function getFontByName(fontName){beep8.Utilities.checkString("fontName",fontName);var font=this.fonts_[fontName];if(!font){beep8.Utilities.fatal("setFont(): font not found: ".concat(fontName));return}var cw=font.getCharWidth();var ch=font.getCharHeight();if(cw%beep8.CONFIG.CHR_WIDTH!==0||ch%beep8.CONFIG.CHR_HEIGHT!==0){beep8.Utilities.fatal("getFontByName(): font ".concat(fontName," has character size ").concat(cw,"x").concat(ch,", ")+"which is not an integer multiple of beep8.CONFIG.CHR_WIDTH x beep8.CONFIG.CHR_HEIGHT = "+"".concat(beep8.CONFIG.CHR_WIDTH,"x").concat(beep8.CONFIG.CHR_HEIGHT,", so it can't be set as the ")+"current font due to the row,column system. However, you can still use it "+"directly with drawText() by passing it as a parameter to that function.");return}return font}},{key:"print",value:function print(text){var font=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var wrapWidth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;this.printFont_=font||this.curFont_;beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("wrapWidth",wrapWidth);if(font!==null){beep8.Utilities.checkObject("font",font)}text=this.wrapText(text,wrapWidth,font);if(text.length>0&&text[text.length-1]!=="\n"){text+="\n"}var col=beep8.Core.drawState.cursorCol;var row=beep8.Core.drawState.cursorRow;this.origFgColor_=beep8.Core.drawState.fgColor;this.origBgColor_=beep8.Core.drawState.bgColor;this.origFont_=this.printFont_;var colInc=this.printFont_.getCharColCount();var rowInc=this.printFont_.getCharRowCount();var initialCol=col;for(var i=0;i<text.length;i++){i=this.processEscapeSeq_(text,i);var ch=text.charCodeAt(i);if(ch===10){col=initialCol;row+=rowInc}else{var chIndex=charMap.indexOf(ch);if(chIndex>=0){this.put_(chIndex,col,row,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,this.printFont_);col+=colInc}}}beep8.Core.drawState.cursorCol=col;beep8.Core.drawState.cursorRow=row;beep8.Core.drawState.fgColor=this.origFgColor_;beep8.Core.drawState.bgColor=this.origBgColor_;beep8.Core.markDirty()}},{key:"printCentered",value:function printCentered(text,width){beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("width",width);text=text.split("\n")[0];if(!text){return}var textWidth=this.measure(text).cols;var col=Math.floor(beep8.Core.drawState.cursorCol+(width-textWidth)/2);beep8.Core.drawState.cursorCol=col;this.print(text)}},{key:"printChar",value:function printChar(ch,n){var font=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(n===undefined||isNaN(n)){n=1}beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("n",n);while(n-- >0){this.put_(ch,beep8.Core.drawState.cursorCol,beep8.Core.drawState.cursorRow,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,font);beep8.Core.drawState.cursorCol++}beep8.Core.markDirty()}},{key:"spr",value:function spr(ch,x,y){beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);this.putxy_(ch,x,y,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor)}},{key:"drawText",value:function drawText(x,y,text,fontName){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkString("text",text);if(fontName){beep8.Utilities.checkString("fontName",fontName)}var x0=x;var font=fontName?this.fonts_[fontName]||this.curFont_:this.curFont_;if(!font){beep8.Utilities.warn("Requested font '".concat(fontName,"' not found: not drawing text."));return}for(var i=0;i<text.length;i++){var ch=text.charCodeAt(i);if(ch===10){x=x0;y+=font.getCharHeight()}else{this.putxy_(ch,x,y,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,font);x+=font.getCharWidth()}}}},{key:"measure",value:function measure(text){beep8.Utilities.checkString("text",text);if(text===""){return{cols:0,rows:0}}var rows=1;var thisLineWidth=0;var cols=0;for(var i=0;i<text.length;i++){i=this.processEscapeSeq_(text,i,true);var ch=text.charCodeAt(i);if(ch===10){rows++;thisLineWidth=0}else{++thisLineWidth;cols=Math.max(cols,thisLineWidth)}}return{cols:cols,rows:rows}}},{key:"printRect",value:function printRect(width,height,ch){beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkNumber("ch",ch);var charIndex=charMap.indexOf(ch);var startCol=beep8.Core.drawState.cursorCol;var startRow=beep8.Core.drawState.cursorRow;for(var i=0;i<height;i++){beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow+i;this.printChar(charIndex,width)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow}},{key:"printBox",value:function printBox(width,height,fill,borderCh){var borderNW=borderCh;var borderNE=borderCh+2;var borderSW=borderCh+32;var borderSE=borderCh+32+2;var borderV=borderCh+16;var borderH=borderCh+1;beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkBoolean("fill",fill);beep8.Utilities.checkNumber("borderCh",borderCh);var startCol=beep8.Core.drawState.cursorCol;var startRow=beep8.Core.drawState.cursorRow;for(var i=0;i<height;i++){beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow+i;if(i===0){this.printChar(borderNW);this.printChar(borderH,width-2);this.printChar(borderNE)}else if(i===height-1){this.printChar(borderSW);this.printChar(borderH,width-2);this.printChar(borderSE)}else{this.printChar(borderV);beep8.Core.drawState.cursorCol=startCol+width-1;this.printChar(borderV)}}if(fill&&width>2&&height>2){beep8.Core.drawState.cursorCol=startCol+1;beep8.Core.drawState.cursorRow=startRow+1;this.printRect(width-2,height-2,0)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow}},{key:"put_",value:function put_(ch,col,row,fgColor,bgColor){var font=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var chrW=beep8.CONFIG.CHR_WIDTH;var chrH=beep8.CONFIG.CHR_HEIGHT;var x=Math.round(col*chrW);var y=Math.round(row*chrH);this.putxy_(ch,x,y,fgColor,bgColor,font)}},{key:"putxy_",value:function putxy_(ch,x,y,fgColor,bgColor){var font=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;font=font||this.curTiles_;var chrW=font.getCharWidth();var chrH=font.getCharHeight();var fontRow=Math.floor(ch/16);var fontCol=ch%16;x=Math.round(x);y=Math.round(y);if(bgColor>=0){beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(bgColor);beep8.Core.ctx.fillRect(x,y,chrW,chrH)}if(bgColor===fgColor){return}var color=beep8.Utilities.clamp(fgColor,0,beep8.CONFIG.COLORS.length-1);var img=font.getImageForColor(color);beep8.Core.ctx.drawImage(img,fontCol*chrW,fontRow*chrH,chrW,chrH,x,y,chrW,chrH);beep8.Core.markDirty()}},{key:"wrapText",value:function wrapText(text,wrapWidth){var font=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;font=font||this.curFont_;if(wrapWidth<=0){return text}wrapWidth=Math.floor(wrapWidth/font.getCharColCount());var lines=text.split("\n");var wrappedLines=[];var _iterator5=_createForOfIteratorHelper(lines),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var line=_step5.value;var words=line.split(" ");var wrappedLine="";var lineWidth=0;var _iterator6=_createForOfIteratorHelper(words),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var word=_step6.value;var wordWidth=this.measure(word).cols;if(lineWidth+wordWidth>wrapWidth){wrappedLines.push(wrappedLine.trim());wrappedLine="";lineWidth=0}wrappedLine+=word+" ";lineWidth+=wordWidth+1}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}wrappedLines.push(wrappedLine.trim())}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return wrappedLines.join("\n")}},{key:"processEscapeSeq_",value:function processEscapeSeq_(text,startPos){var pretend=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var startSeq=beep8.CONFIG.PRINT_ESCAPE_START;var endSeq=beep8.CONFIG.PRINT_ESCAPE_END;if(!startSeq||!endSeq){return startPos}if(text.substring(startPos,startPos+startSeq.length)!=startSeq){return startPos}var endPos=text.indexOf(endSeq,startPos+startSeq.length);if(!pretend){var command=text.substring(startPos+startSeq.length,endPos);this.runEscapeCommand_(command)}return endPos+endSeq.length}},{key:"runEscapeCommand_",value:function runEscapeCommand_(command){if(command.indexOf(",")>0){var parts=command.split(",");var _iterator7=_createForOfIteratorHelper(parts),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var part=_step7.value;this.runEscapeCommand_(part)}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return}command=command.trim();if(command===""){return}var verb=command[0].toLowerCase();var arg=command.substring(1);var argNum=1*arg;switch(verb){case"f":case"c":beep8.Core.drawState.fgColor=arg!==""?argNum:this.origFgColor_;break;case"b":beep8.Core.drawState.bgColor=arg!==""?argNum:this.origBgColor_;break;case"t":this.printFont_=this.getFontByName(arg);break;case"z":beep8.Core.drawState.fgColor=this.origFgColor_;beep8.Core.drawState.bgColor=this.origBgColor_;this.printFont_=this.origFont_||this.fonts_["default"];break;default:console.warn("Unknown beep8 print escape command: "+command)}}},{key:"regenColors",value:function regenColors(){Object.values(this.fonts_).forEach(function(f){return f.regenColors()})}}])}();beep8.TextRenderer=beep8.TextRenderer})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.TextRendererFont=function(){function _class4(fontName,fontImageFile){_classCallCheck(this,_class4);beep8.Utilities.checkString("fontName",fontName);beep8.Utilities.checkString("fontImageFile",fontImageFile);this.fontName_=fontName;this.fontImageFile_=fontImageFile;this.origImg_=null;this.chrImages_=[];this.charWidth_=0;this.charHeight_=0;this.charColCount_=0;this.charRowCount_=0;this.origFgColor_=0;this.origBgColor_=0}return _createClass(_class4,[{key:"getCharWidth",value:function getCharWidth(){return this.charWidth_}},{key:"getCharHeight",value:function getCharHeight(){return this.charHeight_}},{key:"getCharColCount",value:function getCharColCount(){return this.charColCount_}},{key:"getCharRowCount",value:function getCharRowCount(){return this.charRowCount_}},{key:"getImageForColor",value:function getImageForColor(colorNumber){return this.chrImages_[colorNumber]}},{key:"initAsync",value:function(){var _initAsync2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee19(){return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:beep8.Utilities.log("Building font ".concat(this.fontName_," from image ").concat(this.fontImageFile_));_context19.next=3;return beep8.Utilities.loadImageAsync(this.fontImageFile_);case 3:this.origImg_=_context19.sent;beep8.Utilities.assert(this.origImg_.width%16===0&&this.origImg_.height%16===0,"Font ".concat(this.fontName_,": image ").concat(this.fontImageFile_," has dimensions ")+"".concat(this.origImg_.width,"x").concat(this.origImg_.height,". It must ")+"have dimensions that are multiples of 16 (16x16 grid of characters).");this.charWidth_=Math.floor(this.origImg_.width/16);this.charHeight_=Math.floor(this.origImg_.height/16);this.charColCount_=Math.floor(this.charWidth_/beep8.CONFIG.CHR_WIDTH);this.charRowCount_=Math.floor(this.charHeight_/beep8.CONFIG.CHR_HEIGHT);_context19.next=11;return this.regenColors();case 11:case"end":return _context19.stop()}},_callee19,this)}));function initAsync(){return _initAsync2.apply(this,arguments)}return initAsync}()},{key:"regenColors",value:function(){var _regenColors=_asyncToGenerator(_regeneratorRuntime().mark(function _callee20(){var tempCanvas,ctx,c,thisImg;return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:tempCanvas=document.createElement("canvas");tempCanvas.width=this.origImg_.width;tempCanvas.height=this.origImg_.height;ctx=tempCanvas.getContext("2d");this.chrImages_=[];c=0;case 6:if(!(c<beep8.CONFIG.COLORS.length)){_context20.next=21;break}beep8.Utilities.log("Initializing font ".concat(this.fontName_,", color ").concat(c," = ").concat(beep8.CONFIG.COLORS[c]));ctx.clearRect(0,0,this.origImg_.width,this.origImg_.height);ctx.globalCompositeOperation="source-over";ctx.drawImage(this.origImg_,0,0,this.origImg_.width,this.origImg_.height);ctx.globalCompositeOperation="source-in";ctx.fillStyle=beep8.CONFIG.COLORS[c];ctx.fillRect(0,0,this.origImg_.width,this.origImg_.height);_context20.next=16;return this.createImageFromCanvas(tempCanvas);case 16:thisImg=_context20.sent;this.chrImages_.push(thisImg);case 18:c++;_context20.next=6;break;case 21:tempCanvas.remove();case 22:case"end":return _context20.stop()}},_callee20,this)}));function regenColors(){return _regenColors.apply(this,arguments)}return regenColors}()},{key:"createImageFromCanvas",value:function createImageFromCanvas(canvas){return new Promise(function(resolve){var img=new Image;img.src=canvas.toDataURL();img.onload=function(){return resolve(img)}})}}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Utilities={};beep8.Utilities.fatal=function(error){console.error("Fatal error: "+error);try{beep8.Core.handleCrash(error)}catch(e){console.error("Error in beep8.Core.handleCrash: "+e+" while handling error "+error)}throw new Error("Error: "+error)};beep8.Utilities.assert=function(cond,msg){if(!cond){beep8.Utilities.fatal(msg||"Assertion Failed")}return cond};beep8.Utilities.assertDebug=function(cond,msg){if(!cond){if(beep8.CONFIG.DEBUG){warn("DEBUG ASSERT failed: "+msg)}else{beep8.Utilities.fatal(msg)}}return cond};beep8.Utilities.assertEquals=function(expected,actual,what){if(expected!==actual){beep8.Utilities.fatal("".concat(what,": expected ").concat(expected," but got ").concat(actual))}return actual};beep8.Utilities.checkType=function(varName,varValue,varType){beep8.Utilities.assert(varName,"checkType: varName must be provided.");beep8.Utilities.assert(varType,"checkType: varType must be provided.");beep8.Utilities.assert(_typeof(varValue)===varType,"".concat(varName," should be of type ").concat(varType," but was ").concat(_typeof(varValue),": ").concat(varValue));return varValue};beep8.Utilities.checkNumber=function(varName,varValue,optMin,optMax){beep8.Utilities.checkType(varName,varValue,"number");if(isNaN(varValue)){beep8.Utilities.fatal("".concat(varName," should be a number but is NaN"))}if(!isFinite(varValue)){beep8.Utilities.fatal("".concat(varName," should be a number but is infinite: ").concat(varValue))}if(optMin!==undefined){beep8.Utilities.assert(varValue>=optMin,"".concat(varName," should be >= ").concat(optMin," but is ").concat(varValue))}if(optMax!==undefined){beep8.Utilities.assert(varValue<=optMax,"".concat(varName," should be <= ").concat(optMax," but is ").concat(varValue))}return varValue};beep8.Utilities.checkString=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"string")};beep8.Utilities.checkBoolean=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"boolean")};beep8.Utilities.checkFunction=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"function")};beep8.Utilities.checkObject=function(varName,varValue){if(varValue===null){beep8.Utilities.fatal("".concat(varName," should be an object, but was null"))}return beep8.Utilities.checkType(varName,varValue,"object")};beep8.Utilities.checkInstanceOf=function(varName,varValue,expectedClass){beep8.Utilities.assert(varValue instanceof expectedClass,"".concat(varName," should be an instance of ").concat(expectedClass.name," but was not, it's: ").concat(varValue));return varValue};beep8.Utilities.checkArray=function(varName,varValue){beep8.Utilities.assert(Array.isArray(varValue),"".concat(varName," should be an array, but was: ").concat(varValue));return varValue};beep8.Utilities.log=beep8.CONFIG.DEBUG?console.log:function(){};beep8.Utilities.warn=console.warn;beep8.Utilities.error=console.error;beep8.Utilities.loadImageAsync=function(){var _ref16=_asyncToGenerator(_regeneratorRuntime().mark(function _callee21(src){return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:return _context21.abrupt("return",new Promise(function(resolver){var img=new Image;img.src=src;img.onload=function(){return resolver(img)}}));case 1:case"end":return _context21.stop()}},_callee21)}));return function(_x16){return _ref16.apply(this,arguments)}}();beep8.Utilities.loadFileAsync=function(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(){if(xhr.status<200||xhr.status>299){reject("HTTP request finished with status "+xhr.status)}else{resolve(xhr.responseText)}});xhr.addEventListener("error",function(e){return reject(e)});xhr.open("GET",url);xhr.send()})};beep8.Utilities.clamp=function(x,lo,hi){return Math.min(Math.max(x,lo),hi)};beep8.Utilities.randomInt=function(lowInclusive,highInclusive){beep8.Utilities.checkNumber("lowInclusive",lowInclusive);beep8.Utilities.checkNumber("highInclusive",highInclusive);lowInclusive=Math.round(lowInclusive);highInclusive=Math.round(highInclusive);if(highInclusive<=lowInclusive){return lowInclusive}return beep8.Utilities.clamp(Math.floor(Math.random()*(highInclusive-lowInclusive+1))+lowInclusive,lowInclusive,highInclusive)};beep8.Utilities.randomPick=function(array){beep8.Utilities.checkArray("array",array);return array.length>0?array[beep8.Utilities.randomInt(0,array.length-1)]:null};beep8.Utilities.shuffleArray=function(array){beep8.Utilities.checkArray("array",array);array=array.slice();for(var i=0;i<array.length;i++){var j=beep8.Utilities.randomInt(0,array.length-1);var tmp=array[i];array[i]=array[j];array[j]=tmp}return array};beep8.Utilities.dist2d=function(x0,y0,x1,y1){beep8.Utilities.checkNumber("x0",x0);beep8.Utilities.checkNumber("y0",y0);beep8.Utilities.checkNumber("x1",x1);beep8.Utilities.checkNumber("y1",y1);var dx=x0-x1;var dy=y0-y1;return Math.sqrt(dx*dx+dy*dy)};beep8.Utilities.intersectIntervals=function(as,ae,bs,be){var result=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;beep8.Utilities.checkNumber("as",as);beep8.Utilities.checkNumber("ae",ae);beep8.Utilities.checkNumber("bs",bs);beep8.Utilities.checkNumber("be",be);if(result){beep8.Utilities.checkObject("result",result)}var start=Math.max(as,bs);var end=Math.min(ae,be);if(end>=start){if(result){result.start=start;result.end=end}return true}return false};beep8.Utilities.intersectRects=function(r1,r2){var dx1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var dy1=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var dx2=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var dy2=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var result=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;beep8.Utilities.checkObject("r1",r1);beep8.Utilities.checkObject("r2",r2);beep8.Utilities.checkNumber("r1.x",r1.x);beep8.Utilities.checkNumber("r1.y",r1.y);beep8.Utilities.checkNumber("r1.w",r1.w);beep8.Utilities.checkNumber("r1.h",r1.h);beep8.Utilities.checkNumber("r2.x",r2.x);beep8.Utilities.checkNumber("r2.y",r2.y);beep8.Utilities.checkNumber("r2.w",r2.w);beep8.Utilities.checkNumber("r2.h",r2.h);beep8.Utilities.checkNumber("dx1",dx1);beep8.Utilities.checkNumber("dx2",dx2);beep8.Utilities.checkNumber("dy1",dy1);beep8.Utilities.checkNumber("dy2",dy2);if(result){checkObject("result",result)}var xint=intersectRects_xint;var yint=intersectRects_yint;if(!beep8.Utilities.intersectIntervals(r1.x+dx1,r1.x+dx1+r1.w-1,r2.x+dx2,r2.x+dx2+r2.w-1,xint)){return false}if(!beep8.Utilities.intersectIntervals(r1.y+dy1,r1.y+dy1+r1.h-1,r2.y+dy2,r2.y+dy2+r2.h-1,yint)){return false}if(result){result.x=xint.start;result.w=xint.end-xint.start+1;result.y=yint.start;result.h=yint.end-yint.start+1}return true};var intersectRects_xint={};var intersectRects_yint={};beep8.Utilities.makeUrlPretty=function(uglyStr){beep8.Utilities.checkString("uglyStr",uglyStr);var str=uglyStr;str=str.toLowerCase();str=str.replace(/[\s/]+/g,"-");str=str.replace(/[^a-z0-9\-]+/g,"");str=str.replace(/-+/g,"-");str=str.replace(/^-+|-+$/g,"");return str}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Joystick={};var LEFT_VJOY_HTML="\n<div id='vjoy-button-up' class='vjoy-button'></div>\n<div id='vjoy-button-down' class='vjoy-button'></div>\n<div id='vjoy-button-left' class='vjoy-button'></div>\n<div id='vjoy-button-right' class='vjoy-button'></div>\n\t";var RIGHT_VJOY_HTML="\n<div id='vjoy-button-pri' class='vjoy-button'>A</div>\n<div id='vjoy-button-sec' class='vjoy-button'>B</div>\n<div id='vjoy-button-ter' class='vjoy-button'>=</div>\n\t";var VJOY_CSS="\n* {\n\tuser-select: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n\n#vjoy-scrim {\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\ttop: 0;\n\tpointer-events: all;\n}\n\n#vjoy-container-left {\n\tbox-sizing: border-box;\n\tposition: fixed;\n\tbottom: 16px;\n\tleft: 16px;\n\twidth: 40vmin;\n\theight: 40vmin;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n\n#vjoy-container-right {\n\tbox-sizing: border-box;\n\tposition: fixed;\n\tbottom: 16px;\n\tright: 16px;\n\twidth: 40vmin;\n\theight: 40vmin;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n\n.vjoy-button {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground: #444;\n\tborder: none;\n\tfont: bold 14px monospace;\n\tcolor: #888;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n.vjoy-button:active {\n\tbackground: #888;\n}\n\n#vjoy-button-up {\n\tposition: absolute;\n\tleft: 30%;\n\ttop: 0px;\n\twidth: 40%;\n\theight: 45%;\n\tborder-radius: 0px 0px 50% 50%;\n}\n\n#vjoy-button-down {\n\tposition: absolute;\n\tleft: 30%;\n\tbottom: 0px;\n\twidth: 40%;\n\theight: 45%;\n\tborder-radius: 50% 50% 0px 0px;\n}\n\n#vjoy-button-left {\n\tposition: absolute;\n\tleft: 0px;\n\tbottom: 30%;\n\twidth: 45%;\n\theight: 40%;\n\tborder-radius: 0px 50% 50% 0px;\n}\n\n#vjoy-button-right {\n\tposition: absolute;\n\tright: 0px;\n\tbottom: 30%;\n\twidth: 45%;\n\theight: 40%;\n\tborder-radius: 50% 0px 0px 50%;\n}\n\n#vjoy-button-pri {\n\tposition: absolute;\n\tright: 0px;\n\ttop: 30%;\n\twidth: 50%;\n\theight: 50%;\n\tborder-radius: 50%;\n}\n\n#vjoy-button-sec {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 30%;\n\twidth: 50%;\n\theight: 50%;\n\tborder-radius: 50%;\n}\n\n#vjoy-button-ter {\n\tposition: fixed;\n\tright: 0px;\n\tbottom: 0px;\n\twidth: 10vw;\n\theight: 8vmin;\n\tborder-radius: 8px;\n\topacity: 0.5;\n}\n\t";beep8.Joystick.setup=function(){beep8.Utilities.log("Setting up virtual joystick...");var styleEl=document.createElement("style");styleEl.setAttribute("type","text/css");styleEl.innerText=VJOY_CSS;document.body.appendChild(styleEl);var scrim=document.createElement("div");scrim.setAttribute("id","vjoy-scrim");scrim.addEventListener("touchstart",function(e){return e.preventDefault()});document.body.appendChild(scrim);var leftContainer=document.createElement("div");leftContainer.setAttribute("id","vjoy-container-left");leftContainer.innerHTML=LEFT_VJOY_HTML;document.body.appendChild(leftContainer);var rightContainer=document.createElement("div");rightContainer.setAttribute("id","vjoy-container-right");rightContainer.innerHTML=RIGHT_VJOY_HTML;document.body.appendChild(rightContainer);setTimeout(continueSetup,10)};beep8.Joystick.continueSetup=function(){setUpButton("vjoy-button-up","ArrowUp");setUpButton("vjoy-button-down","ArrowDown");setUpButton("vjoy-button-left","ArrowLeft");setUpButton("vjoy-button-right","ArrowRight");setUpButton("vjoy-button-pri","ButtonA");setUpButton("vjoy-button-sec","ButtonB");setUpButton("vjoy-button-ter","Escape");document.body.addEventListener("touchstart",function(e){return e.preventDefault()})};beep8.Joystick.setUpButton=function(buttonId,buttonKeyName){var button=beep8.Utilities.assert(document.getElementById(buttonId),"Could not find button ID "+buttonId);if(buttonKeyName===null){button.style.display="none";return}button.addEventListener("mousedown",function(e){return handleButtonEvent(buttonKeyName,true,e)});button.addEventListener("touchstart",function(e){return handleButtonEvent(buttonKeyName,true,e)});button.addEventListener("mouseup",function(e){return handleButtonEvent(buttonKeyName,false,e)});button.addEventListener("touchend",function(e){return handleButtonEvent(buttonKeyName,false,e)});button.addEventListener("contextmenu",function(e){return e.preventDefault()})};beep8.Joystick.handleButtonEvent=function(buttonKeyName,down,evt){if(down){inputSys.onKeyDown({key:buttonKeyName})}else{inputSys.onKeyUp({key:buttonKeyName})}evt.preventDefault()}})(beep8||({},_readOnlyError("beep8")));"use strict";var zzfx=function zzfx(){return zzfxP(zzfxG.apply(void 0,arguments))};var zzfxV=.3;var zzfxR=44100;var zzfxX=new AudioContext;var zzfxP=function zzfxP(){for(var _len=arguments.length,samples=new Array(_len),_key=0;_key<_len;_key++){samples[_key]=arguments[_key]}var buffer=zzfxX.createBuffer(samples.length,samples[0].length,zzfxR),source=zzfxX.createBufferSource();samples.map(function(d,i){return buffer.getChannelData(i).set(d)});source.buffer=buffer;source.connect(zzfxX.destination);source.start();return source};var zzfxG=function zzfxG(){var volume=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var randomness=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.05;var frequency=arguments.length>2&&arguments[2]!==undefined?arguments[2]:220;var attack=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var sustain=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var release=arguments.length>5&&arguments[5]!==undefined?arguments[5]:.1;var shape=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var shapeCurve=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1;var slide=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var deltaSlide=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var pitchJump=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var pitchJumpTime=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var repeatTime=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var noise=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var modulation=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var bitCrush=arguments.length>15&&arguments[15]!==undefined?arguments[15]:0;var delay=arguments.length>16&&arguments[16]!==undefined?arguments[16]:0;var sustainVolume=arguments.length>17&&arguments[17]!==undefined?arguments[17]:1;var decay=arguments.length>18&&arguments[18]!==undefined?arguments[18]:0;var tremolo=arguments.length>19&&arguments[19]!==undefined?arguments[19]:0;var filter=arguments.length>20&&arguments[20]!==undefined?arguments[20]:0;var PI2=Math.PI*2,sign=function sign(v){return v<0?-1:1},startSlide=slide*=500*PI2/zzfxR/zzfxR,startFrequency=frequency*=(1+randomness*2*Math.random()-randomness)*PI2/zzfxR,b=[],t=0,tm=0,i=0,j=1,r=0,c=0,s=0,f,length,quality=2,w=PI2*Math.abs(filter)*2/zzfxR,cos=Math.cos(w),alpha=Math.sin(w)/2/quality,a0=1+alpha,a1=-2*cos/a0,a2=(1-alpha)/a0,b0=(1+sign(filter)*cos)/2/a0,b1=-(sign(filter)+cos)/a0,b2=b0,x2=0,x1=0,y2=0,y1=0;attack=attack*zzfxR+9;decay*=zzfxR;sustain*=zzfxR;release*=zzfxR;delay*=zzfxR;deltaSlide*=500*PI2/Math.pow(zzfxR,3);modulation*=PI2/zzfxR;pitchJump*=PI2/zzfxR;pitchJumpTime*=zzfxR;repeatTime=repeatTime*zzfxR|0;volume*=zzfxV;for(length=attack+decay+sustain+release+delay|0;i<length;b[i++]=s*volume){if(!(++c%(bitCrush*100|0))){s=shape?shape>1?shape>2?shape>3?Math.sin(Math.pow(t,3)):Math.max(Math.min(Math.tan(t),1),-1):1-(2*t/PI2%2+2)%2:1-4*Math.abs(Math.round(t/PI2)-t/PI2):Math.sin(t);s=(repeatTime?1-tremolo+tremolo*Math.sin(PI2*i/repeatTime):1)*sign(s)*Math.pow(Math.abs(s),shapeCurve)*(i<attack?i/attack:i<attack+decay?1-(i-attack)/decay*(1-sustainVolume):i<attack+decay+sustain?sustainVolume:i<length-delay?(length-i-delay)/release*sustainVolume:0);s=delay?s/2+(delay>i?0:(i<length-delay?1:(length-i)/delay)*b[i-delay|0]/2/volume):s;if(filter)s=y1=b2*x2+b1*(x2=x1)+b0*(x1=s)-a2*y2-a1*(y2=y1)}f=(frequency+=slide+=deltaSlide)*Math.cos(modulation*tm++);t+=f+f*noise*Math.sin(Math.pow(i,5));if(j&&++j>pitchJumpTime){frequency+=pitchJump;startFrequency+=pitchJump;j=0}if(repeatTime&&!(++r%repeatTime)){frequency=startFrequency;slide=startSlide;j=j||1}}return b};zzfxM=function zzfxM(instruments,patterns,sequence){var BPM=arguments.length>3&&arguments[3]!==undefined?arguments[3]:125;var instrumentParameters;var i;var j;var k;var note;var sample;var patternChannel;var notFirstBeat;var stop;var instrument;var pitch;var attenuation;var outSampleOffset;var isSequenceEnd;var sampleOffset=0;var nextSampleOffset;var sampleBuffer=[];var leftChannelBuffer=[];var rightChannelBuffer=[];var channelIndex=0;var panning=0;var hasMore=1;var sampleCache={};var beatLength=zzfxR/BPM*60>>2;for(;hasMore;channelIndex++){sampleBuffer=[hasMore=notFirstBeat=pitch=outSampleOffset=0];sequence.map(function(patternIndex,sequenceIndex){patternChannel=patterns[patternIndex][channelIndex]||[0,0,0];hasMore|=!!patterns[patternIndex][channelIndex];nextSampleOffset=outSampleOffset+(patterns[patternIndex][0].length-2-!notFirstBeat)*beatLength;isSequenceEnd=sequenceIndex==sequence.length-1;for(i=2,k=outSampleOffset;i<patternChannel.length+isSequenceEnd;notFirstBeat=++i){note=patternChannel[i];stop=i==patternChannel.length+isSequenceEnd-1&&isSequenceEnd||instrument!=(patternChannel[0]||0)|note|0;for(j=0;j<beatLength&&notFirstBeat;j++>beatLength-99&&stop?attenuation+=(attenuation<1)/99:0){sample=(1-attenuation)*sampleBuffer[sampleOffset++]/2||0;leftChannelBuffer[k]=(leftChannelBuffer[k]||0)-sample*panning+sample;rightChannelBuffer[k]=(rightChannelBuffer[k++]||0)+sample*panning+sample}if(note){attenuation=note%1;panning=patternChannel[1]||0;if(note|=0){sampleBuffer=sampleCache[[instrument=patternChannel[sampleOffset=0]||0,note]]=sampleCache[[instrument,note]]||(instrumentParameters=_toConsumableArray(instruments[instrument]),instrumentParameters[2]*=Math.pow(2,(note-12)/12),note>0?zzfxG.apply(void 0,_toConsumableArray(instrumentParameters)):[])}}}outSampleOffset=nextSampleOffset})}return[leftChannelBuffer,rightChannelBuffer]};