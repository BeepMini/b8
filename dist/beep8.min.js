function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var r,n,i,o,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return i=!(n=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return n=e.done,e},e:function(e){i=!0,r=e},f:function(){try{n||null==a.return||a.return()}finally{if(i)throw r}}};if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regeneratorRuntime(){_regeneratorRuntime=function(){return a};var u,a={},e=Object.prototype,s=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function l(e,t,r,n){Object.defineProperty(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{l({},"")}catch(u){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i,o,a,c,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype);return l(t,"_invoke",(i=e,o=r,a=new y(n||[]),c=1,function(e,t){if(3===c)throw Error("Generator is already running");if(4===c){if("throw"===e)throw t;return{value:u,done:!0}}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.i[n];if(i===u)return r.delegate=null,"throw"===n&&t.i.return&&(r.method="return",r.arg=u,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;n=h(i,t.i,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,d;i=n.arg;return i?i.done?(r[t.r]=i.value,r.next=t.n,"return"!==r.method&&(r.method="next",r.arg=u),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}(r,a);if(r){if(r===d)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(1===c)throw c=4,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);c=3;r=h(i,o,a);if("normal"===r.type){if(c=a.done?4:2,r.arg===d)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(c=4,a.method="throw",a.arg=r.arg)}}),!0),t}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var d={};function g(){}function o(){}function f(){}var t={},p=(l(t,n,function(){return this}),Object.getPrototypeOf),p=p&&p(p(b([]))),C=(p&&p!==e&&s.call(p,n)&&(t=p),f.prototype=g.prototype=Object.create(t));function A(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function m(a,c){var t;l(this,"_invoke",function(r,n){function e(){return new c(function(e,t){!function t(e,r,n,i){var o,e=h(a[e],a,r);if("throw"!==e.type)return(r=(o=e.arg).value)&&"object"==_typeof(r)&&s.call(r,"__await")?c.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):c.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)});i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()},!0)}function w(e){this.tryEntries.push(e)}function v(e){var t=e[4]||{};t.type="normal",t.arg=u,e[4]=t}function y(e){this.tryEntries=[[-1]],e.forEach(w,this),this.reset(!0)}function b(t){if(null!=t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(s.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return l(C,"constructor",o.prototype=f),l(f,"constructor",o),l(f,i,o.displayName="GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,i,"GeneratorFunction")),e.prototype=Object.create(C),e},a.awrap=function(e){return{__await:e}},A(m.prototype),l(m.prototype,r,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(c(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},A(C),l(C,i,"Generator"),l(C,n,function(){return this}),l(C,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.unshift(t);return function e(){for(;n.length;)if((t=n.pop())in r)return e.value=t,e.done=!1,e;return e.done=!0,e}},a.values=b,y.prototype={constructor:y,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(v),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function e(e){o.type="throw",o.arg=t,r.next=e}for(var n=r.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n],o=i[4],a=this.prev,c=i[1],s=i[2];if(-1===i[0])return e("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=a){if(a<c)return this.method="next",this.arg=u,e(c),!0;if(a<s)return e(s),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(-1<n[0]&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]?null:i)?i[4]:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i[2],d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),v(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i[0]===e)return"throw"===(r=i[4]).type&&(n=r.arg,v(i)),n}throw Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={i:b(e),r:t,n:r},"next"===this.method&&(this.arg=u),d}},a}function asyncGeneratorStep(e,t,r,n,i,o,a){try{var c=e[o](a),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function _asyncToGenerator(c){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=c.apply(e,a);function i(e){asyncGeneratorStep(n,t,r,i,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,i,o,"throw",e)}i(void 0)})}}function _readOnlyError(e){throw new TypeError('"'+e+'" is read-only')}var beep8={};(beep8||_readOnlyError("beep8")).CONFIG={DEBUG:!0,NAME:"beep8 Project",VERSION:"1.0.0-dev",CANVAS_SETTINGS:{CANVAS_ID:"beep8-canvas",CANVAS_CLASSES:[],CONTAINER:null},SFX:{TYPING:"click",MENU_UP:"blip",MENU_DOWN:"blip2",MENU_SELECT:"blip3"},FONT_DEFAULT:"../assets/font-default-thin.png",FONT_TILES:"../assets/font-tiles.png",FONT_ACTORS:"../assets/font-actors.png",CHRS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*+=-<>_#&@%^~$£€¥¢!?:;'\"/\\()[]{}.,©®™•…| ",CHR_WIDTH:12,CHR_HEIGHT:12,SCREEN_ROWS:25,SCREEN_COLS:20,SCREEN_COLORS:1,CRT_ENABLE:.3,CRT_VIGNETTE:!0,COLORS:["#0A0C1F","#263264","#A0ABB6","#B2EFEB","#3FB0F1","#3548A3","#420241","#6A3E49","#C22D44","#E08355","#FFC763","#A7D171","#30AB62","#1E7F82","#FF76D7","#F4F4F4"],PASSKEY:"beep8IsAwesome",TOUCH_VJOY:!0,CURSOR:{WIDTH_F:.8,HEIGHT_F:.8,BLINK_INTERVAL:400,OFFSET_V:.1,OFFSET_H:0},PRINT_ESCAPE_START:"{{",PRINT_ESCAPE_END:"}}",BORDER_CHAR:54},(c=>{c.init=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return c.Utilities.checkFunction("callback",e),c.Utilities.checkObject("options",t),null!==t&&(c.CONFIG=c.Utilities.deepMerge(c.CONFIG,t)),c.Core.init(e)},c.frame=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:30;return c.Core.preflight("beep8.frame"),null!==e&&c.Utilities.checkFunction("render handler",e),null!==t&&c.Utilities.checkFunction("update handler",t),c.Utilities.checkNumber("fps",r),c.Core.setFrameHandlers(e,t,r)},c.render=function(){return c.Core.preflight("beep8.render"),c.Renderer.render()},c.color=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;c.Core.preflight("beep8.color"),c.Utilities.checkNumber("fg",e),void 0!==t&&c.Utilities.checkNumber("bg",t),c.Core.setColor(e,t)},c.getFgColor=function(){return c.Core.preflight("getFgColor"),c.Core.drawState.fgColor},c.getBgColor=function(){return c.Core.preflight("beep8.getBgColor"),c.Core.drawState.bgColor},c.cls=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;c.Core.preflight("beep8.Core.cls"),c.Core.cls(e)},c.locate=function(e,t){c.Core.preflight("beep8.locate"),c.Utilities.checkNumber("col",e),void 0!==t&&c.Utilities.checkNumber("row",t),c.Core.setCursorLocation(e,t)},c.col=function(){return c.Core.preflight("col"),c.Core.drawState.cursorCol},c.row=function(){return c.Core.preflight("row"),c.Core.drawState.cursorRow},c.cursor=function(e){c.Core.preflight("cursor"),c.Utilities.checkBoolean("visible",e),c.CursorRenderer.setCursorVisible(e)},c.print=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=(c.Core.preflight("beep8.text"),c.Utilities.checkString("text",e),c.Utilities.checkNumber("wrapWidth",t),r);null!==n&&(c.Utilities.checkString("fontId",r),n=c.TextRenderer.getFontByName(r)),c.TextRenderer.print(e,n,t)},c.printCentered=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c.CONFIG.SCREEN_COLS,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=(c.Core.preflight("beep8.printCentered"),c.Utilities.checkString("text",e),c.Utilities.checkNumber("width",t),r);null!==n&&(c.Utilities.checkString("fontId",r),n=c.TextRenderer.getFontByName(r)),c.TextRenderer.printCentered(e,t,n)},c.printRight=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c.CONFIG.SCREEN_COLS,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=(c.Core.preflight("beep8.printRight"),c.Utilities.checkString("text",e),c.Utilities.checkNumber("width",t),r);null!==n&&(c.Utilities.checkString("fontId",r),n=c.TextRenderer.getFontByName(r)),c.TextRenderer.printRight(e,t,n)},c.drawText=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;c.Core.preflight("beep8.drawText"),c.Utilities.checkNumber("x",e),c.Utilities.checkNumber("y",t),c.Utilities.checkString("text",r),n&&c.Utilities.checkString("fontId",n),c.TextRenderer.drawText(e,t,r,n)},c.measure=function(e){return c.Core.preflight("measure"),c.Utilities.checkString("text",e),c.TextRenderer.measure(e)},c.printChar=function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;c.Core.preflight("beep8.printChar"),e=c.convChar(e),c.Utilities.checkInt("charCode",e),c.Utilities.checkInt("numTimes",r),r<0&&c.Utilities.fatal("[beep8.printChar] numTimes must be a positive integer"),0!==r&&(null!==(t=n)&&(c.Utilities.checkString("fontId",n),t=c.TextRenderer.getFontByName(n)),c.TextRenderer.printChar(e,r,t))},c.printRect=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:8;c.Core.preflight("beep8.printRect"),r=c.convChar(r),c.Utilities.checkNumber("widthCols",e),c.Utilities.checkNumber("heightRows",t),c.Utilities.checkNumber("charCode",r),c.TextRenderer.printRect(e,t,r)},c.printBox=function(e,t){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:c.CONFIG.BORDER_CHAR;c.Core.preflight("beep8.printBox"),n=c.convChar(n),c.Utilities.checkNumber("widthCols",e),c.Utilities.checkNumber("heightRows",t),c.Utilities.checkBoolean("fill",r),c.Utilities.checkNumber("borderChar",n),c.TextRenderer.printBox(e,t,r,n)},c.drawImage=function(e,t,r){c.Utilities.checkInstanceOf("image",r,HTMLImageElement),c.Utilities.checkNumber("x",e),c.Utilities.checkNumber("y",t),c.Core.drawImage(r,e,t)},c.drawImageRect=function(e,t,r,n,i,o,a){c.Utilities.checkInstanceOf("image",r,HTMLImageElement),c.Utilities.checkNumber("x",e),c.Utilities.checkNumber("y",t),c.Utilities.checkNumber("srcX",n),c.Utilities.checkNumber("srcY",i),c.Utilities.checkNumber("width",o),c.Utilities.checkNumber("height",a),c.Core.drawImage(r,e,t,n,i,o,a)},c.drawRect=function(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1;c.Utilities.checkNumber("x",e),c.Utilities.checkNumber("y",t),c.Utilities.checkNumber("width",r),c.Utilities.checkNumber("height",n),c.Utilities.checkNumber("lineWidth",i),c.Core.drawRect(e,t,r,n,i)},c.fillRect=function(e,t,r,n){c.Utilities.checkNumber("x",e),c.Utilities.checkNumber("y",t),c.Utilities.checkNumber("width",r),c.Utilities.checkNumber("height",n),c.Core.fillRect(e,t,r,n)},c.playSound=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];c.Utilities.checkInstanceOf("sfx",e,HTMLAudioElement),e.currentTime=0,e.volume=t,e.loop=r,e.play()},c.spr=function(e,t,r){e=c.convChar(e),c.Utilities.checkNumber("ch",e),c.Utilities.checkNumber("x",t),c.Utilities.checkNumber("y",r),c.TextRenderer.spr(e,t,r)},c.drawActor=function(e,t){e=c.convChar(e),c.Utilities.checkInt("ch",e),c.Utilities.checkString("animation",t),c.Actors.draw(e,t)},c.sprActor=function(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return e=c.convChar(e),c.Utilities.checkInt("ch",e),c.Utilities.checkString("animation",t),c.Utilities.checkNumber("x",r),c.Utilities.checkNumber("y",n),c.Actors.spr(e,t,r,n,i)},c.key=function(e){return c.Core.preflight("beep8.key"),c.Utilities.checkString("keyName",e),c.Input.keyHeld(e)},c.playSong=function(e){c.Utilities.checkString("song",e),c.Sound.playSong(e)},c.playSfx=function(e){c.Utilities.checkString("sfx",e),c.Sfx.play(e)},c.keyp=function(e){return c.Core.preflight("beep8.keyp"),c.Utilities.checkString("keyName",e),c.Input.keyJustPressed(e)},c.redefineColors=function(e){c.Core.preflight("beep8.redefineColors"),c.Utilities.checkArray("colors",e),c.Core.defineColors(e)},c.setFont=function(e){c.Core.preflight("beep8.setFont"),c.Utilities.checkString("fontId",e=e||"default-thin"),c.TextRenderer.setFont(e)},c.getFont=function(){c.Core.preflight("beep8.getFont"),c.TextRenderer.getFont()},c.getFontByName=function(e){return c.Utilities.checkString("fontName",e),c.TextRenderer.getFontByName(e)},c.setTileFont=function(e){c.Core.preflight("beep8.setTileFont"),c.Utilities.checkString("fontId",e=e||"tiles"),c.TextRenderer.setTileFont(e)},c.convChar=function(e){return"string"==typeof e&&0<e.length?e.charCodeAt(0):e},c.stopSound=function(e){c.Utilities.checkInstanceOf("sfx",e,HTMLAudioElement),e.currentTime=0,e.pause()},c.getContext=function(){return c.Core.getContext()},c.saveScreen=function(){return c.Core.saveScreen()},c.screenShake=function(e){return c.Utilities.checkNumber("duration",e),c.Renderer.shakeScreen(e)},c.restoreScreen=function(e){return c.Core.restoreScreen(e)},c.wrapText=function(e,t){return c.Utilities.checkString("text",e),c.Utilities.checkNumber("width",t),c.TextRenderer.wrapText(e,t)},c.addScene=function(e){c.Scene.add(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})},c.switchScene=function(e){c.Scene.set(e)},c.getScene=function(){return c.Scene.get()},c.speak=function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};window.speechSynthesis&&(c.Utilities.checkString("text",e),c.Utilities.checkObject("options",r),(e=new SpeechSynthesisUtterance(e)).pitch=null!=(t=r.pitch)?t:1,e.rate=null!=(t=r.rate)?t:1,e.volume=null!=(t=r.volume)?t:1,speechSynthesis.speak(e))}})(beep8||_readOnlyError("beep8")),(u=>{u._asyncActive=!1,u.Async=u.Async||{},u.Async=new Proxy(u.Async,{get:function(e,c,t){var s=Reflect.get(e,c,t);return"function"==typeof s?_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r,n,i,o,a=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for((t=!u._asyncActive)&&(u._asyncActive=!0,u.Scene.pause()),e.prev=2,u.Core.preflight("beep8.Async.".concat(c)),r=a.length,n=new Array(r),i=0;i<r;i++)n[i]=a[i];return e.next=7,s.apply(this,n);case 7:return o=e.sent,e.abrupt("return",o);case 9:return e.prev=9,t&&(u.Scene.resume(),u._asyncActive=!1),e.finish(9);case 12:case"end":return e.stop()}},e,this,[[2,,9,12]])})):s}}),u.Async.key=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Input.readKeyAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),u.Async.pointer=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Input.readPointerAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),u.Async.readLine=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<i.length&&void 0!==i[0]?i[0]:"",r=1<i.length&&void 0!==i[1]?i[1]:-1,n=2<i.length&&void 0!==i[2]?i[2]:-1,u.Utilities.checkString("initString",t),u.Utilities.checkNumber("maxLen",r),e.next=7,u.Input.readLine(t,r,n);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e)})),u.Async.menu=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1<n.length&&void 0!==n[1]?n[1]:{},u.Utilities.checkArray("choices",t),u.Utilities.checkObject("options",r),e.next=5,u.Menu.display(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.dialog=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1<n.length&&void 0!==n[1]?n[1]:["OK"],u.Utilities.checkString("prompt",t),u.Utilities.checkArray("choices",r),e.abrupt("return",u.Async.menu(r,{prompt:t,center:!0}));case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.dialogTypewriter=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n,i,o=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1<o.length&&void 0!==o[1]?o[1]:["OK"],n=2<o.length&&void 0!==o[2]?o[2]:-1,i=3<o.length&&void 0!==o[3]?o[3]:.05,u.Utilities.checkString("prompt",t),u.Utilities.checkArray("choices",r),u.Utilities.checkNumber("delay",i),0<n&&(t=u.TextRenderer.wrapText(t,n)),e.next=9,u.Async.menu(r,{prompt:t,typewriter:!0});case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.typewriter=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n,i,o,a=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1<a.length&&void 0!==a[1]?a[1]:-1,n=2<a.length&&void 0!==a[2]?a[2]:.035,i=3<a.length&&void 0!==a[3]?a[3]:null,u.Utilities.checkString("text",t),u.Utilities.checkNumber("wrapWidth",r),u.Utilities.checkNumber("delay",n),null!==(o=i)&&(u.Utilities.checkString("fontId",i),o=u.TextRenderer.getFontByName(i)),e.next=10,u.TextRenderer.printTypewriter(t,r,n,o);case 10:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.loadImage=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u.Utilities.checkString("url",t),e.next=3,u.Core.loadImage(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.loadSound=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var t=new Audio;t.oncanplaythrough=function(){return e(t)},t.src=r,t.load()}));case 1:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.loadFont=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n,i,o=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1<o.length&&void 0!==o[1]?o[1]:1,n=2<o.length&&void 0!==o[2]?o[2]:1,u.Utilities.checkString("fontImageFile",t),u.Utilities.checkNumber("tileSizeWidthMultiplier",r),u.Utilities.checkNumber("tileSizeHeightMultiplier",n),i="FONT@"+u.Utilities.makeUrlPretty(t),e.next=8,u.TextRenderer.loadFontAsync(i,t,r,n);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.wait=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u.Utilities.checkNumber("seconds",t),u.Renderer.render(),e.next=4,new Promise(function(e){return setTimeout(e,Math.round(1e3*t))});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Async.waitForContinue=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,u.Async.key();case 3:if((t=e.sent).includes("Enter")||t.includes("ButtonA")||t.includes(" "))return e.abrupt("break",8);e.next=6;break;case 6:e.next=0;break;case 8:case"end":return e.stop()}},e)}))})(beep8||_readOnlyError("beep8")),(c=>{function s(e,t,r,n,i){var o=c.TextRenderer.curActors_,e=e*o.getColCount()+Math.abs(u(t));c.TextRenderer.spr(e,r,n,o,i||0)}c.Actors={},c.Actors.animations={idle:{frames:[0],fps:1,loop:!0},"move-right":{frames:[1,2],fps:4,loop:!0},"move-left":{frames:[-1,-2],fps:4,loop:!0},"move-up":{frames:[4,-4],fps:4,loop:!0},"move-down":{frames:[3,-3],fps:4,loop:!0},"jump-right":{frames:[5],fps:1,loop:!1},"jump-left":{frames:[-5],fps:1,loop:!1},"spin-left":{frames:[0,1,4,-1],fps:4,loop:!0},"spin-right":{frames:[0,-1,4,1],fps:4,loop:!0}},c.Actors.draw=function(e,t){c.Utilities.checkInt("ch",e),c.Utilities.checkString("animation",t);var r=u(t);s(e,t,c.Core.drawState.cursorCol*c.CONFIG.CHR_WIDTH,c.Core.drawState.cursorRow*c.CONFIG.CHR_HEIGHT,(0<=r?0:1)||0)},c.Actors.spr=function(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=(c.Utilities.checkInt("ch",e),c.Utilities.checkString("animation",t),c.Utilities.checkNumber("x",r),c.Utilities.checkNumber("y",n),null!==i&&c.Utilities.checkNumber("startTime",i),u(t,i)),a=c.Actors.animations[t],o=0<=o?0:1;return!!l(a,i)&&(s(e,t,r,n,o||0),!0)};var u=function(e){var t,r,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=(void 0===c.Actors.animations[e]&&c.Utilities.fatal("Invalid animation: "+e),null===n&&(n=c.Core.startTime),c.Actors.animations[e]),i=0;return 1===e.frames.length&&(i=e.frames[0]),1<e.frames.length&&(n=c.Core.getNow()-n,t=e.frames.length,r=1/e.fps,n=Math.floor(n/1e3/r%t),i=e.frames[n]),i},l=function(e,t){return null===t||!0===e.loop||(e=e.frames.length*(1e3/e.fps),!(c.Core.getNow()-t>=e))}})(beep8||_readOnlyError("beep8")),(e=>{e.Collision={},e.COLLISION={},e.COLLISION.NONE=0,e.COLLISION.N=1,e.COLLISION.E=2,e.COLLISION.S=4,e.COLLISION.W=8,e.COLLISION.NE=e.COLLISION.N+e.COLLISION.E,e.COLLISION.NS=e.COLLISION.N+e.COLLISION.S,e.COLLISION.NW=e.COLLISION.N+e.COLLISION.W,e.COLLISION.SE=e.COLLISION.S+e.COLLISION.E,e.COLLISION.SW=e.COLLISION.S+e.COLLISION.W,e.COLLISION.WE=e.COLLISION.W+e.COLLISION.E,e.COLLISION.WNE=e.COLLISION.W+e.COLLISION.N+e.COLLISION.E,e.COLLISION.WES=e.COLLISION.W+e.COLLISION.E+e.COLLISION.S,e.COLLISION.NES=e.COLLISION.N+e.COLLISION.E+e.COLLISION.S,e.COLLISION.ALL=e.COLLISION.N+e.COLLISION.E+e.COLLISION.S+e.COLLISION.W})(beep8||_readOnlyError("beep8")),(d=>{d.Core={},d.Core.realCanvas=null,d.Core.realCtx=null,d.Core.canvas=null,d.Core.ctx=null,d.Core.container=null,d.Core.startTime=0,d.Core.deltaTime=0,d.Core.crashed=!1,d.Core.crashing=!1,d.Core.drawState={fgColor:7,bgColor:0,cursorCol:0,cursorRow:0,cursorVisible:!1};var o=null,a=!1,c=null,s=null,u=0,l=0,n=null,h=(d.Core.init=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};d.Utilities.checkFunction("callback",e),t&&d.Utilities.checkObject("options",t),d.CONFIG=_objectSpread(_objectSpread({},d.CONFIG),t),d.Core.initScreenshot(),d.Core.asyncInit(e),d.Core.startTime=d.Core.getNow(),d.Utilities.event("initComplete")},d.Core.initialized=function(){return a},d.Core.asyncInit=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r,n,i,o=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<o.length&&void 0!==o[0]?o[0]:null,d.Utilities.log("beep8 System initializing"),d.CONFIG.SCREEN_WIDTH=d.CONFIG.SCREEN_COLS*d.CONFIG.CHR_WIDTH,d.CONFIG.SCREEN_HEIGHT=d.CONFIG.SCREEN_ROWS*d.CONFIG.CHR_HEIGHT,d.Core.realCanvas=document.createElement("canvas"),d.CONFIG.CANVAS_SETTINGS&&d.CONFIG.CANVAS_SETTINGS.CANVAS_ID&&d.Core.realCanvas.setAttribute("id",d.CONFIG.CANVAS_SETTINGS.CANVAS_ID),d.CONFIG.CANVAS_SETTINGS&&d.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES){r=_createForOfIteratorHelper(d.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES);try{for(r.s();!(n=r.n()).done;)i=n.value,d.Core.realCanvas.classList.add(i)}catch(e){r.e(e)}finally{r.f()}}return d.Core.realCanvas.style.touchAction="none",d.Core.realCanvas.style.userSelect="none",d.Core.realCanvas.style.imageRendering="pixelated",d.Core.realCanvas.addEventListener("touchstart",function(e){return e.preventDefault()}),d.Core.container=document.createElement("div"),d.Core.container.setAttribute("style",""),d.Core.container.id="beep8",d.Core.container.style.display="block",d.Core.container.style.lineHeight="0",d.Core.container.style.position="relative",d.Core.container.appendChild(d.Core.realCanvas),d.Core.getBeepContainerEl().appendChild(d.Core.container),d.Core.canvas=document.createElement("canvas"),d.Core.canvas.width=d.CONFIG.SCREEN_WIDTH,d.Core.canvas.height=d.CONFIG.SCREEN_HEIGHT,d.Core.canvas.style.width=d.CONFIG.SCREEN_WIDTH+"px",d.Core.canvas.style.height=d.CONFIG.SCREEN_HEIGHT+"px",d.Core.ctx=d.Core.canvas.getContext("2d"),d.Core.ctx.imageSmoothingEnabled=!1,e.next=28,d.TextRenderer.initAsync();case 28:return d.Input.init(),d.Core.updateLayout(!1),window.addEventListener("resize",function(){return d.Core.updateLayout(!0)}),d.Core.isMobile()&&d.Joystick.setup(),a=!0,d.Utilities.log("beep8 System initialized"),e.next=36,d.Intro.loading();case 36:return e.next=38,d.Intro.splash();case 38:if(t)return e.next=41,t();e.next=41;break;case 41:case"end":return e.stop()}},e)})),d.Core.getBeepContainerEl=function(){var e,t=document.body;return d.CONFIG.CANVAS_SETTINGS&&d.CONFIG.CANVAS_SETTINGS.CONTAINER&&("string"==typeof(e=d.CONFIG.CANVAS_SETTINGS.CONTAINER)?(t=document.getElementById(e.replace("#","")))||d.Utilities.fatal("beep8: Could not find container element with ID: "+e):t=e instanceof HTMLElement?e:(console.error("beep8: beep8.CONFIG.CANVAS_SETTINGS.CONTAINER must be either an ID of an HTMLElement."),document.body)),t},d.Core.preflight=function(e){if(d.Core.crashed)throw new Error("Can't call API method ".concat(e,"() because the engine has crashed."));a||d.Utilities.fatal("Can't call API method ".concat(e,"(): API not initialized. ")+"Call initAsync() wait until it finishes before calling API methods."),n&&d.Utilities.fatal("Can't call API method ".concat(e,"() because there is a pending async ")+"call to ".concat(n.name,"() that hasn't finished running yet. Are you missing ")+"an 'await' keyword to wait for the async method? Use 'await ".concat(n.name,"()',")+"not just '".concat(n.name,"()'"))},d.Core.startAsync=function(e,t,r){if(n)throw new Error("Internal bug: startAsync called while pendingAsync is not null. Missing preflight() call?");n={name:e,resolve:t,reject:r},d.Renderer.render()},d.Core.hasPendingAsync=function(e){return n&&n.name===e},d.Core.endAsyncImpl=function(e,t,r){if(!n)throw new Error("Internal bug: endAsync(".concat(e,") called with no pendingAsync"));if(n.name!==e)throw new Error("Internal bug: endAsync(".concat(e,") called but pendingAsync.name ")+"is ".concat(n.name));e=t?n.reject:n.resolve;n=null,e(r)},d.Core.resolveAsync=function(e,t){d.Core.endAsyncImpl(e,!1,t)},!(d.Core.failAsync=function(e,t){d.Core.endAsyncImpl(e,!0,t)})),g=null,f=(d.Core.setFrameHandlers=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;c=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||function(){},s=e||function(){},u=1/(2<arguments.length&&void 0!==arguments[2]?arguments[2]:30),l=0,o=d.Core.getNow(),g&&(window.cancelAnimationFrame(g),g=null),h=!0,g=window.requestAnimationFrame(d.Core.doFrame)},d.Core.doFrame=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r,n,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h){e.next=2;break}return e.abrupt("return");case 2:for(t=d.Core.getNow(),r=(t-o)/1e3,o=t,d.Core.deltaTime=r,r=Math.min(r,.05),l+=r,n=Math.floor(l/u),10<n&&(n=10,l=0),i=0;i<n;i++)c&&c(u),d.Input&&"function"==typeof d.Input.onEndFrame&&d.Input.onEndFrame(),d.Particles.update(u);l%=u,s&&s(),d.Renderer.render(),g=window.requestAnimationFrame(d.Core.doFrame);case 16:case"end":return e.stop()}},e)})),d.Core.stopFrame=function(){h=!1,g&&(window.cancelAnimationFrame(g),g=null)},d.Core.cls=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0)||d.Core.drawState.bgColor;d.Utilities.checkNumber("bgColor",e),d.Core.ctx.fillStyle=d.Core.getColorHex(e),d.Core.ctx.fillRect(0,0,d.Core.canvas.width,d.Core.canvas.height),d.Core.setCursorLocation(0,0),d.Renderer.markDirty()},d.Core.defineColors=function(e){d.Utilities.checkArray("colors",e),d.CONFIG.COLORS=e.slice(),d.TextRenderer.regenColors()},d.Core.setColor=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;d.Utilities.checkNumber("fg",e),d.Core.drawState.fgColor=Math.round(e),void 0!==t&&(d.Utilities.checkNumber("bg",t),d.Core.drawState.bgColor=Math.round(t))},d.Core.setCursorLocation=function(e,t){d.Utilities.checkNumber("col",e),void 0!==t&&d.Utilities.checkNumber("row",t),d.Core.drawState.cursorCol=Math.round(e),void 0!==t&&(d.Core.drawState.cursorRow=Math.round(t))},d.Core.nextCursorLocation=function(){var e=d.Core.drawState.cursorCol,t=d.Core.drawState.cursorRow;d.Core.setCursorLocation(e+1,t)},d.Core.getColorHex=function(e){return"number"!=typeof e?"#f0f":e<0?"#000":(e=d.Utilities.clamp(Math.round(e),0,d.CONFIG.COLORS.length-1),d.CONFIG.COLORS[e])},d.Core.getNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},d.Core.drawImage=function(e,t,r,n,i,o,a){d.Utilities.checkInstanceOf("img",e,HTMLImageElement),d.Utilities.checkNumber("x",t),d.Utilities.checkNumber("y",r),void 0!==n&&d.Utilities.checkNumber("srcX",n),void 0!==i&&d.Utilities.checkNumber("srcY",i),void 0!==o&&d.Utilities.checkNumber("width",o),void 0!==a&&d.Utilities.checkNumber("height",a),void 0!==n&&void 0!==i&&void 0!==o&&void 0!==a?d.Core.ctx.drawImage(e,n,i,o,a,t,r,o,a):d.Core.ctx.drawImage(e,t,r)},d.Core.loadImage=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("load image",t),e.abrupt("return",new Promise(function(l){var h=new Image;h.crossOrigin="Anonymous",h.onload=function(){for(var e=document.createElement("canvas"),t=e.getContext("2d"),r=(e.width=h.width,e.height=h.height,t.drawImage(h,0,0),t.getImageData(0,0,e.width,e.height)),n=r.data,i=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4;if(0===Object.keys(f).length)for(var r=e.map(function(e){return d.Utilities.hexToRgb(e)}),n=0;n<256;n+=t)for(var i=0;i<256;i+=t)for(var o=0;o<256;o+=t){var a="".concat(n,",").concat(i,",").concat(o);f[a]=((e,t,r,n)=>{var i,o=null,a=1/0,c=_createForOfIteratorHelper(n);try{for(c.s();!(i=c.n()).done;){var s=i.value,u=Math.pow(s.r-e,2)+Math.pow(s.g-t,2)+Math.pow(s.b-r,2);u<a&&(a=u,o=s)}}catch(e){c.e(e)}finally{c.f()}return o})(n,i,o,r)}return f}(d.CONFIG.COLORS),o=0;o<n.length;o+=4){var a=function(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:4,e=Math.floor(e/i)*i,t=Math.floor(t/i)*i,r=Math.floor(r/i)*i,i="".concat(e,",").concat(t,",").concat(r);return n[i]}(n[o],n[o+1],n[o+2],i),c=a.r,s=a.g,a=a.b;n[o]=c,n[o+1]=s,n[o+2]=a}t.putImageData(r,0,0);var u=new Image;u.onload=function(){return l(u)},u.src=e.toDataURL()},h.src=t}));case 2:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),d.Core.drawRect=function(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,o=(d.Utilities.checkNumber("x",e),d.Utilities.checkNumber("y",t),d.Utilities.checkNumber("width",r),d.Utilities.checkNumber("height",n),d.Utilities.checkNumber("lineWidth",i),d.Core.ctx.strokeStyle),a=d.Core.ctx.lineWidth;d.Core.ctx.strokeStyle=d.Core.getColorHex(d.Core.drawState.fgColor),d.Core.ctx.lineWidth=i,d.Core.ctx.strokeRect(Math.round(e),Math.round(t),Math.round(r),Math.round(n)),d.Core.ctx.strokeStyle=o,d.Core.ctx.lineWidth=a},d.Core.fillRect=function(e,t,r,n){d.Utilities.checkNumber("x",e),d.Utilities.checkNumber("y",t),d.Utilities.checkNumber("width",r),d.Utilities.checkNumber("height",n),d.Core.ctx.fillStyle=d.Core.getColorHex(d.Core.drawState.fgColor),d.Core.ctx.fillRect(Math.round(e)+.5,Math.round(t)+.5,Math.round(r)-1,Math.round(n)-1)},d.Core.initScreenshot=function(){var e;d.Core.initialized()||(e=function(e){"0"===e.key&&d.Core.downloadScreenshot()},document.addEventListener("pointerup",e),document.addEventListener("keyup",e))},d.Core.saveScreen=function(){return d.Core.ctx.getImageData(0,0,d.Core.canvas.width,d.Core.canvas.height)},d.Core.downloadScreenshot=function(){var e=d.Core.getHighResDataURL(d.Core.realCanvas);d.Utilities.downloadFile("beep8-screenshot.png",e)},d.Core.getHighResDataURL=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"image/png",n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,i=document.createElement("canvas"),o=(i.width=e.width*t,i.height=e.height*t,i.getContext("2d"));return o.imageSmoothingEnabled=!1,o.scale(t,t),o.drawImage(e,0,0),i.toDataURL(r,n)},d.Core.restoreScreen=function(e){d.Utilities.checkInstanceOf("screenData",e,ImageData),d.Core.ctx.putImageData(e,0,0)},d.Core.updateLayout=function(e){d.Core.updateLayout2d(),e&&d.Renderer.render()},d.Core.updateLayout2d=function(){d.Core.realCtx=d.Core.realCanvas.getContext("2d"),d.Core.realCtx.imageSmoothingEnabled=!1,d.CONFIG.SCREEN_EL_WIDTH=d.CONFIG.SCREEN_WIDTH,d.CONFIG.SCREEN_EL_HEIGHT=d.CONFIG.SCREEN_HEIGHT,d.CONFIG.SCREEN_REAL_WIDTH=d.CONFIG.SCREEN_WIDTH,d.CONFIG.SCREEN_REAL_HEIGHT=d.CONFIG.SCREEN_HEIGHT,d.Core.realCanvas.style.width="100%",d.Core.realCanvas.style.height="100%",d.Core.realCanvas.style.filter="blur(0.5px)",d.Core.realCanvas.width=d.CONFIG.SCREEN_REAL_WIDTH,d.Core.realCanvas.height=d.CONFIG.SCREEN_REAL_HEIGHT,d.Core.container.style.aspectRatio="".concat(d.CONFIG.SCREEN_COLS," / ").concat(d.CONFIG.SCREEN_ROWS)},d.Core.handleCrash=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Fatal error";d.Core.crashed||d.Core.crashing||(d.Core.crashing=!0,d.Core.setColor(d.CONFIG.COLORS.length-1,0),d.Core.cls(),d.Core.setCursorLocation(1,1),d.TextRenderer.print("*** CRASH ***:\n"+e,null,d.CONFIG.SCREEN_COLS-2),d.Renderer.render(),d.Core.crashing=!1,d.Core.crashed=!0)},d.Core.isTouchDevice=function(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},d.Core.isMobile=function(){return d.Core.isIOS()||d.Core.isAndroid()||d.Core.isTouchDevice()},d.Core.isIOS=function(){return/(ipad|ipod|iphone)/i.test(navigator.userAgent)},d.Core.isAndroid=function(){return/android/i.test(navigator.userAgent)},{})})(beep8||_readOnlyError("beep8")),(i=>{i.CursorRenderer={};var o=0,t=null;i.CursorRenderer.setCursorVisible=function(e){i.Utilities.checkBoolean("visible",e),i.Core.drawState.cursorVisible!==e&&(i.Core.drawState.cursorVisible=e,o=0,i.Renderer.render(),null!==t&&(clearInterval(t),t=null),e)&&(t=setInterval(function(){o=(o+1)%2,i.Renderer.render()},i.CONFIG.CURSOR.BLINK_INTERVAL))},i.CursorRenderer.draw=function(e,t,r){var n;i.Utilities.checkInstanceOf("targetCtx",e,CanvasRenderingContext2D),i.Utilities.checkNumber("canvasWidth",t),i.Utilities.checkNumber("canvasHeight",r),!i.Core.drawState.cursorVisible||o<=0||(r=t/i.Core.canvas.width,t=Math.round((i.Core.drawState.cursorCol+.5-i.CONFIG.CURSOR.WIDTH_F/2+i.CONFIG.CURSOR.OFFSET_H)*i.CONFIG.CHR_WIDTH*r),n=Math.round((i.Core.drawState.cursorRow+1-i.CONFIG.CURSOR.HEIGHT_F-i.CONFIG.CURSOR.OFFSET_V)*i.CONFIG.CHR_HEIGHT*r),e.fillStyle=i.Core.getColorHex(i.Core.drawState.fgColor),e.fillRect(t,n,Math.round(i.CONFIG.CURSOR.WIDTH_F*i.CONFIG.CHR_WIDTH*r),Math.round(i.CONFIG.CURSOR.HEIGHT_F*i.CONFIG.CHR_HEIGHT*r)))}})(beep8||_readOnlyError("beep8")),(f=>{f.Input={};var a=null,c=null;f.Input.init=function(){a=new Set,c=new Set,window.addEventListener("keydown",function(e){return f.Input.onKeyDown(e)}),window.addEventListener("keyup",function(e){return f.Input.onKeyUp(e)}),window.addEventListener("pointerdown",function(e){return f.Input.onPointerDown(e)})},f.Input.keyHeld=function(e){return a.has(e.toUpperCase())},f.Input.keyJustPressed=function(e){return c.has(e.toUpperCase())},f.Input.onEndFrame=function(){c.clear()},f.Input.onKeyDown=function(e){var t,r=e.key,n=f.Input.getKeys(r),i=(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(r)&&e.preventDefault(),_createForOfIteratorHelper(n));try{for(i.s();!(t=i.n()).done;){var o=t.value;c.add(o.toUpperCase()),a.add(o.toUpperCase())}}catch(e){i.e(e)}finally{i.f()}f.Core.hasPendingAsync("beep8.Async.key")&&f.Core.resolveAsync("beep8.Async.key",n)},f.Input.onPointerDown=function(e){f.Core.hasPendingAsync("beep8.Async.pointer")&&f.Core.resolveAsync("beep8.Async.pointer",{x:e.clientX,y:e.clientY})},f.Input.onKeyUp=function(e){if(e.key){var t,e=e.key.toUpperCase(),r=_createForOfIteratorHelper(f.Input.getKeys(e));try{for(r.s();!(t=r.n()).done;){var n=t.value;a.delete(n.toUpperCase())}}catch(e){r.e(e)}finally{r.f()}}},f.Input.readKeyAsync=function(){return new Promise(function(e,t){f.Core.startAsync("beep8.Async.key",e,t)})},f.Input.readPointerAsync=function(){return new Promise(function(e,t){f.Core.startAsync("beep8.Async.pointer",e,t)})},f.Input.getKeys=function(e){var t=[e];switch(e.toUpperCase()){case"W":t.push("ArrowUp");break;case"A":t.push("ArrowLeft");break;case"S":t.push("ArrowDown");break;case"D":t.push("ArrowRight");break;case"Enter":t.push("Escape");break;case"Z":case"N":t.push("ButtonA");break;case"X":case"M":t.push("ButtonB")}return t},f.Input.readLine=(()=>{var r=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r){var n,i,o,a,c,s,u,l,h,d,g=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=2<g.length&&void 0!==g[2]?g[2]:-1,i=f.Core.drawState.cursorCol,a=f.Core.drawState.cursorRow,o=i,a=a,c=[t],s=0,u=f.Core.drawState.cursorVisible,f.CursorRenderer.setCursorVisible(!0);case 9:return f.Core.setCursorLocation(o,a),f.TextRenderer.print(c[s]||""),e.next=14,f.Input.readKeyAsync();case 14:l=e.sent,l=_createForOfIteratorHelper(l),e.prev=16,l.s();case 18:if((h=l.n()).done)e.next=42;else if("Backspace"!==(d=h.value))e.next=32;else if(0!==c[s].length)e.next=26;else{if(0===s)return e.abrupt("continue",40);e.next=24}break;case 24:s--,a--;case 26:c[s]=0<c[s].length?c[s].substring(0,c[s].length-1):c[s],f.Core.setCursorLocation(o+c[s].length,a),f.TextRenderer.print(" "),f.Sfx.play(f.CONFIG.SFX.TYPING),e.next=40;break;case 32:if("Enter"===d)return f.Core.setCursorLocation(1,a+1),f.CursorRenderer.setCursorVisible(u),f.Sfx.play(f.CONFIG.SFX.TYPING),e.abrupt("return",c.join(""));e.next=39;break;case 39:1===d.length&&((c.join("").length<r||-1===r)&&(c[s]+=d,-1!==n)&&c[s].length>=n&&(f.TextRenderer.print(c[s].charAt(c[s].length-1)),o=i,c[++s]="",a++),f.Sfx.play(f.CONFIG.SFX.TYPING));case 40:e.next=18;break;case 42:e.next=47;break;case 44:e.prev=44,e.t0=e.catch(16),l.e(e.t0);case 47:return e.prev=47,l.f(),e.finish(47);case 50:e.next=9;break;case 52:case"end":return e.stop()}},e,null,[[16,44,47,50]])}));return function(e,t){return r.apply(this,arguments)}})()})(beep8||_readOnlyError("beep8")),(r=>{r.Intro={},r.Intro.loading=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.color(0,4),r.cls(),r.locate(1,1),r.print("8> beep8 Loading...\n"),e.next=7,r.Async.wait(.4);case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),r.Intro.splash=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.Tilemap.load("mBqYHoMBBACDAAMEgwADBIMBBACDAQQAgxh6AwSDGJkDBIMBBACDAQQAgwEEAIMDAwSDAwMEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmB6DAQQAgwADBIMAAwSDAAMEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwMDBIMDAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAAQEgwAEBIMABAQADwAADwCYHoMBBACDGJIDBIMYNwMEgxhbAwSDGDcDBIMYNwMEgxg3AwSDGQEEAwSDGDcDBIMYNwMEgxg3AwSDGDcDBIMYNwMEgxg3AwSDGDcDBIMZARYDBIMYNwMEgxg4AwSDAQQAgwEEAIMBBACDAAQEgwMDBIMBBAAADwAADwCYHoMPBQSDGEgDBIMCDwSDAQ8AgxMPBIMBBACDGQGIDwSDGQGHDwSDGQGJDwSDGE4FBIMZAVMPBIMZAVQPBIMZAVUPBIMYTgUEgwEPBIMBDwCDEw8EgxhKAwSDAQQAgwEEAIMBBACDDwUEgwEEAIMBBAAADwAADwCYHoMBBACDGEgDBIMBDwCDGHIFBIMBDwCDGE4FBIMZAZkPBIMYcgUEgxg9BQSDGK8FBIMZAVMPBIMYcgUEgxg9BQSDGK8FBIMLDwSDGHIFBIMLDwSDGEgDBIMBBACDAQQAgwEEAIMABASDAQQAgw8FBAAPAAAPAJgegwEEAIMYSgMEgwEPAIMBDwCDFwQPgwEEAIMZAZ0PBIMBDwSDGE4FBIMBBACDGQFUDwSDGQFTDwSDGE4BBIMBBACDAQ8EgwEPAIMYJQ8FgxhuDwSDGG4PBIMYlw8EgwAPBIMABASDAQQAgwEEAAAPAAAPAJgegwEEAIMYSAMEgwkPBIMYcgUEgwEPAIMYTgEEgxkBnQ8EgxhyBQSDGK8FBIMBBACDGQFTDwSDGHIFBIMYrwUEgwEEAIMBDwSDGHIFBIMYPQUEgxhIAwSDAQQAgwEEAIMBBACDAAQEgwAEBIMABAQADwAADwCYHoMBBACDGEgDBIMYTw8EgwEPAIMYJQ8FgxhOBQSDGQGaDwSDEgoPgxgcBQqDGBkFCoMYHQUKgxMKD4MYHQUPgxhOBQSDBg8EgxhOBQSDDwMEgxhIAwSDDgUEgwEEAIMBBACDAQQAgwEEAIMBBAAADwAADwCYHoMBBACDGFoDBIMYNwMEgxg3AwSDGDcDBIMYNwMEgxg3AwSDAQoEgxgrCgWDGDcDBIMYKwQKgwEKBIMYKwUEgxg3AwSDGFsDBIMYNwMEgxg3AwSDGKUDBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAAAPAAAPAJgegwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMYJAoEgxguBQqDGBkKBIMYLwQKgxglCgWDGCsBBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmB6DAQQAgxgpAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMSCgSDGBwFCoMYGQEKgxgdBQqDEwoFgxgiBQSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAAAPAAAPAJgegxiXDwODGJcPA4MYGAMEgwEEAIMBBACDAQQAgw0FBIMLBAqDGCsKBYMABASDGCsECoMBCgSDGDIFBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMDAwSDAwMEgwEEAIMBBACDAQQAAA8AAA8AmB6DAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgxgkCgSDGC4FCoMYGQoEgxgvBAqDGCUKBYMYKwUEgwAFCoMYHQEEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmB6DAQQAgwEEAIMBBACDAQQAgwEEAIMACgSDAAoEgwAKBIMYLgUEgxgZBAWDGBkEAYMYGQQFgxgvBQSDGC4FBIMYLwUEgwEEAIMBBACDAQQAgwEEAIMYrAMEgxg3AwSDGDcDBIMYWwMEgxg3AwQADwAADwCYHoMYNwMEgxg3AwSDGJsDBIMBBACDAQQAgwEEAIMBBACDAQQEgwEEBIMBBASDAQQEgwEEBIMBBACDAQQAgwEEAIMBBACDGQHlAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmB6DAQQAgwEEAIMBBACDAQQAgwEEAIMYbgMEgxhuAwSDGG4DBIMYbgMEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmB6DAA8EgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwADBIMYegMEgxiZAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMAAwSDAAMEgwADBAAPAAAPAJgegxgcCgSDGB0KBIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgxgpAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAAA8AAA8AmB6DGC4KBIMYLwoEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgxgpAwSDGCkDBIMBBACDAQQAgwEEAIMBBACDAQQAgxcDBIMBAwSDGBgDBIMAAwSDAQQAgxh0AwSDGIYDBIMABQSDAQQAAA8AAA8AmB6DAQQAgwEEAIMBBACDAA8EgwEEAIMBBACDAQQAgxcDBIMCAwSDAQMEgxgYAwSDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDAAMEgwADBIMYdAMEgxkBbAUEgwEEAIMZAUYFBIMBBAAADwAADwCYHoMWAwSDGCgDBIMBBACDAQQAgxh0AwSDEAMEgwEEAIMBBACDAQQAgwEEAIMBBACDAQQAgwEEAIMBBACDFgMEgxgoAwSDGHQDBIMYhgMEgxkBbAUEgwAFBIMABQWDAQUEgwEFBIMBBQQADwAADwCYHoMYKAUDgwAFA4MYKAMEgxh0AwSDAQQAgwEEAIMNBQSDAQQAgwEEAIMYdAMEgxiGAwSDFgMEgxgoAwSDFgMEgwEDBIMBAwSDEAMEgxi0BQSDAAEFgwMBBYMABQWDAQUEgwEFBIMBBQQADwAADwCYHoMBBQSDGCgFA4MABQODGCgDBIMYuAUEgwEEAIMBBACDGIYDBIMYdAMEgxi4BQSDDwMEgwsDBIMBAwSDAQMEgxkBagUDgwEDBIMYnAUDgwADBYMAAQWDAQUEgwAFBYMPAQWDAQUEgwEFBAAPAAAPAJgegwMBBYMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgwEFBIMBBQSDAQUEgw8BBYMRAQWDDwEFgwMFAYMBBQSDAQUEAA8AAA8AloMRAQWDEQEFgwMBBYMDAQWDAwEFgwMBBYMADwWDAwEFgwMBBYMADwWDAA8FgwAPBYMDAQWDAA8FgwAPBYMADwWDDwEFgwsBBYMRAQWDCwEFgxhYBQGDAA8BloMADwGDEAEFgwAPBYMADwWDAA8FgwAPBYMADwWDAQEFgxABBYMADwWDAA8FgwAPBYMADwWDAA8FgwkBBYMADwWDAA8FgwQBBYMADwGDAA8BgwAPAYMABQE="),r.locate(0,0),r.Tilemap.draw(t),t="Click to start",r.Core.isTouchDevice()&&(t="Tap to start"),r.color(4,5),r.locate(0,r.CONFIG.SCREEN_ROWS-2),r.printCentered(t,r.CONFIG.SCREEN_COLS),e.next=10,r.Input.readPointerAsync();case 10:r.color(15,0),r.cls();case 12:case"end":return e.stop()}},e)}))})(beep8||_readOnlyError("beep8")),(g=>{g.Menu={},g.Menu.display=(()=>{var r=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r){var n,i,o,a,c,s,u,l,h,d;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r||{},g.Utilities.checkArray("choices",t),g.Utilities.checkObject("options",r),r=Object.assign({title:"",prompt:"",selBgColor:g.Core.drawState.fgColor,selFgColor:g.Core.drawState.bgColor,border:!0,borderChar:g.CONFIG.BORDER_CHAR,center:!1,centerH:!1,centerV:!1,padding:1,selIndex:0,cancelable:!1,typewriter:!1},r),n=g.Core.drawState.cursorCol,i=g.Core.drawState.cursorRow,o=g.TextRenderer.measure(r.prompt),a=r.prompt?1:0,c=r.borderChar?1:0,s=0,l=t.length,t.forEach(function(e){s=Math.ceil(Math.max(s,g.TextRenderer.measure(e).cols))}),u=Math.ceil(Math.max(o.cols,s))+2*r.padding+2*c,u=Math.min(u,g.CONFIG.SCREEN_COLS),l=a*(o.rows+1)+l+2*r.padding+2*c,(r.centerH||r.center)&&(n=Math.round((g.CONFIG.SCREEN_COLS-u)/2)),(r.centerV||r.center)&&(i=Math.round((g.CONFIG.SCREEN_ROWS-l)/2)),g.Core.drawState.cursorCol=n,g.Core.drawState.cursorRow=i,r.border&&(g.TextRenderer.printBox(u,l,!0,r.borderChar),r.title)&&(l=" "+r.title+" ",g.Core.drawState.cursorCol=n+Math.round((u-l.length)/2),g.TextRenderer.print(l)),r.prompt){if(g.Core.drawState.cursorCol=o.cols<=u?n+c+r.padding:n+Math.round((u-o.cols)/2),g.Core.drawState.cursorRow=i+c+r.padding,r.typewriter)return e.next=26,g.Async.typewriter(r.prompt);e.next=28}else e.next=29;break;case 26:e.next=29;break;case 28:g.TextRenderer.print(r.prompt);case 29:h=r.selIndex;case 30:return g.Core.drawState.cursorRow=i+c+r.padding+a*(o.rows+1),g.Core.drawState.cursorCol=o.cols<=s?n+c+r.padding:n+Math.round((u-s)/2),f(t,h,r),e.next=36,g.Input.readKeyAsync();case 36:(d=e.sent).includes("ArrowUp")?(h=0<h?h-1:t.length-1,1<t.length&&g.Sfx.play(g.CONFIG.SFX.MENU_UP),e.next=54):e.next=42;break;case 42:d.includes("ArrowDown")?(h=(h+1)%t.length,1<t.length&&g.Sfx.play(g.CONFIG.SFX.MENU_DOWN),e.next=54):e.next=47;break;case 47:if(d.includes("Enter")||d.includes("ButtonA"))return g.Sfx.play(g.CONFIG.SFX.MENU_SELECT),e.abrupt("return",h);e.next=52;break;case 52:if((d.includes("Escape")||d.includes("ButtonB"))&&r.cancelable)return e.abrupt("return",-1);e.next=54;break;case 54:e.next=30;break;case 56:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}})();var f=function(e,t,r){for(var n=g.Core.drawState.bgColor,i=g.Core.drawState.fgColor,o=0;o<e.length;o++){var a=o===t;g.Core.setColor(a?r.selFgColor:i,a?r.selBgColor:n),g.TextRenderer.print(e[o]+"\n")}g.Core.setColor(i,n)}})(beep8||_readOnlyError("beep8")),(B=>{function N(e,t){for(var r=[],n=0;n<e;n++)r.push(t(n));return r}B.Music={};var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function i(e){var t,r,e=e.match(/^([A-Ga-g])([#b]?)(\d)$/);return e?(r=e[1].toUpperCase(),t=e[2],e=parseInt(e[3],10),r={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[r],"#"===t?r+=1:"b"===t&&--r,12*(e+1)+r):null}function U(e){e=i(e);return null===e?"?":(e=B.Utilities.clamp(e,36,87),t.charAt(e-36))}function M(e){if(0===e.length)return"";for(var t=e[0],r=1;r<e.length;r++)e[r]===e[r-1]&&" "!==e[r]&&"|"!==e[r]?t+="-":t+=e[r];return t}function T(e,t,r,n){for(var i=N(e,function(){return!1}),o=0;o<n&&!(e<r);o++)i=((e,r,t)=>{for(var n=N(r,function(){return!1}),i=0;i<t;i++)n[B.Random.int(0,r-1)]=!0;return e.map(function(e,t){return n[t%r]?!e:e})})(i,r,t),r*=2;return i}var c=[["I","IIIm","VIm"],["IV","IIm"],["V","VIIm"]],s=[[0,1,2],[1,2,0],[2,0]],r={I:["C4","E4","G4","B4"],IIIm:["E4","G4","B4","D5"],VIm:["A3","C4","E4","G4"],IV:["F4","A4","C5","E5"],IIm:["D4","F4","A4","C5"],V:["G3","B3","D4","F4"],VIIm:["B3","D4","F4","A4"]},o={C:0,D:2,Eb:3,F:5,G:7,A:9,Bb:10},D=[0,1,2,3,4,5],_=[6,7];function u(e,t){var t=r[t]||r.I,n=o[e]||0;return t.map(function(e){var t=n,r=i(e);return null===r?e:(r+=t,e=Math.floor(r/12)-1,["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][r%12]+e)})}B.Music.generate=function(e){e&&e.seed&&B.Random.setSeed(e.seed);var t={seed:B.Random.int(1e4,99999),noteCount:B.Random.pick([16,32,48,64]),channelCount:B.Random.int(2,5),drumPartRatio:.3,tempo:B.Random.pick([70,100,140,170,200,240,280]),hold:B.Random.pick([40,50,60,60,70,70,70,80,80,80,80,90,90,90,100,110,120,130,140,150])},R=Object.assign({},t,e),k=(B.Music.currentSongProperties=R,console.log(R),B.Random.setSeed(R.seed),(e=>{for(var t,r=B.Random.pick(["C","D","Eb","F","G","A","Bb"]),n=null,i=0,o=[],a=0;a<e;a++)a%4==0&&(0===a?(i=B.Random.int(0,c.length-1),n=B.Random.pick(c[i])):B.Random.num()<.8-a/4%2*.5&&(i=B.Random.pick(s[i]),n=B.Random.pick(c[i])),t=u(r,n)),o.push(t);return o})(R.noteCount)),t=N(R.channelCount,function(){if(B.Random.num()<R.drumPartRatio){for(var e=R.noteCount,t=[B.Random.pick(_),"|"],r=T(e,B.Random.int(1,3),B.Random.pick([4,8]),3),n=U("C4"),i=0;i<e;i++)t.push(r[i]?n:" ");return t.push("|"),M(t)}if(B.Random.num()<.5){for(var o,a,c=R.noteCount,s=k,u=[B.Random.pick(D),"|"],l=T(c,4,8,3),h=B.Random.int(-1,1),d=0;d<c;d++)B.Random.chance(10)&&(h+=B.Random.int(-1,1)),l[d]?(a=(a=s[d])[B.Random.int(0,a.length-1)],o=parseInt(a.slice(-1),10),o=B.Utilities.clamp(o+h,3,6),a=U(a.slice(0,-1).toUpperCase()+o),u.push(a)):u.push(" ");return u.push("|"),M(u)}for(var g,f,p=R.noteCount,C=k,A=[B.Random.pick(D),"|"],m=B.Random.chance(30),w=B.Random.pick([4,8,16]),v=N(w,function(){return B.Random.int(0,3)}),y=B.Random.pick([2,4,8]),b=m?N(p,function(){return!0}):T(p,B.Random.pick([1,1,y/2]),y,2),I=B.Random.int(-1,1),E=B.Random.chance(m?30:80),S=0,x=0;x<p;x++)E&&x%y==0&&(S=(S+1)%2),b[x]?(f=C[x][m?v[x%w]:0],g=parseInt(f.slice(-1),10),g=B.Utilities.clamp(g+I+S,3,6),f=U(f.slice(0,-1).toUpperCase()+g),A.push(f)):A.push(" ");return A.push("|"),M(A)});return null!==R.tempo&&(e=String(R.tempo),null!==R.hold&&(e+="."+String(R.hold)),t[0]=e+"\n"+t[0]),t.join("\n")};var n=null;B.Music.play=function(e){p1(e),e&&(n=e)},B.Music.stop=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];B.Utilities.checkBoolean("clearCurrentSong",e),e&&(n=null),B.Music.play("")},B.Music.pause=function(){B.Music.isPlaying()&&B.Music.stop(!1)},B.Music.resume=function(){n&&!B.Music.isPlaying()&&B.Music.play(n)},B.Music.setVolume=function(e){B.Utilities.checkNumber("volume",e),p1.setVolume(e)},B.Music.setTempo=function(e){B.Utilities.checkInt("tempo",e),e<50&&(e=50),p1.setTempo(e)},B.Music.isPlaying=function(){return p1.isPlaying()},document.addEventListener("beep8.pageVisibility.wake",B.Music.resume),document.addEventListener("beep8.pageVisibility.sleep",B.Music.pause)})(beep8),(t=>{var r=0,n=!1;function e(){n||(n=!0,r=Date.now(),t.Utilities.event("pageVisibility.sleep"))}function i(){var e;n&&(n=!1,0!==r)&&(e=Date.now()-r,t.Utilities.log("Time asleep:",(e/1e3).toFixed(3)),t.Utilities.event("pageVisibility.wake",{time:e}),r=0)}document.addEventListener("visibilitychange",function(){(document.hidden?e:i)()}),window.addEventListener("blur",e),window.addEventListener("focus",i)})(beep8||_readOnlyError("beep8")),(u=>{u.Particles={};var n=[];u.Particles.add=function(e,t,r){u.Utilities.checkNumber("x",e),u.Utilities.checkNumber("y",t),u.Utilities.checkObject("props",r);e=Object.assign({},{x:e,y:t,vx:0,vy:0,life:1,size:1,color:15,gravity:0},r);Array.isArray(e.color)&&(e.color=u.Random.pick(e.color)),Array.isArray(e.size)&&(e.size=u.Random.pick(e.size)),n.push(e)},u.Particles.createExplosion=function(e,t){for(var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=(u.Utilities.checkNumber("x",e),u.Utilities.checkNumber("y",t),u.Utilities.checkNumber("count",r),u.Utilities.checkObject("props",n),{size:1,color:u.Core.drawState.fgColor,life:2,speed:25,gravity:0}),o=Object.assign({},i,n),a=0;a<r;a++){var c=u.Random.range(0,2*Math.PI),s=u.Random.range(o.speed/2,o.speed);u.Particles.add(e,t,{size:o.size,color:o.color,life:o.life,vx:Math.cos(c)*s,vy:Math.sin(c)*s,g:o.gravity})}},u.Particles.update=function(e){for(var t=n.length-1;0<=t;t--){var r=n[t];r.vy+=r.g*e,r.x+=r.vx*e,r.y+=r.vy*e,r.life-=e,r.life<=0&&n.splice(t,1)}},u.Particles.render=function(){for(var e=0;e<n.length;e++){var t=n[e],r=t.size/2;u.Core.ctx.fillStyle=u.Core.getColorHex(t.color),u.Core.ctx.fillRect(Math.round(t.x-r),Math.round(t.y-r),Math.round(t.size),Math.round(t.size))}},u.Particles.clearAll=function(){n=[]},u.Particles.getParticles=function(){return _toConsumableArray(n)},u.Particles.setParticles=function(e){u.Utilities.checkArray("particles",e),n=e}})(beep8||_readOnlyError("beep8")),(o=>{o.Passcodes={},o.Passcodes.codeLength=4,o.Passcodes.getCode=function(e){o.Utilities.checkIsSet("id",e);e=(e=>{e=btoa(e);for(var t=0,r="",n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;for(var i=0;i<5;i++)t=(t<<5)-t+o.CONFIG.PASSKEY.charCodeAt(i%o.CONFIG.PASSKEY.length),r+=Math.abs(t).toString(36);return r})(e+o.CONFIG.PASSKEY);return(e=(e=e.replace(/[^a-zA-Z]/g,"")).toUpperCase()).substring(0,o.Passcodes.codeLength)},o.Passcodes.checkCode=function(e,t){return o.Utilities.checkIsSet("id",e),o.Utilities.checkString("code",t),o.Passcodes.getCode(e)===t},o.Passcodes.getId=function(e){for(o.Utilities.checkString("code",e),e=e.toUpperCase(),c=1;c<999;c++)if(o.Passcodes.checkCode(c,e))return c;return null},o.Passcodes.input=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r,n,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t="Enter code:").length+2+2,i=Math.round((o.CONFIG.SCREEN_COLS-n)/2),r=Math.round((o.CONFIG.SCREEN_ROWS-6)/2),o.Core.setCursorLocation(i,r),o.TextRenderer.printBox(n,6),o.Core.setCursorLocation(i+2,r+2),o.TextRenderer.print(t+"\n>"),e.next=11,o.Async.readLine("",o.Passcodes.codeLength);case 11:return n=e.sent,i=o.Passcodes.getId(n),e.abrupt("return",i);case 14:case"end":return e.stop()}},e)}))})(beep8||_readOnlyError("beep8")),(a=>{a.Random={};var r=null;a.Random.setSeed=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;"string"==typeof(e=null===e?Date.now():e)&&(e=e.split("").reduce(function(e,t){return e+t.charCodeAt(0)},0)),r=e=((e=(e^=e<<13)^e>>17)^e<<5)>>>0;for(var t=0;t<10;t++)a.Random.num()},a.Random.getSeed=function(){return r},a.Random.num=function(){var e=4294967296;return(r=(1664525*r+1013904223)%e)/e},a.Random.range=function(e,t){return a.Utilities.checkNumber("min",e),a.Utilities.checkNumber("max",t),e+a.Random.num()*(t-e)},a.Random.int=function(e,t){a.Utilities.checkInt("min",e),a.Utilities.checkInt("max",t),t<=e&&(r=t,t=e,e=r);var r=a.Random.range(e,t);return Math.round(r)},a.Random.pick=function(e){return a.Utilities.checkArray("array",e),e[a.Random.int(0,e.length-1)]},a.Random.pickWeighted=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.2,e=(a.Utilities.checkArray("array",e),a.Random.weightedArray(e,t));return a.Random.pick(e)},a.Random.shuffleArray=function(e){a.Utilities.checkArray("array",e),e=e.slice();for(var t=0;t<e.length;t++){var r=a.Random.int(0,e.length-1),n=e[t];e[t]=e[r],e[r]=n}return e},a.Random.chance=function(e){return a.Utilities.checkNumber("probability",e),a.Random.num()<e/100},a.Random.weightedArray=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.2,r=(a.Utilities.checkArray("array",e),[]),n=0;n<e.length;n++)for(var i=10*Math.pow(t,n),o=0;o<i;o++)r.push(e[n]);return r},a.Random.setSeed()})(beep8||_readOnlyError("beep8")),(l=>{for(var t,n=!(l.Renderer={}),o=[],i=0,r=(l.Renderer.render=function(){var e,t,r;l.Core.crashed||(l.Core.realCtx.imageSmoothingEnabled=!1,(r=t=0)<i&&(e=i*l.CONFIG.CHR_WIDTH,t=Math.round(Math.random()*e-e/2),r=Math.round(Math.random()*e-e/2),t=l.Utilities.clamp(t,-6,6),r=l.Utilities.clamp(r,-6,6),i-=l.Core.deltaTime),l.Core.realCtx.clearRect(0,0,l.Core.realCanvas.width,l.Core.realCanvas.height),l.Core.realCtx.drawImage(l.Core.canvas,t,r,l.Core.realCanvas.width,l.Core.realCanvas.height),n=!1,l.CursorRenderer.draw(l.Core.realCtx,l.Core.realCanvas.width,l.Core.realCanvas.height),l.Renderer.applyCrtFilter())},l.Renderer.shakeScreen=function(e){return l.Utilities.checkNumber("duration",e),e<=0?(l.Utilities.warn("Screenshake duration must be positive. Currently: "+e),!1):(i=e,!0)},l.Renderer.markDirty=function(){n||(n=!0,setTimeout(l.Renderer.render,1))},l.Renderer.applyCrtFilter=function(){var e;l.CONFIG.CRT_ENABLE<=0||!l.CONFIG.CRT_VIGNETTE||(e=(t=l.Core.realCtx.getImageData(0,0,l.CONFIG.SCREEN_WIDTH,l.CONFIG.SCREEN_HEIGHT)).data,r(e),a(e),l.Core.realCtx.putImageData(t,0,0))},function(e){if(!l.CONFIG.CRT_VIGNETTE)return e;for(var t=l.CONFIG.SCREEN_WIDTH,r=t/2,n=l.CONFIG.SCREEN_HEIGHT/2,i=Math.sqrt(Math.pow(r,2)+Math.pow(n,2)),o=.8*i,a=.25/(i*(1-.8)),c=0;c<e.length;c+=4){var s=c/4%t,u=Math.floor(c/4/t),s=Math.sqrt(Math.pow(s-r,2)+Math.pow(u-n,2)),u=s<o?1:Math.max(0,1-(s-o)*a);e[c]*=u,e[c+1]*=u,e[c+2]*=u}}),a=function(e){for(var t=l.CONFIG.SCREEN_WIDTH,r=l.CONFIG.SCREEN_HEIGHT,n=0;n<r;n+=2)for(var i=0;i<t;i++){var o=g(i,n),a=h(e,o),c=0<i?h(e,g(i-1,n)):a,s=i<t-1?h(e,g(i+1,n)):a;d(e,o,u(a,c,s))}},u=function(e,t,r){var n=l.CONFIG.CRT_ENABLE,i=1-n;return{r:e[0]*i+(t[0]+r[0])/2*n*o[t[0]],g:e[1]*i+(t[1]+r[1])/2*n*o[t[1]],b:e[2]*i+(t[2]+r[2])/2*n*o[t[2]]}},h=function(e,t){return[e[t+1],e[t+2],e[t+3]]},d=function(e,t,r){e[t+1]=r.r,e[t+2]=r.g,e[t+3]=r.b},g=function(e,t){return t*l.CONFIG.SCREEN_WIDTH*4+4*e},e=0;e<256;e++)o[e]=.4*Math.pow(e/255,1/2.2)+1})(beep8||_readOnlyError("beep8")),(o=>{o.Scene={};var t=null,a={};o.Scene.add=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:30,n=(o.Utilities.checkString("name",e),null!==t&&o.Utilities.checkObject("gameObject",t),o.Utilities.checkInt("frameRate",r),t.init||null),i=t.update||null,t=t.render||null;a[e]={init:n,update:i,render:t,frameRate:r}},o.Scene.set=function(e){o.Utilities.checkString("name",e),a[e]||o.Utilities.fatal('Scene "'.concat(e,'" does not exist.')),o.Core.stopFrame(),t=e,o.Input&&"function"==typeof o.Input.onEndFrame&&o.Input.onEndFrame();e=a[e];e.init&&e.init(),(e.update||e.render)&&o.frame(e.render,e.update,e.frameRate)},o.Scene.pause=function(){o.frame(null)},o.Scene.resume=function(){var e;t&&((e=a[t]).update||e.render)&&o.frame(e.render||function(){},e.update||function(){},e.frameRate||30)},o.Scene.get=function(){return t},o.Scene.getAll=function(){return a}})(beep8||_readOnlyError("beep8")),(r=>{r.Sfx={},r.Sfx.library={coin:[1.2,0,1675,,.06,.24,1,1.82,,,837,.06],coin2:[1.2,0,523.2511,.01,.06,.3,1,1.82,,,837,.06],blip:[5,0,150,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],blip2:[3,0,200,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],blip3:[3,0,250,.02,.03,.02,,2.8,,,,,,,,,,.7,.02],hit:[,0,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17],sparkle:[1.2,0,539,0,.04,.29,1,1.92,,,567,.02,.02,,,,.04],sparkle2:[1.2,0,80,.3,.4,.7,2,.1,-.73,3.42,-430,.09,.17,,,,.19],life:[1.5,0,537,.02,.02,.22,1,1.59,-6.98,4.97],life2:[1.4,0,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07],break:[1.2,0,528,.01,,.48,,.6,-11.6,,,,.32,4.2],lazer1:[1.5,0,515,.05,.07,.09,1,2.8,,,302,.06,.1,,3.5,.1,.08,.75,.04],alien:[,0,662,.82,.11,.33,1,0,,-.2,,,,1.2,,.26,.01],beep:[2,0,270,,.1,,1,1.5,,,,,,,,.1,.01],beep2:[2,0,150,,.1,,1,1.5,,,,,,,,.1,.01],beep3:[2,0,200,,.1,,1,1.5,,,,,,,,.1,.01],ding:[1,0,685,.01,.03,.17,1,1.4,,,,,,,,,,.63,.01,,420],drum:[1.5,0,129,.01,,.15,,,,,,,,5],explode:[1.5,0,333,.01,0,.9,4,1.9,,,,,,.5,,.6],explode2:[1.1,0,418,0,.02,.2,4,1.15,-8.5,,,,,.7,,.1],explode3:[1.2,0,82,.02,,.2,4,4,,,,,,.8,,.2,,.8,.09],squeak1:[1.2,0,1975,.08,.56,.02,,,-.4,,-322,.56,.41,,,,.25],squeak2:[,0,75,.03,.08,.17,1,1.88,7.83,,,,,.4],squeak3:[1.2,0,1306,.8,.08,.02,1,,,,,,.48,,-.1,.11,.25],squeak4:[1.2,0,1e3,.02,,.01,2,,18,,475,.01,.01],bell:[2,0,999,,,,,1.5,,.3,-99,.1,1.63,,,.11,.22],satellite:[,0,847,.02,.3,.9,1,1.67,,,-294,.04,.13,,,,.1],phone:[,0,1600,.13,.52,.61,1,1.1,,,,,,.1,,.14],pop:[4,0,224,.02,.02,.08,1,1.7,-13.9,,,,,,6.7],rocket:[1.5,0,941,.8,,.8,4,.74,-222,,,,,.8,,1],rocket2:[1.2,0,172,.8,,.8,1,.76,7.7,3.73,-482,.08,.15,,.14],squirt:[,0,448,.01,.1,.3,3,.39,-.5,,,,,,.2,.1,.08],swing:[1.5,0,150,.05,,.05,,1.3,,,,,,3],wave:[,0,40,.5,,1.5,,11,,,,,,199],warp:[3,0,713,.16,.09,.24,,.6,-29,-16,,,.09,.5,,,.23,.75,.15,.48],radioactive:[,0,130,.02,.9,.39,2,.8,,,,,.13,.2,,.1,,.93,.06,.28],siren:[1.3,0,960,,1,.01,,.8,-.01,,-190,.5,,.05,,,1],car_horn:[1.8,0,250,.02,.02,.2,2,2,,,,,.02,,,.02,.01,,,.1],engine2:[1.2,0,25,.05,.3,.5,3,9,-.01,,,,,,13,.1,.2],thunder:[1.2,0,471,,.09,.47,4,1.06,-6.7,,,,,.9,61,.1,,.82,.09,.13],sparkle3:[,0,63,,1,,1,1.5,,,,,,,,3.69,.08],sweep:[1.2,0,9220,.01,,,,5,,,,,,9],click:[1.5,0,900,,.01,0,1,,-10,,-31,.02,,,,,,1.2,,.16,-1448]},r.Sfx.play=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";e&&(r.Utilities.checkString("sfx",e),r.Sfx.library[e]||r.Utilities.fatal("SFX ".concat(e," not found.")),r.Sfx.playFromArray(r.Sfx.library[e]))},r.Sfx.playFromArray=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];r.Utilities.checkArray("sfxArray",e),zzfx.apply(void 0,_toConsumableArray(e))},r.Sfx.add=function(e,t){r.Utilities.checkString("sfxName",e),r.Utilities.checkArray("sfxArray",t),r.Sfx.library[e]=t},r.Sfx.get=function(){return Object.keys(r.Sfx.library)}})(beep8||_readOnlyError("beep8")),(n=>{n.State=n.State||{};var r="";function i(e){return new Proxy(e,{get:function(e,t){e=e[t];return"object"===_typeof(e)&&null!==e?i(e):e},set:function(e,t,r){return e[t]=r,n.Utilities.event("stateChange",{prop:t,value:r}),!0}})}document.addEventListener("beep8.initComplete",function(){r="beep8.".concat(n.Utilities.makeUrlPretty(n.CONFIG.NAME),".state")},{once:!0}),n.State.save=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r,t=n.Utilities.encodeData({time:Date.now(),data:n.data});localStorage.setItem(e,t),n.State.lastSave=Date.now()},n.State.load=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r,e=localStorage.getItem(e);e?((e=n.Utilities.decodeData(e)).data&&(n.data=i(e.data)),e.time&&(n.State.lastSave=e.time)):n.Utilities.log("No state found for the given key.")},n.State.init=function(e){n.data||(n.data=i({})),localStorage.getItem(r)&&n.State.load(),n.data=n.Utilities.deepMergeByIndex(e,n.data),n.Utilities.log("State initialized:",n.data)},n.State.clear=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r;n.Utilities.log("Clearing state..."),localStorage.removeItem(e),n.data=i({})},n.data=i({})})(beep8||_readOnlyError("beep8")),(h=>{h.TextRenderer={};var l=[],d=(h.TextRenderer.fonts_={},h.TextRenderer.curFont_=null,h.TextRenderer.curTiles_=null,h.TextRenderer.prepareCharMap=function(){for(var e=_toConsumableArray(h.CONFIG.CHRS),t=0;t<e.length;t++)l.push(e[t].charCodeAt(0))},h.TextRenderer.initAsync=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h.Utilities.log("beep8.TextRenderer init."),e.next=3,h.TextRenderer.loadFontAsync("default-thin",h.CONFIG.FONT_DEFAULT,.5,1);case 3:return h.TextRenderer.curFont_=e.sent,e.next=6,h.TextRenderer.loadFontAsync("tiles",h.CONFIG.FONT_TILES);case 6:return h.TextRenderer.curTiles_=e.sent,e.next=9,h.TextRenderer.loadFontAsync("actors",h.CONFIG.FONT_ACTORS);case 9:h.TextRenderer.curActors_=e.sent,h.TextRenderer.prepareCharMap();case 11:case"end":return e.stop()}},e)})),h.TextRenderer.loadFontAsync=(()=>{var r=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r){var n,i,o=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=2<o.length&&void 0!==o[2]?o[2]:1,n=3<o.length&&void 0!==o[3]?o[3]:1,h.Utilities.checkString("fontName",t),h.Utilities.checkString("fontImageFile",r),i=new h.TextRendererFont(t,r,i,n),e.next=7,i.initAsync();case 7:return h.TextRenderer.fonts_[t]=i,e.abrupt("return",i);case 9:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}})(),h.TextRenderer.setFont=function(e){e=h.TextRenderer.getFontByName(e);e&&(h.TextRenderer.curFont_=e)},h.TextRenderer.getFont=function(){return h.TextRenderer.curFont_},h.TextRenderer.setTileFont=function(e){e=h.TextRenderer.getFontByName(e);e&&(h.TextRenderer.curTiles_=e)},h.TextRenderer.getFontByName=function(e){h.Utilities.checkString("fontName",e);var t=h.TextRenderer.fonts_[e];if(t)return t;h.Utilities.fatal("setFont(): font not found: ".concat(e))},h.TextRenderer.print=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,n=(h.TextRenderer.printFont_=t||h.TextRenderer.curFont_,h.Utilities.checkString("text",e),h.Utilities.checkNumber("wrapWidth",r),null!==t&&h.Utilities.checkObject("font",t),e=h.TextRenderer.wrapText(e,r,t),h.Core.drawState.cursorCol),i=h.Core.drawState.cursorRow,o=(h.TextRenderer.origFgColor_=h.Core.drawState.fgColor,h.TextRenderer.origBgColor_=h.Core.drawState.bgColor,h.TextRenderer.origFont_=h.TextRenderer.printFont_,h.TextRenderer.printFont_.getCharColCount()),a=h.TextRenderer.printFont_.getCharRowCount(),c=n,s=0;s<e.length;s++){var s=g(e,s),u=e.charCodeAt(s);10===u?(n=c,i+=a):0<=(u=l.indexOf(u))&&(d(u,n,i,h.Core.drawState.fgColor,h.Core.drawState.bgColor,h.TextRenderer.printFont_),n+=o)}h.Core.drawState.cursorCol=n,h.Core.drawState.cursorRow=i,h.Core.drawState.fgColor=h.TextRenderer.origFgColor_,h.Core.drawState.bgColor=h.TextRenderer.origBgColor_,h.Renderer.markDirty()},h.TextRenderer.printTypewriter=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n,i,o,a,c,s=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=1<s.length&&void 0!==s[1]?s[1]:-1,r=2<s.length&&void 0!==s[2]?s[2]:.05,n=3<s.length&&void 0!==s[3]?s[3]:null,h.Utilities.checkString("text",t),h.Utilities.checkNumber("wrapWidth",a),h.Utilities.checkNumber("delay",r),i=h.col(),o=h.row(),t=h.TextRenderer.wrapText(t,a),a=0;case 10:if(a<=t.length){if(h.CONFIG.PRINT_ESCAPE_START&&t.substring(a,a+h.CONFIG.PRINT_ESCAPE_START.length)===h.CONFIG.PRINT_ESCAPE_START&&0<=(c=t.indexOf(h.CONFIG.PRINT_ESCAPE_END,a+h.CONFIG.PRINT_ESCAPE_START.length))&&(a=c+h.CONFIG.PRINT_ESCAPE_END.length),c=t.charCodeAt(a),h.Core.setCursorLocation(i,o),h.TextRenderer.print(t.substring(0,a),n),32!==c)return e.next=18,h.Async.wait(r);e.next=18}else e.next=21;break;case 18:a++,e.next=10;break;case 21:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),h.TextRenderer.printCentered=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(h.TextRenderer.printFont_=r||h.TextRenderer.curFont_,h.Utilities.checkString("text",e),h.Utilities.checkNumber("width",t),e){var n=h.Core.drawState.cursorCol,i=h.TextRenderer.printFont_.getCharRowCount();""===(e=e.split("\n"))[e.length-1]&&e.pop();for(var o=0;o<e.length;o++){var a=h.TextRenderer.measure(e[o]).cols;h.Core.drawState.cursorCol=n+(t-a)/2,h.TextRenderer.print(e[o],r,t),h.Core.drawState.cursorRow+=i}h.Core.drawState.cursorCol=n}},h.TextRenderer.printRight=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(h.TextRenderer.printFont_=r||h.TextRenderer.curFont_,h.Utilities.checkString("text",e),h.Utilities.checkNumber("width",t),e){var n=h.Core.drawState.cursorCol,i=h.TextRenderer.printFont_.getCharRowCount();""===(e=(e=h.TextRenderer.wrapText(e,t)).split("\n"))[e.length-1]&&e.pop();for(var o=0;o<e.length;o++){var a=h.TextRenderer.measure(e[o]).cols;h.Core.drawState.cursorCol=n+t-a,h.TextRenderer.print(e[o],r,t),h.Core.drawState.cursorRow+=i}h.Core.drawState.cursorCol=n}},h.TextRenderer.printChar=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;for(void 0!==t&&!isNaN(t)||(t=1),h.Utilities.checkNumber("ch",e),h.Utilities.checkNumber("n",t);0<t--;)d(e,h.Core.drawState.cursorCol,h.Core.drawState.cursorRow,h.Core.drawState.fgColor,h.Core.drawState.bgColor,r),h.Core.drawState.cursorCol++;h.Renderer.markDirty()},h.TextRenderer.spr=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;h.Utilities.checkNumber("ch",e),h.Utilities.checkNumber("x",t),h.Utilities.checkNumber("y",r),h.Utilities.checkInt("direction",i),null!==n&&h.Utilities.checkObject("font",n),s(e,t,r,h.Core.drawState.fgColor,h.Core.drawState.bgColor,n,i)},h.TextRenderer.drawText=function(e,t,r,n){h.Utilities.checkNumber("x",e),h.Utilities.checkNumber("y",t),h.Utilities.checkString("text",r),n&&h.Utilities.checkString("fontName",n);var i=e,o=n&&h.TextRenderer.fonts_[n]||h.TextRenderer.curFont_;if(o)for(var a=0;a<r.length;a++){var c=r.charCodeAt(a);10===c?(e=i,t+=o.getCharHeight()):(s(c,e,t,h.Core.drawState.fgColor,h.Core.drawState.bgColor,o),e+=o.getCharWidth())}else h.Utilities.warn("Requested font '".concat(n,"' not found: not drawing text."))},h.TextRenderer.measure=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(h.Utilities.checkString("text",e),t=t||h.TextRenderer.curFont_,""===e)return{cols:0,rows:0};for(var r=1,n=0,i=0,o=0;o<e.length;o++){o=g(e,o,!0);10===e.charCodeAt(o)?(r++,n=0):(++n,i=Math.max(i,n))}return{cols:i*=t.getCharColCount(),rows:r*=t.getCharRowCount()}},h.TextRenderer.printRect=function(e,t,r){h.Utilities.checkNumber("width",e),h.Utilities.checkNumber("height",t),h.Utilities.checkNumber("ch",r);for(var n=h.Core.drawState.cursorCol,i=h.Core.drawState.cursorRow,o=0;o<t;o++)h.Core.drawState.cursorCol=n,h.Core.drawState.cursorRow=i+o,h.TextRenderer.printChar(r,e);h.Core.drawState.cursorCol=n,h.Core.drawState.cursorRow=i},h.TextRenderer.printBox=function(e,t){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:h.CONFIG.BORDER_CHAR,i=(h.Utilities.checkNumber("width",e),h.Utilities.checkNumber("height",t),h.Utilities.checkBoolean("fill",r),h.Utilities.checkNumber("borderChar",n),h.TextRenderer.curTiles_.getColCount());h.TextRenderer.drawBox(e,t,r,{NW:n,NE:n+2,SW:n+i+i,SE:n+i+i+2,V:n+i,H:n+1})},h.TextRenderer.drawBox=function(e,t){for(var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=h.Core.drawState.cursorCol,o=h.Core.drawState.cursorRow,a=0;a<t;a++)h.Core.drawState.cursorCol=i,h.Core.drawState.cursorRow=o+a,0===a?(h.TextRenderer.printChar(n.NW),h.TextRenderer.printChar(n.H,e-2),h.TextRenderer.printChar(n.NE)):a===t-1?(h.TextRenderer.printChar(n.SW),h.TextRenderer.printChar(n.H,e-2),h.TextRenderer.printChar(n.SE)):(h.TextRenderer.printChar(n.V),h.Core.drawState.cursorCol=i+e-1,h.TextRenderer.printChar(n.V));r&&2<e&&2<t&&(h.Core.drawState.cursorCol=i+1,h.Core.drawState.cursorRow=o+1,h.TextRenderer.printRect(e-2,t-2,0)),h.Core.drawState.cursorCol=i,h.Core.drawState.cursorRow=o},h.TextRenderer.wrapText=function(e,t){(2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)||h.TextRenderer.curFont_;if(t<=0)return e;var r,n=[],i=_createForOfIteratorHelper(e.split("\n"));try{for(i.s();!(r=i.n()).done;){var o,a=r.value.split(" "),c="",s=_createForOfIteratorHelper(a);try{for(s.s();!(o=s.n()).done;){var u=o.value;t<h.TextRenderer.measure((c+u).trim()).cols&&(n.push(c.trim()),c=""),c+=u+" "}}catch(e){s.e(e)}finally{s.f()}n.push(c.trim())}}catch(e){i.e(e)}finally{i.f()}return n.join("\n")},function(e,t,r,n,i){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,t=Math.round(t*h.CONFIG.CHR_WIDTH),r=Math.round(r*h.CONFIG.CHR_HEIGHT);s(e,t,r,n,i,o,a)}),s=function(e,t,r,n,i){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,c=(o=o||h.TextRenderer.curTiles_).getColCount(),s=o.getCharWidth(),u=o.getCharHeight(),l=Math.floor(e/c),e=e%c;t=Math.round(t),r=Math.round(r),0<=i&&(h.Core.ctx.fillStyle=h.Core.getColorHex(i),h.Core.ctx.fillRect(t,r,s,u)),1===h.CONFIG.SCREEN_COLORS&&i===n||(0<a&&(h.Core.ctx.save(),h.Core.ctx.translate(t+((c=0!=(1&a))?s:0),r+((i=0!=(2&a))?u:0)),h.Core.ctx.scale(c?-1:1,i?-1:1),r=t=0),c=h.Utilities.clamp(n,0,h.CONFIG.COLORS.length-1),i=o.getImageForColor(c),h.Core.ctx.drawImage(i,e*s,l*u,s,u,t,r,s,u),0<a&&h.Core.ctx.restore(),h.Renderer.markDirty())},g=function(e,t){var r,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=h.CONFIG.PRINT_ESCAPE_START,o=h.CONFIG.PRINT_ESCAPE_END;return!i||!o||e.substring(t,t+i.length)!=i?t:(r=e.indexOf(o,t+i.length),n||(n=e.substring(t+i.length,r),a(n)),r+o.length)},a=function(e){if(0<e.indexOf(",")){var t,r=_createForOfIteratorHelper(e.split(","));try{for(r.s();!(t=r.n()).done;)a(t.value)}catch(e){r.e(e)}finally{r.f()}}else if(""!==(e=e.trim())){var n=e[0].toLowerCase(),i=e.substring(1),o=+i;switch(n){case"f":case"c":h.Core.drawState.fgColor=""!==i?o:h.TextRenderer.origFgColor_;break;case"b":h.Core.drawState.bgColor=""!==i?o:h.TextRenderer.origBgColor_;break;case"t":h.TextRenderer.printFont_=h.TextRenderer.getFontByName(i);break;case"z":h.Core.drawState.fgColor=h.TextRenderer.origFgColor_,h.Core.drawState.bgColor=h.TextRenderer.origBgColor_,h.TextRenderer.printFont_=h.TextRenderer.origFont_||h.TextRenderer.fonts_.default;break;default:console.warn("Unknown beep8 print escape command: "+e)}}};h.TextRenderer.regenColors=function(){Object.values(h.TextRenderer.fonts_).forEach(function(e){return e.regenColors()})}})(beep8||_readOnlyError("beep8")),(o=>{o.TextRendererFont=(()=>{return _createClass(function e(t,r){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;_classCallCheck(this,e),o.Utilities.checkString("fontName",t),o.Utilities.checkString("fontImageFile",r),this.fontName_=t,this.fontImageFile_=r,this.origImg_=null,this.chrImages_=[],this.imageWidth_=0,this.imageHeight_=0,this.colCount_=0,this.rowCount_=0,this.charWidth_=0,this.charHeight_=0,this.charColCount_=0,this.charRowCount_=0,this.tileWidthMultiplier_=n,this.tileHeightMultiplier_=i},[{key:"initAsync",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Utilities.loadImageAsync(this.fontImageFile_);case 2:return this.origImg_=e.sent,t=o.CONFIG.CHR_WIDTH*this.tileWidthMultiplier_,r=o.CONFIG.CHR_HEIGHT*this.tileHeightMultiplier_,o.Utilities.assert(this.origImg_.width%t==0&&this.origImg_.height%r==0,"Font ".concat(this.fontName_,": image ").concat(this.fontImageFile_," has dimensions ")+"".concat(this.origImg_.width,"x").concat(this.origImg_.height,".")),e.next=8,o.Utilities.makeColorTransparent(this.origImg_);case 8:return this.origImg_=e.sent,this.charWidth_=t,this.charHeight_=r,this.imageWidth_=this.origImg_.width,this.imageHeight_=this.origImg_.height,this.colCount_=this.imageWidth_/this.charWidth_,this.rowCount_=this.imageHeight_/this.charHeight_,this.charColCount_=this.tileWidthMultiplier_,this.charRowCount_=this.tileHeightMultiplier_,e.next=19,this.regenColors();case 19:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"getCharWidth",value:function(){return this.charWidth_}},{key:"getCharHeight",value:function(){return this.charHeight_}},{key:"getCharColCount",value:function(){return this.charColCount_}},{key:"getCharRowCount",value:function(){return this.charRowCount_}},{key:"getRowCount",value:function(){return this.rowCount_}},{key:"getColCount",value:function(){return this.colCount_}},{key:"getImageForColor",value:function(e){return this.chrImages_[e]}},{key:"regenColors",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r,n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(this.chrImages_=[],t=0;t<o.CONFIG.COLORS.length;t++)(r=document.createElement("canvas")).width=this.origImg_.width,r.height=this.origImg_.height,(n=r.getContext("2d")).clearRect(0,0,this.origImg_.width,this.origImg_.height),n.globalCompositeOperation="source-over",n.drawImage(this.origImg_,0,0,this.origImg_.width,this.origImg_.height),n.globalCompositeOperation="source-in",n.fillStyle=o.CONFIG.COLORS[t],n.fillRect(0,0,this.origImg_.width,this.origImg_.height),2===o.CONFIG.SCREEN_COLORS&&(n.globalCompositeOperation="multiply",n.drawImage(this.origImg_,0,0,this.origImg_.width,this.origImg_.height)),this.chrImages_.push(r);case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})}]);var e,t})()})(beep8||_readOnlyError("beep8")),(l=>{l.Tilemap={},l.Tilemap.MAP_CHAR=0,l.Tilemap.MAP_FG=1,l.Tilemap.MAP_BG=2,l.Tilemap.MAP_COLLISION=3,l.Tilemap.MAP_DATA=4;var i={solid:{0:1,1:1,2:1,3:36,4:1,5:1,6:18,7:1,8:1,9:37,10:1,11:1,12:19,13:1,14:1,15:1},rounded:{0:1,1:42,2:23,3:36,4:41,5:1,6:18,7:1,8:24,9:37,10:1,11:1,12:19,13:1,14:1,15:1},half:{0:128,1:75,2:58,3:93,4:75,5:75,6:57,7:129,8:58,9:95,10:58,11:111,12:59,13:130,14:112,15:113},half_rounded:{0:128,1:148,2:166,3:93,4:149,5:75,6:57,7:129,8:167,9:95,10:58,11:111,12:59,13:130,14:112,15:113},pipe:{0:128,1:148,2:166,3:93,4:149,5:[75,77],6:57,7:129,8:167,9:95,10:[58,94],11:111,12:59,13:130,14:112,15:[113,131,76]},thin:{0:110,1:173,2:172,3:164,4:154,5:72,6:146,7:126,8:155,9:165,10:55,11:108,12:147,13:127,14:109,15:73}};l.Tilemap.save=function(e){return l.Utilities.checkArray("tilemap",e),l.Utilities.encodeData(e)},l.Tilemap.load=function(e){return l.Utilities.checkString("data",e),l.Utilities.decodeData(e)},l.Tilemap.draw=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=(l.Utilities.checkArray("tilemap",e),t=t||e[0].length,r=r||e.length,l.Utilities.checkNumber("width",t),l.Utilities.checkNumber("height",r),l.Core.drawState.cursorRow),i=l.Core.drawState.cursorCol,o=0;o<r;o++){l.locate(0+i,o+n);for(var a=0;a<t;a++){var c=e[o][a];c&&3<=c.length&&(l.color(c[l.Tilemap.MAP_FG],c[l.Tilemap.MAP_BG]),l.printChar(c[l.Tilemap.MAP_CHAR]))}}},l.Tilemap.createEmptyTilemap=function(e,t){for(var r=[],n=0;n<t;n++){r[n]=[];for(var i=0;i<e;i++)r[n][i]=l.Tilemap.getDefaultTile()}return r},l.Tilemap.shift=function(e,t,r){l.Utilities.checkArray("tilemap",e),l.Utilities.checkNumber("dx",t),l.Utilities.checkNumber("dy",r);for(var n=e[0].length,i=e.length,o=l.Tilemap.createEmptyTilemap(n,i),a=0;a<i;a++)for(var c=0;c<n;c++)o[(a+r+i)%i][(c+t+n)%n]=_toConsumableArray(e[a][c]);return o},l.Tilemap.resize=function(e,t,r){l.Utilities.checkArray("tilemap",e),l.Utilities.checkNumber("width",t),l.Utilities.checkNumber("height",r);for(var n=l.Tilemap.createEmptyTilemap(t,r),i=0;i<r;i++)for(var o=0;o<t;o++)e[i]&&e[i][o]&&(n[i][o]=_toConsumableArray(e[i][o]));return n},l.Tilemap.getDefaultTile=function(){return[0,15,0,0,{}]},l.Tilemap.convertFromText=function(e){return l.Utilities.checkString("text",e),e.trim().split("\n").map(function(e){return e.trim().split("")})},l.Tilemap.createFromArray=function(e,t){for(var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=(l.Utilities.checkArray("grid",e),l.Utilities.checkObject("tilePattern",t),null!==r&&l.Utilities.checkObject("defaultTilePattern",r),null===r&&(r=l.Tilemap.getDefaultTile()),[]),i=0;i<e.length;i++){n[i]=[];for(var o,a,c,s,u=0;u<e[i].length;u++)n[i][u]=_toConsumableArray(r),t[e[i][u]]&&("string"==typeof(a=(o=t[e[i][u]]).t)&&a.startsWith("wall_")&&(a=l.Tilemap.wallTile(u,i,e,a)),Array.isArray(a)&&(a=l.Random.pickWeighted(a)),c=o.fg||15,Array.isArray(c)&&(c=l.Random.pickWeighted(c)),s=o.bg||0,Array.isArray(s)&&(s=l.Random.pickWeighted(s)),n[i][u]=[a,c,s,o.coll||0,o.data||{}])}return n},l.Tilemap.wallTile=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,n=(l.Utilities.checkNumber("x",e),l.Utilities.checkNumber("y",t),l.Utilities.checkArray("grid",r),l.Utilities.checkString("name",n),null===n&&l.Utilities.fatal("Wall tile name not given: "+n),n.substring(5)),r=(i[n]||l.Utilities.fatal("Wall tile type not found: "+n),((e,t,r)=>{var n=0,i=e[r][t];return 0<r&&e[r-1][t]===i&&(n+=1),t<e[r].length-1&&e[r][t+1]===i&&(n+=2),r<e.length-1&&e[r+1][t]===i&&(n+=4),0<t&&e[r][t-1]===i&&(n+=8),n})(r,e,t));return i[n][r]}})(beep8||_readOnlyError("beep8")),(beep8||({},_readOnlyError("beep8"))).Timer={create:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:60;return{initialTime:e,currentTime:e,isRunning:1<arguments.length&&void 0!==arguments[1]&&arguments[1],isPaused:!1,format:"MM:SS",start:function(){this.isRunning=!0,this.isPaused=!1},stop:function(){this.isRunning=!1,this.currentTime=this.initialTime,this.isPaused=!1},pause:function(){this.isRunning&&(this.isPaused=!0)},resume:function(){this.isRunning&&this.isPaused&&(this.isPaused=!1)},reset:function(){this.currentTime=this.initialTime,this.isRunning=!1,this.isPaused=!1},addTime:function(e){this.currentTime+=e},removeTime:function(e){this.currentTime=Math.max(0,this.currentTime-e)},update:function(e){this.isRunning&&!this.isPaused&&(this.currentTime-=e,this.currentTime<=0)&&(this.currentTime=0,this.isRunning=!1)},setFormat:function(e){this.format=e},getFormattedTime:function(){var e,t,r,n=Math.floor(this.currentTime);return"SS"===this.format?this.currentTime.toFixed(1)+"s":"HH:MM:SS"===this.format?(r=Math.floor(n/3600),e=Math.floor(n%3600/60),t=n%60,r.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0")+":"+t.toString().padStart(2,"0")):(r=n%60,Math.floor(n/60).toString().padStart(2,"0")+":"+r.toString().padStart(2,"0"))}}}},(u=>{u.Utilities={},u.Utilities.fatal=function(t){u.Utilities.error("Fatal error: "+t);try{u.Core.handleCrash(t)}catch(e){u.Utilities.error("Error in beep8.Core.handleCrash: "+e+" while handling error "+t)}throw new Error(t)},u.Utilities.assert=function(e,t){return e||u.Utilities.fatal(t||"Assertion Failed"),e},u.Utilities.assertDebug=function(e,t){return e||(u.CONFIG.DEBUG?warn("DEBUG ASSERT failed: "+t):u.Utilities.fatal(t)),e},u.Utilities.assertEquals=function(e,t,r){return e!==t&&u.Utilities.fatal("".concat(r,": expected ").concat(e," but got ").concat(t)),t},u.Utilities.checkType=function(e,t,r){return u.Utilities.assert(e,"checkType: varName must be provided."),u.Utilities.assert(r,"checkType: varType must be provided."),u.Utilities.assert(_typeof(t)===r,"".concat(e," should be of type ").concat(r," but was ").concat(_typeof(t),": ").concat(t)),t},u.Utilities.checkNumber=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;return u.Utilities.checkType(e,t,"number"),isNaN(t)&&u.Utilities.fatal("".concat(e," should be a number but is NaN")),isFinite(t)||u.Utilities.fatal("".concat(e," should be a number but is infinite: ").concat(t)),void 0!==r&&u.Utilities.assert(r<=t,"".concat(e," should be >= ").concat(r," but is ").concat(t)),void 0!==n&&u.Utilities.assert(t<=n,"".concat(e," should be <= ").concat(n," but is ").concat(t)),t},u.Utilities.checkInt=function(e,t,r,n){return u.Utilities.checkNumber(e,t,r,n),t!==Math.round(t)&&u.Utilities.fatal("".concat(e," should be an integer but is ").concat(t)),t},u.Utilities.checkString=function(e,t){return u.Utilities.checkType(e,t,"string")},u.Utilities.checkBoolean=function(e,t){return u.Utilities.checkType(e,t,"boolean")},u.Utilities.checkFunction=function(e,t){return u.Utilities.checkType(e,t,"function")},u.Utilities.checkObject=function(e,t){return null===t&&u.Utilities.fatal("".concat(e," should be an object, but was null")),u.Utilities.checkType(e,t,"object")},u.Utilities.checkInstanceOf=function(e,t,r){return u.Utilities.assert(t instanceof r,"".concat(e," should be an instance of ").concat(r.name," but was not, it's: ").concat(t)),t},u.Utilities.checkIsSet=function(e,t){return u.Utilities.assert(null!=t,"".concat(e," should be set but was: ").concat(t)),t},u.Utilities.checkArray=function(e,t){return u.Utilities.assert(Array.isArray(t),"".concat(e," should be an array, but was: ").concat(t)),t},u.Utilities.log=function(e){u.CONFIG.DEBUG&&console.log(e)},u.Utilities.warn=function(e){console.warn(e)},u.Utilities.error=function(e){console.error(e)},u.Utilities.loadImageAsync=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var t=new Image;t.src=r,t.onload=function(){return e(t)}}));case 1:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Utilities.makeColorTransparent=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n,i,o,a,c,s,u,l,h,d=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=1<d.length&&void 0!==d[1]?d[1]:[255,0,255],n=2<d.length&&void 0!==d[2]?d[2]:5,i=document.createElement("canvas"),o=i.getContext("2d"),i.width=t.width,i.height=t.height,o.drawImage(t,0,0),a=o.getImageData(0,0,i.width,i.height),c=a.data,s=0;s<c.length;s+=4)u=c[s],l=c[s+1],h=c[s+2],Math.abs(u-r[0])<=n&&Math.abs(l-r[1])<=n&&Math.abs(h-r[2])<=n&&(c[s+3]=0);return o.putImageData(a,0,0),e.abrupt("return",i);case 12:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),u.Utilities.loadFileAsync=function(n){return new Promise(function(e,t){var r=new XMLHttpRequest;r.addEventListener("load",function(){r.status<200||299<r.status?t("HTTP request finished with status "+r.status):e(r.responseText)}),r.addEventListener("error",function(e){return t(e)}),r.open("GET",n),r.send()})},u.Utilities.clamp=function(e,t,r){return Math.min(Math.max(e,t),r)},u.Utilities.dist2d=function(e,t,r,n){u.Utilities.checkNumber("x0",e),u.Utilities.checkNumber("y0",t),u.Utilities.checkNumber("x1",r),u.Utilities.checkNumber("y1",n);e-=r,r=t-n;return Math.sqrt(e*e+r*r)},u.Utilities.hexToRgb=function(e){e=e.replace("#","");e=parseInt(e,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},u.Utilities.intersectIntervals=function(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,e=(u.Utilities.checkNumber("as",e),u.Utilities.checkNumber("ae",t),u.Utilities.checkNumber("bs",r),u.Utilities.checkNumber("be",n),i&&u.Utilities.checkObject("result",i),Math.max(e,r)),r=Math.min(t,n);return e<=r&&(i&&(i.start=e,i.end=r),!0)},u.Utilities.intersectRects=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,c=(u.Utilities.checkObject("r1",e),u.Utilities.checkObject("r2",t),u.Utilities.checkNumber("r1.x",e.x),u.Utilities.checkNumber("r1.y",e.y),u.Utilities.checkNumber("r1.w",e.w),u.Utilities.checkNumber("r1.h",e.h),u.Utilities.checkNumber("r2.x",t.x),u.Utilities.checkNumber("r2.y",t.y),u.Utilities.checkNumber("r2.w",t.w),u.Utilities.checkNumber("r2.h",t.h),u.Utilities.checkNumber("dx1",r),u.Utilities.checkNumber("dx2",i),u.Utilities.checkNumber("dy1",n),u.Utilities.checkNumber("dy2",o),a&&checkObject("result",a),l),s=h;return!!u.Utilities.intersectIntervals(e.x+r,e.x+r+e.w-1,t.x+i,t.x+i+t.w-1,c)&&!!u.Utilities.intersectIntervals(e.y+n,e.y+n+e.h-1,t.y+o,t.y+o+t.h-1,s)&&(a&&(a.x=c.start,a.w=c.end-c.start+1,a.y=s.start,a.h=s.end-s.start+1),!0)};var l={},h={};u.Utilities.makeUrlPretty=function(e){u.Utilities.checkString("uglyStr",e);return e=(e=(e=(e=(e=e.toLowerCase()).replace(/[\s/]+/g,"-")).replace(/[^a-z0-9\-]+/g,"")).replace(/-+/g,"-")).replace(/^-+|-+$/g,"")},u.Utilities.deepMerge=function(){for(var o=function(e){return e&&"object"===_typeof(e)},e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(n,i){return Object.keys(i).forEach(function(e){var t=n[e],r=i[e];Array.isArray(t)&&Array.isArray(r)?n[e]=t.concat.apply(t,_toConsumableArray(r)):o(t)&&o(r)?n[e]=u.Utilities.deepMerge(t,r):n[e]=r}),n},{})},u.Utilities.deepMergeByIndex=function(){for(var o=function(e){return e&&"object"===_typeof(e)},e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(n,i){return Object.keys(i).forEach(function(e){var t=n[e],r=i[e];Array.isArray(t)&&Array.isArray(r)?n[e]=((e,t)=>{for(var r=0;r<t.length;r++)e[r]=t[r];return e})(t,r):o(t)&&o(r)?n[e]=u.Utilities.deepMergeByIndex(t,r):n[e]=r}),n},{})},u.Utilities.padWithZeros=function(e,t){return u.Utilities.checkNumber("number",e),u.Utilities.checkInt("length",t),e<0&&u.Utilities.fatal("padWithZeros does not support negative numbers"),e.toString().padStart(t,"0")},u.Utilities.event=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document,e=(u.Utilities.checkString("eventName",e),u.Utilities.checkObject("detail",t),u.Utilities.checkObject("target",r),e="beep8.".concat(e),new CustomEvent(e,{detail:t}));r.dispatchEvent(e)},u.Utilities.repeatArray=function(e,t){return u.Utilities.checkArray("array",e),u.Utilities.checkInt("times",t,0),Array(t).fill().flatMap(function(){return e})},u.Utilities.downloadFile=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=(u.Utilities.checkString("filename",e),u.Utilities.checkString("src",t),document.createElement("a"));r.setAttribute("href",t),r.setAttribute("download",e),document.body.appendChild(r),r.click(),document.body.removeChild(r)},u.Utilities.encodeData=function(e){e=CBOR.encode(e);return btoa(String.fromCharCode.apply(null,new Uint8Array(e)))},u.Utilities.decodeData=function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);e=r.buffer;return CBOR.decode(e)}})(beep8||_readOnlyError("beep8")),(n=>{n.Joystick={};var i=null;n.Joystick.setup=function(){n.Utilities.log("Setting up virtual joystick...");var e=document.createElement("style"),e=(e.setAttribute("type","text/css"),e.innerText="\n:root {\n\t--b8-vjoy-button-color: #333;\n\t--b8-vjoy-button-size: 14vw;\n\t--b8-vjoy-button-dpad-size: calc(var(--b8-vjoy-button-size) * 2);\n\t--b8-console-radius: 2rem;\n\t--b8-border-radius: calc(var(--b8-vjoy-button-dpad-size) / 5);\n}\n\n.vjoy-container,\n.vjoy-container * {\n\tbox-sizing: border-box;\n\tuser-select: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n\ttouch-action: none;\n}\n\n.vjoy-container {\n\tposition: relative;\n\twidth: 100%;\n\tpadding: 8vw 4vw 8vw 6vw;\n\tbackground: deeppink;\n\tborder-radius: 0 0 var(--b8-console-radius) var(--b8-console-radius);\n}\n\n.vjoy-options {\n\tborder-radius: 5rem;\n\tposition: absolute;\n\tdisplay: flex;\n\tgap: 2vw;\n\talign-items: center;\n\tpadding: 2vw;\n\tborder-radius: 2rem;\n\tbackground: inherit;\n\ttop: -4vw;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n}\n\n.vjoy-controls {\n\tdisplay: flex;\n\tgap: 5vw;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.vjoy-dpad {\n\taspect-ratio: 1;\n\tmax-width: 10rem;\n\twidth: var(--b8-vjoy-button-dpad-size);\n\tdisplay: grid;\n\tgrid-template-columns: 1fr 1fr;\n\tgrid-template-rows: 1fr 1fr;\n\tflex-wrap: wrap;\n\ttransform: rotate(45deg);\n\tborder-radius: var(--b8-border-radius);\n\tbackground:black;\n\tgap: 1px;\n\tborder: 2px solid black;\n}\n\n.vjoy-dpad button {\n\twidth: 100%;\n\theight: 100%;\n\tposition: relative;\n}\n.vjoy-dpad button span {\n\ttransform: rotate(-45deg);\n}\n.vjoy-dpad button:after {\n\tposition: absolute;\n\tcontent: '';\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: rgba(0,0,0,0);\n\ttransform: rotate(-45deg);\n}\n\n#vjoy-button-up {\n\tborder-radius: var(--b8-border-radius) 0 0 0;\n}\n#vjoy-button-down {\n\tborder-radius: 0 0 var(--b8-border-radius) 0;\n}\n#vjoy-button-left {\n\tborder-radius: 0 0 0 var(--b8-border-radius);\n}\n#vjoy-button-right {\n\tborder-radius: 0 var(--b8-border-radius) 0 0;\n}\n\n#vjoy-button-up:after {\n\ttransform: rotate(-45deg) translateY(-30%) scale(1.1);\n}\n#vjoy-button-down:after {\n\ttransform: rotate(-45deg) translateY(30%) scale(1.1);\n}\n#vjoy-button-left:after {\n\ttransform: rotate(-45deg) translateX(-30%) scale(1.1);\n}\n#vjoy-button-right:after {\n\ttransform: rotate(-45deg) translateX(30%) scale(1.1);\n}\n\n.vjoy-buttons {\n\tdisplay: flex;\n\tgap: 2vw;\n\ttransform: rotate(-45deg);\n\tborder: 0.8vw solid rgba(0,0,0,0.2);\n\tborder-radius: calc( var(--b8-border-radius) + 1vw );\n\tpadding: 1vw;\n}\n\n.vjoy-buttons button {\n\twidth: var(--b8-vjoy-button-size);\n\tmax-width: 5rem;\n\tmax-height: 5rem;\n\theight: var(--b8-vjoy-button-size);\n\tborder-radius: var(--b8-border-radius);\n\ttouch-action: none;\n\tborder: 2px solid black;\n\tposition: relative;\n}\n\n.vjoy-buttons button:after {\n\tposition: absolute;\n\tcontent: '';\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: rgba(0,0,0,0);\n\ttransform: scale(1.2);\n}\n\n.vjoy-buttons button span {\n\ttransform: rotate(45deg);\n}\n\n.vjoy-button {\n\tbackground: var(--b8-vjoy-button-color) !important;\n\tborder: none;\n\tfont-family: arial, sans-serif;\n\tfont-size: 12px;\n\tfont-weight: 600;\n\tcolor: #aaa !important;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n\ttext-shadow: 0 -2px 0 black;\n\tpadding: 0;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tletter-spacing: 0.1em;\n\ttext-transform: uppercase;\n}\n\n.vjoy-button:hover,\n.vjoy-button:focus,\n.vjoy-button:active {\n\tbackground: black;\n\toutline: none;\n}\n\n#vjoy-button-screenshot,\n#vjoy-button-ter {\n\twidth: calc(var(--b8-vjoy-button-size) * 1.4);\n\tpadding: 1vw;\n\tborder-radius: 1rem;\n}\n",document.body.appendChild(e),document.createElement("div"));e.className="vjoy-container",e.innerHTML="\n<div class=\"vjoy-options\">\n\t<button id='vjoy-button-ter' class='vjoy-button'>Start</button>\n\t<button id='vjoy-button-screenshot' class='vjoy-button'>Snap</button>\n</div>\n<div class=\"vjoy-controls\">\n\t<div class=\"vjoy-dpad\">\n\t<button id='vjoy-button-up' class='vjoy-button'><span>U</span></button>\n\t<button id='vjoy-button-right' class='vjoy-button'><span>R</span></button>\n\t<button id='vjoy-button-left' class='vjoy-button'><span>L</span></button>\n\t<button id='vjoy-button-down' class='vjoy-button'><span>D</span></button>\n\t</div>\n\t<div class=\"vjoy-buttons\">\n\t<button id='vjoy-button-pri' class='vjoy-button'><span>A</span></button>\n\t<button id='vjoy-button-sec' class='vjoy-button'><span>B</span></button>\n\t</div>\n</div>",n.Core.getBeepContainerEl().appendChild(e),setTimeout(n.Joystick.continueSetup,10)},n.Joystick.continueSetup=function(){n.Joystick.setUpButton("vjoy-button-up","ArrowUp"),n.Joystick.setUpButton("vjoy-button-down","ArrowDown"),n.Joystick.setUpButton("vjoy-button-left","ArrowLeft"),n.Joystick.setUpButton("vjoy-button-right","ArrowRight"),n.Joystick.setUpButton("vjoy-button-pri","ButtonA"),n.Joystick.setUpButton("vjoy-button-sec","ButtonB"),n.Joystick.setUpButton("vjoy-button-ter","Enter"),n.Joystick.setUpButton("vjoy-button-screenshot","0"),document.body.addEventListener("touchstart",function(e){return e.preventDefault()})},n.Joystick.setUpButton=function(e,t){var r=n.Utilities.assert(document.getElementById(e),"Could not find button ID "+e);null===t?r.style.display="none":(["pointerdown","pointerstart"].forEach(function(e){r.addEventListener(e,function(e){e.preventDefault(),n.Joystick.handleButtonEvent(t,!0,e)},{passive:!1})}),["pointerout","pointerup","pointerleave"].forEach(function(e){r.addEventListener(e,function(e){return n.Joystick.handleButtonEvent(t,!1,e)})}),r.addEventListener("pointermove",function(e){e.preventDefault()},{passive:!1}),r.addEventListener("contextmenu",function(e){return e.preventDefault()}))},n.Joystick.handleButtonEvent=function(e,t,r){r.key=e,i=i||{},t?(n.Input.onKeyDown(r),i[e]||(i[e]={},i[e].initialTimeout=setTimeout(function(){i[e].interval=setInterval(function(){n.Input.onKeyDown(r)},150)},150))):(i[e]&&(i[e].initialTimeout&&clearTimeout(i[e].initialTimeout),i[e].interval&&clearInterval(i[e].interval),delete i[e]),n.Input.onKeyUp(r)),r.preventDefault()}})(beep8||_readOnlyError("beep8")),((e,k)=>{var B=Math.pow(2,-24),i=Math.pow(2,32),p=Math.pow(2,53),t={encode:function(e){var a,c=new ArrayBuffer(256),s=new DataView(c),u=0;function l(e){for(var t=c.byteLength,r=u+e;t<r;)t*=2;if(t!==c.byteLength)for(var n=s,i=(c=new ArrayBuffer(t),s=new DataView(c),u+3>>2),o=0;o<i;++o)s.setUint32(4*o,n.getUint32(4*o));return a=e,s}function h(){u+=a}function d(e){h(l(1).setUint8(u,e))}function g(e){for(var t=l(e.length),r=0;r<e.length;++r)t.setUint8(u+r,e[r]);h()}function f(e,t){var r,n;t<24?d(e<<5|t):t<256?(d(e<<5|24),d(t)):t<65536?(d(e<<5|25),n=t,h(l(2).setUint16(u,n))):t<4294967296?(d(e<<5|26),n=t,h(l(4).setUint32(u,n))):(d(e<<5|27),e=((e=t)-(t=t%i))/i,(r=l(8)).setUint32(u,e),r.setUint32(u+4,t),h())}if(!function e(t){var r;if(!1===t)return d(244);if(!0===t)return d(245);if(null===t)return d(246);if(t===k)return d(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=p)return f(0,t);if(-p<=t&&t<0)return f(1,-(t+1))}return d(251),r=t,h(l(8).setFloat64(u,r));case"string":for(var n=[],i=0;i<t.length;++i){var o=t.charCodeAt(i);o<128?n.push(o):(o<2048?n.push(192|o>>6):(o<55296?n.push(224|o>>12):(o=(1023&o)<<10,o|=1023&t.charCodeAt(++i),n.push(240|(o+=65536)>>18),n.push(128|o>>12&63)),n.push(128|o>>6&63)),n.push(128|63&o))}return f(3,n.length),g(n);default:if(Array.isArray(t))for(f(4,a=t.length),i=0;i<a;++i)e(t[i]);else if(t instanceof Uint8Array)f(2,t.length),g(t);else{var a,c=Object.keys(t);for(f(5,a=c.length),i=0;i<a;++i){var s=c[i];e(s),e(t[s])}}}}(e),"slice"in c)return c.slice(0,u);for(var e=new ArrayBuffer(u),t=new DataView(e),r=0;r<u;++r)t.setUint8(r,s.getUint8(r));return e},decode:function(t,C,A){var m=new DataView(t),w=0;function v(e,t){return w+=t,e}function y(e){return v(new Uint8Array(t,w,e),e)}function b(){return v(m.getUint8(w),1)}function I(){return v(m.getUint16(w),2)}function r(){return v(m.getUint32(w),4)}function E(){return 255===m.getUint8(w)&&(w+=1,1)}function S(e){if(e<24)return e;if(24===e)return b();if(25===e)return I();if(26===e)return r();if(27===e)return r()*i+r();if(31===e)return-1;throw"Invalid length encoding"}function x(e){var t=b();if(255===t)return-1;var r=S(31&t);if(r<0||t>>5!==e)throw"Invalid indefinite length element";return r}function R(e,t){for(var r=0;r<t;++r){var n=b();128&n&&(n<224?(n=(31&n)<<6|63&b(),--t):n<240?(n=(15&n)<<12|(63&b())<<6|63&b(),t-=2):(n=(15&n)<<18|(63&b())<<12|(63&b())<<6|63&b(),t-=3)),n<65536?e.push(n):(n-=65536,e.push(55296|n>>10),e.push(56320|1023&n))}}"function"!=typeof C&&(C=function(e){return e}),"function"!=typeof A&&(A=function(){return k});var e=function e(){var t,r,n=b(),i=n>>5,n=31&n;if(7==i)switch(n){case 25:var o=new ArrayBuffer(4),o=new DataView(o),a=I(),c=31744&a,s=1023&a;if(31744===c)c=261120;else if(0!==c)c+=114688;else if(0!=s)return s*B;return o.setUint32(0,(32768&a)<<16|c<<13|s<<13),o.getFloat32(0);case 26:return v(m.getFloat32(w),4);case 27:return v(m.getFloat64(w),8)}if((t=S(n))<0&&(i<2||6<i))throw"Invalid length";switch(i){case 0:return t;case 1:return-1-t;case 2:if(t<0){for(var u=[],l=0;0<=(t=x(i));)l+=t,u.push(y(t));for(var h=new Uint8Array(l),d=0,g=0;g<u.length;++g)h.set(u[g],d),d+=u[g].length;return h}return y(t);case 3:var f=[];if(t<0)for(;0<=(t=x(i));)R(f,t);else R(f,t);return String.fromCharCode.apply(null,f);case 4:if(t<0)for(r=[];!E();)r.push(e());else for(r=new Array(t),g=0;g<t;++g)r[g]=e();return r;case 5:var p={};for(g=0;g<t||t<0&&!E();++g)p[e()]=e();return p;case 6:return C(e(),t);case 7:switch(t){case 20:return!1;case 21:return!0;case 22:return null;case 23:return k;default:return A(t)}}}();if(w!==t.byteLength)throw"Remaining bytes";return e}};"function"==typeof define&&define.amd?define("cbor/cbor",t):e.CBOR||(e.CBOR=t)})(this),(()=>{let d=new AudioContext,o=d.createGain();o.gain.value=1,o.connect(d.destination);const g={};let t=null,f=[],s=[],p=0,C=125,e=.5,r=50,l=!1,n=(e,t)=>Math.sin(6.28*e+t),A=[e=>.1*n(e,Math.pow(n(e,0),2)+.75*n(e,.25)+.1*n(e,.5)),e=>Math.sin(6.28*e)*Math.sin(3.14*e)*.1,e=>.1*Math.sin(2*Math.PI*e),e=>.1*(2*(e-Math.floor(e))-1),e=>.1*(0<=Math.sin(2*Math.PI*e)?1:-1),e=>{e-=Math.floor(e);return.1*(2*Math.abs(2*e-1)-1)},e=>(2*Math.random()-1)*Math.exp(-e/10)*.1,e=>(Math.sin(2*e)+.3*(Math.random()-.5))*Math.exp(-e/15)*.1*2];function i(e){if((e=Array.isArray(e)?e[0]:e)&&""!==e.trim()){200<g.length&&(console.warn("Beep8.Music: Note buffers exceeded limit, clearing old buffers."),g={}),C=125;let u=.5;f=[];e=e.split("\n").map(e=>e.trim());let l=C/1e3,h=/^([0-9])\|(.*)\|$/;e.forEach(e=>{if(e)if(e.startsWith("[")&&e.endsWith("]")||/^\d+(\.\d+)?$/.test(e))t=e.replace(/[\[\]]/g,"").split("."),C=parseFloat(t[0])||C,u=(parseFloat(t[1])||50)/100,l=C/1e3;else if(h.test(e)){var t=e.match(h),r=parseInt(t[1],10),n=A[r]||A[0],i=t[2].trim(),o=[];for(let t=0;t<i.length;t++){var a=i[t];let e=1;for(;t+e<i.length&&"-"===i[t+e];)e++;var c,s=t*l;" "===a?(o.push({startTime:s,noteBuffer:null}),t+=e-1):(a=a.charCodeAt(0),c=(a-=90<a?71:65,e*u*(C/125)),a=m(a,c,44100,n),o.push({startTime:s,noteBuffer:a}),t+=e-1)}f.push(o)}else console.error("Track lines must be in the format 'instrument|track data|': "+e)}),s=f.map(()=>0),p=d.currentTime+.1,i.stop(),t=setInterval(a,r)}else i.stop()}function a(){let o=d.currentTime,a=C/1e3,c=Math.max(e,a);f.forEach((e,t)=>{var r,n=s[t],i=e.length;0!==i&&(r=n%i,n=Math.floor(n/i),(n=p+r*a+n*i*a)<o+c)&&((i=e[r]).noteBuffer&&h(i.noteBuffer,d,n),s[t]++)}),i.loop||f.every((e,t)=>s[t]>=e.length)&&i.stop()}i.stop=function(){null!==t&&(clearInterval(t),t=null),c.forEach(e=>e.stop()),c=[]},i.isPlaying=function(){return null!==t},i.setTempo=function(e){e<50&&(e=50);var t=C/1e3,r=e/1e3,t=(d.currentTime-p)/t;p=d.currentTime-t*r,C=e},i.setVolume=function(e){o.gain.value=Math.min(1,Math.max(0,e))},i.clearCache=function(){g={}},i.loop=!0;let m=(e,t,r,n)=>{var i=e+"-"+t+"-"+n.name;let o=g[i];if(0<=e&&!o){var a=65.406*Math.pow(1.06,e)/r,c=Math.floor(r*t),s=r*(t-.002),u=(o=g[i]=d.createBuffer(1,c,r)).getChannelData(0);for(let t=0;t<c;t++){let e;e=t<88?t/88.2:Math.pow(1-(t-88)/s,Math.pow(Math.log(1e4*a)/2,2)),u[t]=e*n(t*a)}l||(h(o,d,d.currentTime,!0),l=!0)}return o},c=[],h=(e,t,r,n=!1)=>{let i=t.createBufferSource();i.buffer=e,i.connect(o),i.start(r),c.push(i),n&&i.stop(),i.onended=()=>{var e=c.indexOf(i);-1!==e&&c.splice(e,1)}};window.p1=i})();let zzfx=(...e)=>zzfxP(zzfxG(...e)),zzfxV=.3,zzfxR=44100,zzfxX=new AudioContext,zzfxP=(...e)=>{let r=zzfxX.createBuffer(e.length,e[0].length,zzfxR),t=zzfxX.createBufferSource();return e.map((e,t)=>r.getChannelData(t).set(e)),t.buffer=r,t.connect(zzfxX.destination),t.start(),t},zzfxG=(e=1,t=.05,r=220,n=0,i=0,o=.1,a=0,O=1,c=0,s=0,u=0,l=0,h=0,F=0,d=0,G=0,g=0,f=1,p=0,C=0,A=0)=>{let m=2*Math.PI,w=e=>e<0?-1:1,Q=c*=500*m/zzfxR/zzfxR,v=r*=(1+2*t*Math.random()-t)*m/zzfxR,y=[],b=0,L=0,I=0,E=1,P=0,H=0,S=0,x,R,k=m*Math.abs(A)*2/zzfxR,B=Math.cos(k),N=Math.sin(k)/2/2,U=1+N,j=-2*B/U,W=(1-N)/U,M=(1+w(A)*B)/2/U,Y=-(w(A)+B)/U,z=M,T=0,D=0,_=0,V=0;for(n=n*zzfxR+9,p*=zzfxR,i*=zzfxR,o*=zzfxR,g*=zzfxR,s*=500*m/zzfxR**3,d*=m/zzfxR,u*=m/zzfxR,l*=zzfxR,h=h*zzfxR|0,e*=zzfxV,R=n+p+i+o+g|0;I<R;y[I++]=S*e)++H%(100*G|0)||(S=a?1<a?2<a?3<a?Math.sin(b**3):Math.max(Math.min(Math.tan(b),1),-1):1-(2*b/m%2+2)%2:1-4*Math.abs(Math.round(b/m)-b/m):Math.sin(b),S=(h?1-C+C*Math.sin(m*I/h):1)*w(S)*Math.abs(S)**O*(I<n?I/n:I<n+p?1-(I-n)/p*(1-f):I<n+p+i?f:I<R-g?(R-I-g)/o*f:0),S=g?S/2+(g>I?0:(I<R-g?1:(R-I)/g)*y[I-g|0]/2/e):S,A&&(S=V=z*T+Y*(T=D)+M*(D=S)-W*_-j*(_=V))),x=(r+=c+=s)*Math.cos(d*L++),b+=x+x*F*Math.sin(I**5),E&&++E>l&&(r+=u,v+=u,E=0),!h||++P%h||(r=v,c=Q,E=E||1);return y};