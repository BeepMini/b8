"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _readOnlyError(r){throw new TypeError('"'+r+'" is read-only')}var beep8={};(function(beep8){beep8.CONFIG={DEBUG:true,CANVAS_SETTINGS:{CANVAS_ID:"beep8-canvas",CANVAS_CLASSES:[],AUTO_POSITION:true,AUTO_SIZE:true,CONTAINER:null},BG_COLOR:"#000",CHR_FILE:"../assets/chr.png",CHR_WIDTH:8,CHR_HEIGHT:8,SCREEN_ROWS:24,SCREEN_COLS:32,SCREEN_SCALE:"auto",MAX_SCREEN_FRACTION:.95,SCAN_LINES_OPACITY:.1,COLORS:["#000","#00A","#A00","#A0A","#0A0","#0AA","#AA0","#DDD","#666","#00F","#F00","#F0F","#0F0","#0FF","#FF0","#FFF"],TOUCH_VJOY:true,CURSOR:{WIDTH_F:.8,HEIGHT_F:.8,BLINK_INTERVAL:400,OFFSET_V:.1,OFFSET_H:0},PRINT_ESCAPE_START:"{{",PRINT_ESCAPE_END:"}}"}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.init=function(callback){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};beep8.Utilities.checkFunction("callback",callback);beep8.Utilities.checkObject("options",options);if(options!==null){beep8.CONFIG=Object.assign(beep8.CONFIG,options)}return beep8.Core.init(callback)};beep8.frame=function(handler){var fps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:30;beep8.Core.preflight("beep8.frame");if(handler!==null){beep8.Utilities.checkFunction("handler",handler)}beep8.Utilities.checkNumber("fps",fps);return beep8.Core.setFrameHandler(handler,fps)};beep8.render=function(){beep8.Core.preflight("beep8.render");return beep8.Core.render()};beep8.color=function(fg,bg){beep8.Core.preflight("beep8.color");beep8.Utilities.checkNumber("fg",fg);if(bg!==undefined){beep8.Utilities.checkNumber("bg",bg)}beep8.Core.setColor(fg,bg)};beep8.getFgColor=function(){beep8.Core.preflight("getFgColor");return beep8.Core.drawState.fgColor};beep8.getBgColor=function(){beep8.Core.preflight("beep8.getBgColor");return beep8.Core.drawState.bgColor};beep8.cls=function(){beep8.Core.preflight("beep8.Core.cls");beep8.Core.cls()};beep8.locate=function(col,row){beep8.Core.preflight("beep8.locate");beep8.Utilities.checkNumber("col",col);if(row!==undefined){beep8.Utilities.checkNumber("row",row)}beep8.Core.setCursorLocation(col,row)};beep8.col=function(){beep8.Core.preflight("col");return beep8.Core.drawState.cursorCol};beep8.row=function(){beep8.Core.preflight("row");return beep8.Core.drawState.cursorRow};beep8.cursor=function(visible){beep8.Core.preflight("cursor");beep8.Utilities.checkBoolean("visible",visible);beep8.Core.cursorRenderer.setCursorVisible(visible)};beep8.print=function(text){beep8.Core.preflight("beep8.text");beep8.Utilities.checkString("text",text);beep8.Core.textRenderer.print(text)};beep8.printCentered=function(text,width){beep8.Core.preflight("beep8.printCentered");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("width",width);beep8.Core.textRenderer.printCentered(text,width)};beep8.drawText=function(x,y,text){var fontId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;beep8.Core.preflight("beep8.drawText");beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkString("text",text);if(fontId){beep8.Utilities.checkString("fontId",fontId)}beep8.Core.textRenderer.drawText(x,y,text,fontId)};beep8.measure=function(text){beep8.Core.preflight("measure");beep8.Utilities.checkString("text",text);return beep8.Core.textRenderer.measure(text)};beep8.printChar=function(charCode){var numTimes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;beep8.Core.preflight("beep8.printChar");charCode=beep8.convChar(charCode);beep8.Utilities.checkNumber("charCode",charCode);beep8.Utilities.checkNumber("numTimes",numTimes);beep8.Core.textRenderer.printChar(charCode,numTimes)};beep8.printRect=function(widthCols,heightRows){var charCode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:32;beep8.Core.preflight("beep8.printRect");charCode=beep8.convChar(charCode);beep8.Utilities.checkNumber("widthCols",widthCols);beep8.Utilities.checkNumber("heightRows",heightRows);beep8.Utilities.checkNumber("charCode",charCode);beep8.Core.textRenderer.printRect(widthCols,heightRows,charCode)};beep8.printBox=function(widthCols,heightRows){var fill=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var borderChar=arguments.length>3&&arguments[3]!==undefined?arguments[3]:128;beep8.Core.preflight("beep8.printBox");borderChar=beep8.convChar(borderChar);beep8.Utilities.checkNumber("widthCols",widthCols);beep8.Utilities.checkNumber("heightRows",heightRows);beep8.Utilities.checkBoolean("fill",fill);beep8.Utilities.checkNumber("borderChar",borderChar);beep8.Core.textRenderer.printBox(widthCols,heightRows,fill,borderChar)};beep8.drawImage=function(x,y,image){beep8.Utilities.checkInstanceOf("image",image,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Core.drawImage(image,x,y)};beep8.drawImageRect=function(x,y,image,srcX,srcY,width,height){beep8.Utilities.checkInstanceOf("image",image,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("srcX",srcX);beep8.Utilities.checkNumber("srcY",srcY);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.drawImage(image,x,y,srcX,srcY,width,height)};beep8.drawRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.drawRect(x,y,width,height)};beep8.fillRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.fillRect(x,y,width,height)};beep8.playSound=function(sfx){var volume=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var loop=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;beep8.Utilities.checkInstanceOf("sfx",sfx,HTMLAudioElement);sfx.currentTime=0;sfx.volume=volume;sfx.loop=loop;sfx.play()};beep8.spr=function(ch,x,y){ch=beep8.convChar(ch);beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Core.textRenderer.spr(ch,x,y)};beep8.key=function(keyName){beep8.Core.preflight("beep8.key");beep8.Utilities.checkString("keyName",keyName);return beep8.Core.inputSys.keyHeld(keyName)};beep8.playSong=function(song){beep8.Utilities.checkString("song",song);beep8.Sound.playSong(song)};beep8.keyp=function(keyName){beep8.Core.preflight("beep8.keyp");beep8.Utilities.checkString("keyName",keyName);return beep8.Core.inputSys.keyJustPressed(keyName)};beep8.redefineColors=function(colors){beep8.Core.preflight("beep8.redefineColors");beep8.Utilities.checkArray("colors",colors);beep8.Core.defineColors(colors)};beep8.setFont=function(fontId){beep8.Core.preflight("beep8.setFont");fontId=fontId||"default";beep8.Utilities.checkString("fontId",fontId);beep8.Core.textRenderer.setFont(fontId)};beep8.convChar=function(charCode){if(typeof charCode==="string"&&charCode.length>0){return charCode.charCodeAt(0)}return charCode};beep8.stopSound=function(sfx){beep8.Utilities.checkInstanceOf("sfx",sfx,HTMLAudioElement);sfx.currentTime=0;sfx.pause()};beep8.getContext=function(){return beep8.Core.getContext()};beep8.saveScreen=function(){return beep8.Core.saveScreen()};beep8.restoreScreen=function(screenData){return beep8.Core.restoreScreen(screenData)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var startPatterns=["X-X-","XX--"];var followPatterns=["X--X","X-X-","XX--"];var bassPatterns=["X---","X---X---","X-------","X-X-X-X-","X-------X-------","X-------        ","        X-------"];var scales={minor:[2,1,2,2,1,2,2],harmonicMinor:[2,1,2,2,1,3,1],melodicMinorAscending:[2,1,2,2,2,2,1],melodicMinorDescending:[2,1,2,2,1,2,2],pentatonicMajor:[2,2,3,2,3],pentatonicMinor:[3,2,2,3,2],blues:[3,2,1,1,3,2],chromatic:[1,1,1,1,1,1,1,1,1,1,1,1],wholeTone:[2,2,2,2,2,2],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2],phrygianDominant:[1,3,1,2,1,2,2],hungarianMinor:[2,1,3,1,1,3,1],gypsy:[1,3,1,2,1,3,1],japanese:[1,4,2,1,4],arabian:[2,2,1,1,2,2,2],eastern:[1,2,2,1,1,3,1]};var scaleRangeDistance=[3,2,2,1,1,1,0,0,0,0,-1,-1,-1,-2,-2,-3];var speedRange=[75,100,150,200,250,300];var durationRange=[40,50,60,70,80,90];var scaleRange=12;var noteMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");beep8._Music={};beep8._Music.play=function(song){console.log("play song",song);p1(song)};beep8._Music.create=function(){var melody=[];var scaleKeys=Object.keys(scales);var scaleIndex=scaleKeys[Math.floor(Math.random()*scaleKeys.length)];var pattern=generatePattern(8,startPatterns,followPatterns);melody.push(generateMelody(generateScale(2,scaleIndex),pattern));melody.push(generateMelody(generateScale(1,scaleIndex),pattern));var bassRepeat=Math.floor(Math.random()*3)+1;melody.push(generateMelody(generateScale(0,scaleIndex),generatePattern(bassRepeat,[],bassPatterns)));return"".concat(beep8.Utilities.randomPick(speedRange),".").concat(beep8.Utilities.randomPick(durationRange),"\n").concat(melody.join("\n"))};function generateScale(noteMapId,scaleIndex){var startNote=noteMapId*scaleRange;var scale=[];var currentIndex=startNote;var _iterator=_createForOfIteratorHelper(scales[scaleIndex]),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var interval=_step.value;scale.push(noteMap[currentIndex]);console.log(noteMap[currentIndex],currentIndex);currentIndex+=interval}}catch(err){_iterator.e(err)}finally{_iterator.f()}return scale}function generatePattern(){var totalPatterns=arguments.length>0&&arguments[0]!==undefined?arguments[0]:4;var startPatterns=arguments.length>1&&arguments[1]!==undefined?arguments[1]:startPatterns;var followPatterns=arguments.length>2&&arguments[2]!==undefined?arguments[2]:followPatterns;if(totalPatterns<1){return""}var pattern=[];if(startPatterns.length>0){pattern.push(startPatterns[Math.floor(Math.random()*startPatterns.length)])}if(followPatterns.length>0){for(var i=1;i<totalPatterns;i++){var randomPattern=followPatterns[Math.floor(Math.random()*followPatterns.length)];var patternRepeat=Math.floor(Math.random()*3)+1;for(var j=0;j<patternRepeat;j++){pattern.push(randomPattern)}}}console.log(pattern);return pattern.join("|")}function generateMelody(scale,rhythmPattern){var melody="";var scaleIndex=Math.floor(Math.random()*scale.length);for(var i=0;i<rhythmPattern.length;i++){if(rhythmPattern[i]==="-"){melody+="-"}if(rhythmPattern[i]===" "){melody+=" "}if(rhythmPattern[i]==="|"){melody+="|"}if(rhythmPattern[i]==="X"){melody+=scale[scaleIndex];scaleIndex+=scaleRangeDistance[Math.floor(Math.random()*scaleRangeDistance.length)];if(scaleIndex<0){scaleIndex=0}if(scaleIndex>=scale.length){scaleIndex=scale.length-1}}}return melody}})(beep8||({},_readOnlyError("beep8")));!function(){var numberOfTracks=4;var contextsPerTrack=3;var totalContexts=Math.ceil(numberOfTracks*contextsPerTrack*1.2);var buffers={};var contexts=_toConsumableArray(Array(totalContexts).keys()).map(function(_){return new AudioContext});var tracks;var trackLen;var interval;var unlocked;var noteI;var b=function b(note,add){return Math.sin(note*6.28+add)};var pianoify=function pianoify(note){return b(note,Math.pow(b(note,0),2)+b(note,.25)*.75+b(note,.5)*.1)};var drummify=function drummify(note){};var makeNote=function makeNote(note,seconds,sampleRate){var key=note+""+seconds;var buffer=buffers[key];if(note>=0&&!buffer){note=65.406*Math.pow(1.06,note)/sampleRate;var i=sampleRate*seconds|0;var sampleRest=sampleRate*(seconds-.002);var bufferArray;buffer=buffers[key]=contexts[0].createBuffer(1,i,sampleRate);bufferArray=buffer.getChannelData(0);for(;i--;){bufferArray[i]=(i<88?i/88.2:Math.pow(1-(i-88.2)/sampleRest,Math.pow(Math.log(1e4*note)/2,2)))*pianoify(i*note)}if(!unlocked){contexts.map(function(context){return playBuffer(buffer,context,unlocked=1)})}}return buffer};var playBuffer=function playBuffer(buffer,context,stop){var source=context.createBufferSource();source.buffer=buffer;source.connect(context.destination);source.start();stop&&source.stop()};p1=function p1(params){var tempo=125;var noteLen=.5;trackLen=0;params=typeof params==="array"?params[0]:params;tracks=params.replace(/[\!\|]/g,"").split("\n").map(function(track){track=track.trim();if(track[0]==="["&&track[track.length-1]==="]"||!isNaN(parseFloat(track))){track=track.split(".");tempo=track[0];noteLen=track[1]/100||noteLen;return undefined}if(track.length===0){return undefined}return track.split("").map(function(letter,i){var duration=1;var note=letter.charCodeAt(0);note-=note>90?71:65;while(track[i+duration]=="-"){duration++}if(trackLen<i){trackLen=i+1}return makeNote(note,duration*noteLen*tempo/125,44100)})}).filter(function(element){return element!==undefined});noteI=0;clearInterval(interval);interval=setInterval(function(j){tracks.map(function(track,trackI){if(track[j=noteI%track.length]){var contextId=trackI*contextsPerTrack+noteI%contextsPerTrack;playBuffer(track[j],contexts[contextId])}});noteI++;noteI%=trackLen},tempo)}}();(function(beep8){beep8.Async={};beep8.Async.key=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:beep8.Core.preflight("beep8.Async.key");_context.next=3;return beep8.Core.inputSys.readKeyAsync();case 3:return _context.abrupt("return",_context.sent);case 4:case"end":return _context.stop()}},_callee)}));beep8.Async.readLine=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){var initString,maxLen,maxWidth,_args2=arguments;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:initString=_args2.length>0&&_args2[0]!==undefined?_args2[0]:"";maxLen=_args2.length>1&&_args2[1]!==undefined?_args2[1]:-1;maxWidth=_args2.length>2&&_args2[2]!==undefined?_args2[2]:-1;beep8.Core.preflight("beep8.Async.readLine");beep8.Utilities.checkString("initString",initString);beep8.Utilities.checkNumber("maxLen",maxLen);_context2.next=8;return beep8.Core.inputSys.readLine(initString,maxLen,maxWidth);case 8:return _context2.abrupt("return",_context2.sent);case 9:case"end":return _context2.stop()}},_callee2)}));beep8.Async.menu=function(){var _ref3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(choices){var options,_args3=arguments;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:options=_args3.length>1&&_args3[1]!==undefined?_args3[1]:{};beep8.Core.preflight("beep8.Async.menu");beep8.Utilities.checkArray("choices",choices);beep8.Utilities.checkObject("options",options);_context3.next=6;return beep8.Menu.display(choices,options);case 6:return _context3.abrupt("return",_context3.sent);case 7:case"end":return _context3.stop()}},_callee3)}));return function(_x){return _ref3.apply(this,arguments)}}();beep8.Async.dialog=function(){var _ref4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(prompt){var choices,_args4=arguments;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:choices=_args4.length>1&&_args4[1]!==undefined?_args4[1]:["OK"];beep8.Core.preflight("beep8.Async.dialog");beep8.Utilities.checkString("prompt",prompt);beep8.Utilities.checkArray("choices",choices);return _context4.abrupt("return",beep8.Async.menu(choices,{prompt:prompt,center:true}));case 5:case"end":return _context4.stop()}},_callee4)}));return function(_x2){return _ref4.apply(this,arguments)}}();beep8.Async.wait=function(){var _ref5=_asyncToGenerator(_regeneratorRuntime().mark(function _callee5(seconds){return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:beep8.Core.preflight("beep8.Async.wait");beep8.Utilities.checkNumber("seconds",seconds);beep8.Core.render();_context5.next=5;return new Promise(function(resolve){return setTimeout(resolve,Math.round(seconds*1e3))});case 5:return _context5.abrupt("return",_context5.sent);case 6:case"end":return _context5.stop()}},_callee5)}));return function(_x3){return _ref5.apply(this,arguments)}}();beep8.Async.typewriter=function(){var _ref6=_asyncToGenerator(_regeneratorRuntime().mark(function _callee6(text){var delay,startCol,startRow,i,endPos,c,_args6=arguments;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:delay=_args6.length>1&&_args6[1]!==undefined?_args6[1]:.05;beep8.Core.preflight("beep8.Async.typewriter");beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("delay",delay);startCol=beep8.col();startRow=beep8.row();i=0;case 7:if(!(i<=text.length)){_context6.next=18;break}if(beep8.CONFIG.PRINT_ESCAPE_START&&text.substring(i,i+beep8.CONFIG.PRINT_ESCAPE_START.length)===beep8.CONFIG.PRINT_ESCAPE_START){endPos=text.indexOf(beep8.CONFIG.PRINT_ESCAPE_END,i+beep8.CONFIG.PRINT_ESCAPE_START.length);if(endPos>=0){i=endPos+beep8.CONFIG.PRINT_ESCAPE_END.length}}c=text.charCodeAt(i);beep8.locate(startCol,startRow);beep8.print(text.substring(0,i));if(!(c!==32)){_context6.next=15;break}_context6.next=15;return beep8.Async.wait(delay);case 15:i++;_context6.next=7;break;case 18:case"end":return _context6.stop()}},_callee6)}));return function(_x4){return _ref6.apply(this,arguments)}}();beep8.Async.loadImage=function(){var _ref7=_asyncToGenerator(_regeneratorRuntime().mark(function _callee7(url){return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:beep8.Core.preflight("beep8.Async.loadImage");return _context7.abrupt("return",new Promise(function(resolve){var img=new Image;img.onload=function(){return resolve(img)};img.src=url}));case 2:case"end":return _context7.stop()}},_callee7)}));return function(_x5){return _ref7.apply(this,arguments)}}();beep8.Async.loadSound=function(){var _ref8=_asyncToGenerator(_regeneratorRuntime().mark(function _callee8(url){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:beep8.Core.preflight("beep8.Async.loadSound");return _context8.abrupt("return",new Promise(function(resolve){var audio=new Audio;audio.oncanplaythrough=function(){return resolve(audio)};audio.src=url;audio.load()}));case 2:case"end":return _context8.stop()}},_callee8)}));return function(_x6){return _ref8.apply(this,arguments)}}();beep8.Async.loadFont=function(){var _ref9=_asyncToGenerator(_regeneratorRuntime().mark(function _callee9(fontImageFile){var fontName;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:beep8.Core.preflight("beep8.Async.loadFont");beep8.Utilities.checkString("fontImageFile",fontImageFile);fontName="FONT@"+fontImageFile;_context9.next=5;return beep8.Core.textRenderer.loadFontAsync(fontName,fontImageFile);case 5:return _context9.abrupt("return",fontName);case 6:case"end":return _context9.stop()}},_callee9)}));return function(_x7){return _ref9.apply(this,arguments)}}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Core={};beep8.Core.textRenderer=null;beep8.Core.inputSys=null;beep8.Core.cursorRenderer=null;beep8.Core.realCanvas=null;beep8.Core.realCtx=null;beep8.Core.canvas=null;beep8.Core.ctx=null;beep8.Core.deltaTime=0;beep8.Core.drawState={fgColor:7,bgColor:0,cursorCol:0,cursorRow:0,cursorVisible:false};var lastFrameTime=null;var crashed=false;var initDone=false;var frameHandler=null;var frameHandlerTargetInterval=null;var animFrameRequested=false;var timeToNextFrame=0;var scanLinesEl=null;var pendingAsync=null;var dirty=false;beep8.Core.init=function(callback){beep8.Utilities.checkFunction("callback",callback);beep8.Core.asyncInit(callback)};beep8.Core.asyncInit=function(){var _ref10=_asyncToGenerator(_regeneratorRuntime().mark(function _callee10(callback){var _iterator2,_step2,className,container,containerSpec;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:beep8.Utilities.log("beep8 System initialized");beep8.CONFIG.SCREEN_WIDTH=beep8.CONFIG.SCREEN_COLS*beep8.CONFIG.CHR_WIDTH;beep8.CONFIG.SCREEN_HEIGHT=beep8.CONFIG.SCREEN_ROWS*beep8.CONFIG.CHR_HEIGHT;beep8.Core.realCanvas=document.createElement("canvas");if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CANVAS_ID){beep8.Core.realCanvas.setAttribute("id",beep8.CONFIG.CANVAS_SETTINGS.CANVAS_ID)}if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES){_iterator2=_createForOfIteratorHelper(beep8.CONFIG.CANVAS_SETTINGS.CANVAS_CLASSES);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){className=_step2.value;beep8.Core.realCanvas.classList.add(className)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}beep8.Core.realCanvas.addEventListener("touchstart",function(e){return e.preventDefault()});container=document.body;if(beep8.CONFIG.CANVAS_SETTINGS&&beep8.CONFIG.CANVAS_SETTINGS.CONTAINER){containerSpec=beep8.CONFIG.CANVAS_SETTINGS.CONTAINER;if(typeof containerSpec==="string"){container=document.getElementById(containerSpec);if(!container){console.error("beep8: Could not find container element with ID: "+containerSpec);container=document.body}}else if(containerSpec instanceof HTMLElement){container=containerSpec}else{console.error("beep8: beep8.CONFIG.CANVAS_SETTINGS.CONTAINER must be either an ID of an HTMLElement.");container=document.body}}container.appendChild(beep8.Core.realCanvas);beep8.Core.canvas=document.createElement("canvas");beep8.Core.canvas.width=beep8.CONFIG.SCREEN_WIDTH;beep8.Core.canvas.height=beep8.CONFIG.SCREEN_HEIGHT;beep8.Core.canvas.style.width=beep8.CONFIG.SCREEN_WIDTH+"px";beep8.Core.canvas.style.height=beep8.CONFIG.SCREEN_HEIGHT+"px";beep8.Core.ctx=beep8.Core.canvas.getContext("2d");beep8.Core.ctx.imageSmoothingEnabled=false;beep8.Core.textRenderer=new beep8.TextRenderer;beep8.Core.inputSys=new beep8.Input;beep8.Core.cursorRenderer=new beep8.CursorRenderer;_context10.next=22;return beep8.Core.textRenderer.initAsync();case 22:beep8.Core.updateLayout(false);window.addEventListener("resize",function(){return beep8.Core.updateLayout(true)});if(beep8.Core.isMobile()){beep8.Joystick.setup()}initDone=true;_context10.next=28;return new Promise(function(resolve){return setTimeout(resolve,1)});case 28:_context10.next=30;return callback();case 30:beep8.Core.render();case 31:case"end":return _context10.stop()}},_callee10)}));return function(_x8){return _ref10.apply(this,arguments)}}();beep8.Core.preflight=function(apiMethod){if(crashed){throw new Error("Can't call API method ".concat(apiMethod,"() because the engine has crashed."))}if(!initDone){beep8.Utilities.fatal("Can't call API method ".concat(apiMethod,"(): API not initialized. ")+"Call initAsync() wait until it finishes before calling API methods.")}if(pendingAsync){beep8.Utilities.fatal("Can't call API method ".concat(apiMethod,"() because there is a pending async ")+"call to ".concat(pendingAsync.name,"() that hasn't finished running yet. Are you missing ")+"an 'await' keyword to wait for the async method? Use 'await ".concat(pendingAsync.name,"()',")+"not just '".concat(pendingAsync.name,"()'"))}};beep8.Core.startAsync=function(asyncMethodName,resolve,reject){if(pendingAsync){throw new Error("Internal bug: startAsync called while pendingAsync is not null. "+"Missing preflight() call?")}pendingAsync={name:asyncMethodName,resolve:resolve,reject:reject};beep8.Core.render()};beep8.Core.hasPendingAsync=function(asyncMethodName){return pendingAsync&&pendingAsync.name===asyncMethodName};beep8.Core.endAsyncImpl=function(asyncMethodName,isError,result){if(!pendingAsync){throw new Error("Internal bug: endAsync(".concat(asyncMethodName,") called with no pendingAsync"))}if(pendingAsync.name!==asyncMethodName){throw new Error("Internal bug: endAsync(".concat(asyncMethodName,") called but pendingAsync.name ")+"is ".concat(pendingAsync.name))}var fun=isError?pendingAsync.reject:pendingAsync.resolve;pendingAsync=null;fun(result)};beep8.Core.resolveAsync=function(asyncMethodName,result){beep8.Core.endAsyncImpl(asyncMethodName,false,result)};beep8.Core.failAsync=function(asyncMethodName,error){beep8.Core.endAsyncImpl(asyncMethodName,true,error)};beep8.Core.setFrameHandler=function(callback){var targetFps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:30;frameHandler=callback;frameHandlerTargetInterval=1/(targetFps||30);timeToNextFrame=0;if(!animFrameRequested){window.requestAnimationFrame(beep8.Core.doFrame)}};beep8.Core.render=function(){if(crashed)return;beep8.Core.realCtx.imageSmoothingEnabled=false;beep8.Core.realCtx.clearRect(0,0,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height);beep8.Core.realCtx.drawImage(beep8.Core.canvas,0,0,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height);dirty=false;beep8.Core.cursorRenderer.drawCursor(beep8.Core.realCtx,beep8.Core.realCanvas.width,beep8.Core.realCanvas.height)};beep8.Core.markDirty=function(){if(dirty)return;dirty=true;setTimeout(beep8.Core.render,1)};beep8.Core.cls=function(){beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(beep8.Core.drawState.bgColor);beep8.Core.ctx.fillRect(0,0,beep8.Core.canvas.width,beep8.Core.canvas.height);this.setCursorLocation(0,0);beep8.Core.markDirty()};beep8.Core.defineColors=function(colors){beep8.Utilities.checkArray("colors",colors);beep8.CONFIG.COLORS=colors.slice();beep8.Core.textRenderer.regenColors()};beep8.Core.setColor=function(fg,bg){beep8.Utilities.checkNumber("fg",fg);beep8.Core.drawState.fgColor=Math.round(fg);if(bg!==undefined){beep8.Utilities.checkNumber("bg",bg);beep8.Core.drawState.bgColor=Math.round(bg)}};beep8.Core.setCursorLocation=function(col,row){beep8.Utilities.checkNumber("col",col);if(row!==undefined){beep8.Utilities.checkNumber("row",row)}beep8.Core.drawState.cursorCol=Math.round(col);if(row!==undefined){beep8.Core.drawState.cursorRow=Math.round(row)}};beep8.Core.getColorHex=function(c){if(typeof c!=="number"){return"#f0f"}if(c<0){return"#000"}c=beep8.Utilities.clamp(Math.round(c),0,beep8.CONFIG.COLORS.length-1);return beep8.CONFIG.COLORS[c]};beep8.Core.getNow=function(){if(window.performance&&window.performance.now){return window.performance.now()}return(new Date).getTime()};beep8.Core.drawImage=function(img,x,y,srcX,srcY,width,height){beep8.Utilities.checkInstanceOf("img",img,HTMLImageElement);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);if(srcX!==undefined)beep8.Utilities.checkNumber("srcX",srcX);if(srcY!==undefined)beep8.Utilities.checkNumber("srcY",srcY);if(width!==undefined)beep8.Utilities.checkNumber("width",width);if(height!==undefined)beep8.Utilities.checkNumber("height",height);if(srcX!==undefined&&srcY!==undefined&&width!==undefined&&height!==undefined){beep8.Core.ctx.drawImage(img,srcX,srcY,width,height,x,y,width,height)}else{beep8.Core.ctx.drawImage(img,x,y)}};beep8.Core.drawRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);var oldStrokeStyle=beep8.Core.ctx.strokeStyle;beep8.Core.ctx.strokeStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);beep8.Core.ctx.strokeRect(Math.round(x)+.5,Math.round(y)+.5,Math.round(width)-1,Math.round(height)-1);beep8.Core.ctx.strokeStyle=oldStrokeStyle};beep8.Core.fillRect=function(x,y,width,height){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);beep8.Core.ctx.fillRect(Math.round(x)+.5,Math.round(y)+.5,Math.round(width)-1,Math.round(height)-1)};beep8.Core.saveScreen=function(){return beep8.Core.ctx.getImageData(0,0,beep8.Core.canvas.width,beep8.Core.canvas.height)};beep8.Core.restoreScreen=function(screenData){beep8.Utilities.checkInstanceOf("screenData",screenData,ImageData);beep8.Core.ctx.putImageData(screenData,0,0)};beep8.Core.doFrame=_asyncToGenerator(_regeneratorRuntime().mark(function _callee11(){var now,numFramesDone;return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:animFrameRequested=false;now=beep8.Core.getNow();beep8.Core.deltaTime=lastFrameTime!==null?.001*(now-lastFrameTime):1/60;beep8.Core.deltaTime=Math.min(beep8.Core.deltaTime,.05);lastFrameTime=now;timeToNextFrame+=beep8.Core.deltaTime;numFramesDone=0;case 7:if(!(frameHandler&&numFramesDone<4&&timeToNextFrame>frameHandlerTargetInterval)){_context11.next=15;break}_context11.next=10;return frameHandler();case 10:beep8.Core.inputSys.onEndFrame();timeToNextFrame-=frameHandlerTargetInterval;++numFramesDone;_context11.next=7;break;case 15:beep8.Core.render();if(frameHandler){animFrameRequested=true;window.requestAnimationFrame(beep8.Core.doFrame)}case 17:case"end":return _context11.stop()}},_callee11)}));beep8.Core.updateLayout=function(renderNow){beep8.Core.updateLayout2d();if(renderNow){beep8.Core.render()}};beep8.Core.updateLayout2d=function(){var autoSize=!beep8.CONFIG.CANVAS_SETTINGS||beep8.CONFIG.CANVAS_SETTINGS.AUTO_SIZE;var autoPos=!beep8.CONFIG.CANVAS_SETTINGS||beep8.CONFIG.CANVAS_SETTINGS.AUTO_POSITION;var useAutoScale=typeof beep8.CONFIG.SCREEN_SCALE!=="number";var scale;if(useAutoScale){var frac=beep8.CONFIG.MAX_SCREEN_FRACTION||.8;var availableSize=autoSize?{width:frac*window.innerWidth,height:frac*window.innerHeight}:beep8.Core.realCanvas.getBoundingClientRect();scale=Math.floor(Math.min(availableSize.width/beep8.CONFIG.SCREEN_WIDTH,availableSize.height/beep8.CONFIG.SCREEN_HEIGHT));scale=Math.min(Math.max(scale,1),5);beep8.Utilities.log("Auto - scale: available size ".concat(availableSize.width," x ").concat(availableSize.height,", scale ").concat(scale,", dpr ").concat(window.devicePixelRatio))}else{scale=beep8.CONFIG.SCREEN_SCALE}beep8.CONFIG.SCREEN_EL_WIDTH=beep8.CONFIG.SCREEN_WIDTH*scale;beep8.CONFIG.SCREEN_EL_HEIGHT=beep8.CONFIG.SCREEN_HEIGHT*scale;beep8.CONFIG.SCREEN_REAL_WIDTH=beep8.CONFIG.SCREEN_WIDTH*scale;beep8.CONFIG.SCREEN_REAL_HEIGHT=beep8.CONFIG.SCREEN_HEIGHT*scale;if(autoSize){beep8.Core.realCanvas.style.width=beep8.CONFIG.SCREEN_EL_WIDTH+"px";beep8.Core.realCanvas.style.height=beep8.CONFIG.SCREEN_EL_HEIGHT+"px";beep8.Core.realCanvas.width=beep8.CONFIG.SCREEN_REAL_WIDTH;beep8.Core.realCanvas.height=beep8.CONFIG.SCREEN_REAL_HEIGHT}else{var actualSize=beep8.Core.realCanvas.getBoundingClientRect();beep8.Core.realCanvas.width=actualSize.width;beep8.Core.realCanvas.height=actualSize.height}beep8.Core.realCtx=beep8.Core.realCanvas.getContext("2d");beep8.Core.realCtx.imageSmoothingEnabled=false;if(autoPos){beep8.Core.realCanvas.style.position="absolute";beep8.Core.realCanvas.style.left=Math.round((window.innerWidth-beep8.Core.realCanvas.width)/2)+"px";beep8.Core.realCanvas.style.top=Math.round((window.innerHeight-beep8.Core.realCanvas.height)/2)+"px"}var scanLinesOp=beep8.CONFIG.SCAN_LINES_OPACITY||0;if(scanLinesOp>0){if(autoPos&&autoSize){if(!scanLinesEl){scanLinesEl=document.createElement("div");document.body.appendChild(scanLinesEl)}scanLinesEl.style.background="linear-gradient(rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 50%), "+"linear-gradient(90deg, rgba(255, 0, 0, .6), rgba(0, 255, 0, .2), rgba(0, 0, 255, .6))";scanLinesEl.style.backgroundSize="100% 4px, 3px 100%";scanLinesEl.style.opacity=scanLinesOp;scanLinesEl.style.position="absolute";scanLinesEl.style.left=beep8.Core.realCanvas.style.left;scanLinesEl.style.top=beep8.Core.realCanvas.style.top;scanLinesEl.style.width=beep8.Core.realCanvas.style.width;scanLinesEl.style.height=beep8.Core.realCanvas.style.height;scanLinesEl.style.zIndex=1}else{console.error("beep8: 2D scanlines effect only works if beep8.CONFIG.CANVAS_SETTINGS.AUTO_POS and AUTO_SIZE are both on.")}}};var crashing=false;beep8.Core.handleCrash=function(){var errorMessage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"Fatal error";if(crashed||crashing)return;crashing=true;beep8.Core.setColor(beep8.CONFIG.COLORS.length-1,0);beep8.Core.cls();beep8.Core.drawState.cursorCol=beep8.Core.drawState.cursorRow=1;beep8.Core.textRenderer.print("*** CRASH ***:\n"+errorMessage);beep8.Core.render();crashing=false;crashed=true};beep8.Core.isMobile=function(){return beep8.Core.isIOS()||beep8.Core.isAndroid()};beep8.Core.isIOS=function(){return/(ipad|ipod|iphone)/i.test(navigator.userAgent)};beep8.Core.isAndroid=function(){return/android/i.test(navigator.userAgent)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.CursorRenderer=function(){function _class(){_classCallCheck(this,_class);this.blinkCycle_=0;this.toggleBlinkHandle_=null}return _createClass(_class,[{key:"setCursorVisible",value:function setCursorVisible(visible){var _this=this;beep8.Utilities.checkBoolean("visible",visible);if(beep8.Core.drawState.cursorVisible===visible)return;beep8.Core.drawState.cursorVisible=visible;this.blinkCycle_=0;beep8.Core.render();if(this.toggleBlinkHandle_!==null){clearInterval(this.toggleBlinkHandle_);this.toggleBlinkHandle_=null}if(visible){this.toggleBlinkHandle_=setInterval(function(){return _this.advanceBlink_()},beep8.CONFIG.CURSOR.BLINK_INTERVAL)}}},{key:"advanceBlink_",value:function advanceBlink_(){this.blinkCycle_=(this.blinkCycle_+1)%2;beep8.Core.render()}},{key:"drawCursor",value:function drawCursor(targetCtx,canvasWidth,canvasHeight){beep8.Utilities.checkInstanceOf("targetCtx",targetCtx,CanvasRenderingContext2D);beep8.Utilities.checkNumber("canvasWidth",canvasWidth);beep8.Utilities.checkNumber("canvasHeight",canvasHeight);if(!beep8.Core.drawState.cursorVisible||this.blinkCycle_<=0)return;var ratio=canvasWidth/beep8.Core.canvas.width;var realX=Math.round((beep8.Core.drawState.cursorCol+.5-beep8.CONFIG.CURSOR.WIDTH_F/2+beep8.CONFIG.CURSOR.OFFSET_H)*beep8.CONFIG.CHR_WIDTH*ratio);var realY=Math.round((beep8.Core.drawState.cursorRow+1-beep8.CONFIG.CURSOR.HEIGHT_F-beep8.CONFIG.CURSOR.OFFSET_V)*beep8.CONFIG.CHR_HEIGHT*ratio);targetCtx.fillStyle=beep8.Core.getColorHex(beep8.Core.drawState.fgColor);targetCtx.fillRect(realX,realY,Math.round(beep8.CONFIG.CURSOR.WIDTH_F*beep8.CONFIG.CHR_WIDTH*ratio),Math.round(beep8.CONFIG.CURSOR.HEIGHT_F*beep8.CONFIG.CHR_HEIGHT*ratio))}}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Input=function(){function _class2(){var _this2=this;_classCallCheck(this,_class2);this.keysHeld_=new Set;this.keysJustPressed_=new Set;window.addEventListener("keydown",function(e){return _this2.onKeyDown(e)});window.addEventListener("keyup",function(e){return _this2.onKeyUp(e)})}return _createClass(_class2,[{key:"keyHeld",value:function keyHeld(keyName){return this.keysHeld_.has(keyName.toUpperCase())}},{key:"keyJustPressed",value:function keyJustPressed(keyName){return this.keysJustPressed_.has(keyName.toUpperCase())}},{key:"onEndFrame",value:function onEndFrame(){this.keysJustPressed_.clear()}},{key:"onKeyDown",value:function onKeyDown(e){this.keysJustPressed_.add(e.key.toUpperCase());this.keysHeld_.add(e.key.toUpperCase());if(beep8.Core.hasPendingAsync("beep8.Async.key")){beep8.Core.resolveAsync("beep8.Async.key",e.key)}}},{key:"onKeyUp",value:function onKeyUp(e){this.keysHeld_["delete"](e.key.toUpperCase())}},{key:"readKeyAsync",value:function readKeyAsync(){return new Promise(function(resolve,reject){beep8.Core.startAsync("beep8.Async.key",resolve,reject)})}},{key:"readLine",value:function(){var _readLine=_asyncToGenerator(_regeneratorRuntime().mark(function _callee12(initString,maxLen){var maxWidth,startCol,startRow,curCol,curRow,curStrings,curPos,cursorWasVisible,key,_args12=arguments;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:maxWidth=_args12.length>2&&_args12[2]!==undefined?_args12[2]:-1;startCol=beep8.Core.drawState.cursorCol;startRow=beep8.Core.drawState.cursorRow;curCol=startCol;curRow=startRow;curStrings=[initString];curPos=0;cursorWasVisible=beep8.Core.drawState.cursorVisible;beep8.Core.cursorRenderer.setCursorVisible(true);case 9:if(!true){_context12.next=36;break}beep8.Core.setCursorLocation(curCol,curRow);beep8.Core.textRenderer.print(curStrings[curPos]||"");_context12.next=14;return this.readKeyAsync();case 14:key=_context12.sent;beep8.Sfx.play("click");if(!(key==="Backspace")){_context12.next=27;break}if(!(curStrings[curPos].length===0)){_context12.next=22;break}if(!(curPos===0)){_context12.next=20;break}return _context12.abrupt("continue",9);case 20:curPos--;curRow--;case 22:curStrings[curPos]=curStrings[curPos].length>0?curStrings[curPos].substring(0,curStrings[curPos].length-1):curStrings[curPos];beep8.Core.setCursorLocation(curCol+curStrings[curPos].length,curRow);beep8.Core.textRenderer.print(" ");_context12.next=34;break;case 27:if(!(key==="Enter")){_context12.next=33;break}beep8.Core.setCursorLocation(1,curRow+1);beep8.Core.cursorRenderer.setCursorVisible(cursorWasVisible);return _context12.abrupt("return",curStrings.join(""));case 33:if(key.length===1){if(curStrings.join("").length<maxLen||maxLen===-1){curStrings[curPos]+=key;if(maxWidth!==-1&&curStrings[curPos].length>=maxWidth){beep8.Core.textRenderer.print(curStrings[curPos].charAt(curStrings[curPos].length-1));curCol=startCol;curPos++;curStrings[curPos]="";curRow++}}}case 34:_context12.next=9;break;case 36:case"end":return _context12.stop()}},_callee12,this)}));function readLine(_x9,_x10){return _readLine.apply(this,arguments)}return readLine}()}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Menu={};beep8.Menu.display=function(){var _ref12=_asyncToGenerator(_regeneratorRuntime().mark(function _callee13(choices,options){var startCol,startRow,promptSize,prompt01,border01,choicesCols,choicesRows,totalCols,totalRows,t,selIndex,k;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:options=options||{};beep8.Utilities.checkArray("choices",choices);beep8.Utilities.checkObject("options",options);options=Object.assign({title:"",prompt:"",selBgColor:beep8.Core.drawState.fgColor,selFgColor:beep8.Core.drawState.bgColor,bgChar:32,borderChar:128,center:false,centerH:false,centerV:false,padding:1,selIndex:0,cancelable:false},options);startCol=beep8.Core.drawState.cursorCol;startRow=beep8.Core.drawState.cursorRow;promptSize=beep8.Core.textRenderer.measure(options.prompt);prompt01=options.prompt?1:0;border01=options.borderChar?1:0;choicesCols=0;choicesRows=choices.length;choices.forEach(function(choice){return choicesCols=Math.max(choicesCols,choice.length)});totalCols=Math.max(promptSize.cols,choicesCols)+2*options.padding+2*border01;totalRows=prompt01*(promptSize.rows+1)+choicesRows+2*options.padding+2*border01;if(options.centerH||options.center){startCol=Math.round((beep8.CONFIG.SCREEN_COLS-totalCols)/2)}if(options.centerV||options.center){startRow=Math.round((beep8.CONFIG.SCREEN_ROWS-totalRows)/2)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow;beep8.Core.textRenderer.printRect(totalCols,totalRows,options.bgChar);if(options.borderChar){beep8.Core.textRenderer.printBox(totalCols,totalRows,false,options.borderChar);if(options.title){t=" "+options.title+" ";beep8.Core.drawState.cursorCol=startCol+Math.round((totalCols-t.length)/2);beep8.Core.textRenderer.print(t)}}if(options.prompt){beep8.Core.drawState.cursorCol=promptSize.cols<=totalCols?startCol+border01+options.padding:startCol+Math.round((totalCols-promptSize.cols)/2);beep8.Core.drawState.cursorRow=startRow+border01+options.padding;beep8.Core.textRenderer.print(options.prompt)}selIndex=options.selIndex;case 22:if(!true){_context13.next=48;break}beep8.Core.drawState.cursorRow=startRow+border01+options.padding+prompt01*(promptSize.rows+1);beep8.Core.drawState.cursorCol=promptSize.cols<=choicesCols?startCol+border01+options.padding:startCol+Math.round((totalCols-choicesCols)/2);beep8.Menu.printChoices(choices,selIndex,options);_context13.next=28;return beep8.Core.inputSys.readKeyAsync();case 28:k=_context13.sent;if(!(k==="ArrowUp")){_context13.next=34;break}selIndex=selIndex>0?selIndex-1:choices.length-1;if(choices.length>1)beep8.Sfx.play("beep3");_context13.next=46;break;case 34:if(!(k==="ArrowDown")){_context13.next=39;break}selIndex=(selIndex+1)%choices.length;if(choices.length>1)beep8.Sfx.play("beep2");_context13.next=46;break;case 39:if(!(k==="Enter"||k==="ButtonA")){_context13.next=44;break}beep8.Sfx.play("beep");return _context13.abrupt("return",selIndex);case 44:if(!((k==="Escape"||k==="ButtonB")&&options.cancelable)){_context13.next=46;break}return _context13.abrupt("return",-1);case 46:_context13.next=22;break;case 48:case"end":return _context13.stop()}},_callee13)}));return function(_x11,_x12){return _ref12.apply(this,arguments)}}();beep8.Menu.printChoices=function(choices,selIndex,options){var origBg=beep8.Core.drawState.bgColor;var origFg=beep8.Core.drawState.fgColor;for(var i=0;i<choices.length;i++){var isSel=i===selIndex;beep8.Core.setColor(isSel?options.selFgColor:origFg,isSel?options.selBgColor:origBg);beep8.Core.textRenderer.print(choices[i]+"\n")}beep8.Core.setColor(origFg,origBg)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var audioContext=typeof AudioContext!=="undefined"?new AudioContext:new webkitAudioContext;var startPatterns=["X-X-","XX--"];var followPatterns=["X--X","X-X-","XX--"];var bassPatterns=["X---","X---X---","X-------","X-X-X-X-","X-------X-------","X-------        ","        X-------"];var scales={minor:[2,1,2,2,1,2,2],harmonicMinor:[2,1,2,2,1,3,1],melodicMinorAscending:[2,1,2,2,2,2,1],melodicMinorDescending:[2,1,2,2,1,2,2],pentatonicMajor:[2,2,3,2,3],pentatonicMinor:[3,2,2,3,2],blues:[3,2,1,1,3,2],chromatic:[1,1,1,1,1,1,1,1,1,1,1,1],wholeTone:[2,2,2,2,2,2],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2],phrygianDominant:[1,3,1,2,1,2,2],hungarianMinor:[2,1,3,1,1,3,1],gypsy:[1,3,1,2,1,3,1],japanese:[1,4,2,1,4],arabian:[2,2,1,1,2,2,2],eastern:[1,2,2,1,1,3,1]};var scaleRangeDistance=[3,2,2,1,1,1,0,0,0,0,-1,-1,-1,-2,-2,-3];var speedRange=[75,100,150,200,250,300];var durationRange=[40,50,60,70,80,90];var scaleRange=12;var noteMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");beep8.Music={};beep8.Music.play=function(song){console.log("play song",song);p1(song)};beep8.Music.create=function(){var melody=[];var scaleKeys=Object.keys(scales);var scaleIndex=scaleKeys[Math.floor(Math.random()*scaleKeys.length)];var pattern=generatePattern(8,startPatterns,followPatterns);melody.push(generateMelody(generateScale(2,scaleIndex),pattern));melody.push(generateMelody(generateScale(1,scaleIndex),pattern));var bassRepeat=Math.floor(Math.random()*3)+1;melody.push(generateMelody(generateScale(0,scaleIndex),generatePattern(bassRepeat,[],bassPatterns)));return"".concat(beep8.Utilities.randomPick(speedRange),".").concat(beep8.Utilities.randomPick(durationRange),"\n").concat(melody.join("\n"))};function generateScale(noteMapId,scaleIndex){var startNote=noteMapId*scaleRange;var scale=[];var currentIndex=startNote;var _iterator3=_createForOfIteratorHelper(scales[scaleIndex]),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var interval=_step3.value;scale.push(noteMap[currentIndex]);console.log(noteMap[currentIndex],currentIndex);currentIndex+=interval}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}return scale}function generatePattern(){var totalPatterns=arguments.length>0&&arguments[0]!==undefined?arguments[0]:4;var startPatterns=arguments.length>1&&arguments[1]!==undefined?arguments[1]:startPatterns;var followPatterns=arguments.length>2&&arguments[2]!==undefined?arguments[2]:followPatterns;if(totalPatterns<1){return""}var pattern=[];if(startPatterns.length>0){pattern.push(startPatterns[Math.floor(Math.random()*startPatterns.length)])}if(followPatterns.length>0){for(var i=1;i<totalPatterns;i++){var randomPattern=followPatterns[Math.floor(Math.random()*followPatterns.length)];var patternRepeat=Math.floor(Math.random()*3)+1;for(var j=0;j<patternRepeat;j++){pattern.push(randomPattern)}}}console.log(pattern);return pattern.join("|")}function generateMelody(scale,rhythmPattern){var melody="";var scaleIndex=Math.floor(Math.random()*scale.length);for(var i=0;i<rhythmPattern.length;i++){if(rhythmPattern[i]==="-"){melody+="-"}if(rhythmPattern[i]===" "){melody+=" "}if(rhythmPattern[i]==="|"){melody+="|"}if(rhythmPattern[i]==="X"){melody+=scale[scaleIndex];scaleIndex+=scaleRangeDistance[Math.floor(Math.random()*scaleRangeDistance.length)];if(scaleIndex<0){scaleIndex=0}if(scaleIndex>=scale.length){scaleIndex=scale.length-1}}}return melody}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var sfxLibrary={coin:{staccato:.55,notes:["E5 e","E6 q"]},coin2:{notes:["G5 e","G6 q"]},jump:{smoothing:1,notes:["E4 e","E3 q"]},change:{notes:["B3 e","D4b e","D4 e","E4 e"]},die:{staccato:.55,gain:.4,notes:["E0 e","F0 e","E0 h"]},knockout:{staccato:.2,notes:["E6 e","E5 e","E4 e","E3 q"]},dash:{smoothing:1,notes:["E2 q","E5 q"]},beep:{staccato:.55,waveType:"sine",gain:.8,notes:["G3 e"]},beep2:{staccato:.55,waveType:"sine",gain:.7,notes:["G4 e"]},beep3:{staccato:.55,waveType:"sine",gain:.7,notes:["G5 e"]},stars:{staccato:.2,waveType:"triangle",gain:.5,notes:["C6 s","C6 s","B6 s","B6 s","A6 s"]},engine:{customWave:[[-1,1,-1,1,-1,1],[1,0,1,0,1,0]],gain:.8,notes:["C1 w","C1 w"]},next:{customWave:[-1,-.9,-.6,-.3,0,.3,.6,.9,1],gain:.8,notes:["C2 e","C3 e","D2 e","D3 e","E2 e","E3 e"]},start:{notes:["D4 h","- h","D4 h","- h","G4 w"]},buzzbuzzbuzz:{gain:.35,notes:["E1 e","- s","E1 e","- s","E1 e","- s","E1 e","- s","E1 e","- s","E1 e","- s","E1 e","- s","E1 e"]},siren:{smoothing:.5,notes:["C4 h","A3 h","C4 h","A3 h","C4 h","A3 h","C4 h","A3 h","C4 h","A3 h"]},click:{staccato:.8,notes:["A5 e"]}};var sfxSequence={};var audioContext=typeof AudioContext!=="undefined"?new AudioContext:new webkitAudioContext;beep8.Sfx={};beep8.Sfx.play=function(sfx){if(!audioContext){return}beep8.Utilities.checkString("sfx",sfx);if(!sfxLibrary[sfx]){beep8.Utilities.error("SFX ".concat(sfx," not found."))}if(!sfxSequence[sfx]){sfxSequence[sfx]=new TinyMusic.Sequence(audioContext,sfxLibrary[sfx].tempo||300,sfxLibrary[sfx].notes);sfxSequence[sfx].loop=false;sfxSequence[sfx].gain.gain.value=sfxLibrary[sfx].gain||.1;if(sfxLibrary[sfx].staccato){sfxSequence[sfx].staccato=sfxLibrary[sfx].staccato}if(sfxLibrary[sfx].smoothing){sfxSequence[sfx].smoothing=sfxLibrary[sfx].smoothing}if(sfxLibrary[sfx].waveType){sfxSequence[sfx].waveType=sfxLibrary[sfx].waveType}if(sfxLibrary[sfx].customWave){beep8.Utilities.checkArray("customWave",sfxLibrary[sfx].customWave);if(sfxLibrary[sfx].customWave.length===2){sfxSequence[sfx].createCustomWave(sfxLibrary[sfx].customWave[0],sfxLibrary[sfx].customWave[1])}else{sfxSequence[sfx].createCustomWave(sfxLibrary[sfx].customWave)}}}sfxSequence[sfx].play(audioContext.currentTime)};beep8.Sfx.get=function(){return Object.keys(sfxLibrary)}})(beep8||({},_readOnlyError("beep8")));(function(beep8){var styles={classical:{roots:"CDEFGAB".split(""),modes:["maj","min"],len_seqs:[[1],[2,2],[2,4,4],[2,4,8,8],[4,4,4,4],[2,8,8,8,8],[4,4,4,8,8],[8,8,8,8,8,8,8,8]],numNotes:64,numTracks:4,tempo:600,sustain:70},jazz:{roots:"CDEFGAB".split(""),modes:["maj","min","blues","pentatonic"],len_seqs:[[2,2,2,2,2,2],[3,3,3],[4,4,8],[8,8]],numNotes:48,numTracks:5,tempo:450,sustain:60},rock:{roots:"CDEFGAB".split(""),modes:["maj","min","pentatonic"],len_seqs:[[4,4,4,4],[8,8,8,8],[4,8,8,8]],numNotes:32,numTracks:3,tempo:500,sustain:80},electro:{roots:"CDEFGAB".split(""),modes:["maj","min"],len_seqs:[[8,8,8,8,8,8,8,8],[16,16,16,16],[8,8,16,16]],numNotes:32,numTracks:2,tempo:400,sustain:90}};beep8.Sound={};beep8.Sound.playSong=function(song){console.log("play song",song);p1(song)};beep8.Sound.stopSong=function(){p1("")};beep8.Sound.createMusic=function(){function generateP1Music(seed,style){var generator=new Math.seedrandom(seed);var selectedStyle=styles[style];var roots=selectedStyle.roots,modes=selectedStyle.modes,len_seqs=selectedStyle.len_seqs,numNotes=selectedStyle.numNotes,numTracks=selectedStyle.numTracks,tempo=selectedStyle.tempo,sustain=selectedStyle.sustain;var root=roots[Math.floor(generator()*roots.length)];var mode=modes[Math.floor(generator()*modes.length)];var scale=generateScale(root,mode,2,5);var markovChain={C:["D","E","G"],D:["E","F","A"],E:["F","G","C"],F:["G","A","D"],G:["A","B","E"],A:["B","C","F"],B:["C","D","G"]};var tracks=[];for(var t=0;t<numTracks;t++){var notes=generateNotes(scale,len_seqs,generator,8,numNotes,markovChain);var p1Music=convertNotesToP1(notes);tracks.push(p1Music)}var p1FormattedMusic="".concat(tempo,".").concat(sustain,"\n").concat(tracks.join("\n"));return p1FormattedMusic}function generateScale(root,mode,min_oct,max_oct){var steps={maj:[2,2,1,2,2,2,1],min:[2,1,2,2,1,2,2],blues:[3,2,1,1,3,2],pentatonic:[2,2,3,2,3]}[mode];var notes="CDEFGAB".split("");var scale=[];for(var oct=min_oct;oct<=max_oct;oct++){var noteIndex=notes.indexOf(root);var _iterator4=_createForOfIteratorHelper(steps),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var step=_step4.value;scale.push(notes[noteIndex]+oct);noteIndex=(noteIndex+step)%notes.length}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}return scale}function generateNotes(scale,len_seqs,generator,res,numNotes,markovChain){var notes="";var currentNote=scale[Math.floor(generator()*scale.length)];for(var i=0;i<numNotes;i++){var seq=len_seqs[Math.floor(generator()*len_seqs.length)];var len=seq[Math.floor(generator()*seq.length)];var noteLen=res/len;notes+=currentNote[0]+currentNote[1]+"-".repeat(noteLen-1)+" ";currentNote=getNextNoteUsingMarkovChain(currentNote,markovChain,generator)}return notes.trim()}function getNextNoteUsingMarkovChain(currentNote,markovChain,generator){var note=currentNote[0];var possibleNextNotes=markovChain[note];var nextNote=possibleNextNotes[Math.floor(generator()*possibleNextNotes.length)];return nextNote+currentNote[1]}function convertNotesToP1(notes){var p1Letters={C2:"C",D2:"D",E2:"E",F2:"F",G2:"G",A2:"A",B2:"B",C3:"V",D3:"W",E3:"X",F3:"Y",G3:"Z",A3:"a",B3:"b",C4:"c",D4:"d",E4:"e",F4:"f",G4:"g",A4:"h",B4:"i",C5:"j",D5:"k",E5:"l",F5:"m",G5:"n",A5:"o",B5:"p"};var p1String="";var _iterator5=_createForOfIteratorHelper(notes.split(" ")),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var note=_step5.value;var p1Note=p1Letters[note[0]+note[1]];p1String+=p1Note?p1Note+note.slice(2):" "}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return p1String.trim()}var seed="d12d21ddd";var music=generateP1Music(seed,"rock");console.log(music);return music}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.TextRenderer=function(){function _class3(){_classCallCheck(this,_class3);this.fonts_={};this.curFont_=null}return _createClass(_class3,[{key:"initAsync",value:function(){var _initAsync=_asyncToGenerator(_regeneratorRuntime().mark(function _callee14(){var defaultFont,actualCharWidth,actualCharHeight;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:beep8.Utilities.log("beep8.TextRenderer init.");defaultFont=new beep8.TextRendererFont("default",beep8.CONFIG.CHR_FILE);_context14.next=4;return defaultFont.initAsync();case 4:actualCharWidth=defaultFont.getCharWidth();actualCharHeight=defaultFont.getCharHeight();beep8.Utilities.assert(actualCharWidth===defaultFont.getCharWidth()&&actualCharHeight===defaultFont.getCharHeight(),"The character image ".concat(beep8.CONFIG.CHR_FILE," should be a 16x16 grid of characters with ")+"dimensions 16 * beep8.CONFIG.CHR_WIDTH, 16 * beep8.CONFIG.CHR_HEIGHT = "+"".concat(16*beep8.CONFIG.CHR_WIDTH," x ").concat(16*beep8.CONFIG.CHR_HEIGHT));this.fonts_["default"]=defaultFont;this.curFont_=defaultFont;case 9:case"end":return _context14.stop()}},_callee14,this)}));function initAsync(){return _initAsync.apply(this,arguments)}return initAsync}()},{key:"loadFontAsync",value:function(){var _loadFontAsync=_asyncToGenerator(_regeneratorRuntime().mark(function _callee15(fontName,fontImageFile){var font;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:beep8.Utilities.checkString("fontName",fontName);beep8.Utilities.checkString("fontImageFile",fontImageFile);font=new beep8.TextRendererFont(fontName,fontImageFile);_context15.next=5;return font.initAsync();case 5:this.fonts_[fontName]=font;case 6:case"end":return _context15.stop()}},_callee15,this)}));function loadFontAsync(_x13,_x14){return _loadFontAsync.apply(this,arguments)}return loadFontAsync}()},{key:"setFont",value:function setFont(fontName){beep8.Utilities.checkString("fontName",fontName);var font=this.fonts_[fontName];if(!font){beep8.Utilities.fatal("setFont(): font not found: ".concat(fontName));return}var cw=font.getCharWidth();var ch=font.getCharHeight();if(cw%beep8.CONFIG.CHR_WIDTH!==0||ch%beep8.CONFIG.CHR_HEIGHT!==0){beep8.Utilities.fatal("setFont(): font ".concat(fontName," has character size ").concat(cw,"x").concat(ch,", ")+"which is not an integer multiple of beep8.CONFIG.CHR_WIDTH x beep8.CONFIG.CHR_HEIGHT = "+"".concat(beep8.CONFIG.CHR_WIDTH,"x").concat(beep8.CONFIG.CHR_HEIGHT,", so it can't be set as the ")+"current font due to the row,column system. However, you can still use it "+"directly with drawText() by passing it as a parameter to that function.");return}this.curFont_=font}},{key:"print",value:function print(text){beep8.Utilities.checkString("text",text);var col=beep8.Core.drawState.cursorCol;var row=beep8.Core.drawState.cursorRow;this.origFgColor_=beep8.Core.drawState.fgColor;this.origBgColor_=beep8.Core.drawState.bgColor;var colInc=Math.floor(this.curFont_.getCharWidth()/beep8.CONFIG.CHR_WIDTH);var rowInc=Math.floor(this.curFont_.getCharHeight()/beep8.CONFIG.CHR_HEIGHT);var initialCol=col;for(var i=0;i<text.length;i++){i=this.processEscapeSeq_(text,i);var ch=text.charCodeAt(i);if(ch===10){col=initialCol;row+=rowInc}else{this.put_(ch,col,row,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor);col+=colInc}}beep8.Core.drawState.cursorCol=col;beep8.Core.drawState.cursorRow=row;beep8.Core.drawState.fgColor=this.origFgColor_;beep8.Core.drawState.bgColor=this.origBgColor_;beep8.Core.markDirty()}},{key:"printCentered",value:function printCentered(text,width){beep8.Utilities.checkString("text",text);beep8.Utilities.checkNumber("width",width);text=text.split("\n")[0];if(!text)return;var textWidth=this.measure(text).cols;var col=Math.floor(beep8.Core.drawState.cursorCol+(width-textWidth)/2);beep8.Core.drawState.cursorCol=col;this.print(text)}},{key:"printChar",value:function printChar(ch,n){if(n===undefined||isNaN(n))n=1;beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("n",n);while(n-- >0){this.put_(ch,beep8.Core.drawState.cursorCol,beep8.Core.drawState.cursorRow,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor);beep8.Core.drawState.cursorCol++}beep8.Core.markDirty()}},{key:"spr",value:function spr(ch,x,y){beep8.Utilities.checkNumber("ch",ch);beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);this.putxy_(ch,x,y,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor)}},{key:"drawText",value:function drawText(x,y,text,fontName){beep8.Utilities.checkNumber("x",x);beep8.Utilities.checkNumber("y",y);beep8.Utilities.checkString("text",text);if(fontName)beep8.Utilities.checkString("fontName",fontName);var x0=x;var font=fontName?this.fonts_[fontName]||this.curFont_:this.curFont_;if(!font){beep8.Utilities.warn("Requested font '".concat(fontName,"' not found: not drawing text."));return}for(var i=0;i<text.length;i++){var ch=text.charCodeAt(i);if(ch===10){x=x0;y+=font.getCharHeight()}else{this.putxy_(ch,x,y,beep8.Core.drawState.fgColor,beep8.Core.drawState.bgColor,font);x+=font.getCharWidth()}}}},{key:"measure",value:function measure(text){beep8.Utilities.checkString("text",text);if(text==="")return{cols:0,rows:0};var rows=1;var thisLineWidth=0;var cols=0;for(var i=0;i<text.length;i++){i=this.processEscapeSeq_(text,i,true);var ch=text.charCodeAt(i);if(ch===10){rows++;thisLineWidth=0}else{++thisLineWidth;cols=Math.max(cols,thisLineWidth)}}return{cols:cols,rows:rows}}},{key:"printRect",value:function printRect(width,height,ch){beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkNumber("ch",ch);var startCol=beep8.Core.drawState.cursorCol;var startRow=beep8.Core.drawState.cursorRow;for(var i=0;i<height;i++){beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow+i;this.printChar(ch,width)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow}},{key:"printBox",value:function printBox(width,height,fill,borderCh){var borderNW=borderCh;var borderNE=borderCh+1;var borderSW=borderCh+2;var borderSE=borderCh+3;var borderV=borderCh+4;var borderH=borderCh+5;beep8.Utilities.checkNumber("width",width);beep8.Utilities.checkNumber("height",height);beep8.Utilities.checkBoolean("fill",fill);beep8.Utilities.checkNumber("borderCh",borderCh);var startCol=beep8.Core.drawState.cursorCol;var startRow=beep8.Core.drawState.cursorRow;for(var i=0;i<height;i++){beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow+i;if(i===0){this.printChar(borderNW);this.printChar(borderH,width-2);this.printChar(borderNE)}else if(i===height-1){this.printChar(borderSW);this.printChar(borderH,width-2);this.printChar(borderSE)}else{this.printChar(borderV);beep8.Core.drawState.cursorCol=startCol+width-1;this.printChar(borderV)}}if(fill&&width>2&&height>2){beep8.Core.drawState.cursorCol=startCol+1;beep8.Core.drawState.cursorRow=startRow+1;this.printRect(width-2,height-2,32)}beep8.Core.drawState.cursorCol=startCol;beep8.Core.drawState.cursorRow=startRow}},{key:"put_",value:function put_(ch,col,row,fgColor,bgColor){var chrW=beep8.CONFIG.CHR_WIDTH;var chrH=beep8.CONFIG.CHR_HEIGHT;var x=Math.round(col*chrW);var y=Math.round(row*chrH);this.putxy_(ch,x,y,fgColor,bgColor)}},{key:"putxy_",value:function putxy_(ch,x,y,fgColor,bgColor){var font=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;font=font||this.curFont_;var chrW=font.getCharWidth();var chrH=font.getCharHeight();var fontRow=Math.floor(ch/16);var fontCol=ch%16;x=Math.round(x);y=Math.round(y);if(bgColor>=0){beep8.Core.ctx.fillStyle=beep8.Core.getColorHex(bgColor);beep8.Core.ctx.fillRect(x,y,chrW,chrH)}var color=beep8.Utilities.clamp(fgColor,0,beep8.CONFIG.COLORS.length-1);var img=font.getImageForColor(color);beep8.Core.ctx.drawImage(img,fontCol*chrW,fontRow*chrH,chrW,chrH,x,y,chrW,chrH);beep8.Core.markDirty()}},{key:"processEscapeSeq_",value:function processEscapeSeq_(text,startPos){var pretend=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var startSeq=beep8.CONFIG.PRINT_ESCAPE_START;var endSeq=beep8.CONFIG.PRINT_ESCAPE_END;if(!startSeq||!endSeq)return startPos;if(text.substring(startPos,startPos+startSeq.length)!=startSeq){return startPos}var endPos=text.indexOf(endSeq,startPos+startSeq.length);if(!pretend){var command=text.substring(startPos+startSeq.length,endPos);this.runEscapeCommand_(command)}return endPos+endSeq.length}},{key:"runEscapeCommand_",value:function runEscapeCommand_(command){if(command.indexOf(",")>0){var parts=command.split(",");var _iterator6=_createForOfIteratorHelper(parts),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var part=_step6.value;this.runEscapeCommand_(part)}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return}command=command.trim();if(command==="")return;var verb=command[0].toLowerCase();var arg=command.substring(1);var argNum=1*arg;switch(verb){case"f":case"c":beep8.Core.drawState.fgColor=arg!==""?argNum:this.origFgColor_;break;case"b":beep8.Core.drawState.bgColor=arg!==""?argNum:this.origBgColor_;break;case"z":beep8.Core.drawState.fgColor=this.origFgColor_;beep8.Core.drawState.bgColor=this.origBgColor_;break;default:console.warn("Unknown beep8 print escape command: "+command)}}},{key:"regenColors",value:function regenColors(){Object.values(this.fonts_).forEach(function(f){return f.regenColors()})}}])}();beep8.TextRenderer=beep8.TextRenderer})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.TextRendererFont=function(){function _class4(fontName,fontImageFile){_classCallCheck(this,_class4);beep8.Utilities.checkString("fontName",fontName);beep8.Utilities.checkString("fontImageFile",fontImageFile);this.fontName_=fontName;this.fontImageFile_=fontImageFile;this.origImg_=null;this.chrImages_=[];this.charWidth_=0;this.charHeight_=0;this.origFgColor_=0;this.origBgColor_=0}return _createClass(_class4,[{key:"getCharWidth",value:function getCharWidth(){return this.charWidth_}},{key:"getCharHeight",value:function getCharHeight(){return this.charHeight_}},{key:"getImageForColor",value:function getImageForColor(colorNumber){return this.chrImages_[colorNumber]}},{key:"initAsync",value:function(){var _initAsync2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee16(){return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:beep8.Utilities.log("Building font ".concat(this.fontName_," from image ").concat(this.fontImageFile_));_context16.next=3;return beep8.Utilities.loadImageAsync(this.fontImageFile_);case 3:this.origImg_=_context16.sent;beep8.Utilities.assert(this.origImg_.width%16===0&&this.origImg_.height%16===0,"Font ".concat(this.fontName_,": image ").concat(this.fontImageFile_," has dimensions ")+"".concat(this.origImg_.width,"x").concat(this.origImg_.height,". It must ")+"have dimensions that are multiples of 16 (16x16 grid of characters).");this.charWidth_=Math.floor(this.origImg_.width/16);this.charHeight_=Math.floor(this.origImg_.height/16);this.regenColors();case 8:case"end":return _context16.stop()}},_callee16,this)}));function initAsync(){return _initAsync2.apply(this,arguments)}return initAsync}()},{key:"regenColors",value:function regenColors(){var tempCanvas=document.createElement("canvas");tempCanvas.width=this.origImg_.width;tempCanvas.height=this.origImg_.height;var ctx=tempCanvas.getContext("2d");this.chrImages_=[];for(var c=0;c<beep8.CONFIG.COLORS.length;c++){beep8.Utilities.log("Initializing font ".concat(this.fontName_,", color ").concat(c," = ").concat(beep8.CONFIG.COLORS[c]));ctx.clearRect(0,0,this.origImg_.width,this.origImg_.height);ctx.globalCompositeOperation="source-over";ctx.drawImage(this.origImg_,0,0,this.origImg_.width,this.origImg_.height);ctx.globalCompositeOperation="source-in";ctx.fillStyle=beep8.CONFIG.COLORS[c];ctx.fillRect(0,0,this.origImg_.width,this.origImg_.height);var thisImg=new Image;thisImg.src=tempCanvas.toDataURL();this.chrImages_.push(thisImg)}}}])}()})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Utilities={};beep8.Utilities.fatal=function(error){console.error("Fatal error: "+error);try{beep8.Core.handleCrash(error)}catch(e){console.error("Error in beep8.Core.handleCrash: "+e+" while handling error "+error)}throw new Error("Error: "+error)};beep8.Utilities.assert=function(cond,msg){if(!cond){beep8.Utilities.fatal(msg||"Assertion Failed")}return cond};beep8.Utilities.assertDebug=function(cond,msg){if(!cond){if(beep8.CONFIG.DEBUG){warn("DEBUG ASSERT failed: "+msg)}else{beep8.Utilities.fatal(msg)}}return cond};beep8.Utilities.assertEquals=function(expected,actual,what){if(expected!==actual){beep8.Utilities.fatal("".concat(what,": expected ").concat(expected," but got ").concat(actual))}return actual};beep8.Utilities.checkType=function(varName,varValue,varType){beep8.Utilities.assert(varName,"checkType: varName must be provided.");beep8.Utilities.assert(varType,"checkType: varType must be provided.");beep8.Utilities.assert(_typeof(varValue)===varType,"".concat(varName," should be of type ").concat(varType," but was ").concat(_typeof(varValue),": ").concat(varValue));return varValue};beep8.Utilities.checkNumber=function(varName,varValue,optMin,optMax){beep8.Utilities.checkType(varName,varValue,"number");if(isNaN(varValue)){beep8.Utilities.fatal("".concat(varName," should be a number but is NaN"))}if(!isFinite(varValue)){beep8.Utilities.fatal("".concat(varName," should be a number but is infinite: ").concat(varValue))}if(optMin!==undefined){beep8.Utilities.assert(varValue>=optMin,"".concat(varName," should be >= ").concat(optMin," but is ").concat(varValue))}if(optMax!==undefined){beep8.Utilities.assert(varValue<=optMax,"".concat(varName," should be <= ").concat(optMax," but is ").concat(varValue))}return varValue};beep8.Utilities.checkString=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"string")};beep8.Utilities.checkBoolean=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"boolean")};beep8.Utilities.checkFunction=function(varName,varValue){return beep8.Utilities.checkType(varName,varValue,"function")};beep8.Utilities.checkObject=function(varName,varValue){if(varValue===null){beep8.Utilities.fatal("".concat(varName," should be an object, but was null"))}return beep8.Utilities.checkType(varName,varValue,"object")};beep8.Utilities.checkInstanceOf=function(varName,varValue,expectedClass){beep8.Utilities.assert(varValue instanceof expectedClass,"".concat(varName," should be an instance of ").concat(expectedClass.name," but was not, it's: ").concat(varValue));return varValue};beep8.Utilities.checkArray=function(varName,varValue){beep8.Utilities.assert(Array.isArray(varValue),"".concat(varName," should be an array, but was: ").concat(varValue));return varValue};beep8.Utilities.log=beep8.CONFIG.DEBUG?console.log:function(){};beep8.Utilities.warn=console.warn;beep8.Utilities.error=console.error;beep8.Utilities.loadImageAsync=function(){var _ref13=_asyncToGenerator(_regeneratorRuntime().mark(function _callee17(src){return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:return _context17.abrupt("return",new Promise(function(resolver){var img=new Image;img.onload=function(){return resolver(img)};img.src=src}));case 1:case"end":return _context17.stop()}},_callee17)}));return function(_x15){return _ref13.apply(this,arguments)}}();beep8.Utilities.loadFileAsync=function(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(){if(xhr.status<200||xhr.status>299){reject("HTTP request finished with status "+xhr.status)}else{resolve(xhr.responseText)}});xhr.addEventListener("error",function(e){return reject(e)});xhr.open("GET",url);xhr.send()})};beep8.Utilities.clamp=function(x,lo,hi){return Math.min(Math.max(x,lo),hi)};beep8.Utilities.randomInt=function(lowInclusive,highInclusive){beep8.Utilities.checkNumber("lowInclusive",lowInclusive);beep8.Utilities.checkNumber("highInclusive",highInclusive);lowInclusive=Math.round(lowInclusive);highInclusive=Math.round(highInclusive);if(highInclusive<=lowInclusive){return lowInclusive}return beep8.Utilities.clamp(Math.floor(Math.random()*(highInclusive-lowInclusive+1))+lowInclusive,lowInclusive,highInclusive)};beep8.Utilities.randomPick=function(array){beep8.Utilities.checkArray("array",array);return array.length>0?array[beep8.Utilities.randomInt(0,array.length-1)]:null};beep8.Utilities.shuffleArray=function(array){beep8.Utilities.checkArray("array",array);array=array.slice();for(var i=0;i<array.length;i++){var j=beep8.Utilities.randomInt(0,array.length-1);var tmp=array[i];array[i]=array[j];array[j]=tmp}return array};beep8.Utilities.dist2d=function(x0,y0,x1,y1){beep8.Utilities.checkNumber("x0",x0);beep8.Utilities.checkNumber("y0",y0);beep8.Utilities.checkNumber("x1",x1);beep8.Utilities.checkNumber("y1",y1);var dx=x0-x1;var dy=y0-y1;return Math.sqrt(dx*dx+dy*dy)};beep8.Utilities.intersectIntervals=function(as,ae,bs,be){var result=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;beep8.Utilities.checkNumber("as",as);beep8.Utilities.checkNumber("ae",ae);beep8.Utilities.checkNumber("bs",bs);beep8.Utilities.checkNumber("be",be);if(result){beep8.Utilities.checkObject("result",result)}var start=Math.max(as,bs);var end=Math.min(ae,be);if(end>=start){if(result){result.start=start;result.end=end}return true}return false};beep8.Utilities.intersectRects=function(r1,r2){var dx1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var dy1=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var dx2=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var dy2=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var result=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;beep8.Utilities.checkObject("r1",r1);beep8.Utilities.checkObject("r2",r2);beep8.Utilities.checkNumber("r1.x",r1.x);beep8.Utilities.checkNumber("r1.y",r1.y);beep8.Utilities.checkNumber("r1.w",r1.w);beep8.Utilities.checkNumber("r1.h",r1.h);beep8.Utilities.checkNumber("r2.x",r2.x);beep8.Utilities.checkNumber("r2.y",r2.y);beep8.Utilities.checkNumber("r2.w",r2.w);beep8.Utilities.checkNumber("r2.h",r2.h);beep8.Utilities.checkNumber("dx1",dx1);beep8.Utilities.checkNumber("dx2",dx2);beep8.Utilities.checkNumber("dy1",dy1);beep8.Utilities.checkNumber("dy2",dy2);if(result){checkObject("result",result)}var xint=intersectRects_xint;var yint=intersectRects_yint;if(!beep8.Utilities.intersectIntervals(r1.x+dx1,r1.x+dx1+r1.w-1,r2.x+dx2,r2.x+dx2+r2.w-1,xint)){return false}if(!beep8.Utilities.intersectIntervals(r1.y+dy1,r1.y+dy1+r1.h-1,r2.y+dy2,r2.y+dy2+r2.h-1,yint)){return false}if(result){result.x=xint.start;result.w=xint.end-xint.start+1;result.y=yint.start;result.h=yint.end-yint.start+1}return true};var intersectRects_xint={};var intersectRects_yint={}})(beep8||({},_readOnlyError("beep8")));(function(beep8){beep8.Joystick={};var LEFT_VJOY_HTML="\n<div id='vjoy-button-up' class='vjoy-button'></div>\n<div id='vjoy-button-down' class='vjoy-button'></div>\n<div id='vjoy-button-left' class='vjoy-button'></div>\n<div id='vjoy-button-right' class='vjoy-button'></div>\n\t";var RIGHT_VJOY_HTML="\n<div id='vjoy-button-pri' class='vjoy-button'>A</div>\n<div id='vjoy-button-sec' class='vjoy-button'>B</div>\n<div id='vjoy-button-ter' class='vjoy-button'>=</div>\n\t";var VJOY_CSS="\n* {\n\tuser-select: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n\n#vjoy-scrim {\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\ttop: 0;\n\tpointer-events: all;\n}\n\n#vjoy-container-left {\n\tbox-sizing: border-box;\n\tposition: fixed;\n\tbottom: 16px;\n\tleft: 16px;\n\twidth: 40vmin;\n\theight: 40vmin;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n\n#vjoy-container-right {\n\tbox-sizing: border-box;\n\tposition: fixed;\n\tbottom: 16px;\n\tright: 16px;\n\twidth: 40vmin;\n\theight: 40vmin;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n\n.vjoy-button {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground: #444;\n\tborder: none;\n\tfont: bold 14px monospace;\n\tcolor: #888;\n\tuser-select: none;\n\ttouch-callout: none;\n\t-webkit-user-select: none;\n\t-webkit-touch-callout: none;\n}\n.vjoy-button:active {\n\tbackground: #888;\n}\n\n#vjoy-button-up {\n\tposition: absolute;\n\tleft: 30%;\n\ttop: 0px;\n\twidth: 40%;\n\theight: 45%;\n\tborder-radius: 0px 0px 50% 50%;\n}\n\n#vjoy-button-down {\n\tposition: absolute;\n\tleft: 30%;\n\tbottom: 0px;\n\twidth: 40%;\n\theight: 45%;\n\tborder-radius: 50% 50% 0px 0px;\n}\n\n#vjoy-button-left {\n\tposition: absolute;\n\tleft: 0px;\n\tbottom: 30%;\n\twidth: 45%;\n\theight: 40%;\n\tborder-radius: 0px 50% 50% 0px;\n}\n\n#vjoy-button-right {\n\tposition: absolute;\n\tright: 0px;\n\tbottom: 30%;\n\twidth: 45%;\n\theight: 40%;\n\tborder-radius: 50% 0px 0px 50%;\n}\n\n#vjoy-button-pri {\n\tposition: absolute;\n\tright: 0px;\n\ttop: 30%;\n\twidth: 50%;\n\theight: 50%;\n\tborder-radius: 50%;\n}\n\n#vjoy-button-sec {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 30%;\n\twidth: 50%;\n\theight: 50%;\n\tborder-radius: 50%;\n}\n\n#vjoy-button-ter {\n\tposition: fixed;\n\tright: 0px;\n\tbottom: 0px;\n\twidth: 10vw;\n\theight: 8vmin;\n\tborder-radius: 8px;\n\topacity: 0.5;\n}\n\t";beep8.Joystick.setup=function(){beep8.Utilities.log("Setting up virtual joystick...");var styleEl=document.createElement("style");styleEl.setAttribute("type","text/css");styleEl.innerText=VJOY_CSS;document.body.appendChild(styleEl);var scrim=document.createElement("div");scrim.setAttribute("id","vjoy-scrim");scrim.addEventListener("touchstart",function(e){return e.preventDefault()});document.body.appendChild(scrim);var leftContainer=document.createElement("div");leftContainer.setAttribute("id","vjoy-container-left");leftContainer.innerHTML=LEFT_VJOY_HTML;document.body.appendChild(leftContainer);var rightContainer=document.createElement("div");rightContainer.setAttribute("id","vjoy-container-right");rightContainer.innerHTML=RIGHT_VJOY_HTML;document.body.appendChild(rightContainer);setTimeout(continueSetup,10)};beep8.Joystick.continueSetup=function(){setUpButton("vjoy-button-up","ArrowUp");setUpButton("vjoy-button-down","ArrowDown");setUpButton("vjoy-button-left","ArrowLeft");setUpButton("vjoy-button-right","ArrowRight");setUpButton("vjoy-button-pri","ButtonA");setUpButton("vjoy-button-sec","ButtonB");setUpButton("vjoy-button-ter","Escape");document.body.addEventListener("touchstart",function(e){return e.preventDefault()})};beep8.Joystick.setUpButton=function(buttonId,buttonKeyName){var button=beep8.Utilities.assert(document.getElementById(buttonId),"Could not find button ID "+buttonId);if(buttonKeyName===null){button.style.display="none";return}button.addEventListener("mousedown",function(e){return handleButtonEvent(buttonKeyName,true,e)});button.addEventListener("touchstart",function(e){return handleButtonEvent(buttonKeyName,true,e)});button.addEventListener("mouseup",function(e){return handleButtonEvent(buttonKeyName,false,e)});button.addEventListener("touchend",function(e){return handleButtonEvent(buttonKeyName,false,e)});button.addEventListener("contextmenu",function(e){return e.preventDefault()})};beep8.Joystick.handleButtonEvent=function(buttonKeyName,down,evt){if(down){inputSys.onKeyDown({key:buttonKeyName})}else{inputSys.onKeyUp({key:buttonKeyName})}evt.preventDefault()}})(beep8||({},_readOnlyError("beep8")));function generatePerlinNoise(width,height,options){options=options||{};var octaveCount=options.octaveCount||4;var amplitude=options.amplitude||.1;var persistence=options.persistence||.2;var whiteNoise=generateWhiteNoise(width,height);var smoothNoiseList=new Array(octaveCount);var i;for(i=0;i<octaveCount;++i){smoothNoiseList[i]=generateSmoothNoise(i)}var perlinNoise=new Array(width*height);var totalAmplitude=0;for(i=octaveCount-1;i>=0;--i){amplitude*=persistence;totalAmplitude+=amplitude;for(var j=0;j<perlinNoise.length;++j){perlinNoise[j]=perlinNoise[j]||0;perlinNoise[j]+=smoothNoiseList[i][j]*amplitude}}for(i=0;i<perlinNoise.length;++i){perlinNoise[i]/=totalAmplitude}return perlinNoise;function generateSmoothNoise(octave){var noise=new Array(width*height);var samplePeriod=Math.pow(2,octave);var sampleFrequency=1/samplePeriod;var noiseIndex=0;for(var y=0;y<height;++y){var sampleY0=Math.floor(y/samplePeriod)*samplePeriod;var sampleY1=(sampleY0+samplePeriod)%height;var vertBlend=(y-sampleY0)*sampleFrequency;for(var x=0;x<width;++x){var sampleX0=Math.floor(x/samplePeriod)*samplePeriod;var sampleX1=(sampleX0+samplePeriod)%width;var horizBlend=(x-sampleX0)*sampleFrequency;var top=interpolate(whiteNoise[sampleY0*width+sampleX0],whiteNoise[sampleY1*width+sampleX0],vertBlend);var bottom=interpolate(whiteNoise[sampleY0*width+sampleX1],whiteNoise[sampleY1*width+sampleX1],vertBlend);noise[noiseIndex]=interpolate(top,bottom,horizBlend);noiseIndex+=1}}return noise}}!function(global,pool,math){var width=256,chunks=6,digits=52,rngname="random",startdenom=math.pow(width,chunks),significance=math.pow(2,digits),overflow=significance*2,mask=width-1,nodecrypto;function seedrandom(seed,options,callback){var key=[];options=options==true?{entropy:true}:options||{};var shortseed=mixkey(flatten(options.entropy?[seed,tostring(pool)]:seed==null?autoseed():seed,3),key);var arc4=new ARC4(key);var prng=function prng(){var n=arc4.g(chunks),d=startdenom,x=0;while(n<significance){n=(n+x)*width;d*=width;x=arc4.g(1)}while(n>=overflow){n/=2;d/=2;x>>>=1}return(n+x)/d};prng.int32=function(){return arc4.g(4)|0};prng.quick=function(){return arc4.g(4)/4294967296};prng["double"]=prng;mixkey(tostring(arc4.S),pool);return(options.pass||callback||function(prng,seed,is_math_call,state){if(state){if(state.S){copy(state,arc4)}prng.state=function(){return copy(arc4,{})}}if(is_math_call){math[rngname]=prng;return seed}else return prng})(prng,shortseed,"global"in options?options.global:this==math,options.state)}function ARC4(key){var t,keylen=key.length,me=this,i=0,j=me.i=me.j=0,s=me.S=[];if(!keylen){key=[keylen++]}while(i<width){s[i]=i++}for(i=0;i<width;i++){s[i]=s[j=mask&j+key[i%keylen]+(t=s[i])];s[j]=t}(me.g=function(count){var t,r=0,i=me.i,j=me.j,s=me.S;while(count--){t=s[i=mask&i+1];r=r*width+s[mask&(s[i]=s[j=mask&j+t])+(s[j]=t)]}me.i=i;me.j=j;return r})(width)}function copy(f,t){t.i=f.i;t.j=f.j;t.S=f.S.slice();return t}function flatten(obj,depth){var result=[],typ=_typeof(obj),prop;if(depth&&typ=="object"){for(prop in obj){try{result.push(flatten(obj[prop],depth-1))}catch(e){}}}return result.length?result:typ=="string"?obj:obj+"\0"}function mixkey(seed,key){var stringseed=seed+"",smear,j=0;while(j<stringseed.length){key[mask&j]=mask&(smear^=key[mask&j]*19)+stringseed.charCodeAt(j++)}return tostring(key)}function autoseed(){try{var out;if(nodecrypto&&(out=nodecrypto.randomBytes)){out=out(width)}else{out=new Uint8Array(width);(global.crypto||global.msCrypto).getRandomValues(out)}return tostring(out)}catch(e){var browser=global.navigator,plugins=browser&&browser.plugins;return[+new Date,global,plugins,global.screen,tostring(pool)]}}function tostring(a){return String.fromCharCode.apply(0,a)}mixkey(math.random(),pool);if((typeof module==="undefined"?"undefined":_typeof(module))=="object"&&module.exports){module.exports=seedrandom;try{nodecrypto=require("crypto")}catch(ex){}}else if(typeof define=="function"&&define.amd){define(function(){return seedrandom})}else{math["seed"+rngname]=seedrandom}console.log("seed random init")}(typeof self!=="undefined"?self:void 0,[],Math);(function(root,factory){if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"&&typeof exports.nodeName!=="string"){factory(exports)}else{factory(root.TinyMusic={})}})(void 0,function(exports){var enharmonics="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",middleC=440*Math.pow(Math.pow(2,1/12),-9),numeric=/^[0-9.]+$/,octaveOffset=4,space=/\s+/,num=/(\d+)/,offsets={};enharmonics.split("|").forEach(function(val,i){val.split("-").forEach(function(note){offsets[note]=i})});function Note(str){var couple=str.split(space);this.frequency=Note.getFrequency(couple[0])||0;this.duration=Note.getDuration(couple[1])||0}Note.getFrequency=function(name){var couple=name.split(num),distance=offsets[couple[0]],octaveDiff=(couple[1]||octaveOffset)-octaveOffset,freq=middleC*Math.pow(Math.pow(2,1/12),distance);return freq*Math.pow(2,octaveDiff)};Note.getDuration=function(symbol){return numeric.test(symbol)?parseFloat(symbol):symbol.toLowerCase().split("").reduce(function(prev,curr){return prev+(curr==="w"?4:curr==="h"?2:curr==="q"?1:curr==="e"?.5:curr==="s"?.25:0)},0)};function Sequence(ac,tempo,arr){this.ac=ac||new AudioContext;this.createFxNodes();this.tempo=tempo||120;this.loop=true;this.smoothing=0;this.staccato=0;this.notes=[];this.push.apply(this,arr||[])}Sequence.prototype.createFxNodes=function(){var eq=[["bass",100],["mid",1e3],["treble",2500]],prev=this.gain=this.ac.createGain();eq.forEach(function(config,filter){filter=this[config[0]]=this.ac.createBiquadFilter();filter.type="peaking";filter.frequency.value=config[1];prev.connect(prev=filter)}.bind(this));prev.connect(this.ac.destination);return this};Sequence.prototype.push=function(){Array.prototype.forEach.call(arguments,function(note){this.notes.push(note instanceof Note?note:new Note(note))}.bind(this));return this};Sequence.prototype.createCustomWave=function(real,imag){if(!imag){imag=real}this.waveType="custom";this.customWave=[new Float32Array(real),new Float32Array(imag)]};Sequence.prototype.createOscillator=function(){this.stop();this.osc=this.ac.createOscillator();if(this.customWave){this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave))}else{this.osc.type=this.waveType||"square"}this.osc.connect(this.gain);return this};Sequence.prototype.scheduleNote=function(index,when){var duration=60/this.tempo*this.notes[index].duration,cutoff=duration*(1-(this.staccato||0));this.setFrequency(this.notes[index].frequency,when);if(this.smoothing&&this.notes[index].frequency){this.slide(index,when,cutoff)}this.setFrequency(0,when+cutoff);return when+duration};Sequence.prototype.getNextNote=function(index){return this.notes[index<this.notes.length-1?index+1:0]};Sequence.prototype.getSlideStartDelay=function(duration){return duration-Math.min(duration,60/this.tempo*this.smoothing)};Sequence.prototype.slide=function(index,when,cutoff){var next=this.getNextNote(index),start=this.getSlideStartDelay(cutoff);this.setFrequency(this.notes[index].frequency,when+start);this.rampFrequency(next.frequency,when+cutoff);return this};Sequence.prototype.setFrequency=function(freq,when){this.osc.frequency.setValueAtTime(freq,when);return this};Sequence.prototype.rampFrequency=function(freq,when){this.osc.frequency.linearRampToValueAtTime(freq,when);return this};Sequence.prototype.play=function(when){when=typeof when==="number"?when:this.ac.currentTime;this.createOscillator();this.osc.start(when);this.notes.forEach(function(note,i){when=this.scheduleNote(i,when)}.bind(this));this.osc.stop(when);this.osc.onended=this.loop?this.play.bind(this,when):null;return this};Sequence.prototype.stop=function(){if(this.osc){this.osc.onended=null;this.osc.disconnect();this.osc=null}return this};exports.Note=Note;exports.Sequence=Sequence});